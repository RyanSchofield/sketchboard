var XQ=Object.defineProperty;var KQ=(n,e,t)=>e in n?XQ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var v=(n,e,t)=>KQ(n,typeof e!="symbol"?e+"":e,t);function YQ(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var gr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ul(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var PI={exports:{}},iv={},TI={exports:{}},Ze={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zp=Symbol.for("react.element"),ZQ=Symbol.for("react.portal"),JQ=Symbol.for("react.fragment"),eq=Symbol.for("react.strict_mode"),tq=Symbol.for("react.profiler"),nq=Symbol.for("react.provider"),rq=Symbol.for("react.context"),iq=Symbol.for("react.forward_ref"),sq=Symbol.for("react.suspense"),oq=Symbol.for("react.memo"),aq=Symbol.for("react.lazy"),kk=Symbol.iterator;function lq(n){return n===null||typeof n!="object"?null:(n=kk&&n[kk]||n["@@iterator"],typeof n=="function"?n:null)}var EI={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},II=Object.assign,MI={};function Hd(n,e,t){this.props=n,this.context=e,this.refs=MI,this.updater=t||EI}Hd.prototype.isReactComponent={};Hd.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Hd.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function AI(){}AI.prototype=Hd.prototype;function Y5(n,e,t){this.props=n,this.context=e,this.refs=MI,this.updater=t||EI}var Z5=Y5.prototype=new AI;Z5.constructor=Y5;II(Z5,Hd.prototype);Z5.isPureReactComponent=!0;var Ck=Array.isArray,_I=Object.prototype.hasOwnProperty,J5={current:null},RI={key:!0,ref:!0,__self:!0,__source:!0};function DI(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)_I.call(e,r)&&!RI.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:zp,type:n,key:s,ref:o,props:i,_owner:J5.current}}function cq(n,e){return{$$typeof:zp,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function e3(n){return typeof n=="object"&&n!==null&&n.$$typeof===zp}function uq(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Pk=/\/+/g;function QS(n,e){return typeof n=="object"&&n!==null&&n.key!=null?uq(""+n.key):e.toString(36)}function um(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case zp:case ZQ:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+QS(o,0):r,Ck(i)?(t="",n!=null&&(t=n.replace(Pk,"$&/")+"/"),um(i,e,t,"",function(c){return c})):i!=null&&(e3(i)&&(i=cq(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Pk,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Ck(n))for(var a=0;a<n.length;a++){s=n[a];var l=r+QS(s,a);o+=um(s,e,t,l,i)}else if(l=lq(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=r+QS(s,a++),o+=um(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function M0(n,e,t){if(n==null)return n;var r=[],i=0;return um(n,r,"","",function(s){return e.call(t,s,i++)}),r}function dq(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Mr={current:null},dm={transition:null},hq={ReactCurrentDispatcher:Mr,ReactCurrentBatchConfig:dm,ReactCurrentOwner:J5};function jI(){throw Error("act(...) is not supported in production builds of React.")}Ze.Children={map:M0,forEach:function(n,e,t){M0(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return M0(n,function(){e++}),e},toArray:function(n){return M0(n,function(e){return e})||[]},only:function(n){if(!e3(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Ze.Component=Hd;Ze.Fragment=JQ;Ze.Profiler=tq;Ze.PureComponent=Y5;Ze.StrictMode=eq;Ze.Suspense=sq;Ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hq;Ze.act=jI;Ze.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=II({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=J5.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)_I.call(e,l)&&!RI.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:zp,type:n.type,key:i,ref:s,props:r,_owner:o}};Ze.createContext=function(n){return n={$$typeof:rq,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:nq,_context:n},n.Consumer=n};Ze.createElement=DI;Ze.createFactory=function(n){var e=DI.bind(null,n);return e.type=n,e};Ze.createRef=function(){return{current:null}};Ze.forwardRef=function(n){return{$$typeof:iq,render:n}};Ze.isValidElement=e3;Ze.lazy=function(n){return{$$typeof:aq,_payload:{_status:-1,_result:n},_init:dq}};Ze.memo=function(n,e){return{$$typeof:oq,type:n,compare:e===void 0?null:e}};Ze.startTransition=function(n){var e=dm.transition;dm.transition={};try{n()}finally{dm.transition=e}};Ze.unstable_act=jI;Ze.useCallback=function(n,e){return Mr.current.useCallback(n,e)};Ze.useContext=function(n){return Mr.current.useContext(n)};Ze.useDebugValue=function(){};Ze.useDeferredValue=function(n){return Mr.current.useDeferredValue(n)};Ze.useEffect=function(n,e){return Mr.current.useEffect(n,e)};Ze.useId=function(){return Mr.current.useId()};Ze.useImperativeHandle=function(n,e,t){return Mr.current.useImperativeHandle(n,e,t)};Ze.useInsertionEffect=function(n,e){return Mr.current.useInsertionEffect(n,e)};Ze.useLayoutEffect=function(n,e){return Mr.current.useLayoutEffect(n,e)};Ze.useMemo=function(n,e){return Mr.current.useMemo(n,e)};Ze.useReducer=function(n,e,t){return Mr.current.useReducer(n,e,t)};Ze.useRef=function(n){return Mr.current.useRef(n)};Ze.useState=function(n){return Mr.current.useState(n)};Ze.useSyncExternalStore=function(n,e,t){return Mr.current.useSyncExternalStore(n,e,t)};Ze.useTransition=function(){return Mr.current.useTransition()};Ze.version="18.3.1";TI.exports=Ze;var k=TI.exports;const Qe=Ul(k),fq=YQ({__proto__:null,default:Qe},[k]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pq=k,gq=Symbol.for("react.element"),mq=Symbol.for("react.fragment"),yq=Object.prototype.hasOwnProperty,vq=pq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Sq={key:!0,ref:!0,__self:!0,__source:!0};function LI(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)yq.call(e,r)&&!Sq.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:gq,type:n,key:s,ref:o,props:i,_owner:vq.current}}iv.Fragment=mq;iv.jsx=LI;iv.jsxs=LI;PI.exports=iv;var f=PI.exports,Bw={},zI={exports:{}},_i={},NI={exports:{}},$I={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(W,J){var ne=W.length;W.push(J);e:for(;0<ne;){var le=ne-1>>>1,ue=W[le];if(0<i(ue,J))W[le]=J,W[ne]=ue,ne=le;else break e}}function t(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var J=W[0],ne=W.pop();if(ne!==J){W[0]=ne;e:for(var le=0,ue=W.length,Pe=ue>>>1;le<Pe;){var je=2*(le+1)-1,he=W[je],et=je+1,Ue=W[et];if(0>i(he,ne))et<ue&&0>i(Ue,he)?(W[le]=Ue,W[et]=ne,le=et):(W[le]=he,W[je]=ne,le=je);else if(et<ue&&0>i(Ue,ne))W[le]=Ue,W[et]=ne,le=et;else break e}}return J}function i(W,J){var ne=W.sortIndex-J.sortIndex;return ne!==0?ne:W.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,p=!1,g=!1,m=!1,S=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(W){for(var J=t(c);J!==null;){if(J.callback===null)r(c);else if(J.startTime<=W)r(c),J.sortIndex=J.expirationTime,e(l,J);else break;J=t(c)}}function O(W){if(m=!1,w(W),!g)if(t(l)!==null)g=!0,Y(T);else{var J=t(c);J!==null&&V(O,J.startTime-W)}}function T(W,J){g=!1,m&&(m=!1,y(M),M=-1),p=!0;var ne=h;try{for(w(J),d=t(l);d!==null&&(!(d.expirationTime>J)||W&&!N());){var le=d.callback;if(typeof le=="function"){d.callback=null,h=d.priorityLevel;var ue=le(d.expirationTime<=J);J=n.unstable_now(),typeof ue=="function"?d.callback=ue:d===t(l)&&r(l),w(J)}else r(l);d=t(l)}if(d!==null)var Pe=!0;else{var je=t(c);je!==null&&V(O,je.startTime-J),Pe=!1}return Pe}finally{d=null,h=ne,p=!1}}var E=!1,C=null,M=-1,A=5,D=-1;function N(){return!(n.unstable_now()-D<A)}function F(){if(C!==null){var W=n.unstable_now();D=W;var J=!0;try{J=C(!0,W)}finally{J?j():(E=!1,C=null)}}else E=!1}var j;if(typeof x=="function")j=function(){x(F)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,U=L.port2;L.port1.onmessage=F,j=function(){U.postMessage(null)}}else j=function(){S(F,0)};function Y(W){C=W,E||(E=!0,j())}function V(W,J){M=S(function(){W(n.unstable_now())},J)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(W){W.callback=null},n.unstable_continueExecution=function(){g||p||(g=!0,Y(T))},n.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<W?Math.floor(1e3/W):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(W){switch(h){case 1:case 2:case 3:var J=3;break;default:J=h}var ne=h;h=J;try{return W()}finally{h=ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(W,J){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var ne=h;h=W;try{return J()}finally{h=ne}},n.unstable_scheduleCallback=function(W,J,ne){var le=n.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?le+ne:le):ne=le,W){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=ne+ue,W={id:u++,callback:J,priorityLevel:W,startTime:ne,expirationTime:ue,sortIndex:-1},ne>le?(W.sortIndex=ne,e(c,W),t(l)===null&&W===t(c)&&(m?(y(M),M=-1):m=!0,V(O,ne-le))):(W.sortIndex=ue,e(l,W),g||p||(g=!0,Y(T))),W},n.unstable_shouldYield=N,n.unstable_wrapCallback=function(W){var J=h;return function(){var ne=h;h=J;try{return W.apply(this,arguments)}finally{h=ne}}}})($I);NI.exports=$I;var xq=NI.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wq=k,Ii=xq;function ae(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var FI=new Set,Bf={};function ru(n,e){vd(n,e),vd(n+"Capture",e)}function vd(n,e){for(Bf[n]=e,n=0;n<e.length;n++)FI.add(e[n])}var ya=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Uw=Object.prototype.hasOwnProperty,bq=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Tk={},Ek={};function Oq(n){return Uw.call(Ek,n)?!0:Uw.call(Tk,n)?!1:bq.test(n)?Ek[n]=!0:(Tk[n]=!0,!1)}function kq(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Cq(n,e,t,r){if(e===null||typeof e>"u"||kq(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ar(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Zn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Zn[n]=new Ar(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Zn[e]=new Ar(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Zn[n]=new Ar(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Zn[n]=new Ar(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Zn[n]=new Ar(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Zn[n]=new Ar(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Zn[n]=new Ar(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Zn[n]=new Ar(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Zn[n]=new Ar(n,5,!1,n.toLowerCase(),null,!1,!1)});var t3=/[\-:]([a-z])/g;function n3(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(t3,n3);Zn[e]=new Ar(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(t3,n3);Zn[e]=new Ar(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(t3,n3);Zn[e]=new Ar(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Zn[n]=new Ar(n,1,!1,n.toLowerCase(),null,!1,!1)});Zn.xlinkHref=new Ar("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Zn[n]=new Ar(n,1,!1,n.toLowerCase(),null,!0,!0)});function r3(n,e,t,r){var i=Zn.hasOwnProperty(e)?Zn[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Cq(e,t,i,r)&&(t=null),r||i===null?Oq(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Ma=wq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A0=Symbol.for("react.element"),Mu=Symbol.for("react.portal"),Au=Symbol.for("react.fragment"),i3=Symbol.for("react.strict_mode"),Hw=Symbol.for("react.profiler"),BI=Symbol.for("react.provider"),UI=Symbol.for("react.context"),s3=Symbol.for("react.forward_ref"),Qw=Symbol.for("react.suspense"),qw=Symbol.for("react.suspense_list"),o3=Symbol.for("react.memo"),Ka=Symbol.for("react.lazy"),HI=Symbol.for("react.offscreen"),Ik=Symbol.iterator;function fh(n){return n===null||typeof n!="object"?null:(n=Ik&&n[Ik]||n["@@iterator"],typeof n=="function"?n:null)}var en=Object.assign,qS;function Qh(n){if(qS===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);qS=e&&e[1]||""}return`
`+qS+n}var WS=!1;function VS(n,e){if(!n||WS)return"";WS=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{WS=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Qh(n):""}function Pq(n){switch(n.tag){case 5:return Qh(n.type);case 16:return Qh("Lazy");case 13:return Qh("Suspense");case 19:return Qh("SuspenseList");case 0:case 2:case 15:return n=VS(n.type,!1),n;case 11:return n=VS(n.type.render,!1),n;case 1:return n=VS(n.type,!0),n;default:return""}}function Ww(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Au:return"Fragment";case Mu:return"Portal";case Hw:return"Profiler";case i3:return"StrictMode";case Qw:return"Suspense";case qw:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case UI:return(n.displayName||"Context")+".Consumer";case BI:return(n._context.displayName||"Context")+".Provider";case s3:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case o3:return e=n.displayName||null,e!==null?e:Ww(n.type)||"Memo";case Ka:e=n._payload,n=n._init;try{return Ww(n(e))}catch{}}return null}function Tq(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ww(e);case 8:return e===i3?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Cl(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function QI(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Eq(n){var e=QI(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function _0(n){n._valueTracker||(n._valueTracker=Eq(n))}function qI(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=QI(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function v1(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Vw(n,e){var t=e.checked;return en({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Mk(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Cl(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function WI(n,e){e=e.checked,e!=null&&r3(n,"checked",e,!1)}function Gw(n,e){WI(n,e);var t=Cl(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Xw(n,e.type,t):e.hasOwnProperty("defaultValue")&&Xw(n,e.type,Cl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Ak(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Xw(n,e,t){(e!=="number"||v1(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var qh=Array.isArray;function ed(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Cl(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Kw(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ae(91));return en({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function _k(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ae(92));if(qh(t)){if(1<t.length)throw Error(ae(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Cl(t)}}function VI(n,e){var t=Cl(e.value),r=Cl(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function Rk(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function GI(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yw(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?GI(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var R0,XI=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(R0=R0||document.createElement("div"),R0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=R0.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Uf(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var vf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Iq=["Webkit","ms","Moz","O"];Object.keys(vf).forEach(function(n){Iq.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),vf[e]=vf[n]})});function KI(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||vf.hasOwnProperty(n)&&vf[n]?(""+e).trim():e+"px"}function YI(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=KI(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var Mq=en({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zw(n,e){if(e){if(Mq[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ae(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ae(62))}}function Jw(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var eb=null;function a3(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var tb=null,td=null,nd=null;function Dk(n){if(n=Fp(n)){if(typeof tb!="function")throw Error(ae(280));var e=n.stateNode;e&&(e=cv(e),tb(n.stateNode,n.type,e))}}function ZI(n){td?nd?nd.push(n):nd=[n]:td=n}function JI(){if(td){var n=td,e=nd;if(nd=td=null,Dk(n),e)for(n=0;n<e.length;n++)Dk(e[n])}}function eM(n,e){return n(e)}function tM(){}var GS=!1;function nM(n,e,t){if(GS)return n(e,t);GS=!0;try{return eM(n,e,t)}finally{GS=!1,(td!==null||nd!==null)&&(tM(),JI())}}function Hf(n,e){var t=n.stateNode;if(t===null)return null;var r=cv(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(ae(231,e,typeof t));return t}var nb=!1;if(ya)try{var ph={};Object.defineProperty(ph,"passive",{get:function(){nb=!0}}),window.addEventListener("test",ph,ph),window.removeEventListener("test",ph,ph)}catch{nb=!1}function Aq(n,e,t,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var Sf=!1,S1=null,x1=!1,rb=null,_q={onError:function(n){Sf=!0,S1=n}};function Rq(n,e,t,r,i,s,o,a,l){Sf=!1,S1=null,Aq.apply(_q,arguments)}function Dq(n,e,t,r,i,s,o,a,l){if(Rq.apply(this,arguments),Sf){if(Sf){var c=S1;Sf=!1,S1=null}else throw Error(ae(198));x1||(x1=!0,rb=c)}}function iu(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function rM(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function jk(n){if(iu(n)!==n)throw Error(ae(188))}function jq(n){var e=n.alternate;if(!e){if(e=iu(n),e===null)throw Error(ae(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return jk(i),n;if(s===r)return jk(i),e;s=s.sibling}throw Error(ae(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error(ae(189))}}if(t.alternate!==r)throw Error(ae(190))}if(t.tag!==3)throw Error(ae(188));return t.stateNode.current===t?n:e}function iM(n){return n=jq(n),n!==null?sM(n):null}function sM(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=sM(n);if(e!==null)return e;n=n.sibling}return null}var oM=Ii.unstable_scheduleCallback,Lk=Ii.unstable_cancelCallback,Lq=Ii.unstable_shouldYield,zq=Ii.unstable_requestPaint,cn=Ii.unstable_now,Nq=Ii.unstable_getCurrentPriorityLevel,l3=Ii.unstable_ImmediatePriority,aM=Ii.unstable_UserBlockingPriority,w1=Ii.unstable_NormalPriority,$q=Ii.unstable_LowPriority,lM=Ii.unstable_IdlePriority,sv=null,yo=null;function Fq(n){if(yo&&typeof yo.onCommitFiberRoot=="function")try{yo.onCommitFiberRoot(sv,n,void 0,(n.current.flags&128)===128)}catch{}}var Ps=Math.clz32?Math.clz32:Hq,Bq=Math.log,Uq=Math.LN2;function Hq(n){return n>>>=0,n===0?32:31-(Bq(n)/Uq|0)|0}var D0=64,j0=4194304;function Wh(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function b1(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?r=Wh(a):(s&=o,s!==0&&(r=Wh(s)))}else o=t&~i,o!==0?r=Wh(o):s!==0&&(r=Wh(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Ps(e),i=1<<t,r|=n[t],e&=~i;return r}function Qq(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qq(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-Ps(s),a=1<<o,l=i[o];l===-1?(!(a&t)||a&r)&&(i[o]=Qq(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function ib(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function cM(){var n=D0;return D0<<=1,!(D0&4194240)&&(D0=64),n}function XS(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Np(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Ps(e),n[e]=t}function Wq(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Ps(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function c3(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Ps(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var yt=0;function uM(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var dM,u3,hM,fM,pM,sb=!1,L0=[],fl=null,pl=null,gl=null,Qf=new Map,qf=new Map,el=[],Vq="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zk(n,e){switch(n){case"focusin":case"focusout":fl=null;break;case"dragenter":case"dragleave":pl=null;break;case"mouseover":case"mouseout":gl=null;break;case"pointerover":case"pointerout":Qf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":qf.delete(e.pointerId)}}function gh(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Fp(e),e!==null&&u3(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function Gq(n,e,t,r,i){switch(e){case"focusin":return fl=gh(fl,n,e,t,r,i),!0;case"dragenter":return pl=gh(pl,n,e,t,r,i),!0;case"mouseover":return gl=gh(gl,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return Qf.set(s,gh(Qf.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,qf.set(s,gh(qf.get(s)||null,n,e,t,r,i)),!0}return!1}function gM(n){var e=Sc(n.target);if(e!==null){var t=iu(e);if(t!==null){if(e=t.tag,e===13){if(e=rM(t),e!==null){n.blockedOn=e,pM(n.priority,function(){hM(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function hm(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=ob(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);eb=r,t.target.dispatchEvent(r),eb=null}else return e=Fp(t),e!==null&&u3(e),n.blockedOn=t,!1;e.shift()}return!0}function Nk(n,e,t){hm(n)&&t.delete(e)}function Xq(){sb=!1,fl!==null&&hm(fl)&&(fl=null),pl!==null&&hm(pl)&&(pl=null),gl!==null&&hm(gl)&&(gl=null),Qf.forEach(Nk),qf.forEach(Nk)}function mh(n,e){n.blockedOn===e&&(n.blockedOn=null,sb||(sb=!0,Ii.unstable_scheduleCallback(Ii.unstable_NormalPriority,Xq)))}function Wf(n){function e(i){return mh(i,n)}if(0<L0.length){mh(L0[0],n);for(var t=1;t<L0.length;t++){var r=L0[t];r.blockedOn===n&&(r.blockedOn=null)}}for(fl!==null&&mh(fl,n),pl!==null&&mh(pl,n),gl!==null&&mh(gl,n),Qf.forEach(e),qf.forEach(e),t=0;t<el.length;t++)r=el[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<el.length&&(t=el[0],t.blockedOn===null);)gM(t),t.blockedOn===null&&el.shift()}var rd=Ma.ReactCurrentBatchConfig,O1=!0;function Kq(n,e,t,r){var i=yt,s=rd.transition;rd.transition=null;try{yt=1,d3(n,e,t,r)}finally{yt=i,rd.transition=s}}function Yq(n,e,t,r){var i=yt,s=rd.transition;rd.transition=null;try{yt=4,d3(n,e,t,r)}finally{yt=i,rd.transition=s}}function d3(n,e,t,r){if(O1){var i=ob(n,e,t,r);if(i===null)sx(n,e,r,k1,t),zk(n,r);else if(Gq(i,n,e,t,r))r.stopPropagation();else if(zk(n,r),e&4&&-1<Vq.indexOf(n)){for(;i!==null;){var s=Fp(i);if(s!==null&&dM(s),s=ob(n,e,t,r),s===null&&sx(n,e,r,k1,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else sx(n,e,r,null,t)}}var k1=null;function ob(n,e,t,r){if(k1=null,n=a3(r),n=Sc(n),n!==null)if(e=iu(n),e===null)n=null;else if(t=e.tag,t===13){if(n=rM(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return k1=n,null}function mM(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Nq()){case l3:return 1;case aM:return 4;case w1:case $q:return 16;case lM:return 536870912;default:return 16}default:return 16}}var il=null,h3=null,fm=null;function yM(){if(fm)return fm;var n,e=h3,t=e.length,r,i="value"in il?il.value:il.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return fm=i.slice(n,1<r?1-r:void 0)}function pm(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function z0(){return!0}function $k(){return!1}function Ri(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?z0:$k,this.isPropagationStopped=$k,this}return en(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=z0)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=z0)},persist:function(){},isPersistent:z0}),e}var Qd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},f3=Ri(Qd),$p=en({},Qd,{view:0,detail:0}),Zq=Ri($p),KS,YS,yh,ov=en({},$p,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:p3,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==yh&&(yh&&n.type==="mousemove"?(KS=n.screenX-yh.screenX,YS=n.screenY-yh.screenY):YS=KS=0,yh=n),KS)},movementY:function(n){return"movementY"in n?n.movementY:YS}}),Fk=Ri(ov),Jq=en({},ov,{dataTransfer:0}),eW=Ri(Jq),tW=en({},$p,{relatedTarget:0}),ZS=Ri(tW),nW=en({},Qd,{animationName:0,elapsedTime:0,pseudoElement:0}),rW=Ri(nW),iW=en({},Qd,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),sW=Ri(iW),oW=en({},Qd,{data:0}),Bk=Ri(oW),aW={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lW={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cW={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uW(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=cW[n])?!!e[n]:!1}function p3(){return uW}var dW=en({},$p,{key:function(n){if(n.key){var e=aW[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=pm(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?lW[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:p3,charCode:function(n){return n.type==="keypress"?pm(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?pm(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),hW=Ri(dW),fW=en({},ov,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Uk=Ri(fW),pW=en({},$p,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:p3}),gW=Ri(pW),mW=en({},Qd,{propertyName:0,elapsedTime:0,pseudoElement:0}),yW=Ri(mW),vW=en({},ov,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),SW=Ri(vW),xW=[9,13,27,32],g3=ya&&"CompositionEvent"in window,xf=null;ya&&"documentMode"in document&&(xf=document.documentMode);var wW=ya&&"TextEvent"in window&&!xf,vM=ya&&(!g3||xf&&8<xf&&11>=xf),Hk=" ",Qk=!1;function SM(n,e){switch(n){case"keyup":return xW.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xM(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var _u=!1;function bW(n,e){switch(n){case"compositionend":return xM(e);case"keypress":return e.which!==32?null:(Qk=!0,Hk);case"textInput":return n=e.data,n===Hk&&Qk?null:n;default:return null}}function OW(n,e){if(_u)return n==="compositionend"||!g3&&SM(n,e)?(n=yM(),fm=h3=il=null,_u=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return vM&&e.locale!=="ko"?null:e.data;default:return null}}var kW={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qk(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!kW[n.type]:e==="textarea"}function wM(n,e,t,r){ZI(r),e=C1(e,"onChange"),0<e.length&&(t=new f3("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var wf=null,Vf=null;function CW(n){_M(n,0)}function av(n){var e=ju(n);if(qI(e))return n}function PW(n,e){if(n==="change")return e}var bM=!1;if(ya){var JS;if(ya){var ex="oninput"in document;if(!ex){var Wk=document.createElement("div");Wk.setAttribute("oninput","return;"),ex=typeof Wk.oninput=="function"}JS=ex}else JS=!1;bM=JS&&(!document.documentMode||9<document.documentMode)}function Vk(){wf&&(wf.detachEvent("onpropertychange",OM),Vf=wf=null)}function OM(n){if(n.propertyName==="value"&&av(Vf)){var e=[];wM(e,Vf,n,a3(n)),nM(CW,e)}}function TW(n,e,t){n==="focusin"?(Vk(),wf=e,Vf=t,wf.attachEvent("onpropertychange",OM)):n==="focusout"&&Vk()}function EW(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return av(Vf)}function IW(n,e){if(n==="click")return av(e)}function MW(n,e){if(n==="input"||n==="change")return av(e)}function AW(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Is=typeof Object.is=="function"?Object.is:AW;function Gf(n,e){if(Is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Uw.call(e,i)||!Is(n[i],e[i]))return!1}return!0}function Gk(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Xk(n,e){var t=Gk(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Gk(t)}}function kM(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?kM(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function CM(){for(var n=window,e=v1();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=v1(n.document)}return e}function m3(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function _W(n){var e=CM(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&kM(t.ownerDocument.documentElement,t)){if(r!==null&&m3(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=Xk(t,s);var o=Xk(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var RW=ya&&"documentMode"in document&&11>=document.documentMode,Ru=null,ab=null,bf=null,lb=!1;function Kk(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;lb||Ru==null||Ru!==v1(r)||(r=Ru,"selectionStart"in r&&m3(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),bf&&Gf(bf,r)||(bf=r,r=C1(ab,"onSelect"),0<r.length&&(e=new f3("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Ru)))}function N0(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Du={animationend:N0("Animation","AnimationEnd"),animationiteration:N0("Animation","AnimationIteration"),animationstart:N0("Animation","AnimationStart"),transitionend:N0("Transition","TransitionEnd")},tx={},PM={};ya&&(PM=document.createElement("div").style,"AnimationEvent"in window||(delete Du.animationend.animation,delete Du.animationiteration.animation,delete Du.animationstart.animation),"TransitionEvent"in window||delete Du.transitionend.transition);function lv(n){if(tx[n])return tx[n];if(!Du[n])return n;var e=Du[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in PM)return tx[n]=e[t];return n}var TM=lv("animationend"),EM=lv("animationiteration"),IM=lv("animationstart"),MM=lv("transitionend"),AM=new Map,Yk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Hl(n,e){AM.set(n,e),ru(e,[n])}for(var nx=0;nx<Yk.length;nx++){var rx=Yk[nx],DW=rx.toLowerCase(),jW=rx[0].toUpperCase()+rx.slice(1);Hl(DW,"on"+jW)}Hl(TM,"onAnimationEnd");Hl(EM,"onAnimationIteration");Hl(IM,"onAnimationStart");Hl("dblclick","onDoubleClick");Hl("focusin","onFocus");Hl("focusout","onBlur");Hl(MM,"onTransitionEnd");vd("onMouseEnter",["mouseout","mouseover"]);vd("onMouseLeave",["mouseout","mouseover"]);vd("onPointerEnter",["pointerout","pointerover"]);vd("onPointerLeave",["pointerout","pointerover"]);ru("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ru("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ru("onBeforeInput",["compositionend","keypress","textInput","paste"]);ru("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ru("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ru("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),LW=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vh));function Zk(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,Dq(r,e,void 0,n),n.currentTarget=null}function _M(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Zk(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Zk(i,a,c),s=l}}}if(x1)throw n=rb,x1=!1,rb=null,n}function jt(n,e){var t=e[fb];t===void 0&&(t=e[fb]=new Set);var r=n+"__bubble";t.has(r)||(RM(e,n,2,!1),t.add(r))}function ix(n,e,t){var r=0;e&&(r|=4),RM(t,n,r,e)}var $0="_reactListening"+Math.random().toString(36).slice(2);function Xf(n){if(!n[$0]){n[$0]=!0,FI.forEach(function(t){t!=="selectionchange"&&(LW.has(t)||ix(t,!1,n),ix(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[$0]||(e[$0]=!0,ix("selectionchange",!1,e))}}function RM(n,e,t,r){switch(mM(e)){case 1:var i=Kq;break;case 4:i=Yq;break;default:i=d3}t=i.bind(null,e,t,n),i=void 0,!nb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function sx(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Sc(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}nM(function(){var c=s,u=a3(t),d=[];e:{var h=AM.get(n);if(h!==void 0){var p=f3,g=n;switch(n){case"keypress":if(pm(t)===0)break e;case"keydown":case"keyup":p=hW;break;case"focusin":g="focus",p=ZS;break;case"focusout":g="blur",p=ZS;break;case"beforeblur":case"afterblur":p=ZS;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Fk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=eW;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=gW;break;case TM:case EM:case IM:p=rW;break;case MM:p=yW;break;case"scroll":p=Zq;break;case"wheel":p=SW;break;case"copy":case"cut":case"paste":p=sW;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Uk}var m=(e&4)!==0,S=!m&&n==="scroll",y=m?h!==null?h+"Capture":null:h;m=[];for(var x=c,w;x!==null;){w=x;var O=w.stateNode;if(w.tag===5&&O!==null&&(w=O,y!==null&&(O=Hf(x,y),O!=null&&m.push(Kf(x,O,w)))),S)break;x=x.return}0<m.length&&(h=new p(h,g,null,t,u),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",h&&t!==eb&&(g=t.relatedTarget||t.fromElement)&&(Sc(g)||g[va]))break e;if((p||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,p?(g=t.relatedTarget||t.toElement,p=c,g=g?Sc(g):null,g!==null&&(S=iu(g),g!==S||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=c),p!==g)){if(m=Fk,O="onMouseLeave",y="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(m=Uk,O="onPointerLeave",y="onPointerEnter",x="pointer"),S=p==null?h:ju(p),w=g==null?h:ju(g),h=new m(O,x+"leave",p,t,u),h.target=S,h.relatedTarget=w,O=null,Sc(u)===c&&(m=new m(y,x+"enter",g,t,u),m.target=w,m.relatedTarget=S,O=m),S=O,p&&g)t:{for(m=p,y=g,x=0,w=m;w;w=fu(w))x++;for(w=0,O=y;O;O=fu(O))w++;for(;0<x-w;)m=fu(m),x--;for(;0<w-x;)y=fu(y),w--;for(;x--;){if(m===y||y!==null&&m===y.alternate)break t;m=fu(m),y=fu(y)}m=null}else m=null;p!==null&&Jk(d,h,p,m,!1),g!==null&&S!==null&&Jk(d,S,g,m,!0)}}e:{if(h=c?ju(c):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var T=PW;else if(qk(h))if(bM)T=MW;else{T=EW;var E=TW}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(T=IW);if(T&&(T=T(n,c))){wM(d,T,t,u);break e}E&&E(n,h,c),n==="focusout"&&(E=h._wrapperState)&&E.controlled&&h.type==="number"&&Xw(h,"number",h.value)}switch(E=c?ju(c):window,n){case"focusin":(qk(E)||E.contentEditable==="true")&&(Ru=E,ab=c,bf=null);break;case"focusout":bf=ab=Ru=null;break;case"mousedown":lb=!0;break;case"contextmenu":case"mouseup":case"dragend":lb=!1,Kk(d,t,u);break;case"selectionchange":if(RW)break;case"keydown":case"keyup":Kk(d,t,u)}var C;if(g3)e:{switch(n){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else _u?SM(n,t)&&(M="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(M="onCompositionStart");M&&(vM&&t.locale!=="ko"&&(_u||M!=="onCompositionStart"?M==="onCompositionEnd"&&_u&&(C=yM()):(il=u,h3="value"in il?il.value:il.textContent,_u=!0)),E=C1(c,M),0<E.length&&(M=new Bk(M,n,null,t,u),d.push({event:M,listeners:E}),C?M.data=C:(C=xM(t),C!==null&&(M.data=C)))),(C=wW?bW(n,t):OW(n,t))&&(c=C1(c,"onBeforeInput"),0<c.length&&(u=new Bk("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=C))}_M(d,e)})}function Kf(n,e,t){return{instance:n,listener:e,currentTarget:t}}function C1(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Hf(n,t),s!=null&&r.unshift(Kf(n,s,i)),s=Hf(n,e),s!=null&&r.push(Kf(n,s,i))),n=n.return}return r}function fu(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Jk(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Hf(t,s),l!=null&&o.unshift(Kf(t,l,a))):i||(l=Hf(t,s),l!=null&&o.push(Kf(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var zW=/\r\n?/g,NW=/\u0000|\uFFFD/g;function e8(n){return(typeof n=="string"?n:""+n).replace(zW,`
`).replace(NW,"")}function F0(n,e,t){if(e=e8(e),e8(n)!==e&&t)throw Error(ae(425))}function P1(){}var cb=null,ub=null;function db(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var hb=typeof setTimeout=="function"?setTimeout:void 0,$W=typeof clearTimeout=="function"?clearTimeout:void 0,t8=typeof Promise=="function"?Promise:void 0,FW=typeof queueMicrotask=="function"?queueMicrotask:typeof t8<"u"?function(n){return t8.resolve(null).then(n).catch(BW)}:hb;function BW(n){setTimeout(function(){throw n})}function ox(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Wf(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Wf(e)}function ml(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function n8(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var qd=Math.random().toString(36).slice(2),no="__reactFiber$"+qd,Yf="__reactProps$"+qd,va="__reactContainer$"+qd,fb="__reactEvents$"+qd,UW="__reactListeners$"+qd,HW="__reactHandles$"+qd;function Sc(n){var e=n[no];if(e)return e;for(var t=n.parentNode;t;){if(e=t[va]||t[no]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=n8(n);n!==null;){if(t=n[no])return t;n=n8(n)}return e}n=t,t=n.parentNode}return null}function Fp(n){return n=n[no]||n[va],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ju(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ae(33))}function cv(n){return n[Yf]||null}var pb=[],Lu=-1;function Ql(n){return{current:n}}function $t(n){0>Lu||(n.current=pb[Lu],pb[Lu]=null,Lu--)}function Et(n,e){Lu++,pb[Lu]=n.current,n.current=e}var Pl={},mr=Ql(Pl),ti=Ql(!1),_c=Pl;function Sd(n,e){var t=n.type.contextTypes;if(!t)return Pl;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function ni(n){return n=n.childContextTypes,n!=null}function T1(){$t(ti),$t(mr)}function r8(n,e,t){if(mr.current!==Pl)throw Error(ae(168));Et(mr,e),Et(ti,t)}function DM(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(ae(108,Tq(n)||"Unknown",i));return en({},t,r)}function E1(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Pl,_c=mr.current,Et(mr,n),Et(ti,ti.current),!0}function i8(n,e,t){var r=n.stateNode;if(!r)throw Error(ae(169));t?(n=DM(n,e,_c),r.__reactInternalMemoizedMergedChildContext=n,$t(ti),$t(mr),Et(mr,n)):$t(ti),Et(ti,t)}var Zo=null,uv=!1,ax=!1;function jM(n){Zo===null?Zo=[n]:Zo.push(n)}function QW(n){uv=!0,jM(n)}function ql(){if(!ax&&Zo!==null){ax=!0;var n=0,e=yt;try{var t=Zo;for(yt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Zo=null,uv=!1}catch(i){throw Zo!==null&&(Zo=Zo.slice(n+1)),oM(l3,ql),i}finally{yt=e,ax=!1}}return null}var zu=[],Nu=0,I1=null,M1=0,Ui=[],Hi=0,Rc=null,ia=1,sa="";function pc(n,e){zu[Nu++]=M1,zu[Nu++]=I1,I1=n,M1=e}function LM(n,e,t){Ui[Hi++]=ia,Ui[Hi++]=sa,Ui[Hi++]=Rc,Rc=n;var r=ia;n=sa;var i=32-Ps(r)-1;r&=~(1<<i),t+=1;var s=32-Ps(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,ia=1<<32-Ps(e)+i|t<<i|r,sa=s+n}else ia=1<<s|t<<i|r,sa=n}function y3(n){n.return!==null&&(pc(n,1),LM(n,1,0))}function v3(n){for(;n===I1;)I1=zu[--Nu],zu[Nu]=null,M1=zu[--Nu],zu[Nu]=null;for(;n===Rc;)Rc=Ui[--Hi],Ui[Hi]=null,sa=Ui[--Hi],Ui[Hi]=null,ia=Ui[--Hi],Ui[Hi]=null}var Oi=null,bi=null,Ht=!1,xs=null;function zM(n,e){var t=Vi(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function s8(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Oi=n,bi=ml(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Oi=n,bi=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Rc!==null?{id:ia,overflow:sa}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Vi(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Oi=n,bi=null,!0):!1;default:return!1}}function gb(n){return(n.mode&1)!==0&&(n.flags&128)===0}function mb(n){if(Ht){var e=bi;if(e){var t=e;if(!s8(n,e)){if(gb(n))throw Error(ae(418));e=ml(t.nextSibling);var r=Oi;e&&s8(n,e)?zM(r,t):(n.flags=n.flags&-4097|2,Ht=!1,Oi=n)}}else{if(gb(n))throw Error(ae(418));n.flags=n.flags&-4097|2,Ht=!1,Oi=n}}}function o8(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Oi=n}function B0(n){if(n!==Oi)return!1;if(!Ht)return o8(n),Ht=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!db(n.type,n.memoizedProps)),e&&(e=bi)){if(gb(n))throw NM(),Error(ae(418));for(;e;)zM(n,e),e=ml(e.nextSibling)}if(o8(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ae(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){bi=ml(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}bi=null}}else bi=Oi?ml(n.stateNode.nextSibling):null;return!0}function NM(){for(var n=bi;n;)n=ml(n.nextSibling)}function xd(){bi=Oi=null,Ht=!1}function S3(n){xs===null?xs=[n]:xs.push(n)}var qW=Ma.ReactCurrentBatchConfig;function vh(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ae(309));var r=t.stateNode}if(!r)throw Error(ae(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(ae(284));if(!t._owner)throw Error(ae(290,n))}return n}function U0(n,e){throw n=Object.prototype.toString.call(e),Error(ae(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function a8(n){var e=n._init;return e(n._payload)}function $M(n){function e(y,x){if(n){var w=y.deletions;w===null?(y.deletions=[x],y.flags|=16):w.push(x)}}function t(y,x){if(!n)return null;for(;x!==null;)e(y,x),x=x.sibling;return null}function r(y,x){for(y=new Map;x!==null;)x.key!==null?y.set(x.key,x):y.set(x.index,x),x=x.sibling;return y}function i(y,x){return y=xl(y,x),y.index=0,y.sibling=null,y}function s(y,x,w){return y.index=w,n?(w=y.alternate,w!==null?(w=w.index,w<x?(y.flags|=2,x):w):(y.flags|=2,x)):(y.flags|=1048576,x)}function o(y){return n&&y.alternate===null&&(y.flags|=2),y}function a(y,x,w,O){return x===null||x.tag!==6?(x=px(w,y.mode,O),x.return=y,x):(x=i(x,w),x.return=y,x)}function l(y,x,w,O){var T=w.type;return T===Au?u(y,x,w.props.children,O,w.key):x!==null&&(x.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Ka&&a8(T)===x.type)?(O=i(x,w.props),O.ref=vh(y,x,w),O.return=y,O):(O=wm(w.type,w.key,w.props,null,y.mode,O),O.ref=vh(y,x,w),O.return=y,O)}function c(y,x,w,O){return x===null||x.tag!==4||x.stateNode.containerInfo!==w.containerInfo||x.stateNode.implementation!==w.implementation?(x=gx(w,y.mode,O),x.return=y,x):(x=i(x,w.children||[]),x.return=y,x)}function u(y,x,w,O,T){return x===null||x.tag!==7?(x=Tc(w,y.mode,O,T),x.return=y,x):(x=i(x,w),x.return=y,x)}function d(y,x,w){if(typeof x=="string"&&x!==""||typeof x=="number")return x=px(""+x,y.mode,w),x.return=y,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case A0:return w=wm(x.type,x.key,x.props,null,y.mode,w),w.ref=vh(y,null,x),w.return=y,w;case Mu:return x=gx(x,y.mode,w),x.return=y,x;case Ka:var O=x._init;return d(y,O(x._payload),w)}if(qh(x)||fh(x))return x=Tc(x,y.mode,w,null),x.return=y,x;U0(y,x)}return null}function h(y,x,w,O){var T=x!==null?x.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return T!==null?null:a(y,x,""+w,O);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case A0:return w.key===T?l(y,x,w,O):null;case Mu:return w.key===T?c(y,x,w,O):null;case Ka:return T=w._init,h(y,x,T(w._payload),O)}if(qh(w)||fh(w))return T!==null?null:u(y,x,w,O,null);U0(y,w)}return null}function p(y,x,w,O,T){if(typeof O=="string"&&O!==""||typeof O=="number")return y=y.get(w)||null,a(x,y,""+O,T);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case A0:return y=y.get(O.key===null?w:O.key)||null,l(x,y,O,T);case Mu:return y=y.get(O.key===null?w:O.key)||null,c(x,y,O,T);case Ka:var E=O._init;return p(y,x,w,E(O._payload),T)}if(qh(O)||fh(O))return y=y.get(w)||null,u(x,y,O,T,null);U0(x,O)}return null}function g(y,x,w,O){for(var T=null,E=null,C=x,M=x=0,A=null;C!==null&&M<w.length;M++){C.index>M?(A=C,C=null):A=C.sibling;var D=h(y,C,w[M],O);if(D===null){C===null&&(C=A);break}n&&C&&D.alternate===null&&e(y,C),x=s(D,x,M),E===null?T=D:E.sibling=D,E=D,C=A}if(M===w.length)return t(y,C),Ht&&pc(y,M),T;if(C===null){for(;M<w.length;M++)C=d(y,w[M],O),C!==null&&(x=s(C,x,M),E===null?T=C:E.sibling=C,E=C);return Ht&&pc(y,M),T}for(C=r(y,C);M<w.length;M++)A=p(C,y,M,w[M],O),A!==null&&(n&&A.alternate!==null&&C.delete(A.key===null?M:A.key),x=s(A,x,M),E===null?T=A:E.sibling=A,E=A);return n&&C.forEach(function(N){return e(y,N)}),Ht&&pc(y,M),T}function m(y,x,w,O){var T=fh(w);if(typeof T!="function")throw Error(ae(150));if(w=T.call(w),w==null)throw Error(ae(151));for(var E=T=null,C=x,M=x=0,A=null,D=w.next();C!==null&&!D.done;M++,D=w.next()){C.index>M?(A=C,C=null):A=C.sibling;var N=h(y,C,D.value,O);if(N===null){C===null&&(C=A);break}n&&C&&N.alternate===null&&e(y,C),x=s(N,x,M),E===null?T=N:E.sibling=N,E=N,C=A}if(D.done)return t(y,C),Ht&&pc(y,M),T;if(C===null){for(;!D.done;M++,D=w.next())D=d(y,D.value,O),D!==null&&(x=s(D,x,M),E===null?T=D:E.sibling=D,E=D);return Ht&&pc(y,M),T}for(C=r(y,C);!D.done;M++,D=w.next())D=p(C,y,M,D.value,O),D!==null&&(n&&D.alternate!==null&&C.delete(D.key===null?M:D.key),x=s(D,x,M),E===null?T=D:E.sibling=D,E=D);return n&&C.forEach(function(F){return e(y,F)}),Ht&&pc(y,M),T}function S(y,x,w,O){if(typeof w=="object"&&w!==null&&w.type===Au&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case A0:e:{for(var T=w.key,E=x;E!==null;){if(E.key===T){if(T=w.type,T===Au){if(E.tag===7){t(y,E.sibling),x=i(E,w.props.children),x.return=y,y=x;break e}}else if(E.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Ka&&a8(T)===E.type){t(y,E.sibling),x=i(E,w.props),x.ref=vh(y,E,w),x.return=y,y=x;break e}t(y,E);break}else e(y,E);E=E.sibling}w.type===Au?(x=Tc(w.props.children,y.mode,O,w.key),x.return=y,y=x):(O=wm(w.type,w.key,w.props,null,y.mode,O),O.ref=vh(y,x,w),O.return=y,y=O)}return o(y);case Mu:e:{for(E=w.key;x!==null;){if(x.key===E)if(x.tag===4&&x.stateNode.containerInfo===w.containerInfo&&x.stateNode.implementation===w.implementation){t(y,x.sibling),x=i(x,w.children||[]),x.return=y,y=x;break e}else{t(y,x);break}else e(y,x);x=x.sibling}x=gx(w,y.mode,O),x.return=y,y=x}return o(y);case Ka:return E=w._init,S(y,x,E(w._payload),O)}if(qh(w))return g(y,x,w,O);if(fh(w))return m(y,x,w,O);U0(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,x!==null&&x.tag===6?(t(y,x.sibling),x=i(x,w),x.return=y,y=x):(t(y,x),x=px(w,y.mode,O),x.return=y,y=x),o(y)):t(y,x)}return S}var wd=$M(!0),FM=$M(!1),A1=Ql(null),_1=null,$u=null,x3=null;function w3(){x3=$u=_1=null}function b3(n){var e=A1.current;$t(A1),n._currentValue=e}function yb(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function id(n,e){_1=n,x3=$u=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Kr=!0),n.firstContext=null)}function rs(n){var e=n._currentValue;if(x3!==n)if(n={context:n,memoizedValue:e,next:null},$u===null){if(_1===null)throw Error(ae(308));$u=n,_1.dependencies={lanes:0,firstContext:n}}else $u=$u.next=n;return e}var xc=null;function O3(n){xc===null?xc=[n]:xc.push(n)}function BM(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,O3(e)):(t.next=i.next,i.next=t),e.interleaved=t,Sa(n,r)}function Sa(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Ya=!1;function k3(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function UM(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ca(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function yl(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ot&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Sa(n,t)}return i=r.interleaved,i===null?(e.next=e,O3(r)):(e.next=i.next,i.next=e),r.interleaved=e,Sa(n,t)}function gm(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,c3(n,t)}}function l8(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function R1(n,e,t,r){var i=n.updateQueue;Ya=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,p=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=n,m=a;switch(h=e,p=t,m.tag){case 1:if(g=m.payload,typeof g=="function"){d=g.call(p,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=m.payload,h=typeof g=="function"?g.call(p,d,h):g,h==null)break e;d=en({},d,h);break e;case 2:Ya=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=d):u=u.next=p,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(u===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);jc|=o,n.lanes=o,n.memoizedState=d}}function c8(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(ae(191,i));i.call(r)}}}var Bp={},vo=Ql(Bp),Zf=Ql(Bp),Jf=Ql(Bp);function wc(n){if(n===Bp)throw Error(ae(174));return n}function C3(n,e){switch(Et(Jf,e),Et(Zf,n),Et(vo,Bp),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Yw(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Yw(e,n)}$t(vo),Et(vo,e)}function bd(){$t(vo),$t(Zf),$t(Jf)}function HM(n){wc(Jf.current);var e=wc(vo.current),t=Yw(e,n.type);e!==t&&(Et(Zf,n),Et(vo,t))}function P3(n){Zf.current===n&&($t(vo),$t(Zf))}var Xt=Ql(0);function D1(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var lx=[];function T3(){for(var n=0;n<lx.length;n++)lx[n]._workInProgressVersionPrimary=null;lx.length=0}var mm=Ma.ReactCurrentDispatcher,cx=Ma.ReactCurrentBatchConfig,Dc=0,Jt=null,bn=null,_n=null,j1=!1,Of=!1,ep=0,WW=0;function rr(){throw Error(ae(321))}function E3(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Is(n[t],e[t]))return!1;return!0}function I3(n,e,t,r,i,s){if(Dc=s,Jt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,mm.current=n===null||n.memoizedState===null?KW:YW,n=t(r,i),Of){s=0;do{if(Of=!1,ep=0,25<=s)throw Error(ae(301));s+=1,_n=bn=null,e.updateQueue=null,mm.current=ZW,n=t(r,i)}while(Of)}if(mm.current=L1,e=bn!==null&&bn.next!==null,Dc=0,_n=bn=Jt=null,j1=!1,e)throw Error(ae(300));return n}function M3(){var n=ep!==0;return ep=0,n}function Zs(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _n===null?Jt.memoizedState=_n=n:_n=_n.next=n,_n}function is(){if(bn===null){var n=Jt.alternate;n=n!==null?n.memoizedState:null}else n=bn.next;var e=_n===null?Jt.memoizedState:_n.next;if(e!==null)_n=e,bn=n;else{if(n===null)throw Error(ae(310));bn=n,n={memoizedState:bn.memoizedState,baseState:bn.baseState,baseQueue:bn.baseQueue,queue:bn.queue,next:null},_n===null?Jt.memoizedState=_n=n:_n=_n.next=n}return _n}function tp(n,e){return typeof e=="function"?e(n):e}function ux(n){var e=is(),t=e.queue;if(t===null)throw Error(ae(311));t.lastRenderedReducer=n;var r=bn,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Dc&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,Jt.lanes|=u,jc|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,Is(r,e.memoizedState)||(Kr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,Jt.lanes|=s,jc|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function dx(n){var e=is(),t=e.queue;if(t===null)throw Error(ae(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);Is(s,e.memoizedState)||(Kr=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function QM(){}function qM(n,e){var t=Jt,r=is(),i=e(),s=!Is(r.memoizedState,i);if(s&&(r.memoizedState=i,Kr=!0),r=r.queue,A3(GM.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||_n!==null&&_n.memoizedState.tag&1){if(t.flags|=2048,np(9,VM.bind(null,t,r,i,e),void 0,null),jn===null)throw Error(ae(349));Dc&30||WM(t,e,i)}return i}function WM(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Jt.updateQueue,e===null?(e={lastEffect:null,stores:null},Jt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function VM(n,e,t,r){e.value=t,e.getSnapshot=r,XM(e)&&KM(n)}function GM(n,e,t){return t(function(){XM(e)&&KM(n)})}function XM(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Is(n,t)}catch{return!0}}function KM(n){var e=Sa(n,1);e!==null&&Ts(e,n,1,-1)}function u8(n){var e=Zs();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:tp,lastRenderedState:n},e.queue=n,n=n.dispatch=XW.bind(null,Jt,n),[e.memoizedState,n]}function np(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Jt.updateQueue,e===null?(e={lastEffect:null,stores:null},Jt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function YM(){return is().memoizedState}function ym(n,e,t,r){var i=Zs();Jt.flags|=n,i.memoizedState=np(1|e,t,void 0,r===void 0?null:r)}function dv(n,e,t,r){var i=is();r=r===void 0?null:r;var s=void 0;if(bn!==null){var o=bn.memoizedState;if(s=o.destroy,r!==null&&E3(r,o.deps)){i.memoizedState=np(e,t,s,r);return}}Jt.flags|=n,i.memoizedState=np(1|e,t,s,r)}function d8(n,e){return ym(8390656,8,n,e)}function A3(n,e){return dv(2048,8,n,e)}function ZM(n,e){return dv(4,2,n,e)}function JM(n,e){return dv(4,4,n,e)}function eA(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function tA(n,e,t){return t=t!=null?t.concat([n]):null,dv(4,4,eA.bind(null,e,n),t)}function _3(){}function nA(n,e){var t=is();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&E3(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function rA(n,e){var t=is();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&E3(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function iA(n,e,t){return Dc&21?(Is(t,e)||(t=cM(),Jt.lanes|=t,jc|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Kr=!0),n.memoizedState=t)}function VW(n,e){var t=yt;yt=t!==0&&4>t?t:4,n(!0);var r=cx.transition;cx.transition={};try{n(!1),e()}finally{yt=t,cx.transition=r}}function sA(){return is().memoizedState}function GW(n,e,t){var r=Sl(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},oA(n))aA(e,t);else if(t=BM(n,e,t,r),t!==null){var i=Er();Ts(t,n,r,i),lA(t,e,r)}}function XW(n,e,t){var r=Sl(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(oA(n))aA(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,Is(a,o)){var l=e.interleaved;l===null?(i.next=i,O3(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=BM(n,e,i,r),t!==null&&(i=Er(),Ts(t,n,r,i),lA(t,e,r))}}function oA(n){var e=n.alternate;return n===Jt||e!==null&&e===Jt}function aA(n,e){Of=j1=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function lA(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,c3(n,t)}}var L1={readContext:rs,useCallback:rr,useContext:rr,useEffect:rr,useImperativeHandle:rr,useInsertionEffect:rr,useLayoutEffect:rr,useMemo:rr,useReducer:rr,useRef:rr,useState:rr,useDebugValue:rr,useDeferredValue:rr,useTransition:rr,useMutableSource:rr,useSyncExternalStore:rr,useId:rr,unstable_isNewReconciler:!1},KW={readContext:rs,useCallback:function(n,e){return Zs().memoizedState=[n,e===void 0?null:e],n},useContext:rs,useEffect:d8,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,ym(4194308,4,eA.bind(null,e,n),t)},useLayoutEffect:function(n,e){return ym(4194308,4,n,e)},useInsertionEffect:function(n,e){return ym(4,2,n,e)},useMemo:function(n,e){var t=Zs();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Zs();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=GW.bind(null,Jt,n),[r.memoizedState,n]},useRef:function(n){var e=Zs();return n={current:n},e.memoizedState=n},useState:u8,useDebugValue:_3,useDeferredValue:function(n){return Zs().memoizedState=n},useTransition:function(){var n=u8(!1),e=n[0];return n=VW.bind(null,n[1]),Zs().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Jt,i=Zs();if(Ht){if(t===void 0)throw Error(ae(407));t=t()}else{if(t=e(),jn===null)throw Error(ae(349));Dc&30||WM(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,d8(GM.bind(null,r,s,n),[n]),r.flags|=2048,np(9,VM.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=Zs(),e=jn.identifierPrefix;if(Ht){var t=sa,r=ia;t=(r&~(1<<32-Ps(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=ep++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=WW++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},YW={readContext:rs,useCallback:nA,useContext:rs,useEffect:A3,useImperativeHandle:tA,useInsertionEffect:ZM,useLayoutEffect:JM,useMemo:rA,useReducer:ux,useRef:YM,useState:function(){return ux(tp)},useDebugValue:_3,useDeferredValue:function(n){var e=is();return iA(e,bn.memoizedState,n)},useTransition:function(){var n=ux(tp)[0],e=is().memoizedState;return[n,e]},useMutableSource:QM,useSyncExternalStore:qM,useId:sA,unstable_isNewReconciler:!1},ZW={readContext:rs,useCallback:nA,useContext:rs,useEffect:A3,useImperativeHandle:tA,useInsertionEffect:ZM,useLayoutEffect:JM,useMemo:rA,useReducer:dx,useRef:YM,useState:function(){return dx(tp)},useDebugValue:_3,useDeferredValue:function(n){var e=is();return bn===null?e.memoizedState=n:iA(e,bn.memoizedState,n)},useTransition:function(){var n=dx(tp)[0],e=is().memoizedState;return[n,e]},useMutableSource:QM,useSyncExternalStore:qM,useId:sA,unstable_isNewReconciler:!1};function ms(n,e){if(n&&n.defaultProps){e=en({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function vb(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:en({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var hv={isMounted:function(n){return(n=n._reactInternals)?iu(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Er(),i=Sl(n),s=ca(r,i);s.payload=e,t!=null&&(s.callback=t),e=yl(n,s,i),e!==null&&(Ts(e,n,i,r),gm(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Er(),i=Sl(n),s=ca(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=yl(n,s,i),e!==null&&(Ts(e,n,i,r),gm(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Er(),r=Sl(n),i=ca(t,r);i.tag=2,e!=null&&(i.callback=e),e=yl(n,i,r),e!==null&&(Ts(e,n,r,t),gm(e,n,r))}};function h8(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Gf(t,r)||!Gf(i,s):!0}function cA(n,e,t){var r=!1,i=Pl,s=e.contextType;return typeof s=="object"&&s!==null?s=rs(s):(i=ni(e)?_c:mr.current,r=e.contextTypes,s=(r=r!=null)?Sd(n,i):Pl),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=hv,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function f8(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&hv.enqueueReplaceState(e,e.state,null)}function Sb(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},k3(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=rs(s):(s=ni(e)?_c:mr.current,i.context=Sd(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(vb(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&hv.enqueueReplaceState(i,i.state,null),R1(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Od(n,e){try{var t="",r=e;do t+=Pq(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function hx(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function xb(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var JW=typeof WeakMap=="function"?WeakMap:Map;function uA(n,e,t){t=ca(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){N1||(N1=!0,Mb=r),xb(n,e)},t}function dA(n,e,t){t=ca(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){xb(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){xb(n,e),typeof r!="function"&&(vl===null?vl=new Set([this]):vl.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function p8(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new JW;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=fV.bind(null,n,e,t),e.then(n,n))}function g8(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function m8(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ca(-1,1),e.tag=2,yl(t,e,1))),t.lanes|=1),n)}var eV=Ma.ReactCurrentOwner,Kr=!1;function kr(n,e,t,r){e.child=n===null?FM(e,null,t,r):wd(e,n.child,t,r)}function y8(n,e,t,r,i){t=t.render;var s=e.ref;return id(e,i),r=I3(n,e,t,r,s,i),t=M3(),n!==null&&!Kr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,xa(n,e,i)):(Ht&&t&&y3(e),e.flags|=1,kr(n,e,r,i),e.child)}function v8(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!F3(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,hA(n,e,s,r,i)):(n=wm(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:Gf,t(o,r)&&n.ref===e.ref)return xa(n,e,i)}return e.flags|=1,n=xl(s,r),n.ref=e.ref,n.return=e,e.child=n}function hA(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(Gf(s,r)&&n.ref===e.ref)if(Kr=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(Kr=!0);else return e.lanes=n.lanes,xa(n,e,i)}return wb(n,e,t,r,i)}function fA(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Et(Bu,mi),mi|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Et(Bu,mi),mi|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,Et(Bu,mi),mi|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,Et(Bu,mi),mi|=r;return kr(n,e,i,t),e.child}function pA(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function wb(n,e,t,r,i){var s=ni(t)?_c:mr.current;return s=Sd(e,s),id(e,i),t=I3(n,e,t,r,s,i),r=M3(),n!==null&&!Kr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,xa(n,e,i)):(Ht&&r&&y3(e),e.flags|=1,kr(n,e,t,i),e.child)}function S8(n,e,t,r,i){if(ni(t)){var s=!0;E1(e)}else s=!1;if(id(e,i),e.stateNode===null)vm(n,e),cA(e,t,r),Sb(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=rs(c):(c=ni(t)?_c:mr.current,c=Sd(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&f8(e,o,r,c),Ya=!1;var h=e.memoizedState;o.state=h,R1(e,r,o,i),l=e.memoizedState,a!==r||h!==l||ti.current||Ya?(typeof u=="function"&&(vb(e,t,u,r),l=e.memoizedState),(a=Ya||h8(e,t,a,r,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,UM(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:ms(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=rs(l):(l=ni(t)?_c:mr.current,l=Sd(e,l));var p=t.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&f8(e,o,r,l),Ya=!1,h=e.memoizedState,o.state=h,R1(e,r,o,i);var g=e.memoizedState;a!==d||h!==g||ti.current||Ya?(typeof p=="function"&&(vb(e,t,p,r),g=e.memoizedState),(c=Ya||h8(e,t,c,r,h,g,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),o.props=r,o.state=g,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return bb(n,e,t,r,s,i)}function bb(n,e,t,r,i,s){pA(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&i8(e,t,!1),xa(n,e,s);r=e.stateNode,eV.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=wd(e,n.child,null,s),e.child=wd(e,null,a,s)):kr(n,e,a,s),e.memoizedState=r.state,i&&i8(e,t,!0),e.child}function gA(n){var e=n.stateNode;e.pendingContext?r8(n,e.pendingContext,e.pendingContext!==e.context):e.context&&r8(n,e.context,!1),C3(n,e.containerInfo)}function x8(n,e,t,r,i){return xd(),S3(i),e.flags|=256,kr(n,e,t,r),e.child}var Ob={dehydrated:null,treeContext:null,retryLane:0};function kb(n){return{baseLanes:n,cachePool:null,transitions:null}}function mA(n,e,t){var r=e.pendingProps,i=Xt.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Et(Xt,i&1),n===null)return mb(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=gv(o,r,0,null),n=Tc(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=kb(t),e.memoizedState=Ob,n):R3(e,o));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return tV(n,e,o,r,a,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=xl(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=xl(a,s):(s=Tc(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?kb(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=Ob,r}return s=n.child,n=s.sibling,r=xl(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function R3(n,e){return e=gv({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function H0(n,e,t,r){return r!==null&&S3(r),wd(e,n.child,null,t),n=R3(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function tV(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=hx(Error(ae(422))),H0(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=gv({mode:"visible",children:r.children},i,0,null),s=Tc(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&wd(e,n.child,null,o),e.child.memoizedState=kb(o),e.memoizedState=Ob,s);if(!(e.mode&1))return H0(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(ae(419)),r=hx(s,r,void 0),H0(n,e,o,r)}if(a=(o&n.childLanes)!==0,Kr||a){if(r=jn,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Sa(n,i),Ts(r,n,i,-1))}return $3(),r=hx(Error(ae(421))),H0(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=pV.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,bi=ml(i.nextSibling),Oi=e,Ht=!0,xs=null,n!==null&&(Ui[Hi++]=ia,Ui[Hi++]=sa,Ui[Hi++]=Rc,ia=n.id,sa=n.overflow,Rc=e),e=R3(e,r.children),e.flags|=4096,e)}function w8(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),yb(n.return,e,t)}function fx(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function yA(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(kr(n,e,r.children,t),r=Xt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&w8(n,t,e);else if(n.tag===19)w8(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Et(Xt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&D1(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),fx(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&D1(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}fx(e,!0,t,null,s);break;case"together":fx(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function vm(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function xa(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),jc|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(ae(153));if(e.child!==null){for(n=e.child,t=xl(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=xl(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function nV(n,e,t){switch(e.tag){case 3:gA(e),xd();break;case 5:HM(e);break;case 1:ni(e.type)&&E1(e);break;case 4:C3(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Et(A1,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Et(Xt,Xt.current&1),e.flags|=128,null):t&e.child.childLanes?mA(n,e,t):(Et(Xt,Xt.current&1),n=xa(n,e,t),n!==null?n.sibling:null);Et(Xt,Xt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return yA(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Et(Xt,Xt.current),r)break;return null;case 22:case 23:return e.lanes=0,fA(n,e,t)}return xa(n,e,t)}var vA,Cb,SA,xA;vA=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Cb=function(){};SA=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,wc(vo.current);var s=null;switch(t){case"input":i=Vw(n,i),r=Vw(n,r),s=[];break;case"select":i=en({},i,{value:void 0}),r=en({},r,{value:void 0}),s=[];break;case"textarea":i=Kw(n,i),r=Kw(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=P1)}Zw(t,r);var o;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Bf.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Bf.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&jt("scroll",n),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};xA=function(n,e,t,r){t!==r&&(e.flags|=4)};function Sh(n,e){if(!Ht)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function ir(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function rV(n,e,t){var r=e.pendingProps;switch(v3(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ir(e),null;case 1:return ni(e.type)&&T1(),ir(e),null;case 3:return r=e.stateNode,bd(),$t(ti),$t(mr),T3(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(B0(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xs!==null&&(Rb(xs),xs=null))),Cb(n,e),ir(e),null;case 5:P3(e);var i=wc(Jf.current);if(t=e.type,n!==null&&e.stateNode!=null)SA(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ae(166));return ir(e),null}if(n=wc(vo.current),B0(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[no]=e,r[Yf]=s,n=(e.mode&1)!==0,t){case"dialog":jt("cancel",r),jt("close",r);break;case"iframe":case"object":case"embed":jt("load",r);break;case"video":case"audio":for(i=0;i<Vh.length;i++)jt(Vh[i],r);break;case"source":jt("error",r);break;case"img":case"image":case"link":jt("error",r),jt("load",r);break;case"details":jt("toggle",r);break;case"input":Mk(r,s),jt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},jt("invalid",r);break;case"textarea":_k(r,s),jt("invalid",r)}Zw(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&F0(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&F0(r.textContent,a,n),i=["children",""+a]):Bf.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&jt("scroll",r)}switch(t){case"input":_0(r),Ak(r,s,!0);break;case"textarea":_0(r),Rk(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=P1)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=GI(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[no]=e,n[Yf]=r,vA(n,e,!1,!1),e.stateNode=n;e:{switch(o=Jw(t,r),t){case"dialog":jt("cancel",n),jt("close",n),i=r;break;case"iframe":case"object":case"embed":jt("load",n),i=r;break;case"video":case"audio":for(i=0;i<Vh.length;i++)jt(Vh[i],n);i=r;break;case"source":jt("error",n),i=r;break;case"img":case"image":case"link":jt("error",n),jt("load",n),i=r;break;case"details":jt("toggle",n),i=r;break;case"input":Mk(n,r),i=Vw(n,r),jt("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=en({},r,{value:void 0}),jt("invalid",n);break;case"textarea":_k(n,r),i=Kw(n,r),jt("invalid",n);break;default:i=r}Zw(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?YI(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&XI(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Uf(n,l):typeof l=="number"&&Uf(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Bf.hasOwnProperty(s)?l!=null&&s==="onScroll"&&jt("scroll",n):l!=null&&r3(n,s,l,o))}switch(t){case"input":_0(n),Ak(n,r,!1);break;case"textarea":_0(n),Rk(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Cl(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?ed(n,!!r.multiple,s,!1):r.defaultValue!=null&&ed(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=P1)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ir(e),null;case 6:if(n&&e.stateNode!=null)xA(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ae(166));if(t=wc(Jf.current),wc(vo.current),B0(e)){if(r=e.stateNode,t=e.memoizedProps,r[no]=e,(s=r.nodeValue!==t)&&(n=Oi,n!==null))switch(n.tag){case 3:F0(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&F0(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[no]=e,e.stateNode=r}return ir(e),null;case 13:if($t(Xt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ht&&bi!==null&&e.mode&1&&!(e.flags&128))NM(),xd(),e.flags|=98560,s=!1;else if(s=B0(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(ae(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ae(317));s[no]=e}else xd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ir(e),s=!1}else xs!==null&&(Rb(xs),xs=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Xt.current&1?Cn===0&&(Cn=3):$3())),e.updateQueue!==null&&(e.flags|=4),ir(e),null);case 4:return bd(),Cb(n,e),n===null&&Xf(e.stateNode.containerInfo),ir(e),null;case 10:return b3(e.type._context),ir(e),null;case 17:return ni(e.type)&&T1(),ir(e),null;case 19:if($t(Xt),s=e.memoizedState,s===null)return ir(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)Sh(s,!1);else{if(Cn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=D1(n),o!==null){for(e.flags|=128,Sh(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Et(Xt,Xt.current&1|2),e.child}n=n.sibling}s.tail!==null&&cn()>kd&&(e.flags|=128,r=!0,Sh(s,!1),e.lanes=4194304)}else{if(!r)if(n=D1(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Sh(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Ht)return ir(e),null}else 2*cn()-s.renderingStartTime>kd&&t!==1073741824&&(e.flags|=128,r=!0,Sh(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=cn(),e.sibling=null,t=Xt.current,Et(Xt,r?t&1|2:t&1),e):(ir(e),null);case 22:case 23:return N3(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?mi&1073741824&&(ir(e),e.subtreeFlags&6&&(e.flags|=8192)):ir(e),null;case 24:return null;case 25:return null}throw Error(ae(156,e.tag))}function iV(n,e){switch(v3(e),e.tag){case 1:return ni(e.type)&&T1(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return bd(),$t(ti),$t(mr),T3(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return P3(e),null;case 13:if($t(Xt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(ae(340));xd()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return $t(Xt),null;case 4:return bd(),null;case 10:return b3(e.type._context),null;case 22:case 23:return N3(),null;case 24:return null;default:return null}}var Q0=!1,dr=!1,sV=typeof WeakSet=="function"?WeakSet:Set,Se=null;function Fu(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){rn(n,e,r)}else t.current=null}function Pb(n,e,t){try{t()}catch(r){rn(n,e,r)}}var b8=!1;function oV(n,e){if(cb=O1,n=CM(),m3(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=n,h=null;t:for(;;){for(var p;d!==t||i!==0&&d.nodeType!==3||(a=o+i),d!==s||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)h=d,d=p;for(;;){if(d===n)break t;if(h===t&&++c===i&&(a=o),h===s&&++u===r&&(l=o),(p=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=p}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(ub={focusedElem:n,selectionRange:t},O1=!1,Se=e;Se!==null;)if(e=Se,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Se=n;else for(;Se!==null;){e=Se;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var m=g.memoizedProps,S=g.memoizedState,y=e.stateNode,x=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:ms(e.type,m),S);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ae(163))}}catch(O){rn(e,e.return,O)}if(n=e.sibling,n!==null){n.return=e.return,Se=n;break}Se=e.return}return g=b8,b8=!1,g}function kf(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&Pb(e,t,s)}i=i.next}while(i!==r)}}function fv(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Tb(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function wA(n){var e=n.alternate;e!==null&&(n.alternate=null,wA(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[no],delete e[Yf],delete e[fb],delete e[UW],delete e[HW])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function bA(n){return n.tag===5||n.tag===3||n.tag===4}function O8(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||bA(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Eb(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=P1));else if(r!==4&&(n=n.child,n!==null))for(Eb(n,e,t),n=n.sibling;n!==null;)Eb(n,e,t),n=n.sibling}function Ib(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Ib(n,e,t),n=n.sibling;n!==null;)Ib(n,e,t),n=n.sibling}var Fn=null,ys=!1;function Ha(n,e,t){for(t=t.child;t!==null;)OA(n,e,t),t=t.sibling}function OA(n,e,t){if(yo&&typeof yo.onCommitFiberUnmount=="function")try{yo.onCommitFiberUnmount(sv,t)}catch{}switch(t.tag){case 5:dr||Fu(t,e);case 6:var r=Fn,i=ys;Fn=null,Ha(n,e,t),Fn=r,ys=i,Fn!==null&&(ys?(n=Fn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Fn.removeChild(t.stateNode));break;case 18:Fn!==null&&(ys?(n=Fn,t=t.stateNode,n.nodeType===8?ox(n.parentNode,t):n.nodeType===1&&ox(n,t),Wf(n)):ox(Fn,t.stateNode));break;case 4:r=Fn,i=ys,Fn=t.stateNode.containerInfo,ys=!0,Ha(n,e,t),Fn=r,ys=i;break;case 0:case 11:case 14:case 15:if(!dr&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Pb(t,e,o),i=i.next}while(i!==r)}Ha(n,e,t);break;case 1:if(!dr&&(Fu(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){rn(t,e,a)}Ha(n,e,t);break;case 21:Ha(n,e,t);break;case 22:t.mode&1?(dr=(r=dr)||t.memoizedState!==null,Ha(n,e,t),dr=r):Ha(n,e,t);break;default:Ha(n,e,t)}}function k8(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new sV),e.forEach(function(r){var i=gV.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function ps(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Fn=a.stateNode,ys=!1;break e;case 3:Fn=a.stateNode.containerInfo,ys=!0;break e;case 4:Fn=a.stateNode.containerInfo,ys=!0;break e}a=a.return}if(Fn===null)throw Error(ae(160));OA(s,o,i),Fn=null,ys=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){rn(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)kA(e,n),e=e.sibling}function kA(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ps(e,n),qs(n),r&4){try{kf(3,n,n.return),fv(3,n)}catch(m){rn(n,n.return,m)}try{kf(5,n,n.return)}catch(m){rn(n,n.return,m)}}break;case 1:ps(e,n),qs(n),r&512&&t!==null&&Fu(t,t.return);break;case 5:if(ps(e,n),qs(n),r&512&&t!==null&&Fu(t,t.return),n.flags&32){var i=n.stateNode;try{Uf(i,"")}catch(m){rn(n,n.return,m)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&WI(i,s),Jw(a,o);var c=Jw(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?YI(i,d):u==="dangerouslySetInnerHTML"?XI(i,d):u==="children"?Uf(i,d):r3(i,u,d,c)}switch(a){case"input":Gw(i,s);break;case"textarea":VI(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?ed(i,!!s.multiple,p,!1):h!==!!s.multiple&&(s.defaultValue!=null?ed(i,!!s.multiple,s.defaultValue,!0):ed(i,!!s.multiple,s.multiple?[]:"",!1))}i[Yf]=s}catch(m){rn(n,n.return,m)}}break;case 6:if(ps(e,n),qs(n),r&4){if(n.stateNode===null)throw Error(ae(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(m){rn(n,n.return,m)}}break;case 3:if(ps(e,n),qs(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Wf(e.containerInfo)}catch(m){rn(n,n.return,m)}break;case 4:ps(e,n),qs(n);break;case 13:ps(e,n),qs(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(L3=cn())),r&4&&k8(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(dr=(c=dr)||u,ps(e,n),dr=c):ps(e,n),qs(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(Se=n,u=n.child;u!==null;){for(d=Se=u;Se!==null;){switch(h=Se,p=h.child,h.tag){case 0:case 11:case 14:case 15:kf(4,h,h.return);break;case 1:Fu(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(m){rn(r,t,m)}}break;case 5:Fu(h,h.return);break;case 22:if(h.memoizedState!==null){P8(d);continue}}p!==null?(p.return=h,Se=p):P8(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=KI("display",o))}catch(m){rn(n,n.return,m)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(m){rn(n,n.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ps(e,n),qs(n),r&4&&k8(n);break;case 21:break;default:ps(e,n),qs(n)}}function qs(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(bA(t)){var r=t;break e}t=t.return}throw Error(ae(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Uf(i,""),r.flags&=-33);var s=O8(n);Ib(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=O8(n);Eb(n,a,o);break;default:throw Error(ae(161))}}catch(l){rn(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function aV(n,e,t){Se=n,CA(n)}function CA(n,e,t){for(var r=(n.mode&1)!==0;Se!==null;){var i=Se,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Q0;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||dr;a=Q0;var c=dr;if(Q0=o,(dr=l)&&!c)for(Se=i;Se!==null;)o=Se,l=o.child,o.tag===22&&o.memoizedState!==null?T8(i):l!==null?(l.return=o,Se=l):T8(i);for(;s!==null;)Se=s,CA(s),s=s.sibling;Se=i,Q0=a,dr=c}C8(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,Se=s):C8(n)}}function C8(n){for(;Se!==null;){var e=Se;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:dr||fv(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!dr)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:ms(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&c8(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}c8(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Wf(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ae(163))}dr||e.flags&512&&Tb(e)}catch(h){rn(e,e.return,h)}}if(e===n){Se=null;break}if(t=e.sibling,t!==null){t.return=e.return,Se=t;break}Se=e.return}}function P8(n){for(;Se!==null;){var e=Se;if(e===n){Se=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Se=t;break}Se=e.return}}function T8(n){for(;Se!==null;){var e=Se;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{fv(4,e)}catch(l){rn(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){rn(e,i,l)}}var s=e.return;try{Tb(e)}catch(l){rn(e,s,l)}break;case 5:var o=e.return;try{Tb(e)}catch(l){rn(e,o,l)}}}catch(l){rn(e,e.return,l)}if(e===n){Se=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Se=a;break}Se=e.return}}var lV=Math.ceil,z1=Ma.ReactCurrentDispatcher,D3=Ma.ReactCurrentOwner,Zi=Ma.ReactCurrentBatchConfig,ot=0,jn=null,gn=null,Xn=0,mi=0,Bu=Ql(0),Cn=0,rp=null,jc=0,pv=0,j3=0,Cf=null,qr=null,L3=0,kd=1/0,Ko=null,N1=!1,Mb=null,vl=null,q0=!1,sl=null,$1=0,Pf=0,Ab=null,Sm=-1,xm=0;function Er(){return ot&6?cn():Sm!==-1?Sm:Sm=cn()}function Sl(n){return n.mode&1?ot&2&&Xn!==0?Xn&-Xn:qW.transition!==null?(xm===0&&(xm=cM()),xm):(n=yt,n!==0||(n=window.event,n=n===void 0?16:mM(n.type)),n):1}function Ts(n,e,t,r){if(50<Pf)throw Pf=0,Ab=null,Error(ae(185));Np(n,t,r),(!(ot&2)||n!==jn)&&(n===jn&&(!(ot&2)&&(pv|=t),Cn===4&&tl(n,Xn)),ri(n,r),t===1&&ot===0&&!(e.mode&1)&&(kd=cn()+500,uv&&ql()))}function ri(n,e){var t=n.callbackNode;qq(n,e);var r=b1(n,n===jn?Xn:0);if(r===0)t!==null&&Lk(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Lk(t),e===1)n.tag===0?QW(E8.bind(null,n)):jM(E8.bind(null,n)),FW(function(){!(ot&6)&&ql()}),t=null;else{switch(uM(r)){case 1:t=l3;break;case 4:t=aM;break;case 16:t=w1;break;case 536870912:t=lM;break;default:t=w1}t=RA(t,PA.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function PA(n,e){if(Sm=-1,xm=0,ot&6)throw Error(ae(327));var t=n.callbackNode;if(sd()&&n.callbackNode!==t)return null;var r=b1(n,n===jn?Xn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=F1(n,r);else{e=r;var i=ot;ot|=2;var s=EA();(jn!==n||Xn!==e)&&(Ko=null,kd=cn()+500,Pc(n,e));do try{dV();break}catch(a){TA(n,a)}while(!0);w3(),z1.current=s,ot=i,gn!==null?e=0:(jn=null,Xn=0,e=Cn)}if(e!==0){if(e===2&&(i=ib(n),i!==0&&(r=i,e=_b(n,i))),e===1)throw t=rp,Pc(n,0),tl(n,r),ri(n,cn()),t;if(e===6)tl(n,r);else{if(i=n.current.alternate,!(r&30)&&!cV(i)&&(e=F1(n,r),e===2&&(s=ib(n),s!==0&&(r=s,e=_b(n,s))),e===1))throw t=rp,Pc(n,0),tl(n,r),ri(n,cn()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(ae(345));case 2:gc(n,qr,Ko);break;case 3:if(tl(n,r),(r&130023424)===r&&(e=L3+500-cn(),10<e)){if(b1(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Er(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=hb(gc.bind(null,n,qr,Ko),e);break}gc(n,qr,Ko);break;case 4:if(tl(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-Ps(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=cn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*lV(r/1960))-r,10<r){n.timeoutHandle=hb(gc.bind(null,n,qr,Ko),r);break}gc(n,qr,Ko);break;case 5:gc(n,qr,Ko);break;default:throw Error(ae(329))}}}return ri(n,cn()),n.callbackNode===t?PA.bind(null,n):null}function _b(n,e){var t=Cf;return n.current.memoizedState.isDehydrated&&(Pc(n,e).flags|=256),n=F1(n,e),n!==2&&(e=qr,qr=t,e!==null&&Rb(e)),n}function Rb(n){qr===null?qr=n:qr.push.apply(qr,n)}function cV(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!Is(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function tl(n,e){for(e&=~j3,e&=~pv,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Ps(e),r=1<<t;n[t]=-1,e&=~r}}function E8(n){if(ot&6)throw Error(ae(327));sd();var e=b1(n,0);if(!(e&1))return ri(n,cn()),null;var t=F1(n,e);if(n.tag!==0&&t===2){var r=ib(n);r!==0&&(e=r,t=_b(n,r))}if(t===1)throw t=rp,Pc(n,0),tl(n,e),ri(n,cn()),t;if(t===6)throw Error(ae(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,gc(n,qr,Ko),ri(n,cn()),null}function z3(n,e){var t=ot;ot|=1;try{return n(e)}finally{ot=t,ot===0&&(kd=cn()+500,uv&&ql())}}function Lc(n){sl!==null&&sl.tag===0&&!(ot&6)&&sd();var e=ot;ot|=1;var t=Zi.transition,r=yt;try{if(Zi.transition=null,yt=1,n)return n()}finally{yt=r,Zi.transition=t,ot=e,!(ot&6)&&ql()}}function N3(){mi=Bu.current,$t(Bu)}function Pc(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,$W(t)),gn!==null)for(t=gn.return;t!==null;){var r=t;switch(v3(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&T1();break;case 3:bd(),$t(ti),$t(mr),T3();break;case 5:P3(r);break;case 4:bd();break;case 13:$t(Xt);break;case 19:$t(Xt);break;case 10:b3(r.type._context);break;case 22:case 23:N3()}t=t.return}if(jn=n,gn=n=xl(n.current,null),Xn=mi=e,Cn=0,rp=null,j3=pv=jc=0,qr=Cf=null,xc!==null){for(e=0;e<xc.length;e++)if(t=xc[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}xc=null}return n}function TA(n,e){do{var t=gn;try{if(w3(),mm.current=L1,j1){for(var r=Jt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}j1=!1}if(Dc=0,_n=bn=Jt=null,Of=!1,ep=0,D3.current=null,t===null||t.return===null){Cn=1,rp=e,gn=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=Xn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=g8(o);if(p!==null){p.flags&=-257,m8(p,o,a,s,e),p.mode&1&&p8(s,c,e),e=p,l=c;var g=e.updateQueue;if(g===null){var m=new Set;m.add(l),e.updateQueue=m}else g.add(l);break e}else{if(!(e&1)){p8(s,c,e),$3();break e}l=Error(ae(426))}}else if(Ht&&a.mode&1){var S=g8(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),m8(S,o,a,s,e),S3(Od(l,a));break e}}s=l=Od(l,a),Cn!==4&&(Cn=2),Cf===null?Cf=[s]:Cf.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=uA(s,l,e);l8(s,y);break e;case 1:a=l;var x=s.type,w=s.stateNode;if(!(s.flags&128)&&(typeof x.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(vl===null||!vl.has(w)))){s.flags|=65536,e&=-e,s.lanes|=e;var O=dA(s,a,e);l8(s,O);break e}}s=s.return}while(s!==null)}MA(t)}catch(T){e=T,gn===t&&t!==null&&(gn=t=t.return);continue}break}while(!0)}function EA(){var n=z1.current;return z1.current=L1,n===null?L1:n}function $3(){(Cn===0||Cn===3||Cn===2)&&(Cn=4),jn===null||!(jc&268435455)&&!(pv&268435455)||tl(jn,Xn)}function F1(n,e){var t=ot;ot|=2;var r=EA();(jn!==n||Xn!==e)&&(Ko=null,Pc(n,e));do try{uV();break}catch(i){TA(n,i)}while(!0);if(w3(),ot=t,z1.current=r,gn!==null)throw Error(ae(261));return jn=null,Xn=0,Cn}function uV(){for(;gn!==null;)IA(gn)}function dV(){for(;gn!==null&&!Lq();)IA(gn)}function IA(n){var e=_A(n.alternate,n,mi);n.memoizedProps=n.pendingProps,e===null?MA(n):gn=e,D3.current=null}function MA(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=iV(t,e),t!==null){t.flags&=32767,gn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Cn=6,gn=null;return}}else if(t=rV(t,e,mi),t!==null){gn=t;return}if(e=e.sibling,e!==null){gn=e;return}gn=e=n}while(e!==null);Cn===0&&(Cn=5)}function gc(n,e,t){var r=yt,i=Zi.transition;try{Zi.transition=null,yt=1,hV(n,e,t,r)}finally{Zi.transition=i,yt=r}return null}function hV(n,e,t,r){do sd();while(sl!==null);if(ot&6)throw Error(ae(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(ae(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(Wq(n,s),n===jn&&(gn=jn=null,Xn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||q0||(q0=!0,RA(w1,function(){return sd(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Zi.transition,Zi.transition=null;var o=yt;yt=1;var a=ot;ot|=4,D3.current=null,oV(n,t),kA(t,n),_W(ub),O1=!!cb,ub=cb=null,n.current=t,aV(t),zq(),ot=a,yt=o,Zi.transition=s}else n.current=t;if(q0&&(q0=!1,sl=n,$1=i),s=n.pendingLanes,s===0&&(vl=null),Fq(t.stateNode),ri(n,cn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(N1)throw N1=!1,n=Mb,Mb=null,n;return $1&1&&n.tag!==0&&sd(),s=n.pendingLanes,s&1?n===Ab?Pf++:(Pf=0,Ab=n):Pf=0,ql(),null}function sd(){if(sl!==null){var n=uM($1),e=Zi.transition,t=yt;try{if(Zi.transition=null,yt=16>n?16:n,sl===null)var r=!1;else{if(n=sl,sl=null,$1=0,ot&6)throw Error(ae(331));var i=ot;for(ot|=4,Se=n.current;Se!==null;){var s=Se,o=s.child;if(Se.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Se=c;Se!==null;){var u=Se;switch(u.tag){case 0:case 11:case 15:kf(8,u,s)}var d=u.child;if(d!==null)d.return=u,Se=d;else for(;Se!==null;){u=Se;var h=u.sibling,p=u.return;if(wA(u),u===c){Se=null;break}if(h!==null){h.return=p,Se=h;break}Se=p}}}var g=s.alternate;if(g!==null){var m=g.child;if(m!==null){g.child=null;do{var S=m.sibling;m.sibling=null,m=S}while(m!==null)}}Se=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Se=o;else e:for(;Se!==null;){if(s=Se,s.flags&2048)switch(s.tag){case 0:case 11:case 15:kf(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,Se=y;break e}Se=s.return}}var x=n.current;for(Se=x;Se!==null;){o=Se;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,Se=w;else e:for(o=x;Se!==null;){if(a=Se,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:fv(9,a)}}catch(T){rn(a,a.return,T)}if(a===o){Se=null;break e}var O=a.sibling;if(O!==null){O.return=a.return,Se=O;break e}Se=a.return}}if(ot=i,ql(),yo&&typeof yo.onPostCommitFiberRoot=="function")try{yo.onPostCommitFiberRoot(sv,n)}catch{}r=!0}return r}finally{yt=t,Zi.transition=e}}return!1}function I8(n,e,t){e=Od(t,e),e=uA(n,e,1),n=yl(n,e,1),e=Er(),n!==null&&(Np(n,1,e),ri(n,e))}function rn(n,e,t){if(n.tag===3)I8(n,n,t);else for(;e!==null;){if(e.tag===3){I8(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(vl===null||!vl.has(r))){n=Od(t,n),n=dA(e,n,1),e=yl(e,n,1),n=Er(),e!==null&&(Np(e,1,n),ri(e,n));break}}e=e.return}}function fV(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Er(),n.pingedLanes|=n.suspendedLanes&t,jn===n&&(Xn&t)===t&&(Cn===4||Cn===3&&(Xn&130023424)===Xn&&500>cn()-L3?Pc(n,0):j3|=t),ri(n,e)}function AA(n,e){e===0&&(n.mode&1?(e=j0,j0<<=1,!(j0&130023424)&&(j0=4194304)):e=1);var t=Er();n=Sa(n,e),n!==null&&(Np(n,e,t),ri(n,t))}function pV(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),AA(n,t)}function gV(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(ae(314))}r!==null&&r.delete(e),AA(n,t)}var _A;_A=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||ti.current)Kr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Kr=!1,nV(n,e,t);Kr=!!(n.flags&131072)}else Kr=!1,Ht&&e.flags&1048576&&LM(e,M1,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;vm(n,e),n=e.pendingProps;var i=Sd(e,mr.current);id(e,t),i=I3(null,e,r,n,i,t);var s=M3();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ni(r)?(s=!0,E1(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,k3(e),i.updater=hv,e.stateNode=i,i._reactInternals=e,Sb(e,r,n,t),e=bb(null,e,r,!0,s,t)):(e.tag=0,Ht&&s&&y3(e),kr(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(vm(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=yV(r),n=ms(r,n),i){case 0:e=wb(null,e,r,n,t);break e;case 1:e=S8(null,e,r,n,t);break e;case 11:e=y8(null,e,r,n,t);break e;case 14:e=v8(null,e,r,ms(r.type,n),t);break e}throw Error(ae(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ms(r,i),wb(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ms(r,i),S8(n,e,r,i,t);case 3:e:{if(gA(e),n===null)throw Error(ae(387));r=e.pendingProps,s=e.memoizedState,i=s.element,UM(n,e),R1(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Od(Error(ae(423)),e),e=x8(n,e,r,t,i);break e}else if(r!==i){i=Od(Error(ae(424)),e),e=x8(n,e,r,t,i);break e}else for(bi=ml(e.stateNode.containerInfo.firstChild),Oi=e,Ht=!0,xs=null,t=FM(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(xd(),r===i){e=xa(n,e,t);break e}kr(n,e,r,t)}e=e.child}return e;case 5:return HM(e),n===null&&mb(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,db(r,i)?o=null:s!==null&&db(r,s)&&(e.flags|=32),pA(n,e),kr(n,e,o,t),e.child;case 6:return n===null&&mb(e),null;case 13:return mA(n,e,t);case 4:return C3(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=wd(e,null,r,t):kr(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ms(r,i),y8(n,e,r,i,t);case 7:return kr(n,e,e.pendingProps,t),e.child;case 8:return kr(n,e,e.pendingProps.children,t),e.child;case 12:return kr(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Et(A1,r._currentValue),r._currentValue=o,s!==null)if(Is(s.value,o)){if(s.children===i.children&&!ti.current){e=xa(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=ca(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),yb(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(ae(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),yb(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}kr(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,id(e,t),i=rs(i),r=r(i),e.flags|=1,kr(n,e,r,t),e.child;case 14:return r=e.type,i=ms(r,e.pendingProps),i=ms(r.type,i),v8(n,e,r,i,t);case 15:return hA(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ms(r,i),vm(n,e),e.tag=1,ni(r)?(n=!0,E1(e)):n=!1,id(e,t),cA(e,r,i),Sb(e,r,i,t),bb(null,e,r,!0,n,t);case 19:return yA(n,e,t);case 22:return fA(n,e,t)}throw Error(ae(156,e.tag))};function RA(n,e){return oM(n,e)}function mV(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vi(n,e,t,r){return new mV(n,e,t,r)}function F3(n){return n=n.prototype,!(!n||!n.isReactComponent)}function yV(n){if(typeof n=="function")return F3(n)?1:0;if(n!=null){if(n=n.$$typeof,n===s3)return 11;if(n===o3)return 14}return 2}function xl(n,e){var t=n.alternate;return t===null?(t=Vi(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function wm(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")F3(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Au:return Tc(t.children,i,s,e);case i3:o=8,i|=8;break;case Hw:return n=Vi(12,t,e,i|2),n.elementType=Hw,n.lanes=s,n;case Qw:return n=Vi(13,t,e,i),n.elementType=Qw,n.lanes=s,n;case qw:return n=Vi(19,t,e,i),n.elementType=qw,n.lanes=s,n;case HI:return gv(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case BI:o=10;break e;case UI:o=9;break e;case s3:o=11;break e;case o3:o=14;break e;case Ka:o=16,r=null;break e}throw Error(ae(130,n==null?n:typeof n,""))}return e=Vi(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function Tc(n,e,t,r){return n=Vi(7,n,r,e),n.lanes=t,n}function gv(n,e,t,r){return n=Vi(22,n,r,e),n.elementType=HI,n.lanes=t,n.stateNode={isHidden:!1},n}function px(n,e,t){return n=Vi(6,n,null,e),n.lanes=t,n}function gx(n,e,t){return e=Vi(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function vV(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=XS(0),this.expirationTimes=XS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=XS(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function B3(n,e,t,r,i,s,o,a,l){return n=new vV(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Vi(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},k3(s),n}function SV(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Mu,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function DA(n){if(!n)return Pl;n=n._reactInternals;e:{if(iu(n)!==n||n.tag!==1)throw Error(ae(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ni(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ae(171))}if(n.tag===1){var t=n.type;if(ni(t))return DM(n,t,e)}return e}function jA(n,e,t,r,i,s,o,a,l){return n=B3(t,r,!0,n,i,s,o,a,l),n.context=DA(null),t=n.current,r=Er(),i=Sl(t),s=ca(r,i),s.callback=e??null,yl(t,s,i),n.current.lanes=i,Np(n,i,r),ri(n,r),n}function mv(n,e,t,r){var i=e.current,s=Er(),o=Sl(i);return t=DA(t),e.context===null?e.context=t:e.pendingContext=t,e=ca(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=yl(i,e,o),n!==null&&(Ts(n,i,o,s),gm(n,i,o)),o}function B1(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function M8(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function U3(n,e){M8(n,e),(n=n.alternate)&&M8(n,e)}function xV(){return null}var LA=typeof reportError=="function"?reportError:function(n){console.error(n)};function H3(n){this._internalRoot=n}yv.prototype.render=H3.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(ae(409));mv(n,e,null,null)};yv.prototype.unmount=H3.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Lc(function(){mv(null,n,null,null)}),e[va]=null}};function yv(n){this._internalRoot=n}yv.prototype.unstable_scheduleHydration=function(n){if(n){var e=fM();n={blockedOn:null,target:n,priority:e};for(var t=0;t<el.length&&e!==0&&e<el[t].priority;t++);el.splice(t,0,n),t===0&&gM(n)}};function Q3(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function vv(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function A8(){}function wV(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=B1(o);s.call(c)}}var o=jA(e,r,n,0,null,!1,!1,"",A8);return n._reactRootContainer=o,n[va]=o.current,Xf(n.nodeType===8?n.parentNode:n),Lc(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=B1(l);a.call(c)}}var l=B3(n,0,!1,null,null,!1,!1,"",A8);return n._reactRootContainer=l,n[va]=l.current,Xf(n.nodeType===8?n.parentNode:n),Lc(function(){mv(e,l,t,r)}),l}function Sv(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=B1(o);a.call(l)}}mv(e,o,n,i)}else o=wV(t,e,n,i,r);return B1(o)}dM=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Wh(e.pendingLanes);t!==0&&(c3(e,t|1),ri(e,cn()),!(ot&6)&&(kd=cn()+500,ql()))}break;case 13:Lc(function(){var r=Sa(n,1);if(r!==null){var i=Er();Ts(r,n,1,i)}}),U3(n,1)}};u3=function(n){if(n.tag===13){var e=Sa(n,134217728);if(e!==null){var t=Er();Ts(e,n,134217728,t)}U3(n,134217728)}};hM=function(n){if(n.tag===13){var e=Sl(n),t=Sa(n,e);if(t!==null){var r=Er();Ts(t,n,e,r)}U3(n,e)}};fM=function(){return yt};pM=function(n,e){var t=yt;try{return yt=n,e()}finally{yt=t}};tb=function(n,e,t){switch(e){case"input":if(Gw(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=cv(r);if(!i)throw Error(ae(90));qI(r),Gw(r,i)}}}break;case"textarea":VI(n,t);break;case"select":e=t.value,e!=null&&ed(n,!!t.multiple,e,!1)}};eM=z3;tM=Lc;var bV={usingClientEntryPoint:!1,Events:[Fp,ju,cv,ZI,JI,z3]},xh={findFiberByHostInstance:Sc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},OV={bundleType:xh.bundleType,version:xh.version,rendererPackageName:xh.rendererPackageName,rendererConfig:xh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ma.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=iM(n),n===null?null:n.stateNode},findFiberByHostInstance:xh.findFiberByHostInstance||xV,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var W0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!W0.isDisabled&&W0.supportsFiber)try{sv=W0.inject(OV),yo=W0}catch{}}_i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bV;_i.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Q3(e))throw Error(ae(200));return SV(n,e,null,t)};_i.createRoot=function(n,e){if(!Q3(n))throw Error(ae(299));var t=!1,r="",i=LA;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=B3(n,1,!1,null,null,t,!1,r,i),n[va]=e.current,Xf(n.nodeType===8?n.parentNode:n),new H3(e)};_i.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(ae(188)):(n=Object.keys(n).join(","),Error(ae(268,n)));return n=iM(e),n=n===null?null:n.stateNode,n};_i.flushSync=function(n){return Lc(n)};_i.hydrate=function(n,e,t){if(!vv(e))throw Error(ae(200));return Sv(null,n,e,!0,t)};_i.hydrateRoot=function(n,e,t){if(!Q3(n))throw Error(ae(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=LA;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=jA(e,null,n,1,t??null,i,!1,s,o),n[va]=e.current,Xf(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new yv(e)};_i.render=function(n,e,t){if(!vv(e))throw Error(ae(200));return Sv(null,n,e,!1,t)};_i.unmountComponentAtNode=function(n){if(!vv(n))throw Error(ae(40));return n._reactRootContainer?(Lc(function(){Sv(null,null,n,!1,function(){n._reactRootContainer=null,n[va]=null})}),!0):!1};_i.unstable_batchedUpdates=z3;_i.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!vv(t))throw Error(ae(200));if(n==null||n._reactInternals===void 0)throw Error(ae(38));return Sv(n,e,t,!1,r)};_i.version="18.3.1-next-f1338f8080-20240426";function zA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(zA)}catch(n){console.error(n)}}zA(),zI.exports=_i;var su=zI.exports;const kV=Ul(su);var NA,_8=su;NA=Bw.createRoot=_8.createRoot,Bw.hydrateRoot=_8.hydrateRoot;var wh=function(n){return n&&n.Math===Math&&n},_r=wh(typeof globalThis=="object"&&globalThis)||wh(typeof window=="object"&&window)||wh(typeof self=="object"&&self)||wh(typeof gr=="object"&&gr)||wh(typeof gr=="object"&&gr)||function(){return this}()||Function("return this")(),q3={},Rr=function(n){try{return!!n()}catch{return!0}},CV=Rr,Wl=!CV(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),PV=Rr,xv=!PV(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),TV=xv,V0=Function.prototype.call,Aa=TV?V0.bind(V0):function(){return V0.apply(V0,arguments)},$A={},FA={}.propertyIsEnumerable,BA=Object.getOwnPropertyDescriptor,EV=BA&&!FA.call({1:2},1);$A.f=EV?function(e){var t=BA(this,e);return!!t&&t.enumerable}:FA;var UA=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}},HA=xv,QA=Function.prototype,Db=QA.call,IV=HA&&QA.bind.bind(Db,Db),Ln=HA?IV:function(n){return function(){return Db.apply(n,arguments)}},qA=Ln,MV=qA({}.toString),AV=qA("".slice),Wd=function(n){return AV(MV(n),8,-1)},_V=Ln,RV=Rr,DV=Wd,mx=Object,jV=_V("".split),LV=RV(function(){return!mx("z").propertyIsEnumerable(0)})?function(n){return DV(n)==="String"?jV(n,""):mx(n)}:mx,wv=function(n){return n==null},zV=wv,NV=TypeError,Vd=function(n){if(zV(n))throw new NV("Can't call method on "+n);return n},$V=LV,FV=Vd,bv=function(n){return $V(FV(n))},yx=typeof document=="object"&&document.all,Dr=typeof yx>"u"&&yx!==void 0?function(n){return typeof n=="function"||n===yx}:function(n){return typeof n=="function"},BV=Dr,ou=function(n){return typeof n=="object"?n!==null:BV(n)},vx=_r,UV=Dr,HV=function(n){return UV(n)?n:void 0},Ov=function(n,e){return arguments.length<2?HV(vx[n]):vx[n]&&vx[n][e]},QV=Ln,WA=QV({}.isPrototypeOf),qV=_r,R8=qV.navigator,D8=R8&&R8.userAgent,WV=D8?String(D8):"",VA=_r,Sx=WV,j8=VA.process,L8=VA.Deno,z8=j8&&j8.versions||L8&&L8.version,N8=z8&&z8.v8,ws,U1;N8&&(ws=N8.split("."),U1=ws[0]>0&&ws[0]<4?1:+(ws[0]+ws[1]));!U1&&Sx&&(ws=Sx.match(/Edge\/(\d+)/),(!ws||ws[1]>=74)&&(ws=Sx.match(/Chrome\/(\d+)/),ws&&(U1=+ws[1])));var VV=U1,$8=VV,GV=Rr,XV=_r,KV=XV.String,GA=!!Object.getOwnPropertySymbols&&!GV(function(){var n=Symbol("symbol detection");return!KV(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&$8&&$8<41}),YV=GA,XA=YV&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ZV=Ov,JV=Dr,eG=WA,tG=XA,nG=Object,KA=tG?function(n){return typeof n=="symbol"}:function(n){var e=ZV("Symbol");return JV(e)&&eG(e.prototype,nG(n))},rG=String,iG=function(n){try{return rG(n)}catch{return"Object"}},sG=Dr,oG=iG,aG=TypeError,W3=function(n){if(sG(n))return n;throw new aG(oG(n)+" is not a function")},lG=W3,cG=wv,V3=function(n,e){var t=n[e];return cG(t)?void 0:lG(t)},xx=Aa,wx=Dr,bx=ou,uG=TypeError,dG=function(n,e){var t,r;if(e==="string"&&wx(t=n.toString)&&!bx(r=xx(t,n))||wx(t=n.valueOf)&&!bx(r=xx(t,n))||e!=="string"&&wx(t=n.toString)&&!bx(r=xx(t,n)))return r;throw new uG("Can't convert object to primitive value")},YA={exports:{}},F8=_r,hG=Object.defineProperty,G3=function(n,e){try{hG(F8,n,{value:e,configurable:!0,writable:!0})}catch{F8[n]=e}return e},fG=_r,pG=G3,B8="__core-js_shared__",U8=YA.exports=fG[B8]||pG(B8,{});(U8.versions||(U8.versions=[])).push({version:"3.38.1",mode:"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.1/LICENSE",source:"https://github.com/zloirock/core-js"});var X3=YA.exports,H8=X3,K3=function(n,e){return H8[n]||(H8[n]=e||{})},gG=Vd,mG=Object,Up=function(n){return mG(gG(n))},yG=Ln,vG=Up,SG=yG({}.hasOwnProperty),Vl=Object.hasOwn||function(e,t){return SG(vG(e),t)},xG=Ln,wG=0,bG=Math.random(),OG=xG(1 .toString),ZA=function(n){return"Symbol("+(n===void 0?"":n)+")_"+OG(++wG+bG,36)},kG=_r,CG=K3,Q8=Vl,PG=ZA,TG=GA,EG=XA,Uu=kG.Symbol,Ox=CG("wks"),IG=EG?Uu.for||Uu:Uu&&Uu.withoutSetter||PG,_a=function(n){return Q8(Ox,n)||(Ox[n]=TG&&Q8(Uu,n)?Uu[n]:IG("Symbol."+n)),Ox[n]},MG=Aa,q8=ou,W8=KA,AG=V3,_G=dG,RG=_a,DG=TypeError,jG=RG("toPrimitive"),LG=function(n,e){if(!q8(n)||W8(n))return n;var t=AG(n,jG),r;if(t){if(e===void 0&&(e="default"),r=MG(t,n,e),!q8(r)||W8(r))return r;throw new DG("Can't convert object to primitive value")}return e===void 0&&(e="number"),_G(n,e)},zG=LG,NG=KA,JA=function(n){var e=zG(n,"string");return NG(e)?e:e+""},$G=_r,V8=ou,jb=$G.document,FG=V8(jb)&&V8(jb.createElement),e_=function(n){return FG?jb.createElement(n):{}},BG=Wl,UG=Rr,HG=e_,t_=!BG&&!UG(function(){return Object.defineProperty(HG("div"),"a",{get:function(){return 7}}).a!==7}),QG=Wl,qG=Aa,WG=$A,VG=UA,GG=bv,XG=JA,KG=Vl,YG=t_,G8=Object.getOwnPropertyDescriptor;q3.f=QG?G8:function(e,t){if(e=GG(e),t=XG(t),YG)try{return G8(e,t)}catch{}if(KG(e,t))return VG(!qG(WG.f,e,t),e[t])};var Gd={},ZG=Wl,JG=Rr,n_=ZG&&JG(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),eX=ou,tX=String,nX=TypeError,au=function(n){if(eX(n))return n;throw new nX(tX(n)+" is not an object")},rX=Wl,iX=t_,sX=n_,G0=au,X8=JA,oX=TypeError,kx=Object.defineProperty,aX=Object.getOwnPropertyDescriptor,Cx="enumerable",Px="configurable",Tx="writable";Gd.f=rX?sX?function(e,t,r){if(G0(e),t=X8(t),G0(r),typeof e=="function"&&t==="prototype"&&"value"in r&&Tx in r&&!r[Tx]){var i=aX(e,t);i&&i[Tx]&&(e[t]=r.value,r={configurable:Px in r?r[Px]:i[Px],enumerable:Cx in r?r[Cx]:i[Cx],writable:!1})}return kx(e,t,r)}:kx:function(e,t,r){if(G0(e),t=X8(t),G0(r),iX)try{return kx(e,t,r)}catch{}if("get"in r||"set"in r)throw new oX("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var lX=Wl,cX=Gd,uX=UA,Y3=lX?function(n,e,t){return cX.f(n,e,uX(1,t))}:function(n,e,t){return n[e]=t,n},r_={exports:{}},Lb=Wl,dX=Vl,i_=Function.prototype,hX=Lb&&Object.getOwnPropertyDescriptor,Z3=dX(i_,"name"),fX=Z3&&(function(){}).name==="something",pX=Z3&&(!Lb||Lb&&hX(i_,"name").configurable),gX={EXISTS:Z3,PROPER:fX,CONFIGURABLE:pX},mX=Ln,yX=Dr,zb=X3,vX=mX(Function.toString);yX(zb.inspectSource)||(zb.inspectSource=function(n){return vX(n)});var s_=zb.inspectSource,SX=_r,xX=Dr,K8=SX.WeakMap,wX=xX(K8)&&/native code/.test(String(K8)),bX=K3,OX=ZA,Y8=bX("keys"),o_=function(n){return Y8[n]||(Y8[n]=OX(n))},J3={},kX=wX,a_=_r,CX=ou,PX=Y3,Ex=Vl,Ix=X3,TX=o_,EX=J3,Z8="Object already initialized",Nb=a_.TypeError,IX=a_.WeakMap,H1,ip,Q1,MX=function(n){return Q1(n)?ip(n):H1(n,{})},AX=function(n){return function(e){var t;if(!CX(e)||(t=ip(e)).type!==n)throw new Nb("Incompatible receiver, "+n+" required");return t}};if(kX||Ix.state){var Ws=Ix.state||(Ix.state=new IX);Ws.get=Ws.get,Ws.has=Ws.has,Ws.set=Ws.set,H1=function(n,e){if(Ws.has(n))throw new Nb(Z8);return e.facade=n,Ws.set(n,e),e},ip=function(n){return Ws.get(n)||{}},Q1=function(n){return Ws.has(n)}}else{var pu=TX("state");EX[pu]=!0,H1=function(n,e){if(Ex(n,pu))throw new Nb(Z8);return e.facade=n,PX(n,pu,e),e},ip=function(n){return Ex(n,pu)?n[pu]:{}},Q1=function(n){return Ex(n,pu)}}var l_={set:H1,get:ip,has:Q1,enforce:MX,getterFor:AX},e6=Ln,_X=Rr,RX=Dr,X0=Vl,$b=Wl,DX=gX.CONFIGURABLE,jX=s_,c_=l_,LX=c_.enforce,zX=c_.get,J8=String,bm=Object.defineProperty,NX=e6("".slice),$X=e6("".replace),FX=e6([].join),BX=$b&&!_X(function(){return bm(function(){},"length",{value:8}).length!==8}),UX=String(String).split("String"),HX=r_.exports=function(n,e,t){NX(J8(e),0,7)==="Symbol("&&(e="["+$X(J8(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!X0(n,"name")||DX&&n.name!==e)&&($b?bm(n,"name",{value:e,configurable:!0}):n.name=e),BX&&t&&X0(t,"arity")&&n.length!==t.arity&&bm(n,"length",{value:t.arity});try{t&&X0(t,"constructor")&&t.constructor?$b&&bm(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch{}var r=LX(n);return X0(r,"source")||(r.source=FX(UX,typeof e=="string"?e:"")),n};Function.prototype.toString=HX(function(){return RX(this)&&zX(this).source||jX(this)},"toString");var QX=r_.exports,qX=Dr,WX=Gd,VX=QX,GX=G3,u_=function(n,e,t,r){r||(r={});var i=r.enumerable,s=r.name!==void 0?r.name:e;if(qX(t)&&VX(t,s,r),r.global)i?n[e]=t:GX(e,t);else{try{r.unsafe?n[e]&&(i=!0):delete n[e]}catch{}i?n[e]=t:WX.f(n,e,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return n},d_={},XX=Math.ceil,KX=Math.floor,YX=Math.trunc||function(e){var t=+e;return(t>0?KX:XX)(t)},ZX=YX,lu=function(n){var e=+n;return e!==e||e===0?0:ZX(e)},JX=lu,eK=Math.max,tK=Math.min,nK=function(n,e){var t=JX(n);return t<0?eK(t+e,0):tK(t,e)},rK=lu,iK=Math.min,h_=function(n){var e=rK(n);return e>0?iK(e,9007199254740991):0},sK=h_,Hp=function(n){return sK(n.length)},oK=bv,aK=nK,lK=Hp,eC=function(n){return function(e,t,r){var i=oK(e),s=lK(i);if(s===0)return!n&&-1;var o=aK(r,s),a;if(n&&t!==t){for(;s>o;)if(a=i[o++],a!==a)return!0}else for(;s>o;o++)if((n||o in i)&&i[o]===t)return n||o||0;return!n&&-1}},cK={includes:eC(!0),indexOf:eC(!1)},uK=Ln,Mx=Vl,dK=bv,hK=cK.indexOf,fK=J3,tC=uK([].push),f_=function(n,e){var t=dK(n),r=0,i=[],s;for(s in t)!Mx(fK,s)&&Mx(t,s)&&tC(i,s);for(;e.length>r;)Mx(t,s=e[r++])&&(~hK(i,s)||tC(i,s));return i},t6=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],pK=f_,gK=t6,mK=gK.concat("length","prototype");d_.f=Object.getOwnPropertyNames||function(e){return pK(e,mK)};var p_={};p_.f=Object.getOwnPropertySymbols;var yK=Ov,vK=Ln,SK=d_,xK=p_,wK=au,bK=vK([].concat),OK=yK("Reflect","ownKeys")||function(e){var t=SK.f(wK(e)),r=xK.f;return r?bK(t,r(e)):t},nC=Vl,kK=OK,CK=q3,PK=Gd,TK=function(n,e,t){for(var r=kK(e),i=PK.f,s=CK.f,o=0;o<r.length;o++){var a=r[o];!nC(n,a)&&!(t&&nC(t,a))&&i(n,a,s(e,a))}},EK=Rr,IK=Dr,MK=/#|\.prototype\./,Qp=function(n,e){var t=_K[AK(n)];return t===DK?!0:t===RK?!1:IK(e)?EK(e):!!e},AK=Qp.normalize=function(n){return String(n).replace(MK,".").toLowerCase()},_K=Qp.data={},RK=Qp.NATIVE="N",DK=Qp.POLYFILL="P",jK=Qp,K0=_r,LK=q3.f,zK=Y3,NK=u_,$K=G3,FK=TK,BK=jK,Xd=function(n,e){var t=n.target,r=n.global,i=n.stat,s,o,a,l,c,u;if(r?o=K0:i?o=K0[t]||$K(t,{}):o=K0[t]&&K0[t].prototype,o)for(a in e){if(c=e[a],n.dontCallGetSet?(u=LK(o,a),l=u&&u.value):l=o[a],s=BK(r?a:t+(i?".":"#")+a,n.forced),!s&&l!==void 0){if(typeof c==typeof l)continue;FK(c,l)}(n.sham||l&&l.sham)&&zK(c,"sham",!0),NK(o,a,c,n)}},g_={},UK=f_,HK=t6,QK=Object.keys||function(e){return UK(e,HK)},qK=Wl,WK=n_,VK=Gd,GK=au,XK=bv,KK=QK;g_.f=qK&&!WK?Object.defineProperties:function(e,t){GK(e);for(var r=XK(t),i=KK(t),s=i.length,o=0,a;s>o;)VK.f(e,a=i[o++],r[a]);return e};var YK=Ov,ZK=YK("document","documentElement"),JK=au,eY=g_,rC=t6,tY=J3,nY=ZK,rY=e_,iY=o_,iC=">",sC="<",Fb="prototype",Bb="script",m_=iY("IE_PROTO"),Ax=function(){},y_=function(n){return sC+Bb+iC+n+sC+"/"+Bb+iC},oC=function(n){n.write(y_("")),n.close();var e=n.parentWindow.Object;return n=null,e},sY=function(){var n=rY("iframe"),e="java"+Bb+":",t;return n.style.display="none",nY.appendChild(n),n.src=String(e),t=n.contentWindow.document,t.open(),t.write(y_("document.F=Object")),t.close(),t.F},Y0,Om=function(){try{Y0=new ActiveXObject("htmlfile")}catch{}Om=typeof document<"u"?document.domain&&Y0?oC(Y0):sY():oC(Y0);for(var n=rC.length;n--;)delete Om[Fb][rC[n]];return Om()};tY[m_]=!0;var v_=Object.create||function(e,t){var r;return e!==null?(Ax[Fb]=JK(e),r=new Ax,Ax[Fb]=null,r[m_]=e):r=Om(),t===void 0?r:eY.f(r,t)},oY=_a,aY=v_,lY=Gd.f,Ub=oY("unscopables"),Hb=Array.prototype;Hb[Ub]===void 0&&lY(Hb,Ub,{configurable:!0,value:aY(null)});var n6=function(n){Hb[Ub][n]=!0},cY=Xd,uY=Up,dY=Hp,hY=lu,fY=n6;cY({target:"Array",proto:!0},{at:function(e){var t=uY(this),r=dY(t),i=hY(e),s=i>=0?i:r+i;return s<0||s>=r?void 0:t[s]}});fY("at");var pY=_r,gY=Ln,qp=function(n,e){return gY(pY[n].prototype[e])},mY=qp;mY("Array","at");var yY=Wd,S_=Array.isArray||function(e){return yY(e)==="Array"},vY=TypeError,SY=9007199254740991,xY=function(n){if(n>SY)throw vY("Maximum allowed index exceeded");return n},wY=Wd,bY=Ln,OY=function(n){if(wY(n)==="Function")return bY(n)},aC=OY,kY=W3,CY=xv,PY=aC(aC.bind),TY=function(n,e){return kY(n),e===void 0?n:CY?PY(n,e):function(){return n.apply(e,arguments)}},EY=S_,IY=Hp,MY=xY,AY=TY,x_=function(n,e,t,r,i,s,o,a){for(var l=i,c=0,u=o?AY(o,a):!1,d,h;c<r;)c in t&&(d=u?u(t[c],c,e):t[c],s>0&&EY(d)?(h=IY(d),l=x_(n,e,d,h,l,s-1)-1):(MY(l+1),n[l]=d),l++),c++;return l},w_=x_,_Y=_a,RY=_Y("toStringTag"),b_={};b_[RY]="z";var DY=String(b_)==="[object z]",jY=DY,LY=Dr,km=Wd,zY=_a,NY=zY("toStringTag"),$Y=Object,FY=km(function(){return arguments}())==="Arguments",BY=function(n,e){try{return n[e]}catch{}},O_=jY?km:function(n){var e,t,r;return n===void 0?"Undefined":n===null?"Null":typeof(t=BY(e=$Y(n),NY))=="string"?t:FY?km(e):(r=km(e))==="Object"&&LY(e.callee)?"Arguments":r},UY=Ln,HY=Rr,k_=Dr,QY=O_,qY=Ov,WY=s_,C_=function(){},P_=qY("Reflect","construct"),r6=/^\s*(?:class|function)\b/,VY=UY(r6.exec),GY=!r6.test(C_),bh=function(e){if(!k_(e))return!1;try{return P_(C_,[],e),!0}catch{return!1}},T_=function(e){if(!k_(e))return!1;switch(QY(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return GY||!!VY(r6,WY(e))}catch{return!0}};T_.sham=!0;var XY=!P_||HY(function(){var n;return bh(bh.call)||!bh(Object)||!bh(function(){n=!0})||n})?T_:bh,lC=S_,KY=XY,YY=ou,ZY=_a,JY=ZY("species"),cC=Array,eZ=function(n){var e;return lC(n)&&(e=n.constructor,KY(e)&&(e===cC||lC(e.prototype))?e=void 0:YY(e)&&(e=e[JY],e===null&&(e=void 0))),e===void 0?cC:e},tZ=eZ,E_=function(n,e){return new(tZ(n))(e===0?0:e)},nZ=Xd,rZ=w_,iZ=W3,sZ=Up,oZ=Hp,aZ=E_;nZ({target:"Array",proto:!0},{flatMap:function(e){var t=sZ(this),r=oZ(t),i;return iZ(e),i=aZ(t,0),i.length=rZ(i,t,t,r,0,1,e,arguments.length>1?arguments[1]:void 0),i}});var lZ=n6;lZ("flatMap");var cZ=qp;cZ("Array","flatMap");var uZ=Xd,dZ=w_,hZ=Up,fZ=Hp,pZ=lu,gZ=E_;uZ({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=hZ(this),r=fZ(t),i=gZ(t,0);return i.length=dZ(i,t,t,r,0,e===void 0?1:pZ(e)),i}});var mZ=n6;mZ("flat");var yZ=qp;yZ("Array","flat");var vZ=O_,SZ=String,Wp=function(n){if(vZ(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return SZ(n)},xZ=Xd,wZ=Ln,bZ=Vd,OZ=lu,kZ=Wp,CZ=Rr,PZ=wZ("".charAt),TZ=CZ(function(){return"".at(-2)!=="\uD842"});xZ({target:"String",proto:!0,forced:TZ},{at:function(e){var t=kZ(bZ(this)),r=t.length,i=OZ(e),s=i>=0?i:r+i;return s<0||s>=r?void 0:PZ(t,s)}});var EZ=qp;EZ("String","at");var IZ=au,I_=function(){var n=IZ(this),e="";return n.hasIndices&&(e+="d"),n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.dotAll&&(e+="s"),n.unicode&&(e+="u"),n.unicodeSets&&(e+="v"),n.sticky&&(e+="y"),e},i6=Rr,MZ=_r,s6=MZ.RegExp,o6=i6(function(){var n=s6("a","y");return n.lastIndex=2,n.exec("abcd")!==null}),AZ=o6||i6(function(){return!s6("a","y").sticky}),_Z=o6||i6(function(){var n=s6("^r","gy");return n.lastIndex=2,n.exec("str")!==null}),RZ={BROKEN_CARET:_Z,MISSED_STICKY:AZ,UNSUPPORTED_Y:o6},DZ=Rr,jZ=_r,LZ=jZ.RegExp,zZ=DZ(function(){var n=LZ(".","s");return!(n.dotAll&&n.test(`
`)&&n.flags==="s")}),NZ=Rr,$Z=_r,FZ=$Z.RegExp,BZ=NZ(function(){var n=FZ("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),Hu=Aa,kv=Ln,UZ=Wp,HZ=I_,QZ=RZ,qZ=K3,WZ=v_,VZ=l_.get,GZ=zZ,XZ=BZ,KZ=qZ("native-string-replace",String.prototype.replace),q1=RegExp.prototype.exec,Qb=q1,YZ=kv("".charAt),ZZ=kv("".indexOf),JZ=kv("".replace),_x=kv("".slice),qb=function(){var n=/a/,e=/b*/g;return Hu(q1,n,"a"),Hu(q1,e,"a"),n.lastIndex!==0||e.lastIndex!==0}(),M_=QZ.BROKEN_CARET,Wb=/()??/.exec("")[1]!==void 0,eJ=qb||Wb||M_||GZ||XZ;eJ&&(Qb=function(e){var t=this,r=VZ(t),i=UZ(e),s=r.raw,o,a,l,c,u,d,h;if(s)return s.lastIndex=t.lastIndex,o=Hu(Qb,s,i),t.lastIndex=s.lastIndex,o;var p=r.groups,g=M_&&t.sticky,m=Hu(HZ,t),S=t.source,y=0,x=i;if(g&&(m=JZ(m,"y",""),ZZ(m,"g")===-1&&(m+="g"),x=_x(i,t.lastIndex),t.lastIndex>0&&(!t.multiline||t.multiline&&YZ(i,t.lastIndex-1)!==`
`)&&(S="(?: "+S+")",x=" "+x,y++),a=new RegExp("^(?:"+S+")",m)),Wb&&(a=new RegExp("^"+S+"$(?!\\s)",m)),qb&&(l=t.lastIndex),c=Hu(q1,g?a:t,x),g?c?(c.input=_x(c.input,y),c[0]=_x(c[0],y),c.index=t.lastIndex,t.lastIndex+=c[0].length):t.lastIndex=0:qb&&c&&(t.lastIndex=t.global?c.index+c[0].length:l),Wb&&c&&c.length>1&&Hu(KZ,c[0],a,function(){for(u=1;u<arguments.length-2;u++)arguments[u]===void 0&&(c[u]=void 0)}),c&&p)for(c.groups=d=WZ(null),u=0;u<p.length;u++)h=p[u],d[h[0]]=c[h[1]];return c});var a6=Qb,tJ=Xd,uC=a6;tJ({target:"RegExp",proto:!0,forced:/./.exec!==uC},{exec:uC});var nJ=xv,A_=Function.prototype,dC=A_.apply,hC=A_.call,rJ=typeof Reflect=="object"&&Reflect.apply||(nJ?hC.bind(dC):function(){return hC.apply(dC,arguments)}),fC=Aa,pC=u_,iJ=a6,gC=Rr,__=_a,sJ=Y3,oJ=__("species"),Rx=RegExp.prototype,aJ=function(n,e,t,r){var i=__(n),s=!gC(function(){var c={};return c[i]=function(){return 7},""[n](c)!==7}),o=s&&!gC(function(){var c=!1,u=/a/;return n==="split"&&(u={},u.constructor={},u.constructor[oJ]=function(){return u},u.flags="",u[i]=/./[i]),u.exec=function(){return c=!0,null},u[i](""),!c});if(!s||!o||t){var a=/./[i],l=e(i,""[n],function(c,u,d,h,p){var g=u.exec;return g===iJ||g===Rx.exec?s&&!p?{done:!0,value:fC(a,u,d,h)}:{done:!0,value:fC(c,d,u,h)}:{done:!1}});pC(String.prototype,n,l[0]),pC(Rx,i,l[1])}r&&sJ(Rx[i],"sham",!0)},l6=Ln,lJ=lu,cJ=Wp,uJ=Vd,dJ=l6("".charAt),mC=l6("".charCodeAt),hJ=l6("".slice),yC=function(n){return function(e,t){var r=cJ(uJ(e)),i=lJ(t),s=r.length,o,a;return i<0||i>=s?n?"":void 0:(o=mC(r,i),o<55296||o>56319||i+1===s||(a=mC(r,i+1))<56320||a>57343?n?dJ(r,i):o:n?hJ(r,i,i+2):(o-55296<<10)+(a-56320)+65536)}},fJ={codeAt:yC(!1),charAt:yC(!0)},pJ=fJ.charAt,gJ=function(n,e,t){return e+(t?pJ(n,e).length:1)},c6=Ln,mJ=Up,yJ=Math.floor,Dx=c6("".charAt),vJ=c6("".replace),jx=c6("".slice),SJ=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,xJ=/\$([$&'`]|\d{1,2})/g,R_=function(n,e,t,r,i,s){var o=t+n.length,a=r.length,l=xJ;return i!==void 0&&(i=mJ(i),l=SJ),vJ(s,l,function(c,u){var d;switch(Dx(u,0)){case"$":return"$";case"&":return n;case"`":return jx(e,0,t);case"'":return jx(e,o);case"<":d=i[jx(u,1,-1)];break;default:var h=+u;if(h===0)return c;if(h>a){var p=yJ(h/10);return p===0?c:p<=a?r[p-1]===void 0?Dx(u,1):r[p-1]+Dx(u,1):c}d=r[h-1]}return d===void 0?"":d})},vC=Aa,wJ=au,bJ=Dr,OJ=Wd,kJ=a6,CJ=TypeError,PJ=function(n,e){var t=n.exec;if(bJ(t)){var r=vC(t,n,e);return r!==null&&wJ(r),r}if(OJ(n)==="RegExp")return vC(kJ,n,e);throw new CJ("RegExp#exec called on incompatible receiver")},TJ=rJ,SC=Aa,Cv=Ln,EJ=aJ,IJ=Rr,MJ=au,AJ=Dr,_J=wv,RJ=lu,DJ=h_,gu=Wp,jJ=Vd,LJ=gJ,zJ=V3,NJ=R_,$J=PJ,FJ=_a,Vb=FJ("replace"),BJ=Math.max,UJ=Math.min,HJ=Cv([].concat),Lx=Cv([].push),xC=Cv("".indexOf),wC=Cv("".slice),QJ=function(n){return n===void 0?n:String(n)},qJ=function(){return"a".replace(/./,"$0")==="$0"}(),bC=function(){return/./[Vb]?/./[Vb]("a","$0")==="":!1}(),WJ=!IJ(function(){var n=/./;return n.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(n,"$<a>")!=="7"});EJ("replace",function(n,e,t){var r=bC?"$":"$0";return[function(s,o){var a=jJ(this),l=_J(s)?void 0:zJ(s,Vb);return l?SC(l,s,a,o):SC(e,gu(a),s,o)},function(i,s){var o=MJ(this),a=gu(i);if(typeof s=="string"&&xC(s,r)===-1&&xC(s,"$<")===-1){var l=t(e,o,a,s);if(l.done)return l.value}var c=AJ(s);c||(s=gu(s));var u=o.global,d;u&&(d=o.unicode,o.lastIndex=0);for(var h=[],p;p=$J(o,a),!(p===null||(Lx(h,p),!u));){var g=gu(p[0]);g===""&&(o.lastIndex=LJ(a,DJ(o.lastIndex),d))}for(var m="",S=0,y=0;y<h.length;y++){p=h[y];for(var x=gu(p[0]),w=BJ(UJ(RJ(p.index),a.length),0),O=[],T,E=1;E<p.length;E++)Lx(O,QJ(p[E]));var C=p.groups;if(c){var M=HJ([x],O,w,a);C!==void 0&&Lx(M,C),T=gu(TJ(s,void 0,M))}else T=NJ(x,a,w,O,C,s);w>=S&&(m+=wC(a,S,w)+T,S=w+x.length)}return m+wC(a,S)}]},!WJ||!qJ||bC);var VJ=ou,GJ=Wd,XJ=_a,KJ=XJ("match"),YJ=function(n){var e;return VJ(n)&&((e=n[KJ])!==void 0?!!e:GJ(n)==="RegExp")},ZJ=Aa,JJ=Vl,eee=WA,tee=I_,OC=RegExp.prototype,nee=function(n){var e=n.flags;return e===void 0&&!("flags"in OC)&&!JJ(n,"flags")&&eee(OC,n)?ZJ(tee,n):e},ree=Xd,iee=Aa,u6=Ln,kC=Vd,see=Dr,oee=wv,aee=YJ,Oh=Wp,lee=V3,cee=nee,uee=R_,dee=_a,hee=dee("replace"),fee=TypeError,zx=u6("".indexOf);u6("".replace);var CC=u6("".slice),pee=Math.max;ree({target:"String",proto:!0},{replaceAll:function(e,t){var r=kC(this),i,s,o,a,l,c,u,d,h,p,g=0,m="";if(!oee(e)){if(i=aee(e),i&&(s=Oh(kC(cee(e))),!~zx(s,"g")))throw new fee("`.replaceAll` does not allow non-global regexes");if(o=lee(e,hee),o)return iee(o,e,r,t)}for(a=Oh(r),l=Oh(e),c=see(t),c||(t=Oh(t)),u=l.length,d=pee(1,u),h=zx(a,l);h!==-1;)p=c?Oh(t(l,h,a)):uee(l,a,h,[],void 0,t),m+=CC(a,g,h)+p,g=h+u,h=h+d>a.length?-1:zx(a,l,h+d);return g<a.length&&(m+=CC(a,g)),m}});var gee=qp;gee("String","replaceAll");function D_(n){return n&&typeof n=="object"&&"parents"in n}function j_(n){for(let e=0,t=n.parents.length;e<t;e++)if(n.parents[e].__unsafe__getWithoutCapture(!0),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}const W1=(n,e)=>{if(n.children.remove(e)&&n.children.isEmpty&&D_(n))for(let t=0,r=n.parents.length;t<r;t++)W1(n.parents[t],n)},d6=(n,e)=>{if(n.children.add(e)&&D_(n))for(let t=0,r=n.parents.length;t<r;t++)d6(n.parents[t],n)};function L_(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function Gl(n,e){const t=Symbol.for(`com.tldraw.state/${n}`),r=globalThis;return r[t]??(r[t]=e()),r[t]}const ua=Gl("empty_array",()=>Object.freeze([])),PC=8;class V1{constructor(){v(this,"arraySize",0);v(this,"array",Array(PC));v(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<PC?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const r=this.array[t];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const ki=Symbol.for("com.tldraw.state/RESET_VALUE");class z_{constructor(e){v(this,"index",0);v(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,r){if(r!==void 0){if(r===ki){this.clear();return}this.buffer[this.index]=[e,t,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:r,buffer:i}=this;for(let s=0;s<r;s++){const o=(t-1+r-s)%r,a=i[o];if(!a)return ki;const[l,c]=a;if(s===0&&e>=c)return[];if(l<=e&&e<c){const u=s+1,d=new Array(u);for(let h=0;h<u;h++)d[h]=i[(o+h)%r][2];return d}}return ki}}class mee{constructor(e,t){v(this,"offset",0);v(this,"maybeRemoved");this.below=e,this.child=t}}const Ut=Gl("capture",()=>({stack:null}));function Z0(n){const e=Ut.stack;Ut.stack=null;try{return n()}finally{Ut.stack=e}}function N_(n){Ut.stack=new mee(Ut.stack,n),n.parentSet.clear()}function $_(){const n=Ut.stack;if(Ut.stack=n.below,n.offset<n.child.parents.length){for(let e=n.offset;e<n.child.parents.length;e++){const t=n.child.parents[e];n.child.parentSet.has(t)||W1(t,n.child)}n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset}if(n.maybeRemoved)for(let e=0;e<n.maybeRemoved.length;e++){const t=n.maybeRemoved[e];n.child.parentSet.has(t)||W1(t,n.child)}}function G1(n){if(Ut.stack){if(Ut.stack.child.parentSet.has(n))return;if(Ut.stack.child.parentSet.add(n),Ut.stack.child.isActivelyListening&&d6(n,Ut.stack.child),Ut.stack.offset<Ut.stack.child.parents.length){const t=Ut.stack.child.parents[Ut.stack.offset];t!==n&&(Ut.stack.maybeRemoved?Ut.stack.maybeRemoved.push(t):Ut.stack.maybeRemoved=[t])}Ut.stack.child.parents[Ut.stack.offset]=n,Ut.stack.child.parentEpochs[Ut.stack.offset]=n.lastChangedEpoch,Ut.stack.offset++}}const ol=-1;class yee{constructor(e,t,r){v(this,"_isActivelyListening",!1);v(this,"lastTraversedEpoch",ol);v(this,"lastReactedEpoch",ol);v(this,"_scheduleCount",0);v(this,"parentSet",new V1);v(this,"parentEpochs",[]);v(this,"parents",[]);v(this,"_scheduleEffect");v(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Hr()){if(this.parents.length&&!j_(this)){this.lastReactedEpoch=Hr();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)d6(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)W1(this.parents[e],this)}execute(){try{N_(this);const e=Hr(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{$_()}}}const Kd=Gl("EffectScheduler",()=>yee);function Xl(n,e,t){const r=new Kd(n,e,t);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function vee(n,e,t){const r=new Kd(n,e,t);return{scheduler:r,start:i=>{const s=(i==null?void 0:i.force)??!1;r.attach(),s?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}let See=class{constructor(e){v(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){this.isRoot?F_(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){St.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{var r;t.set(e),(r=t.historyBuffer)==null||r.clear()}),this.commit()}};const St=Gl("transactions",()=>({globalEpoch:ol+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:ol+1}));function xee(){return St.reactionEpoch}function Hr(){return St.globalEpoch}function wee(){return St.globalIsReacting}function h6(n,e){e.lastTraversedEpoch!==St.globalEpoch&&(e.lastTraversedEpoch=St.globalEpoch,e instanceof Kd?n.add(e):e.children.visit(t=>h6(n,t)))}function F_(n){var e;if(St.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{St.globalIsReacting=!0,St.reactionEpoch=St.globalEpoch;const t=new Set;for(const i of n)i.children.visit(s=>h6(t,s));for(const i of t)i.maybeScheduleEffect();let r=0;for(;(e=St.cleanupReactors)!=null&&e.size;){if(r++>1e3)throw new Error("Reaction update depth limit exceeded");const i=St.cleanupReactors;St.cleanupReactors=null;for(const s of i)s.maybeScheduleEffect()}}finally{St.cleanupReactors=null,St.globalIsReacting=!1}}function bee(n,e){if(St.globalIsReacting){const t=St.cleanupReactors??(St.cleanupReactors=new Set);n.children.visit(r=>h6(t,r))}else St.currentTransaction?St.currentTransaction.initialAtomValues.has(n)||St.currentTransaction.initialAtomValues.set(n,e):F_([n])}function Oee(){St.globalEpoch++}function kee(n){const e=new See(St.currentTransaction);St.currentTransaction=e;try{let t,r=!1;try{t=n(()=>r=!0)}catch(i){throw e.abort(),i}return r?e.abort():e.commit(),t}finally{St.currentTransaction=St.currentTransaction.parent}}function Es(n){return St.currentTransaction?n():kee(n)}class Cee{constructor(e,t,r){v(this,"isEqual");v(this,"computeDiff");v(this,"lastChangedEpoch",Hr());v(this,"children",new V1);v(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new z_(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return G1(this),this.current}set(e,t){var i,s;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,e))??L_(this.current,e))return this.current;Oee(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Hr(),t??((s=this.computeDiff)==null?void 0:s.call(this,this.current,e,this.lastChangedEpoch,Hr()))??ki),this.lastChangedEpoch=Hr();const r=this.current;return this.current=e,bee(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return G1(this),e>=this.lastChangedEpoch?ua:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??ki}}const B_=Gl("Atom",()=>Cee);function mn(n,e,t){return new B_(n,e,t)}let TC=!1;function Pee(){TC||(TC=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const Gh=Symbol.for("com.tldraw.state/UNINITIALIZED"),Ec=n=>n===Gh,Gb=Gl("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function Xh(n,e){return new Gb(n,e)}class Tee{constructor(e,t,r){v(this,"lastChangedEpoch",ol);v(this,"lastTraversedEpoch",ol);v(this,"lastCheckedEpoch",ol);v(this,"parentSet",new V1);v(this,"parents",[]);v(this,"parentEpochs",[]);v(this,"children",new V1);v(this,"historyBuffer");v(this,"state",Gh);v(this,"error",null);v(this,"computeDiff");v(this,"isEqual");this.name=e,this.derive=t,r!=null&&r.historyLength&&(this.historyBuffer=new z_(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??L_}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var i;const t=this.lastChangedEpoch===ol,r=Hr();if(!t&&(this.lastCheckedEpoch===r||this.isActivelyListening&&wee()&&this.lastTraversedEpoch<xee()||!j_(this)))if(this.lastCheckedEpoch=r,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{N_(this);const s=this.derive(this.state,this.lastCheckedEpoch),o=s instanceof Gb?s.value:s,a=this.state===Gh;if(a||!this.isEqual(o,this.state)){if(this.historyBuffer&&!a){const l=s instanceof Gb?s.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Hr(),l??((i=this.computeDiff)==null?void 0:i.call(this,this.state,o,this.lastCheckedEpoch,Hr()))??ki)}this.lastChangedEpoch=Hr(),this.state=o}return this.error=null,this.lastCheckedEpoch=Hr(),this.state}catch(s){if(this.state!==Gh&&(this.state=Gh,this.lastChangedEpoch=Hr()),this.lastCheckedEpoch=Hr(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:s},!e)throw s;return this.state}finally{$_()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{G1(this)}}getDiffSince(e){var t;return this.__unsafe__getWithoutCapture(!0),G1(this),e>=this.lastChangedEpoch?ua:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??ki}}const Pv=Gl("Computed",()=>Tee);function Eee(n={},e,t,r){const i=r.value,s=Symbol.for("__@tldraw/state__computed__"+t);return r.value=function(){let o=this[s];return o||(o=new Pv(t,i.bind(this),n),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r.value[Mee]=!0,r}function EC(n={},e,t,r){return r.get?(Pee(),Iee(n,e,t,r)):Eee(n,e,t,r)}function Iee(n={},e,t,r){const i=r.get,s=Symbol.for("__@tldraw/state__computed__"+t);return r.get=function(){let o=this[s];return o||(o=new Pv(t,i.bind(this),n),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r}const Mee="@@__isComputedMethod__@@";function te(){if(arguments.length===1){const n=arguments[0];return(e,t,r)=>EC(n,e,t,r)}else return typeof arguments[0]=="string"?new Pv(arguments[0],arguments[1],arguments[2]):EC(void 0,arguments[0],arguments[1],arguments[2])}function Aee(n){return n instanceof B_||n instanceof Pv}const U_=1,_ee=Gl("apiVersion",()=>U_);if(_ee!==U_)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");var H_="Expected a function",IC=NaN,Ree="[object Symbol]",Dee=/^\s+|\s+$/g,jee=/^[-+]0x[0-9a-f]+$/i,Lee=/^0b[01]+$/i,zee=/^0o[0-7]+$/i,Nee=parseInt,$ee=typeof gr=="object"&&gr&&gr.Object===Object&&gr,Fee=typeof self=="object"&&self&&self.Object===Object&&self,Bee=$ee||Fee||Function("return this")(),Uee=Object.prototype,Hee=Uee.toString,Qee=Math.max,qee=Math.min,Nx=function(){return Bee.Date.now()};function Wee(n,e,t){var r,i,s,o,a,l,c=0,u=!1,d=!1,h=!0;if(typeof n!="function")throw new TypeError(H_);e=MC(e)||0,X1(t)&&(u=!!t.leading,d="maxWait"in t,s=d?Qee(MC(t.maxWait)||0,e):s,h="trailing"in t?!!t.trailing:h);function p(E){var C=r,M=i;return r=i=void 0,c=E,o=n.apply(M,C),o}function g(E){return c=E,a=setTimeout(y,e),u?p(E):o}function m(E){var C=E-l,M=E-c,A=e-C;return d?qee(A,s-M):A}function S(E){var C=E-l,M=E-c;return l===void 0||C>=e||C<0||d&&M>=s}function y(){var E=Nx();if(S(E))return x(E);a=setTimeout(y,m(E))}function x(E){return a=void 0,h&&r?p(E):(r=i=void 0,o)}function w(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function O(){return a===void 0?o:x(Nx())}function T(){var E=Nx(),C=S(E);if(r=arguments,i=this,l=E,C){if(a===void 0)return g(l);if(d)return a=setTimeout(y,e),p(l)}return a===void 0&&(a=setTimeout(y,e)),o}return T.cancel=w,T.flush=O,T}function Vee(n,e,t){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(H_);return X1(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),Wee(n,e,{leading:r,maxWait:e,trailing:i})}function X1(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function Gee(n){return!!n&&typeof n=="object"}function Xee(n){return typeof n=="symbol"||Gee(n)&&Hee.call(n)==Ree}function MC(n){if(typeof n=="number")return n;if(Xee(n))return IC;if(X1(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=X1(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(Dee,"");var t=Lee.test(n);return t||zee.test(n)?Nee(n.slice(2),t?2:8):jee.test(n)?IC:+n}var Kee=Vee;const Q_=Ul(Kee);var Yee=200,f6="__lodash_hash_undefined__",Zee=1/0,Jee="[object Function]",ete="[object GeneratorFunction]",tte=/[\\^$.*+?()[\]{}|]/g,nte=/^\[object .+?Constructor\]$/,rte=typeof gr=="object"&&gr&&gr.Object===Object&&gr,ite=typeof self=="object"&&self&&self.Object===Object&&self,p6=rte||ite||Function("return this")();function ste(n,e){var t=n?n.length:0;return!!t&&ate(n,e,0)>-1}function ote(n,e,t,r){for(var i=n.length,s=t+-1;++s<i;)if(e(n[s],s,n))return s;return-1}function ate(n,e,t){if(e!==e)return ote(n,lte,t);for(var r=t-1,i=n.length;++r<i;)if(n[r]===e)return r;return-1}function lte(n){return n!==n}function cte(n,e){return n.has(e)}function ute(n,e){return n==null?void 0:n[e]}function dte(n){var e=!1;if(n!=null&&typeof n.toString!="function")try{e=!!(n+"")}catch{}return e}function q_(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var hte=Array.prototype,fte=Function.prototype,W_=Object.prototype,$x=p6["__core-js_shared__"],AC=function(){var n=/[^.]+$/.exec($x&&$x.keys&&$x.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),V_=fte.toString,g6=W_.hasOwnProperty,pte=W_.toString,gte=RegExp("^"+V_.call(g6).replace(tte,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),mte=hte.splice,yte=m6(p6,"Map"),Fx=m6(p6,"Set"),sp=m6(Object,"create");function zc(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function vte(){this.__data__=sp?sp(null):{}}function Ste(n){return this.has(n)&&delete this.__data__[n]}function xte(n){var e=this.__data__;if(sp){var t=e[n];return t===f6?void 0:t}return g6.call(e,n)?e[n]:void 0}function wte(n){var e=this.__data__;return sp?e[n]!==void 0:g6.call(e,n)}function bte(n,e){var t=this.__data__;return t[n]=sp&&e===void 0?f6:e,this}zc.prototype.clear=vte;zc.prototype.delete=Ste;zc.prototype.get=xte;zc.prototype.has=wte;zc.prototype.set=bte;function Yd(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function Ote(){this.__data__=[]}function kte(n){var e=this.__data__,t=Tv(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():mte.call(e,t,1),!0}function Cte(n){var e=this.__data__,t=Tv(e,n);return t<0?void 0:e[t][1]}function Pte(n){return Tv(this.__data__,n)>-1}function Tte(n,e){var t=this.__data__,r=Tv(t,n);return r<0?t.push([n,e]):t[r][1]=e,this}Yd.prototype.clear=Ote;Yd.prototype.delete=kte;Yd.prototype.get=Cte;Yd.prototype.has=Pte;Yd.prototype.set=Tte;function Zd(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function Ete(){this.__data__={hash:new zc,map:new(yte||Yd),string:new zc}}function Ite(n){return Ev(this,n).delete(n)}function Mte(n){return Ev(this,n).get(n)}function Ate(n){return Ev(this,n).has(n)}function _te(n,e){return Ev(this,n).set(n,e),this}Zd.prototype.clear=Ete;Zd.prototype.delete=Ite;Zd.prototype.get=Mte;Zd.prototype.has=Ate;Zd.prototype.set=_te;function K1(n){var e=-1,t=n?n.length:0;for(this.__data__=new Zd;++e<t;)this.add(n[e])}function Rte(n){return this.__data__.set(n,f6),this}function Dte(n){return this.__data__.has(n)}K1.prototype.add=K1.prototype.push=Rte;K1.prototype.has=Dte;function Tv(n,e){for(var t=n.length;t--;)if(Ute(n[t][0],e))return t;return-1}function jte(n){if(!G_(n)||$te(n))return!1;var e=Hte(n)||dte(n)?gte:nte;return e.test(Fte(n))}function Lte(n,e,t){var r=-1,i=ste,s=n.length,o=!0,a=[],l=a;if(s>=Yee){var c=zte(n);if(c)return q_(c);o=!1,i=cte,l=new K1}else l=a;e:for(;++r<s;){var u=n[r],d=u;if(u=u!==0?u:0,o&&d===d){for(var h=l.length;h--;)if(l[h]===d)continue e;a.push(u)}else i(l,d,t)||(l!==a&&l.push(d),a.push(u))}return a}var zte=Fx&&1/q_(new Fx([,-0]))[1]==Zee?function(n){return new Fx(n)}:Qte;function Ev(n,e){var t=n.__data__;return Nte(e)?t[typeof e=="string"?"string":"hash"]:t.map}function m6(n,e){var t=ute(n,e);return jte(t)?t:void 0}function Nte(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function $te(n){return!!AC&&AC in n}function Fte(n){if(n!=null){try{return V_.call(n)}catch{}try{return n+""}catch{}}return""}function Bte(n){return n&&n.length?Lte(n):[]}function Ute(n,e){return n===e||n!==n&&e!==e}function Hte(n){var e=G_(n)?pte.call(n):"";return e==Jee||e==ete}function G_(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function Qte(){}var qte=Bte;const Wte=Ul(qte),Kh={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},Vte=Kh.Good;class X_{constructor(){v(this,"startTime",0);v(this,"name","");v(this,"frames",0);v(this,"started",!1);v(this,"frame",null);v(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,t=e===0?0:Math.floor(this.frames/e),r=t>55?Kh.Good:t>30?Kh.Mid:Kh.Poor,i=r===Kh.Mid?"black":"white",s=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${s} %c${t}%c fps`,`color: white; background: ${Vte};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${r};color: ${i};`,"font-weight: normal")}isStarted(){return this.started}}function y6(n,e){const t=[];e:for(const r of n){for(const i of t)if(e?e(r,i):r===i)continue e;t.push(r)}return t}function He(n){return n.filter(e=>e!=null)}function Hn(n){return n[n.length-1]}function Gte(n,e){let t,r=1/0;for(const i of n){const s=e(i);s<r&&(t=i,r=s)}return t}function Xte(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Object.is(n[t],e[t]))return!1;return!0}class wa{constructor(){v(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function K_(n){const e=(...t)=>{try{return n(...t)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}const op=()=>{},wl={ok(n){return{ok:!0,value:n}},err(n){return{ok:!1,error:n}}};function Vn(n,e){const t=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${t}`)}const Ye=K_((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),Qi=K_((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function Y_(n,e){let t;const r=(...i)=>(t||(t={},t.promise=new Promise((s,o)=>{t.resolve=s,t.reject=o})),clearTimeout(t.timeout),t.latestArgs=i,t.timeout=setTimeout(()=>{const s=t;t=void 0;try{s.resolve(n(...s.latestArgs))}catch(o){s.reject(o)}},e),t.promise);return r.cancel=()=>{t&&clearTimeout(t.timeout)},r}const _C=new WeakMap;function v6(n,e){if(typeof n!="object"||n===null)return;let t=_C.get(n);t||(t={tags:{},extras:{}},_C.set(n,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}async function Oo(n,e){return window.fetch(n,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const Cd=(n,e)=>{const t=new window.Image(n,e);return t.referrerPolicy="strict-origin-when-cross-origin",t};class Ic{static async dataUrlToArrayBuffer(e){return Oo(e).then(function(t){return t.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((t,r)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s=>r(s),i.onabort=s=>r(s),i.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,r)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s=>r(s),i.onabort=s=>r(s),i.readAsText(e)}})}}function Xb(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e+""}function Kte(n){const e=new DataView(n);let t=0;for(let r=0;r<e.byteLength;r++)t=(t<<5)-t+e.getUint8(r),t|=0;return t+""}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function Yte(n){const e=new Uint8Array(n);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function r(s,o,a,l,c=1024){if(!o)return-1;o=new RegExp(o,"g");const u=o.source.length,d=new TextDecoder,h=s.length;if(typeof l>"u"&&(l=h),a>=h||l<=0||a>=l)return-1;s=s.subarray(a,l);let p=-1,g=0,m=0,S="";e:for(;g<s.length;){const y=g+c,x=s.subarray(g,y),w=d.decode(x,{stream:!0}),O=S+w;let T,E=-1;for(;(T=o.exec(O))!==null;){E=T.index-S.length,p=m+E;break e}g=y,m+=w.length;const C=E>-1?E+u:w.length-u;S=w.slice(C)}return p>=0&&(p+=a>=0?a:h+a),p}const i=r(e,"IDAT",12);return i>=12?r(e,"acTL",8,i)>=8:!1}const Zte=n=>new Uint8Array(n)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Jzef Sokoowski <j.k.sokolowski@gmail.com>
 */function RC(n,e){let t=0;for(;n[e+t];)t+=n[e+t]+1;return t+1}function Jte(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function ene(n){const e=new Uint8Array(n);let t,r,i=0,s=0;if(!Jte(n))return!1;for(t=e[10]&128,r=e[10]&7,i+=6,i+=7,i+=t?3*Math.pow(2,r+1):0;s<2&&i<e.length;)switch(e[i]){case 44:s+=1,t=e[i+9]&128,r=e[i+9]&7,i+=10,i+=t?3*Math.pow(2,r+1):0,i+=RC(e,i+1)+1;break;case 33:i+=2,i+=RC(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return s>1}let Kb=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(Kb=new Int32Array(Kb));/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */const tne=(n,e)=>{let t=~~e^-1;for(let r=0;r<n.length;r++)t=Kb[(t^n[r])&255]^t>>>8;return t^-1},DC=4,jC=4;class ro{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const r={};if(!ro.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const i=t,s=e.getInt32(t);t+=4;const o=ro.getChunkType(e,t);if(o==="IDAT"&&r[o]){t+=s+DC+jC;continue}if(o==="IEND")break;r[o]={start:i,dataOffset:t+4,size:s},t+=s+DC+jC}return r}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return ro.readChunks(e)[t]}static setPhysChunk(e,t=1,r){let i=46,s=0;const o=ro.findChunk(e,"pHYs");o&&(i=o.start,s=o.size);const a=ro.findChunk(e,"IDAT");a&&(i=a.start,s=0);const l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,112),c.setUint8(5,72),c.setUint8(6,89),c.setUint8(7,115);const u=2835.5;c.setInt32(8,u*t),c.setInt32(12,u*t),c.setInt8(16,1);const d=new Uint8Array(l.slice(4,17));c.setInt32(17,tne(d));const h=e.buffer.slice(0,i),p=e.buffer.slice(i+s);return new Blob([h,l,p],r)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function nne(n){return!n||n.length<12?!1:n[8]===87&&n[9]===69&&n[10]===66&&n[11]===80}function rne(n){const e=new Uint8Array(n);return!nne(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const Z_=Object.freeze(["image/svg+xml"]),J_=Object.freeze(["image/jpeg","image/png","image/webp"]),eR=Object.freeze(["image/gif","image/apng","image/avif"]),S6=Object.freeze([...J_,...Z_,...eR]),tR=Object.freeze(["video/mp4","video/webm","video/quicktime"]),ine=[...S6,...tR].join(",");class ao{static loadVideo(e){return new Promise((t,r)=>{const i=document.createElement("video");i.onloadeddata=()=>t(i),i.onerror=s=>{console.error(s),r(new Error("Could not load video"))},i.crossOrigin="anonymous",i.src=e})}static loadImage(e){return new Promise((t,r)=>{const i=Cd();i.onload=()=>t(i),i.onerror=s=>{console.error(s),r(new Error("Could not load image"))},i.crossOrigin="anonymous",i.referrerPolicy="strict-origin-when-cross-origin",i.src=e})}static async getVideoSize(e){return ao.usingObjectURL(e,async t=>{const r=await ao.loadVideo(t);return{w:r.videoWidth,h:r.videoHeight}})}static async getImageSize(e){const t=await ao.usingObjectURL(e,ao.loadImage);try{if(e.type==="image/png"){const r=new DataView(await e.arrayBuffer());if(ro.isPng(r,0)){const i=ro.findChunk(r,"pHYs");if(i){const s=ro.parsePhys(r,i.dataOffset);if(s.unit===0&&s.ppux===s.ppuy){const o=Math.max(s.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/o),h:Math.round(t.naturalHeight/o)}}}}}}catch(r){return console.error(r),{w:t.naturalWidth,h:t.naturalHeight}}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?ene(await e.arrayBuffer()):e.type==="image/avif"?Zte(await e.arrayBuffer()):e.type==="image/webp"?rne(await e.arrayBuffer()):e.type==="image/apng"?Yte(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return eR.includes(e||"")}static isStaticImageType(e){return J_.includes(e||"")}static isVectorImageType(e){return Z_.includes(e||"")}static isImageType(e){return S6.includes(e)}static async usingObjectURL(e,t){const r=URL.createObjectURL(e);try{return await t(r)}finally{URL.revokeObjectURL(r)}}}function Wr(n,e,t){return n+(e-n)*t}function Ls(n=""){let e=0,t=0,r=0,i=0;function s(){const o=e^e<<11;return e=t,t=r,r=i,i^=(i>>>19^o^o>>>8)>>>0,i/4294967296*2}for(let o=0;o<n.length+64;o++)e^=n.charCodeAt(o)|0,s();return s}function Pd(n,e,t,r=!1){const[i,s]=e,[o,a]=t,l=o+(n-i)/(s-i)*(a-o);return r?o<a?Math.max(Math.min(l,a),o):Math.max(Math.min(l,o),a):l}function So(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Yr(n,e){if(So(n,e))return n[e]}function LC(n){return Object.keys(n)}function Gt(n){return Object.values(n)}function Kn(n){return Object.entries(n)}function nR(n){return Object.fromEntries(n)}function Tf(n,e){const t={};let r=!1;for(const[i,s]of Kn(n))e(i,s)?t[i]=s:r=!0;return r?t:n}function Vp(n,e){const t={};for(const[r,i]of Kn(n)){const s=e(r,i);t[r]=s}return t}function x6(n,e){if(n===e)return!0;const t=new Set(Object.keys(n)),r=new Set(Object.keys(e));if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i)||!Object.is(n[i],e[i]))return!1;return!0}const xi="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",rR="a0",iR="A00000000000000000000000000";function sR(n){if(n>="a"&&n<="z")return n.charCodeAt(0)-97+2;if(n>="A"&&n<="Z")return 90-n.charCodeAt(0)+2;throw new Error("Invalid index key head: "+n)}function oR(n){if(n.length!==sR(n.charAt(0)))throw new Error("invalid integer part of index key: "+n)}function zC(n){if(n===void 0)throw Error("n is undefined")}function NC(n){oR(n);const[e,...t]=n.split("");let r=!0;for(let i=t.length-1;r&&i>=0;i--){const s=xi.indexOf(t[i])+1;s===xi.length?t[i]="0":(t[i]=xi.charAt(s),r=!1)}if(r){if(e==="Z")return"a0";if(e==="z")return;const i=String.fromCharCode(e.charCodeAt(0)+1);return i>"a"?t.push("0"):t.pop(),i+t.join("")}else return e+t.join("")}function sne(n){oR(n);const[e,...t]=n.split("");let r=!0;for(let i=t.length-1;r&&i>=0;i--){const s=xi.indexOf(t[i])-1;s===-1?t[i]=xi.slice(-1):(t[i]=xi.charAt(s),r=!1)}if(r){if(e==="a")return"Z"+xi.slice(-1);if(e==="A")return;const i=String.fromCharCode(e.charCodeAt(0)-1);return i<"Z"?t.push(xi.slice(-1)):t.pop(),i+t.join("")}else return e+t.join("")}function Qu(n,e){if(e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n.slice(-1)==="0"||e&&e.slice(-1)==="0")throw new Error("trailing zero");if(e){let i=0;for(;(n.charAt(i)||"0")===e.charAt(i);)i++;if(i>0)return e.slice(0,i)+Qu(n.slice(i),e.slice(i))}const t=n?xi.indexOf(n.charAt(0)):0,r=e!==void 0?xi.indexOf(e.charAt(0)):xi.length;if(r-t>1){const i=Math.round(.5*(t+r));return xi.charAt(i)}else return e&&e.length>1?e.slice(0,1):xi.charAt(t)+Qu(n.slice(1),void 0)}function Yh(n){const e=sR(n.charAt(0));if(e>n.length)throw new Error("invalid index: "+n);return n.slice(0,e)}function Yb(n){if(n===iR)throw new Error("invalid index: "+n);const e=Yh(n);if(n.slice(e.length).slice(-1)==="0")throw new Error("invalid index: "+n)}function mu(n,e){if(n!==void 0&&Yb(n),e!==void 0&&Yb(e),n!==void 0&&e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n===void 0&&e===void 0)return rR;if(n===void 0){if(e===void 0)throw Error("b is undefined");const a=Yh(e),l=e.slice(a.length);if(a===iR)return a+Qu("",l);if(a<e)return a;const c=sne(a);return zC(c),c}if(e===void 0){const a=Yh(n),l=n.slice(a.length),c=NC(a);return c===void 0?a+Qu(l,void 0):c}const t=Yh(n),r=n.slice(t.length),i=Yh(e),s=e.slice(i.length);if(t===i)return t+Qu(r,s);const o=NC(t);return zC(o),o<e?o:t+Qu(r,void 0)}function Tl(n,e,t){if(t===0)return[];if(t===1)return[mu(n,e)];if(e===void 0){let s=mu(n,e);const o=[s];for(let a=0;a<t-1;a++)s=mu(s,e),o.push(s);return o}if(n===void 0){let s=mu(n,e);const o=[s];for(let a=0;a<t-1;a++)s=mu(n,s),o.push(s);return o.reverse(),o}const r=Math.floor(t/2),i=mu(n,e);return[...Tl(n,i,r),i,...Tl(i,e,t-r-1)]}const aR=rR;function one(n){Yb(n)}function Td(n,e,t){return Tl(n,e,t)}function Bx(n,e){return Tl(n,void 0,e)}function ap(n,e){return Tl(n,e,1)[0]}function bs(n){return Tl(n,void 0,1)[0]}function ane(n){return Tl(void 0,n,1)[0]}function lp(n,e="a1"){return[e,...Tl(e,void 0,n)]}function fr(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function lne(n,e){return n.id>e.id?1:-1}function w6(n){try{return localStorage.getItem(n)}catch{return null}}function b6(n,e){try{localStorage.setItem(n,e)}catch{}}function cne(){try{localStorage.clear()}catch{}}function lR(n){try{return sessionStorage.getItem(n)}catch{return null}}function O6(n,e){try{sessionStorage.setItem(n,e)}catch{}}function cR(n){try{sessionStorage.removeItem(n)}catch{}}function une(){try{sessionStorage.clear()}catch{}}const uR=()=>typeof process<"u"&&!1,lo=[],dne=60,Ef=Math.ceil(1e3/dne);let yc,Ux=0,Y1=0;const hne=()=>{const n=lo.splice(0,lo.length);for(const e of n)e()};function k6(){if(yc)return;const n=Date.now(),e=n-Y1;if(Ux+e<Ef){yc=requestAnimationFrame(()=>{yc=void 0,k6()});return}yc=requestAnimationFrame(()=>{yc=void 0,Y1=n,Ux=Math.min(Ux+e-Ef,Ef*10),hne()})}let Z1=!1;function $C(n){if(uR())return n.cancel=()=>yc&&cancelAnimationFrame(yc),n;const e=()=>{lo.includes(n)||(lo.push(n),Z1||(Z1=!0,Y1=Date.now()-Ef-1),k6())};return e.cancel=()=>{const t=lo.indexOf(n);t>-1&&lo.splice(t,1)},e}function dR(n){return uR()?(n(),()=>{}):(lo.includes(n)||(lo.push(n),Z1||(Z1=!0,Y1=Date.now()-Ef-1),k6()),()=>{const e=lo.indexOf(n);e>-1&&lo.splice(e,1)})}class fne{constructor(){v(this,"timeouts",[]);v(this,"intervals",[]);v(this,"rafs",[])}setTimeout(e,t,...r){const i=window.setTimeout(e,t,r);return this.timeouts.push(i),i}setInterval(e,t,...r){const i=window.setInterval(e,t,r);return this.intervals.push(i),i}requestAnimationFrame(e){const t=window.requestAnimationFrame(e);return this.rafs.push(t),t}dispose(){this.timeouts.forEach(e=>clearTimeout(e)),this.intervals.forEach(e=>clearInterval(e)),this.rafs.forEach(e=>cancelAnimationFrame(e)),this.timeouts.length=0,this.intervals.length=0,this.rafs.length=0}}function pne(n){return n!==null}function gne(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[n=>n&&JSON.parse(JSON.stringify(n)),!1]}const hR=gne(),It=hR[0];hR[1];const mne=Object.getPrototypeOf(It({})),FC=new Set;function yne(n){FC.has(n)||(FC.add(n),console.warn(`[tldraw] ${n}`))}var Hx={};const C6={enableLicensing:vne("enableLicensing",{defaults:{all:!0,production:!1}})},fR=Fr("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),un={logPreventDefaults:Fr("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:Fr("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:Fr("logElementRemoves",{defaults:{all:!1}}),debugSvg:Fr("debugSvg",{defaults:{all:!1}}),showFps:Fr("showFps",{defaults:{all:!1}}),measurePerformance:Fr("measurePerformance",{defaults:{all:!1}}),throwToBlob:Fr("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:Fr("reconnectOnPing",{defaults:{all:!1}}),debugCursors:Fr("debugCursors",{defaults:{all:!1}}),forceSrgb:Fr("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Fr("debugGeometry",{defaults:{all:!1}}),hideShapes:Fr("hideShapes",{defaults:{all:!1}}),editOnType:Fr("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const n=Element.prototype.removeChild;Xl("element removal logging",()=>{un.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function Fr(n,{defaults:e,shouldStoreForSession:t=!0}){return pR({name:n,defaults:e,shouldStoreForSession:t})}function vne(n,{defaults:e,shouldStoreForSession:t=!0}){return pR({name:n,defaults:e,shouldStoreForSession:t})}function pR(n){const e=xne(n),t=n.shouldStoreForSession?Sne(n.name):null,r=mn(`debug:${n.name}`,t??e);return typeof window<"u"&&(n.shouldStoreForSession&&Xl(`debug:${n.name}`,()=>{const i=r.get();i===e?cR(`tldraw_debug:${n.name}`):O6(`tldraw_debug:${n.name}`,JSON.stringify(i))}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return r.get()},set(i){r.set(i)},configurable:!0})),Object.assign(r,n)}function Sne(n){try{return JSON.parse(lR(`tldraw_debug:${n}`)??"null")}catch{return null}}function Qx(n){try{return n()}catch{return null}}function xne(n){switch(Qx(()=>Hx.TLDRAW_ENV)??Qx(()=>Hx.VERCEL_PUBLIC_TLDRAW_ENV)??Qx(()=>Hx.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}class Cm{constructor(e){v(this,"nextValue");v(this,"diff");this.previousValue=e}get(){var r,i,s,o;const e=((i=(r=this.diff)==null?void 0:r.removed)==null?void 0:i.size)??0,t=((o=(s=this.diff)==null?void 0:s.added)==null?void 0:o.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(r=this.diff.removed)==null||r.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var i,s,o;const t=this.previousValue.has(e);if(t)return((s=(i=this.diff)==null?void 0:i.removed)==null?void 0:s.has(e))?this._add(e,t):void 0;(o=this.nextValue)!=null&&o.has(e)||this._add(e,t)}_remove(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(i=this.diff.added)==null||i.delete(e)}remove(e){var i,s,o,a;const t=this.previousValue.has(e);if(!t)return((s=(i=this.diff)==null?void 0:i.added)==null?void 0:s.has(e))?this._remove(e,t):void 0;(a=(o=this.diff)==null?void 0:o.removed)!=null&&a.has(e)||this._remove(e,t)}}let gR=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");class Iv{constructor(e,t){v(this,"createDefaultProperties");v(this,"validator");v(this,"ephemeralKeys");v(this,"ephemeralKeySet");v(this,"scope");v(this,"isInstance",e=>(e==null?void 0:e.typeName)===this.typeName);this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:i=>i},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;const r=new Set;if(t.ephemeralKeys)for(const[i,s]of Kn(t.ephemeralKeys))s&&r.add(i);this.ephemeralKeySet=r}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[r,i]of Object.entries(e))i!==void 0&&(t[r]=i);return t.typeName=this.typeName,t}clone(e){return{...It(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??gR())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new Iv(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function Ao(n,e){return new Iv(n,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function J1(){return{added:{},updated:{},removed:{}}}function cp(n){const e={added:n.removed,removed:n.added,updated:{}};for(const[t,r]of Object.values(n.updated))e.updated[t.id]=[r,t];return e}function mR(n){return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0}function Mv(n){const e={added:{},removed:{},updated:{}};return If(e,n),e}function If(n,e){for(const t of e){for(const[r,i]of Kn(t.added))if(n.removed[r]){const s=n.removed[r];delete n.removed[r],s!==i&&(n.updated[r]=[s,i])}else n.added[r]=i;for(const[r,[i,s]]of Kn(t.updated)){if(n.added[r]){n.added[r]=s,delete n.updated[r],delete n.removed[r];continue}if(n.updated[r]){n.updated[r]=[n.updated[r][0],s],delete n.removed[r];continue}n.updated[r]=t.updated[r],delete n.removed[r]}for(const[r,i]of Kn(t.removed))n.added[r]?delete n.added[r]:n.updated[r]?(n.removed[r]=n.updated[r][0],delete n.updated[r]):n.removed[r]=i}}var ey={exports:{}};ey.exports;(function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",h="[object Error]",p="[object Function]",g="[object GeneratorFunction]",m="[object Map]",S="[object Number]",y="[object Null]",x="[object Object]",w="[object Promise]",O="[object Proxy]",T="[object RegExp]",E="[object Set]",C="[object String]",M="[object Symbol]",A="[object Undefined]",D="[object WeakMap]",N="[object ArrayBuffer]",F="[object DataView]",j="[object Float32Array]",L="[object Float64Array]",U="[object Int8Array]",Y="[object Int16Array]",V="[object Int32Array]",W="[object Uint8Array]",J="[object Uint8ClampedArray]",ne="[object Uint16Array]",le="[object Uint32Array]",ue=/[\\^$.*+?()[\]{}|]/g,Pe=/^\[object .+?Constructor\]$/,je=/^(?:0|[1-9]\d*)$/,he={};he[j]=he[L]=he[U]=he[Y]=he[V]=he[W]=he[J]=he[ne]=he[le]=!0,he[a]=he[l]=he[N]=he[u]=he[F]=he[d]=he[h]=he[p]=he[m]=he[S]=he[x]=he[T]=he[E]=he[C]=he[D]=!1;var et=typeof gr=="object"&&gr&&gr.Object===Object&&gr,Ue=typeof self=="object"&&self&&self.Object===Object&&self,ct=et||Ue||Function("return this")(),Je=e&&!e.nodeType&&e,vt=Je&&!0&&n&&!n.nodeType&&n,ut=vt&&vt.exports===Je,wr=ut&&et.process,xn=function(){try{return wr&&wr.binding&&wr.binding("util")}catch{}}(),In=xn&&xn.isTypedArray;function Bt(z,Q){for(var re=-1,ve=z==null?0:z.length,Rt=0,Fe=[];++re<ve;){var tn=z[re];Q(tn,re,z)&&(Fe[Rt++]=tn)}return Fe}function wn(z,Q){for(var re=-1,ve=Q.length,Rt=z.length;++re<ve;)z[Rt+re]=Q[re];return z}function ui(z,Q){for(var re=-1,ve=z==null?0:z.length;++re<ve;)if(Q(z[re],re,z))return!0;return!1}function Hs(z,Q){for(var re=-1,ve=Array(z);++re<z;)ve[re]=Q(re);return ve}function di(z){return function(Q){return z(Q)}}function QH(z,Q){return z.has(Q)}function qH(z,Q){return z==null?void 0:z[Q]}function WH(z){var Q=-1,re=Array(z.size);return z.forEach(function(ve,Rt){re[++Q]=[Rt,ve]}),re}function VH(z,Q){return function(re){return z(Q(re))}}function GH(z){var Q=-1,re=Array(z.size);return z.forEach(function(ve){re[++Q]=ve}),re}var XH=Array.prototype,KH=Function.prototype,b0=Object.prototype,zS=ct["__core-js_shared__"],ok=KH.toString,Qs=b0.hasOwnProperty,ak=function(){var z=/[^.]+$/.exec(zS&&zS.keys&&zS.keys.IE_PROTO||"");return z?"Symbol(src)_1."+z:""}(),lk=b0.toString,YH=RegExp("^"+ok.call(Qs).replace(ue,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ck=ut?ct.Buffer:void 0,O0=ct.Symbol,uk=ct.Uint8Array,dk=b0.propertyIsEnumerable,ZH=XH.splice,ic=O0?O0.toStringTag:void 0,hk=Object.getOwnPropertySymbols,JH=ck?ck.isBuffer:void 0,eQ=VH(Object.keys,Object),NS=hu(ct,"DataView"),ch=hu(ct,"Map"),$S=hu(ct,"Promise"),FS=hu(ct,"Set"),BS=hu(ct,"WeakMap"),uh=hu(Object,"create"),tQ=ac(NS),nQ=ac(ch),rQ=ac($S),iQ=ac(FS),sQ=ac(BS),fk=O0?O0.prototype:void 0,US=fk?fk.valueOf:void 0;function sc(z){var Q=-1,re=z==null?0:z.length;for(this.clear();++Q<re;){var ve=z[Q];this.set(ve[0],ve[1])}}function oQ(){this.__data__=uh?uh(null):{},this.size=0}function aQ(z){var Q=this.has(z)&&delete this.__data__[z];return this.size-=Q?1:0,Q}function lQ(z){var Q=this.__data__;if(uh){var re=Q[z];return re===r?void 0:re}return Qs.call(Q,z)?Q[z]:void 0}function cQ(z){var Q=this.__data__;return uh?Q[z]!==void 0:Qs.call(Q,z)}function uQ(z,Q){var re=this.__data__;return this.size+=this.has(z)?0:1,re[z]=uh&&Q===void 0?r:Q,this}sc.prototype.clear=oQ,sc.prototype.delete=aQ,sc.prototype.get=lQ,sc.prototype.has=cQ,sc.prototype.set=uQ;function $o(z){var Q=-1,re=z==null?0:z.length;for(this.clear();++Q<re;){var ve=z[Q];this.set(ve[0],ve[1])}}function dQ(){this.__data__=[],this.size=0}function hQ(z){var Q=this.__data__,re=C0(Q,z);if(re<0)return!1;var ve=Q.length-1;return re==ve?Q.pop():ZH.call(Q,re,1),--this.size,!0}function fQ(z){var Q=this.__data__,re=C0(Q,z);return re<0?void 0:Q[re][1]}function pQ(z){return C0(this.__data__,z)>-1}function gQ(z,Q){var re=this.__data__,ve=C0(re,z);return ve<0?(++this.size,re.push([z,Q])):re[ve][1]=Q,this}$o.prototype.clear=dQ,$o.prototype.delete=hQ,$o.prototype.get=fQ,$o.prototype.has=pQ,$o.prototype.set=gQ;function oc(z){var Q=-1,re=z==null?0:z.length;for(this.clear();++Q<re;){var ve=z[Q];this.set(ve[0],ve[1])}}function mQ(){this.size=0,this.__data__={hash:new sc,map:new(ch||$o),string:new sc}}function yQ(z){var Q=P0(this,z).delete(z);return this.size-=Q?1:0,Q}function vQ(z){return P0(this,z).get(z)}function SQ(z){return P0(this,z).has(z)}function xQ(z,Q){var re=P0(this,z),ve=re.size;return re.set(z,Q),this.size+=re.size==ve?0:1,this}oc.prototype.clear=mQ,oc.prototype.delete=yQ,oc.prototype.get=vQ,oc.prototype.has=SQ,oc.prototype.set=xQ;function k0(z){var Q=-1,re=z==null?0:z.length;for(this.__data__=new oc;++Q<re;)this.add(z[Q])}function wQ(z){return this.__data__.set(z,r),this}function bQ(z){return this.__data__.has(z)}k0.prototype.add=k0.prototype.push=wQ,k0.prototype.has=bQ;function Fa(z){var Q=this.__data__=new $o(z);this.size=Q.size}function OQ(){this.__data__=new $o,this.size=0}function kQ(z){var Q=this.__data__,re=Q.delete(z);return this.size=Q.size,re}function CQ(z){return this.__data__.get(z)}function PQ(z){return this.__data__.has(z)}function TQ(z,Q){var re=this.__data__;if(re instanceof $o){var ve=re.__data__;if(!ch||ve.length<t-1)return ve.push([z,Q]),this.size=++re.size,this;re=this.__data__=new oc(ve)}return re.set(z,Q),this.size=re.size,this}Fa.prototype.clear=OQ,Fa.prototype.delete=kQ,Fa.prototype.get=CQ,Fa.prototype.has=PQ,Fa.prototype.set=TQ;function EQ(z,Q){var re=T0(z),ve=!re&&HQ(z),Rt=!re&&!ve&&HS(z),Fe=!re&&!ve&&!Rt&&bk(z),tn=re||ve||Rt||Fe,Mn=tn?Hs(z.length,String):[],$n=Mn.length;for(var Wt in z)Qs.call(z,Wt)&&!(tn&&(Wt=="length"||Rt&&(Wt=="offset"||Wt=="parent")||Fe&&(Wt=="buffer"||Wt=="byteLength"||Wt=="byteOffset")||NQ(Wt,$n)))&&Mn.push(Wt);return Mn}function C0(z,Q){for(var re=z.length;re--;)if(vk(z[re][0],Q))return re;return-1}function IQ(z,Q,re){var ve=Q(z);return T0(z)?ve:wn(ve,re(z))}function dh(z){return z==null?z===void 0?A:y:ic&&ic in Object(z)?LQ(z):UQ(z)}function pk(z){return hh(z)&&dh(z)==a}function gk(z,Q,re,ve,Rt){return z===Q?!0:z==null||Q==null||!hh(z)&&!hh(Q)?z!==z&&Q!==Q:MQ(z,Q,re,ve,gk,Rt)}function MQ(z,Q,re,ve,Rt,Fe){var tn=T0(z),Mn=T0(Q),$n=tn?l:Ba(z),Wt=Mn?l:Ba(Q);$n=$n==a?x:$n,Wt=Wt==a?x:Wt;var hi=$n==x,fs=Wt==x,nr=$n==Wt;if(nr&&HS(z)){if(!HS(Q))return!1;tn=!0,hi=!1}if(nr&&!hi)return Fe||(Fe=new Fa),tn||bk(z)?mk(z,Q,re,ve,Rt,Fe):DQ(z,Q,$n,re,ve,Rt,Fe);if(!(re&i)){var zi=hi&&Qs.call(z,"__wrapped__"),Ni=fs&&Qs.call(Q,"__wrapped__");if(zi||Ni){var Ua=zi?z.value():z,Fo=Ni?Q.value():Q;return Fe||(Fe=new Fa),Rt(Ua,Fo,re,ve,Fe)}}return nr?(Fe||(Fe=new Fa),jQ(z,Q,re,ve,Rt,Fe)):!1}function AQ(z){if(!wk(z)||FQ(z))return!1;var Q=Sk(z)?YH:Pe;return Q.test(ac(z))}function _Q(z){return hh(z)&&xk(z.length)&&!!he[dh(z)]}function RQ(z){if(!BQ(z))return eQ(z);var Q=[];for(var re in Object(z))Qs.call(z,re)&&re!="constructor"&&Q.push(re);return Q}function mk(z,Q,re,ve,Rt,Fe){var tn=re&i,Mn=z.length,$n=Q.length;if(Mn!=$n&&!(tn&&$n>Mn))return!1;var Wt=Fe.get(z);if(Wt&&Fe.get(Q))return Wt==Q;var hi=-1,fs=!0,nr=re&s?new k0:void 0;for(Fe.set(z,Q),Fe.set(Q,z);++hi<Mn;){var zi=z[hi],Ni=Q[hi];if(ve)var Ua=tn?ve(Ni,zi,hi,Q,z,Fe):ve(zi,Ni,hi,z,Q,Fe);if(Ua!==void 0){if(Ua)continue;fs=!1;break}if(nr){if(!ui(Q,function(Fo,lc){if(!QH(nr,lc)&&(zi===Fo||Rt(zi,Fo,re,ve,Fe)))return nr.push(lc)})){fs=!1;break}}else if(!(zi===Ni||Rt(zi,Ni,re,ve,Fe))){fs=!1;break}}return Fe.delete(z),Fe.delete(Q),fs}function DQ(z,Q,re,ve,Rt,Fe,tn){switch(re){case F:if(z.byteLength!=Q.byteLength||z.byteOffset!=Q.byteOffset)return!1;z=z.buffer,Q=Q.buffer;case N:return!(z.byteLength!=Q.byteLength||!Fe(new uk(z),new uk(Q)));case u:case d:case S:return vk(+z,+Q);case h:return z.name==Q.name&&z.message==Q.message;case T:case C:return z==Q+"";case m:var Mn=WH;case E:var $n=ve&i;if(Mn||(Mn=GH),z.size!=Q.size&&!$n)return!1;var Wt=tn.get(z);if(Wt)return Wt==Q;ve|=s,tn.set(z,Q);var hi=mk(Mn(z),Mn(Q),ve,Rt,Fe,tn);return tn.delete(z),hi;case M:if(US)return US.call(z)==US.call(Q)}return!1}function jQ(z,Q,re,ve,Rt,Fe){var tn=re&i,Mn=yk(z),$n=Mn.length,Wt=yk(Q),hi=Wt.length;if($n!=hi&&!tn)return!1;for(var fs=$n;fs--;){var nr=Mn[fs];if(!(tn?nr in Q:Qs.call(Q,nr)))return!1}var zi=Fe.get(z);if(zi&&Fe.get(Q))return zi==Q;var Ni=!0;Fe.set(z,Q),Fe.set(Q,z);for(var Ua=tn;++fs<$n;){nr=Mn[fs];var Fo=z[nr],lc=Q[nr];if(ve)var Ok=tn?ve(lc,Fo,nr,Q,z,Fe):ve(Fo,lc,nr,z,Q,Fe);if(!(Ok===void 0?Fo===lc||Rt(Fo,lc,re,ve,Fe):Ok)){Ni=!1;break}Ua||(Ua=nr=="constructor")}if(Ni&&!Ua){var E0=z.constructor,I0=Q.constructor;E0!=I0&&"constructor"in z&&"constructor"in Q&&!(typeof E0=="function"&&E0 instanceof E0&&typeof I0=="function"&&I0 instanceof I0)&&(Ni=!1)}return Fe.delete(z),Fe.delete(Q),Ni}function yk(z){return IQ(z,WQ,zQ)}function P0(z,Q){var re=z.__data__;return $Q(Q)?re[typeof Q=="string"?"string":"hash"]:re.map}function hu(z,Q){var re=qH(z,Q);return AQ(re)?re:void 0}function LQ(z){var Q=Qs.call(z,ic),re=z[ic];try{z[ic]=void 0;var ve=!0}catch{}var Rt=lk.call(z);return ve&&(Q?z[ic]=re:delete z[ic]),Rt}var zQ=hk?function(z){return z==null?[]:(z=Object(z),Bt(hk(z),function(Q){return dk.call(z,Q)}))}:VQ,Ba=dh;(NS&&Ba(new NS(new ArrayBuffer(1)))!=F||ch&&Ba(new ch)!=m||$S&&Ba($S.resolve())!=w||FS&&Ba(new FS)!=E||BS&&Ba(new BS)!=D)&&(Ba=function(z){var Q=dh(z),re=Q==x?z.constructor:void 0,ve=re?ac(re):"";if(ve)switch(ve){case tQ:return F;case nQ:return m;case rQ:return w;case iQ:return E;case sQ:return D}return Q});function NQ(z,Q){return Q=Q??o,!!Q&&(typeof z=="number"||je.test(z))&&z>-1&&z%1==0&&z<Q}function $Q(z){var Q=typeof z;return Q=="string"||Q=="number"||Q=="symbol"||Q=="boolean"?z!=="__proto__":z===null}function FQ(z){return!!ak&&ak in z}function BQ(z){var Q=z&&z.constructor,re=typeof Q=="function"&&Q.prototype||b0;return z===re}function UQ(z){return lk.call(z)}function ac(z){if(z!=null){try{return ok.call(z)}catch{}try{return z+""}catch{}}return""}function vk(z,Q){return z===Q||z!==z&&Q!==Q}var HQ=pk(function(){return arguments}())?pk:function(z){return hh(z)&&Qs.call(z,"callee")&&!dk.call(z,"callee")},T0=Array.isArray;function QQ(z){return z!=null&&xk(z.length)&&!Sk(z)}var HS=JH||GQ;function qQ(z,Q){return gk(z,Q)}function Sk(z){if(!wk(z))return!1;var Q=dh(z);return Q==p||Q==g||Q==c||Q==O}function xk(z){return typeof z=="number"&&z>-1&&z%1==0&&z<=o}function wk(z){var Q=typeof z;return z!=null&&(Q=="object"||Q=="function")}function hh(z){return z!=null&&typeof z=="object"}var bk=In?di(In):_Q;function WQ(z){return QQ(z)?EQ(z):RQ(z)}function VQ(){return[]}function GQ(){return!1}n.exports=qQ})(ey,ey.exports);var wne=ey.exports;const Nc=Ul(wne);function bne(n){if(n.length===0)return new Set;const e=n[0],t=n.slice(1),r=new Set;for(const i of e)t.every(s=>s.has(i))&&r.add(i);return r}function One(n,e){const t={};for(const r of e)n.has(r)||(t.added??(t.added=new Set),t.added.add(r));for(const r of n)e.has(r)||(t.removed??(t.removed=new Set),t.removed.add(r));return t.added||t.removed?t:void 0}function BC(n,e){for(const[t,r]of Object.entries(n)){const i=r,s=e[t];if("eq"in i&&s!==i.eq||"neq"in i&&s===i.neq||"gt"in i&&(typeof s!="number"||s<=i.gt))return!1}return!0}function UC(n,e,t){const r=Object.fromEntries(Object.keys(t).map(i=>[i,new Set]));for(const[i,s]of Object.entries(t))if("eq"in s){const a=n.index(e,i).get().get(s.eq);if(a)for(const l of a)r[i].add(l)}else if("neq"in s){const o=n.index(e,i);for(const[a,l]of o.get())if(a!==s.neq)for(const c of l)r[i].add(c)}else if("gt"in s){const o=n.index(e,i);for(const[a,l]of o.get())if(a>s.gt)for(const c of l)r[i].add(c)}return bne(Object.values(r))}class kne{constructor(e,t){v(this,"indexCache",new Map);v(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=te("filterHistory:"+e,(r,i)=>{if(Ec(r))return this.history.get();const s=this.history.getDiffSince(i);if(s===ki)return this.history.get();const o={added:{},removed:{},updated:{}};let a=0,l=0,c=0;for(const u of s){for(const d of Gt(u.added))if(d.typeName===e)if(o.removed[d.id]){const h=o.removed[d.id];delete o.removed[d.id],l--,h!==d&&(o.updated[d.id]=[h,d],c++)}else o.added[d.id]=d,a++;for(const[d,h]of Gt(u.updated))h.typeName===e&&(o.added[h.id]?o.added[h.id]=h:o.updated[h.id]?o.updated[h.id]=[o.updated[h.id][0],h]:(o.updated[h.id]=[d,h],c++));for(const d of Gt(u.removed))d.typeName===e&&(o.added[d.id]?(delete o.added[d.id],a--):o.updated[d.id]?(o.removed[d.id]=o.updated[d.id][0],delete o.updated[d.id],c--,l++):(o.removed[d.id]=d,l++))}return a||l||c?Xh(this.history.get(),o):r},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const r=e+":"+t;if(this.indexCache.has(r))return this.indexCache.get(r);const i=this.__uncached_createIndex(e,t);return this.indexCache.set(r,i),i}__uncached_createIndex(e,t){const r=this.filterHistory(e),i=()=>{r.get();const s=new Map;for(const o of Gt(this.atoms.get())){const a=o.get();if(a.typeName===e){const l=a[t];s.has(l)||s.set(l,new Set),s.get(l).add(a.id)}}return s};return te("index:"+e+":"+t,(s,o)=>{if(Ec(s))return i();const a=r.getDiffSince(o);if(a===ki)return i();const l=new Map,c=(p,g)=>{let m=l.get(p);m||(m=new Cm(s.get(p)??new Set)),m.add(g),l.set(p,m)},u=(p,g)=>{let m=l.get(p);m||(m=new Cm(s.get(p)??new Set)),m.remove(g),l.set(p,m)};for(const p of a){for(const g of Gt(p.added))if(g.typeName===e){const m=g[t];c(m,g.id)}for(const[g,m]of Gt(p.updated))if(m.typeName===e){const S=g[t],y=m[t];S!==y&&(u(S,m.id),c(y,m.id))}for(const g of Gt(p.removed))if(g.typeName===e){const m=g[t];u(m,g.id)}}let d,h;for(const[p,g]of l){const m=g.get();m&&(d||(d=new Map(s)),h||(h=new Map),m.value.size===0?d.delete(p):d.set(p,m.value),h.set(p,m.diff))}return d&&h?Xh(d,h):s},{historyLength:100})}record(e,t=()=>({}),r="record:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,r);return te(r,()=>{var s;for(const o of i.get())return(s=this.atoms.get()[o])==null?void 0:s.get()})}records(e,t=()=>({}),r="records:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,"ids:"+r);return te(r,()=>[...i.get()].map(s=>{const o=this.atoms.get()[s];if(!o)throw new Error("no atom found for record id: "+s);return o.get()}))}ids(e,t=()=>({}),r="ids:"+e+(t?":"+t.toString():"")){const i=this.filterHistory(e),s=()=>{i.get();const l=t();return Object.keys(l).length===0?new Set(Gt(this.atoms.get()).flatMap(c=>{const u=c.get();return u.typeName===e?u.id:[]})):UC(this,e,l)},o=l=>{const c=s(),u=One(l,c);return u?Xh(c,u):l},a=te("ids_query:"+r,t,{isEqual:Nc});return te("query:"+r,(l,c)=>{const u=a.get();if(Ec(l))return s();if(c<a.lastChangedEpoch)return o(l);const d=i.getDiffSince(c);if(d===ki)return o(l);const h=new Cm(l);for(const g of d){for(const m of Gt(g.added))m.typeName===e&&BC(u,m)&&h.add(m.id);for(const[m,S]of Gt(g.updated))S.typeName===e&&(BC(u,S)?h.add(S.id):h.remove(S.id));for(const m of Gt(g.removed))m.typeName===e&&h.remove(m.id)}const p=h.get();return p?Xh(p.value,p.diff):l},{historyLength:50})}exec(e,t){const r=UC(this,e,t);if(r.size===0)return ua;const i=this.atoms.get();return[...r].map(s=>i[s].get())}}class Cne{constructor(e){v(this,"_beforeCreateHandlers",{});v(this,"_afterCreateHandlers",{});v(this,"_beforeChangeHandlers",{});v(this,"_afterChangeHandlers",{});v(this,"_beforeDeleteHandlers",{});v(this,"_afterDeleteHandlers",{});v(this,"_operationCompleteHandlers",[]);v(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const r=this._beforeCreateHandlers[e.typeName];if(r){let i=e;for(const s of r)i=s(i,t);return i}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const r=this._afterCreateHandlers[e.typeName];if(r)for(const i of r)i(e,t)}handleBeforeChange(e,t,r){if(!this._isEnabled)return t;const i=this._beforeChangeHandlers[t.typeName];if(i){let s=t;for(const o of i)s=o(e,s,r);return s}return t}handleAfterChange(e,t,r){if(!this._isEnabled)return;const i=this._afterChangeHandlers[t.typeName];if(i)for(const s of i)s(e,t,r)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const r=this._beforeDeleteHandlers[e.typeName];if(r){for(const i of r)if(i(e,t)===!1)return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const r=this._afterDeleteHandlers[e.typeName];if(r)for(const i of r)i(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[r,i]of Object.entries(e))i!=null&&i.beforeCreate&&t.push(this.registerBeforeCreateHandler(r,i.beforeCreate)),i!=null&&i.afterCreate&&t.push(this.registerAfterCreateHandler(r,i.afterCreate)),i!=null&&i.beforeChange&&t.push(this.registerBeforeChangeHandler(r,i.beforeChange)),i!=null&&i.afterChange&&t.push(this.registerAfterChangeHandler(r,i.afterChange)),i!=null&&i.beforeDelete&&t.push(this.registerBeforeDeleteHandler(r,i.beforeDelete)),i!=null&&i.afterDelete&&t.push(this.registerAfterDeleteHandler(r,i.afterDelete));return()=>{for(const r of t)r()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>cc(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>cc(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>cc(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>cc(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>cc(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>cc(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>cc(this._operationCompleteHandlers,e)}}function cc(n,e){const t=n.indexOf(e);t>=0&&n.splice(t,1)}class P6{constructor(e){v(this,"id");v(this,"atoms",mn("store_atoms",{}));v(this,"history",mn("history",0,{historyLength:1e3}));v(this,"query",new kne(this.atoms,this.history));v(this,"listeners",new Set);v(this,"historyAccumulator",new Tne);v(this,"historyReactor");v(this,"cancelHistoryReactor",()=>{});v(this,"schema");v(this,"props");v(this,"scopedTypes");v(this,"sideEffects",new Cne(this));v(this,"put",(e,t)=>{this.atomic(()=>{const r={},i={},s=this.atoms.__unsafe__getWithoutCapture();let o=null,a,l=!1;const c=this.isMergingRemoteChanges?"remote":"user";for(let u=0,d=e.length;u<d;u++){a=e[u];const h=(o??s)[a.id];if(h){const p=h.__unsafe__getWithoutCapture();if(a=this.sideEffects.handleBeforeChange(p,a,c),this.schema.validateRecord(this,a,t??"updateRecord",p)===p)continue;h.set(a),l=!0;const m=h.__unsafe__getWithoutCapture();r[a.id]=[p,m],this.addDiffForAfterEvent(p,m)}else a=this.sideEffects.handleBeforeCreate(a,c),l=!0,a=this.schema.validateRecord(this,a,t??"createRecord",null),i[a.id]=a,this.addDiffForAfterEvent(null,a),o||(o={...s}),o[a.id]=mn("atom:"+a.id,a)}o&&this.atoms.set(o),l&&this.updateHistory({added:i,updated:r,removed:{}})})});v(this,"remove",e=>{this.atomic(()=>{const t=new Set,r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const s of e){const o=this.atoms.__unsafe__getWithoutCapture()[s];o&&this.sideEffects.handleBeforeDelete(o.get(),r)===!1&&t.add(s)}let i;this.atoms.update(s=>{let o;for(const a of e){if(t.has(a)||!(a in s))continue;o||(o={...s}),i||(i={}),delete o[a];const l=s[a].get();i[a]=l,this.addDiffForAfterEvent(l,null)}return o??s}),i&&this.updateHistory({added:{},updated:{},removed:i})})});v(this,"get",e=>{var t;return(t=this.atoms.get()[e])==null?void 0:t.get()});v(this,"unsafeGetWithoutCapture",e=>{var t;return(t=this.atoms.get()[e])==null?void 0:t.__unsafe__getWithoutCapture()});v(this,"serialize",(e="document")=>{const t={};for(const[r,i]of Kn(this.atoms.get())){const s=i.get();(e==="all"||this.scopedTypes[e].has(s.typeName))&&(t[r]=s)}return t});v(this,"allRecords",()=>Gt(this.atoms.get()).map(e=>e.get()));v(this,"clear",()=>{this.remove(LC(this.atoms.get()))});v(this,"update",(e,t)=>{const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(r.__unsafe__getWithoutCapture())])});v(this,"has",e=>!!this.atoms.get()[e]);v(this,"listen",(e,t)=>{this._flushHistory();const r={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}});v(this,"isMergingRemoteChanges",!1);v(this,"mergeRemoteChanges",e=>{if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,Es(e)}finally{this.isMergingRemoteChanges=!1}});v(this,"createComputedCache",(e,t,r)=>{const i=new wa;return{get:s=>{const o=this.atoms.get()[s];if(o)return i.get(o,()=>{const a=r?te(o.name+":equals",()=>o.get(),{isEqual:r}):o;return te(e+":"+s,()=>t(a.get()))}).get()}}});v(this,"createSelectedComputedCache",(e,t,r)=>{const i=new wa;return{get:s=>{const o=this.atoms.get()[s];if(o)return i.get(o,()=>{const a=te(e+":"+s+":selector",()=>t(o.get()));return te(e+":"+s,()=>r(a.get()))}).get()}}});v(this,"_integrityChecker");v(this,"_isPossiblyCorrupted",!1);v(this,"pendingAfterEvents",null);v(this,"_isInAtomicOp",!1);const{initialData:t,schema:r,id:i}=e;this.id=i??gR(),this.schema=r,this.props=e.props,t&&this.atoms.set(nR(Kn(t).map(([s,o])=>[s,mn("atom:"+s,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=vee("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:s=>this.cancelHistoryReactor=dR(s)}),this.scopedTypes={document:new Set(Gt(this.schema.types).filter(s=>s.scope==="document").map(s=>s.typeName)),session:new Set(Gt(this.schema.types).filter(s=>s.scope==="session").map(s=>s.typeName)),presence:new Set(Gt(this.schema.types).filter(s=>s.scope==="presence").map(s=>s.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:r}of e){let i=null,s=null,o=null;for(const{onHistory:a,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==r))if(l.scope!=="all")if(l.scope==="document"){if(s??(s=this.filterChangesByScope(t,"document")),!s)continue;a({changes:s,source:r})}else if(l.scope==="session"){if(i??(i=this.filterChangesByScope(t,"session")),!i)continue;a({changes:i,source:r})}else{if(o??(o=this.filterChangesByScope(t,"presence")),!o)continue;a({changes:o,source:r})}else a({changes:t,source:r})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const r={added:Tf(e.added,(i,s)=>this.scopedTypes[t].has(s.typeName)),updated:Tf(e.updated,(i,s)=>this.scopedTypes[t].has(s[1].typeName)),removed:Tf(e.removed,(i,s)=>this.scopedTypes[t].has(s.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);const r=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(r)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}extractingChanges(e){const t=[],r=this.historyAccumulator.addInterceptor(i=>t.push(i.changes));try{return Es(e),Mv(t)}finally{r()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:r=!1}={}){this.atomic(()=>{const i=Gt(e.added);for(const[o,a]of Gt(e.updated)){const l=this.schema.getType(a.typeName);if(r&&l.ephemeralKeySet.size){const c=this.get(a.id);if(!c){i.push(a);continue}let u=null;for(const[d,h]of Object.entries(a))l.ephemeralKeySet.has(d)||Object.is(h,Yr(c,d))||(u||(u={...c}),u[d]=h);u&&i.push(u)}else i.push(a)}const s=LC(e.removed);i.length&&this.put(i),s.length&&this.remove(s)},t)}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,t){if(Ye(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&Ye(e.id===t.id),!e&&!t))return;const r=(e||t).id,i=this.pendingAfterEvents.get(r);i?i.after=t:this.pendingAfterEvents.set(r,{before:e,after:t})}flushAtomicCallbacks(){let e=0;const t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const r=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:i,after:s}of r.values())i&&s?this.sideEffects.handleAfterChange(i,s,t):i&&!s?this.sideEffects.handleAfterDelete(i,t):!i&&s&&this.sideEffects.handleAfterCreate(s,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}atomic(e,t=!0){return Es(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const r=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??r),this._isInAtomicOp=!0;try{const i=e();return this.flushAtomicCallbacks(),i}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(r),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}}function Pne(n){if(n.length===0)return[];const e=[];let t=[n[0]],r;for(let i=1,s=n.length;i<s;i++)r=n[i],t[0].source!==r.source&&(e.push(t),t=[]),t.push(r);return e.push(t),e.map(i=>({source:i[0].source,changes:Mv(i.map(s=>s.changes))}))}class Tne{constructor(){v(this,"_history",[]);v(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=Pne(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function Ene(n,e,t){const r=new wa;return{get(i,s){return r.get(i,()=>(i instanceof P6?i:i.store).createComputedCache(n,l=>e(i,l),t)).get(s)}}}function Ine(n){const e=[];for(let t=n.length-1;t>=0;t--){const r=n[t];if("id"in r)e.unshift(r);else{const i=r.dependsOn,s=e[0];s&&(e[0]={...s,dependsOn:i.concat(s.dependsOn??[])})}}return e}function od({sequence:n,sequenceId:e,retroactive:t=!0}){const r={sequenceId:e,retroactive:t,sequence:Ine(n)};return yR(r),r}function ai(n,e){return Object.fromEntries(Kn(e).map(([t,r])=>[t,`${n}/${r}`]))}function Di(n){const e=n.sequenceId;return od({sequenceId:e,retroactive:n.retroactive??!0,sequence:n.sequence.map(t=>"id"in t?{...t,scope:"record",filter:r=>{var i,s;return r.typeName===n.recordType&&(((i=t.filter)==null?void 0:i.call(t,r))??!0)&&(((s=n.filter)==null?void 0:s.call(n,r))??!0)}}:t)})}function Mne(n){const e=new Map(n.map(s=>[s.id,s])),t=new Set,r=[];function i(s){Ye(!t.has(s.id),`Circular dependency in migrations: ${s.id}`),t.add(s.id);const{version:o,sequenceId:a}=ty(s.id),l=e.get(`${a}/${o-1}`);if(l&&i(l),s.dependsOn)for(const c of s.dependsOn){const u=e.get(c);u&&i(u)}e.delete(s.id),r.push(s)}for(const s of e.values())i(s);return r}function ty(n){const[e,t]=n.split("/");return{sequenceId:e,version:parseInt(t)}}function HC(n,e){e&&Ye(n.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${n}'`),Ye(n.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${n}'`)}function yR(n){if(Ye(!n.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${n.sequenceId}`),Ye(n.sequenceId.length,"sequenceId must be a non-empty string"),n.sequence.length===0)return;HC(n.sequence[0].id,n.sequenceId);let e=ty(n.sequence[0].id).version;Ye(e===1,`Expected the first migrationId to be '${n.sequenceId}/1' but got '${n.sequence[0].id}'`);for(let t=1;t<n.sequence.length;t++){const r=n.sequence[t].id;HC(r,n.sequenceId);const i=ty(r).version;Ye(i===e+1,`Migration id numbers must increase in increments of 1, expected ${n.sequenceId}/${e+1} but got '${n.sequence[t].id}'`),e=i}}var Ga=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(Ga||{});function Ane(n){if(n.schemaVersion>2||n.schemaVersion<1)return wl.err("Bad schema version");if(n.schemaVersion===2)return wl.ok(n);const e={schemaVersion:2,sequences:{}};for(const[t,r]of Object.entries(n.recordVersions))if(e.sequences[`com.tldraw.${t}`]=r.version,"subTypeKey"in r)for(const[i,s]of Object.entries(r.subTypeVersions))e.sequences[`com.tldraw.${t}.${i}`]=s;return wl.ok(e)}class T6{constructor(e,t){v(this,"migrations",{});v(this,"sortedMigrations");var i;this.types=e,this.options=t;for(const s of t.migrations??[])Ye(!this.migrations[s.sequenceId],`Duplicate migration sequenceId ${s.sequenceId}`),yR(s),this.migrations[s.sequenceId]=s;const r=Object.values(this.migrations).flatMap(s=>s.sequence);this.sortedMigrations=Mne(r);for(const s of this.sortedMigrations)if((i=s.dependsOn)!=null&&i.length)for(const o of s.dependsOn){const a=r.find(l=>l.id===o);Ye(a,`Migration '${s.id}' depends on missing migration '${o}'`)}}static create(e,t){return new T6(e,t??{})}validateRecord(e,t,r,i){try{const s=Yr(this.types,t.typeName);if(!s)throw new Error(`Missing definition for record type ${t.typeName}`);return s.validate(t,i??void 0)}catch(s){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:r,recordBefore:i,error:s});throw s}}getMigrationsSince(e){const t=Ane(e);if(!t.ok)return t;const r=t.value,i=new Set(Object.keys(r.sequences).filter(o=>this.migrations[o]));for(const o in this.migrations)r.sequences[o]===void 0&&this.migrations[o].retroactive&&i.add(o);if(i.size===0)return wl.ok([]);const s=new Set;for(const o of i){const a=r.sequences[o];if(typeof a!="number"&&this.migrations[o].retroactive||a===0){for(const u of this.migrations[o].sequence)s.add(u.id);continue}const l=`${o}/${a}`,c=this.migrations[o].sequence.findIndex(u=>u.id===l);if(c===-1)return wl.err("Incompatible schema?");for(const u of this.migrations[o].sequence.slice(c+1))s.add(u.id)}return wl.ok(this.sortedMigrations.filter(({id:o})=>s.has(o)))}migratePersistedRecord(e,t,r="up"){const i=this.getMigrationsSince(t);if(!i.ok)return console.error("Error migrating record",i.error),{type:"error",reason:Ga.MigrationError};let s=i.value;if(s.length===0)return{type:"success",value:e};if(s.some(o=>o.scope==="store"))return{type:"error",reason:r==="down"?Ga.TargetVersionTooOld:Ga.TargetVersionTooNew};if(r==="down"){if(!s.every(o=>o.down))return{type:"error",reason:Ga.TargetVersionTooOld};s=s.slice().reverse()}e=It(e);try{for(const o of s){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(e):!0))continue;const l=o[r](e);l&&(e=It(l))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:Ga.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e;const r=this.getMigrationsSince(e.schema);if(!r.ok)return console.error("Error migrating store",r.error),{type:"error",reason:Ga.MigrationError};const i=r.value;if(i.length===0)return{type:"success",value:t};t=It(t);try{for(const s of i)if(s.scope==="record")for(const[o,a]of Object.entries(t)){if(!(s.filter?s.filter(a):!0))continue;const c=s.up(a);c&&(t[o]=It(c))}else if(s.scope==="store"){const o=s.up(t);o&&(t=It(o))}else Vn(s)}catch(s){return console.error("Error migrating store",s),{type:"error",reason:Ga.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){var t,r;return((r=(t=this.options).createIntegrityChecker)==null?void 0:r.call(t,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?ty(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const t=Yr(this.types,e);return Ye(t,"record type does not exists"),t}}function _ne(n){if(!n.length)return null;let e="";for(const t of n)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class nt extends Error{constructor(t,r=[]){const i=_ne(r),s=t.split(`
`).map((o,a)=>a===0?o:`  ${o}`).join(`
`);super(r?`At ${i}: ${s}`:s);v(this,"name","ValidationError");this.rawMessage=t,this.path=r}}function ii(n,e){try{return e()}catch(t){throw t instanceof nt?new nt(t.rawMessage,[n,...t.path]):new nt(t.toString(),[n])}}function El(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:Vn(e)}}class jr{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return Nne(this)}optional(){return SR(this)}refine(e){return new jr(t=>e(this.validate(t)),(t,r)=>{const i=this.validateUsingKnownGoodVersion(t,r);return Object.is(t,i)?t:e(i)})}check(e,t){return typeof e=="string"?this.refine(r=>(ii(`(check ${e})`,()=>t(r)),r)):this.refine(r=>(e(r),r))}}class Rne extends jr{constructor(e){super(t=>{const r=QC.validate(t);for(let i=0;i<r.length;i++)ii(i,()=>e.validate(r[i]));return r},(t,r)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(r);const i=QC.validate(r);let s=t.length!==i.length;for(let o=0;o<i.length;o++){const a=i[o];if(o>=t.length){s=!0,ii(o,()=>e.validate(a));continue}if(Object.is(t[o],a))continue;const l=ii(o,()=>e.validateUsingKnownGoodVersion(t[o],a));Object.is(l,t[o])||(s=!0)}return s?r:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new nt("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new nt("Expected an array with length greater than 1")})}}class ny extends jr{constructor(e,t=!1){super(r=>{if(typeof r!="object"||r===null)throw new nt(`Expected object, got ${El(r)}`);for(const[i,s]of Object.entries(e))ii(i,()=>{s.validate(Yr(r,i))});if(!t){for(const i of Object.keys(r))if(!So(e,i))throw new nt("Unexpected property",[i])}return r},(r,i)=>{if(typeof i!="object"||i===null)throw new nt(`Expected object, got ${El(i)}`);let s=!1;for(const[o,a]of Object.entries(e)){const l=Yr(r,o),c=Yr(i,o);if(Object.is(l,c))continue;const u=ii(o,()=>{const d=a;return d.validateUsingKnownGoodVersion?d.validateUsingKnownGoodVersion(l,c):d.validate(c)});Object.is(u,l)||(s=!0)}if(!t){for(const o of Object.keys(i))if(!So(e,o))throw new nt("Unexpected property",[o])}for(const o of Object.keys(r))if(!So(i,o)){s=!0;break}return s?i:r}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new ny(this.config,!0)}extend(e){return new ny({...this.config,...e})}}class Av extends jr{constructor(e,t,r,i){super(s=>{this.expectObject(s);const{matchingSchema:o,variant:a}=this.getMatchingSchemaAndVariant(s);return o===void 0?this.unknownValueValidation(s,a):ii(`(${e} = ${a})`,()=>o.validate(s))},(s,o)=>{this.expectObject(o),this.expectObject(s);const{matchingSchema:a,variant:l}=this.getMatchingSchemaAndVariant(o);return a===void 0?this.unknownValueValidation(o,l):Yr(s,e)!==Yr(o,e)?ii(`(${e} = ${l})`,()=>a.validate(o)):ii(`(${e} = ${l})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(s,o):a.validate(o))}),this.key=e,this.config=t,this.unknownValueValidation=r,this.useNumberKeys=i}expectObject(e){if(typeof e!="object"||e===null)throw new nt(`Expected an object, got ${El(e)}`,[])}getMatchingSchemaAndVariant(e){const t=Yr(e,this.key);if(!this.useNumberKeys&&typeof t!="string")throw new nt(`Expected a string for key "${this.key}", got ${El(t)}`);if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new nt(`Expected a number for key "${this.key}", got "${t}"`);return{matchingSchema:So(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new Av(this.key,this.config,e,this.useNumberKeys)}}class Dne extends jr{constructor(e,t){super(r=>{if(typeof r!="object"||r===null)throw new nt(`Expected object, got ${El(r)}`);for(const[i,s]of Object.entries(r))ii(i,()=>{e.validate(i),t.validate(s)});return r},(r,i)=>{if(typeof i!="object"||i===null)throw new nt(`Expected object, got ${El(i)}`);let s=!1;for(const[o,a]of Object.entries(i)){if(!So(r,o)){s=!0,ii(o,()=>{e.validate(o),t.validate(a)});continue}const l=Yr(r,o),c=a;if(Object.is(l,c))continue;const u=ii(o,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(l,c):t.validate(c));Object.is(u,l)||(s=!0)}for(const o of Object.keys(r))if(!So(i,o)){s=!0;break}return s?i:r}),this.keyValidator=e,this.valueValidator=t}}function E6(n){return new jr(e=>{if(typeof e!==n)throw new nt(`Expected ${n}, got ${El(e)}`);return e})}const jne=new jr(n=>n),ze=E6("string"),Me=E6("number").check(n=>{if(Number.isNaN(n))throw new nt("Expected a number, got NaN");if(!Number.isFinite(n))throw new nt(`Expected a finite number, got ${n}`)}),ry=Me.check(n=>{if(n<0)throw new nt(`Expected a positive number, got ${n}`)}),fn=Me.check(n=>{if(n<=0)throw new nt(`Expected a non-zero positive number, got ${n}`)}),vR=Me.check(n=>{if(!Number.isInteger(n))throw new nt(`Expected an integer, got ${n}`)}),Pm=vR.check(n=>{if(n<0)throw new nt(`Expected a positive integer, got ${n}`)}),Lne=vR.check(n=>{if(n<=0)throw new nt(`Expected a non-zero positive integer, got ${n}`)}),qe=E6("boolean");function yr(n){return new jr(e=>{if(e!==n)throw new nt(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const QC=new jr(n=>{if(!Array.isArray(n))throw new nt(`Expected an array, got ${El(n)}`);return n});function qn(n){return new Rne(n)}function Ve(n){return new ny(n)}function Zb(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null||Object.getPrototypeOf(n)===mne)}function Jb(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(Jb):Zb(n)?Object.values(n).every(Jb):!1}const Wn=new jr(n=>{if(Jb(n))return n;throw new nt(`Expected json serializable value, got ${typeof n}`)},(n,e)=>{if(Array.isArray(n)&&Array.isArray(e)){let t=n.length!==e.length;for(let r=0;r<e.length;r++){if(r>=n.length){t=!0,Wn.validate(e[r]);continue}const i=n[r],s=e[r];if(Object.is(i,s))continue;const o=Wn.validateUsingKnownGoodVersion(i,s);Object.is(o,i)||(t=!0)}return t?e:n}else if(Zb(n)&&Zb(e)){let t=!1;for(const r of Object.keys(e)){if(!So(n,r)){t=!0,Wn.validate(e[r]);continue}const i=n[r],s=e[r];if(Object.is(i,s))continue;const o=Wn.validateUsingKnownGoodVersion(i,s);Object.is(o,i)||(t=!0)}for(const r of Object.keys(n))if(!So(e,r)){t=!0;break}return t?e:n}else return Wn.validate(e)});function iy(n,e){return new Dne(n,e)}function I6(n,e){return new Av(n,e,(t,r)=>{throw new nt(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!1)}function zne(n,e){return new Av(n,e,(t,r)=>{throw new nt(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!0)}function _o(n,e){return new jr(t=>ii(n,()=>e.validate(t)),(t,r)=>ii(n,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(t,r):e.validate(r)))}function _v(n){return new jr(e=>{if(!n.has(e)){const t=Array.from(n,r=>JSON.stringify(r)).join(" or ");throw new nt(`Expected ${t}, got ${e}`)}return e})}function SR(n){return new jr(e=>{if(e!==void 0)return n.validate(e)},(e,t)=>{if(!(e===void 0&&t===void 0)&&t!==void 0)return n.validateUsingKnownGoodVersion&&e!==void 0?n.validateUsingKnownGoodVersion(e,t):n.validate(t)})}function Nne(n){return new jr(e=>e===null?null:n.validate(e),(e,t)=>t===null?null:n.validateUsingKnownGoodVersion&&e!==null?n.validateUsingKnownGoodVersion(e,t):n.validate(t))}function Rv(...n){return _v(new Set(n))}function M6(n){try{return new URL(n)}catch{if(n.startsWith("/")||n.startsWith("./"))try{return new URL(n,"http://example.com")}catch{throw new nt(`Expected a valid url, got ${JSON.stringify(n)}`)}throw new nt(`Expected a valid url, got ${JSON.stringify(n)}`)}}const $ne=new Set(["http:","https:","mailto:"]),Mi=ze.check(n=>{if(n==="")return;const e=M6(n);if(!$ne.has(e.protocol.toLowerCase()))throw new nt(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),Fne=new Set(["http:","https:","data:","asset:"]),$c=ze.check(n=>{if(n==="")return;const e=M6(n);if(!Fne.has(e.protocol.toLowerCase()))throw new nt(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});ze.check(n=>{if(n==="")return;if(!M6(n).protocol.toLowerCase().match(/^https?:$/))throw new nt(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});const A6=ze.refine(n=>{try{return one(n),n}catch{throw new nt(`Expected an index key, got ${JSON.stringify(n)}`)}});function Ci(n){return ze.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const Dv=Ci("asset");function _6(n,e){return Ve({id:Dv,typeName:yr("asset"),type:yr(n),props:e,meta:Wn})}const Fc=Ve({x:Me,y:Me,z:Me.optional()}),Mf=Ve({x:Me,y:Me,w:Me,h:Me});let xR=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const wR=Me.check(n=>{if(n<0||n>1)throw new nt("Opacity must be between 0 and 1")}),Bne=ze.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),Fi=Ci("shape");function Une(n,e,t){return Ve({id:Fi,typeName:yr("shape"),x:Me,y:Me,rotation:Me,index:A6,parentId:Bne,type:yr(n),isLocked:qe,opacity:wR,props:e?Ve(e):Wn,meta:t?Ve(t):Wn})}const Hne=Ci("binding");function Qne(n,e,t){return Ve({id:Hne,typeName:yr("binding"),type:yr(n),fromId:Fi,toId:Fi,props:e?Ve(e):Wn,meta:t?Ve(t):Wn})}ai("com.tldraw.binding",{});Di({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Mc(n){return`binding:${xR()}`}function qne(n){return Ao("binding",{scope:"document",validator:_o("binding",I6("type",Vp(n,(e,{props:t,meta:r})=>Qne(e,t,r))))}).withDefaultProperties(()=>({meta:{}}))}class er{constructor(e,t,r){this.id=e,this.defaultValue=t,this.type=r}static define(e,t){const{defaultValue:r,type:i=jne}=t;return new er(e,r,i)}static defineEnum(e,t){const{defaultValue:r,values:i}=t;return new Wne(e,r,i)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class Wne extends er{constructor(e,t,r){super(e,t,Rv(...r)),this.values=r}}const J0=ai("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),Vne=Di({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:J0.AddIsLocked,up:n=>{n.isLocked=!1},down:n=>{delete n.isLocked}},{id:J0.HoistOpacity,up:n=>{n.opacity=Number(n.props.opacity??"1"),delete n.props.opacity},down:n=>{const e=n.opacity;delete n.opacity,n.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:J0.AddMeta,up:n=>{n.meta={}}},{id:J0.AddWhite,up:n=>{},down:n=>{n.props.color==="white"&&(n.props.color="black")}}]});function qu(n){return n?n.typeName==="shape":!1}function Qr(n){return n?n.startsWith("shape:"):!1}function mt(n){return`shape:${n??xR()}`}function bR(n){const e=new Map;for(const[t,r]of Object.entries(n))if(r instanceof er){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,t)}return e}function zs(n,e){return Vp(e,(t,r)=>`com.tldraw.shape.${n}/${r}`)}function Gne(n){return Ao("shape",{scope:"document",validator:_o("shape",I6("type",Vp(n,(e,{props:t,meta:r})=>Une(e,t,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function qC(n,e){const t=[];for(const[r,{migrations:i}]of Object.entries(e)){const s=`com.tldraw.${n}.${r}`;i?"sequenceId"in i?(Ye(s===i.sequenceId,`sequenceId mismatch for ${r} ${Iv} migrations. Expected '${s}', got '${i.sequenceId}'`),t.push(i)):"sequence"in i?t.push(od({sequenceId:s,retroactive:!1,sequence:i.sequence.map(o=>"id"in o?OR(n,r,o):o)})):t.push(od({sequenceId:s,retroactive:!1,sequence:Object.keys(i.migrators).map(o=>Number(o)).sort((o,a)=>o-a).map(o=>({id:`${s}/${o}`,scope:"record",filter:a=>a.typeName===n&&a.type===r,up:a=>{const l=i.migrators[o].up(a);if(l)return l},down:a=>{const l=i.migrators[o].down(a);if(l)return l}}))})):t.push(od({sequenceId:s,retroactive:!1,sequence:[]}))}return t}function OR(n,e,t){return{id:t.id,dependsOn:t.dependsOn,scope:"record",filter:r=>r.typeName===n&&r.type===e,up:r=>{const i=t.up(r.props);i&&(r.props=i)},down:typeof t.down=="function"?r=>{const i=t.down(r.props);i&&(r.props=i)}:void 0}}const kR=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],sy={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function Ra(n){return n.isDarkMode?sy.darkMode:sy.lightMode}const Ai=er.defineEnum("tldraw:color",{defaultValue:"black",values:kR}),CR=er.defineEnum("tldraw:labelColor",{defaultValue:"black",values:kR}),Bc=er.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Uc=er.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),ko=er.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),PR={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Co=er.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),TR=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],oy=er.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:TR}),ay=er.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:TR}),ER={labelColor:CR,color:Ai,fill:Uc,dash:Bc,size:Co,arrowheadStart:oy,arrowheadEnd:ay,font:ko,start:Fc,end:Fc,bend:Me,text:ze,labelPosition:Me,scale:fn},Tu=zs("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function eg(n){return OR("shape","arrow",n)}const IR=od({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[eg({id:Tu.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"}),eg({id:Tu.AddIsPrecise,up:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise=!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise||(n.normalizedAnchor={x:.5,y:.5}),delete n.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),eg({id:Tu.AddLabelPosition,up:n=>{n.labelPosition=.5},down:n=>{delete n.labelPosition}}),{id:Tu.ExtractBindings,scope:"store",up:n=>{const e=Object.values(n).filter(t=>t.typeName==="shape"&&t.type==="arrow");for(const t of e){const{start:r,end:i}=t.props;if(r.type==="binding"){const s=Mc(),o={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:r.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};n[s]=o,t.props.start={x:0,y:0}}else delete t.props.start.type;if(i.type==="binding"){const s=Mc(),o={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:i.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};n[s]=o,t.props.end={x:0,y:0}}else delete t.props.end.type}}},eg({id:Tu.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}})]}),MR={terminal:Rv("start","end"),normalizedAnchor:Fc,isExact:qe,isPrecise:qe},AR={sequence:[{dependsOn:[Tu.ExtractBindings]}]},Xne=_o("camera",Ve({typeName:yr("camera"),id:Ci("camera"),x:Me,y:Me,z:Me,meta:Wn})),Kne=ai("com.tldraw.camera",{AddMeta:1}),Yne=Di({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:Kne.AddMeta,up:n=>{n.meta={}}}]}),Os=Ao("camera",{validator:Xne,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),Zne=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),_R=_v(Zne),Jne=Ve({type:_R,rotation:Me}),ere=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),tre=_v(ere),nre=new Set(["starting","paused","active","stopping"]),RR=Ve({id:ze,points:qn(Fc),size:ry,color:tre,opacity:Me,state:_v(nre),delay:Me,shrink:Me,taper:qe}),up=Ci("page"),rre=_o("page",Ve({typeName:yr("page"),id:up,name:ze,index:A6,meta:Wn})),ire=ai("com.tldraw.page",{AddMeta:1}),sre=Di({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:ire.AddMeta,up:n=>{n.meta={}}}]}),ba=Ao("page",{validator:rre,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Br(n){return ba.isId(n)}const ore={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1},DR=n=>n?Tf(n,e=>ore[e]):null;Ci("instance");function are(n){const e={};for(const[r,i]of n)e[r]=SR(i);const t=_o("instance",Ve({typeName:yr("instance"),id:Ci("instance"),currentPageId:up,followingUserId:ze.nullable(),brush:Mf.nullable(),opacityForNextShape:wR,stylesForNextShape:Ve(e),cursor:Jne,scribbles:qn(RR),isFocusMode:qe,isDebugMode:qe,isToolLocked:qe,exportBackground:qe,screenBounds:Mf,insets:qn(qe),zoomBrush:Mf.nullable(),isPenMode:qe,isGridMode:qe,chatMessage:ze,isChatting:qe,highlightedUserIds:qn(ze),isFocused:qe,devicePixelRatio:Me,isCoarsePointer:qe,isHoveringCanvas:qe.nullable(),openMenus:qn(ze),isChangingStyle:qe,isReadonly:qe,meta:Wn,duplicateProps:Ve({shapeIds:qn(Ci("shape")),offset:Ve({x:Me,y:Me})}).nullable()}));return Ao("instance",{validator:t,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const Dt=ai("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),lre=Di({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:Dt.AddTransparentExportBgs,up:n=>({...n,exportBackground:!0})},{id:Dt.RemoveDialog,up:({dialog:n,...e})=>e},{id:Dt.AddToolLockMode,up:n=>({...n,isToolLocked:!1})},{id:Dt.RemoveExtraPropsForNextShape,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))})},{id:Dt.AddLabelColor,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}})},{id:Dt.AddFollowingUserId,up:n=>({...n,followingUserId:null})},{id:Dt.RemoveAlignJustify,up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}}},{id:Dt.AddZoom,up:n=>({...n,zoomBrush:null})},{id:Dt.AddVerticalAlign,up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}})},{id:Dt.AddScribbleDelay,up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n}},{id:Dt.RemoveUserId,up:({userId:n,...e})=>e},{id:Dt.AddIsPenModeAndIsGridMode,up:n=>({...n,isPenMode:!1,isGridMode:!1})},{id:Dt.HoistOpacity,up:({propsForNextShape:{opacity:n,...e},...t})=>({...t,opacityForNextShape:Number(n??"1"),propsForNextShape:e})},{id:Dt.AddChat,up:n=>({...n,chatMessage:"",isChatting:!1})},{id:Dt.AddHighlightedUserIds,up:n=>({...n,highlightedUserIds:[]})},{id:Dt.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}})},{id:Dt.AddMeta,up:n=>({...n,meta:{}})},{id:Dt.RemoveCursorColor,up:n=>{const{color:e,...t}=n.cursor;return{...n,cursor:t}}},{id:Dt.AddLonelyProperties,up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:Dt.ReadOnlyReadonly,up:({isReadOnly:n,...e})=>({...e,isReadonly:n})},{id:Dt.AddHoveringCanvas,up:n=>({...n,isHoveringCanvas:null})},{id:Dt.AddScribbles,up:({scribble:n,...e})=>({...e,scribbles:[]})},{id:Dt.AddInset,up:n=>({...n,insets:[!1,!1,!1,!1]}),down:({insets:n,...e})=>({...e})},{id:Dt.AddDuplicateProps,up:n=>({...n,duplicateProps:null}),down:({duplicateProps:n,...e})=>({...e})},{id:Dt.RemoveCanMoveCamera,up:({canMoveCamera:n,...e})=>({...e}),down:n=>({...n,canMoveCamera:!0})}]}),cr="instance:instance",cre=_o("instance_page_state",Ve({typeName:yr("instance_page_state"),id:Ci("instance_page_state"),pageId:up,selectedShapeIds:qn(Fi),hintingShapeIds:qn(Fi),erasingShapeIds:qn(Fi),hoveredShapeId:Fi.nullable(),editingShapeId:Fi.nullable(),croppingShapeId:Fi.nullable(),focusedGroupId:Fi.nullable(),meta:Wn})),kh=ai("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),ure=Di({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:kh.AddCroppingId,up(n){n.croppingShapeId=null}},{id:kh.RemoveInstanceIdAndCameraId,up(n){delete n.instanceId,delete n.cameraId}},{id:kh.AddMeta,up:n=>{n.meta={}}},{id:kh.RenameProperties,up:n=>{},down:n=>{}},{id:kh.RenamePropertiesAgain,up:n=>{n.selectedShapeIds=n.selectedIds,delete n.selectedIds,n.hintingShapeIds=n.hintingIds,delete n.hintingIds,n.erasingShapeIds=n.erasingIds,delete n.erasingIds,n.hoveredShapeId=n.hoveredId,delete n.hoveredId,n.editingShapeId=n.editingId,delete n.editingId,n.croppingShapeId=n.croppingShapeId??n.croppingId??null,delete n.croppingId,n.focusedGroupId=n.focusLayerId,delete n.focusLayerId},down:n=>{n.selectedIds=n.selectedShapeIds,delete n.selectedShapeIds,n.hintingIds=n.hintingShapeIds,delete n.hintingShapeIds,n.erasingIds=n.erasingShapeIds,delete n.erasingShapeIds,n.hoveredId=n.hoveredShapeId,delete n.hoveredShapeId,n.editingId=n.editingShapeId,delete n.editingShapeId,n.croppingId=n.croppingShapeId,delete n.croppingShapeId,n.focusLayerId=n.focusedGroupId,delete n.focusedGroupId}}]}),Gi=Ao("instance_page_state",{validator:cre,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),dre=_o("pointer",Ve({typeName:yr("pointer"),id:Ci("pointer"),x:Me,y:Me,lastActivityTimestamp:Me,meta:Wn})),hre=ai("com.tldraw.pointer",{AddMeta:1}),fre=Di({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:hre.AddMeta,up:n=>{n.meta={}}}]}),R6=Ao("pointer",{validator:dre,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),dp=R6.createId("pointer"),pre=_o("instance_presence",Ve({typeName:yr("instance_presence"),id:Ci("instance_presence"),userId:ze,userName:ze,lastActivityTimestamp:Me,followingUserId:ze.nullable(),cursor:Ve({x:Me,y:Me,type:_R,rotation:Me}),color:ze,camera:Ve({x:Me,y:Me,z:Me}),screenBounds:Mf,selectedShapeIds:qn(Ci("shape")),currentPageId:Ci("page"),brush:Mf.nullable(),scribbles:qn(RR),chatMessage:ze,meta:Wn})),Ch=ai("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),gre=Di({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:Ch.AddScribbleDelay,up:n=>{n.scribble!==null&&(n.scribble.delay=0)}},{id:Ch.RemoveInstanceId,up:n=>{delete n.instanceId}},{id:Ch.AddChatMessage,up:n=>{n.chatMessage=""}},{id:Ch.AddMeta,up:n=>{n.meta={}}},{id:Ch.RenameSelectedShapeIds,up:n=>{}}]}),e4=Ao("instance_presence",{validator:pre,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),mre=(n,e)=>t=>te("instancePresence",()=>{const r=t.get(cr),i=t.get(Gi.createId(r==null?void 0:r.currentPageId)),s=t.get(Os.createId(r==null?void 0:r.currentPageId)),o=t.get(dp),a=n.get();return!i||!r||!s||!o||!a?null:e4.create({id:e4.createId(t.id),selectedShapeIds:i.selectedShapeIds,brush:r.brush,scribbles:r.scribbles,userId:a.id,userName:a.name,followingUserId:r.followingUserId,camera:{x:s.x,y:s.y,z:s.z},color:a.color,currentPageId:r.currentPageId,cursor:{x:o.x,y:o.y,rotation:r.cursor.rotation,type:r.cursor.type},lastActivityTimestamp:o.lastActivityTimestamp,screenBounds:r.screenBounds,chatMessage:r.chatMessage,meta:{}})}),yre=_o("document",Ve({typeName:yr("document"),id:yr("document:document"),gridSize:Me,name:ze,meta:Wn})),WC=ai("com.tldraw.document",{AddName:1,AddMeta:2}),vre=Di({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:WC.AddName,up:n=>{n.name=""},down:n=>{delete n.name}},{id:WC.AddMeta,up:n=>{n.meta={}}}]}),D6=Ao("document",{validator:yre,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),t4=D6.createId("document");function Sre(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function VC(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}const xre=({error:n,phase:e,record:t,recordBefore:r})=>{throw v6(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?VC(It(r)):void 0,recordAfter:VC(It(t))}}),n};function wre(){return[ba.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function bre(n){const e=n.query.ids("page"),t=()=>{if(!n.has(t4))return n.put([D6.create({id:t4,name:n.props.defaultName})]),t();if(!n.has(dp))return n.put([R6.create({id:dp})]),t();const r=e.get();if(r.size===0)return n.put(wre()),t();const i=()=>[...r].map(l=>n.get(l)).sort(Sre)[0].id,s=n.get(cr);if(s){if(!r.has(s.currentPageId))return n.put([{...s,currentPageId:i()}]),t()}else return n.put([n.schema.types.instance.create({id:cr,currentPageId:i(),exportBackground:!0})]),t();const o=new Set,a=new Set;for(const l of r){const c=Gi.createId(l);n.has(c)||o.add(c);const u=Os.createId(l);n.has(u)||a.add(u)}o.size>0&&n.put([...o].map(l=>Gi.create({id:l,pageId:Gi.parseId(l)}))),a.size>0&&n.put([...a].map(l=>Os.create({id:l})))};return t}const Ore=_6("bookmark",Ve({title:ze,description:ze,image:ze,favicon:ze,src:$c.nullable()})),GC=ai("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),kre=Di({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:n=>n.type==="bookmark",sequence:[{id:GC.MakeUrlsValid,up:n=>{$c.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:GC.AddFavicon,up:n=>{$c.isValid(n.props.favicon)||(n.props.favicon="")},down:n=>{delete n.props.favicon}}]}),Cre=_6("image",Ve({w:Me,h:Me,name:ze,isAnimated:qe,mimeType:ze.nullable(),src:$c.nullable(),fileSize:fn.optional()})),Ph=ai("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),Pre=Di({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:n=>n.type==="image",sequence:[{id:Ph.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:Ph.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:Ph.MakeUrlsValid,up:n=>{$c.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:Ph.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:Ph.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),Tre=_6("video",Ve({w:Me,h:Me,name:ze,isAnimated:qe,mimeType:ze.nullable(),src:$c.nullable(),fileSize:Me.optional()})),Th=ai("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),Ere=Di({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:n=>n.type==="video",sequence:[{id:Th.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:Th.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:Th.MakeUrlsValid,up:n=>{$c.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:Th.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:Th.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),Ire=_o("asset",I6("type",{image:Cre,video:Tre,bookmark:Ore})),Mre=ai("com.tldraw.asset",{AddMeta:1}),Are=Di({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:Mre.AddMeta,up:n=>{n.meta={}}}]}),bc=Ao("asset",{validator:Ire,scope:"document"}).withDefaultProperties(()=>({meta:{}})),jR={w:fn,h:fn,assetId:Dv.nullable(),url:Mi},XC=zs("bookmark",{NullAssetId:1,MakeUrlsValid:2}),LR={sequence:[{id:XC.NullAssetId,up:n=>{n.assetId===void 0&&(n.assetId=null)},down:"retired"},{id:XC.MakeUrlsValid,up:n=>{Mi.isValid(n.url)||(n.url="")},down:n=>{}}]},zR=Ve({type:Rv("free","straight"),points:qn(Fc)}),NR={color:Ai,fill:Uc,dash:Bc,size:Co,segments:qn(zR),isComplete:qe,isClosed:qe,isPen:qe,scale:fn},KC=zs("draw",{AddInPen:1,AddScale:2}),$R={sequence:[{id:KC.AddInPen,up:n=>{const{points:e}=n.segments[0];if(e.length===0){n.isPen=!1;return}let t=!(e[0].z===0||e[0].z===.5);e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),n.isPen=t},down:"retired"},{id:KC.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]};var _re={};const YC=/(^\/r\/[^/]+\/?$)/,dt=n=>{try{return new URL(n)}catch{return}},Gp=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(YC))return n},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(YC))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:n=>{if(n.includes("/maps/")){const e=n.match(/@(.*),(.*),(.*)z/);let t;if(e){const[,r,i,s]=e;t=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${_re.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${s}`}else t="";return t}},fromEmbedUrl:n=>{const e=dt(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[i,s]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${s},${r}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=dt(n),t=e&&e.pathname.match(/\/v\/(.+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:n=>{const e=dt(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=dt(n),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:n=>{const e=dt(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=n.match(e);if(t){const[r,i,s]=t;return`https://codepen.io/${i}/embed/${s}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i,s]=t;return`https://codepen.io/${i}/pen/${s}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=dt(n);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=dt(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=dt(n),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:n=>{const e=dt(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=dt(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}},fromEmbedUrl:n=>{const e=dt(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=dt(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=dt(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:n=>{const e=dt(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${n}?embed`},fromEmbedUrl:n=>{const e=dt(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],Rre={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},FR={w:fn,h:fn,url:ze},tg=zs("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),BR={sequence:[{id:tg.GenOriginalUrlInEmbed,up:n=>{try{const e=n.url,t=new URL(e).host.replace("www.","");let r;for(const i of Gp)if(i.hostnames.includes(t))try{r=i.fromEmbedUrl(e)}catch(s){console.warn(s)}n.tmpOldUrl=n.url,n.url=r??""}catch{n.url="",n.tmpOldUrl=n.url}},down:"retired"},{id:tg.RemoveDoesResize,up:n=>{delete n.doesResize},down:"retired"},{id:tg.RemoveTmpOldUrl,up:n=>{delete n.tmpOldUrl},down:"retired"},{id:tg.RemovePermissionOverrides,up:n=>{delete n.overridePermissions},down:"retired"}]},UR={w:fn,h:fn,name:ze},HR={sequence:[]},ly=er.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),cy=er.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),ks=er.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),QR={geo:ks,labelColor:CR,color:Ai,fill:Uc,dash:Bc,size:Co,font:ko,align:ly,verticalAlign:cy,url:Mi,w:fn,h:fn,growY:ry,text:ze,scale:fn},Bo=zs("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),qR={sequence:[{id:Bo.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Bo.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"},{id:Bo.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:Bo.AddCheckBox,up:n=>{},down:"retired"},{id:Bo.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:Bo.MigrateLegacyAlign,up:n=>{let e;switch(n.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}n.align=e},down:"retired"},{id:Bo.AddCloud,up:n=>{},down:"retired"},{id:Bo.MakeUrlsValid,up:n=>{Mi.isValid(n.url)||(n.url="")},down:n=>{}},{id:Bo.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},WR={},VR={sequence:[]},GR={color:Ai,size:Co,segments:qn(zR),isComplete:qe,isPen:qe,scale:fn},Dre=zs("highlight",{AddScale:1}),XR={sequence:[{id:Dre.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},jre=Ve({topLeft:Fc,bottomRight:Fc}),KR={w:fn,h:fn,playing:qe,url:Mi,assetId:Dv.nullable(),crop:jre.nullable(),flipX:qe,flipY:qe},ng=zs("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),YR={sequence:[{id:ng.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:ng.AddCropProp,up:n=>{n.crop=null},down:n=>{delete n.crop}},{id:ng.MakeUrlsValid,up:n=>{Mi.isValid(n.url)||(n.url="")},down:n=>{}},{id:ng.AddFlipProps,up:n=>{n.flipX=!1,n.flipY=!1},down:n=>{delete n.flipX,delete n.flipY}}]},uy=er.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),Lre=Ve({id:ze,index:A6,x:Me,y:Me}),ZR={color:Ai,dash:Bc,size:Co,spline:uy,points:iy(ze,Lre),scale:fn},Eh=zs("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),JR={sequence:[{id:Eh.AddSnapHandles,up:n=>{for(const e of Object.values(n.handles))e.canSnap=!0},down:"retired"},{id:Eh.RemoveExtraHandleProps,up:n=>{n.handles=nR(Object.values(n.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:n=>{const e=Object.entries(n.handles).map(([t,r])=>({index:t,...r})).sort(fr);n.handles=Object.fromEntries(e.map((t,r)=>{const i=r===0?"start":r===e.length-1?"end":`handle:${t.index}`;return[i,{id:i,type:"vertex",canBind:!1,canSnap:!0,index:t.index,x:t.x,y:t.y}]}))}},{id:Eh.HandlesToPoints,up:n=>{const e=Object.entries(n.handles).map(([t,{x:r,y:i}])=>({x:r,y:i,index:t})).sort(fr);n.points=e.map(({x:t,y:r})=>({x:t,y:r})),delete n.handles},down:n=>{const e=lp(n.points.length);n.handles=Object.fromEntries(n.points.map((t,r)=>[e[r],{x:t.x,y:t.y}])),delete n.points}},{id:Eh.PointIndexIds,up:n=>{const e=lp(n.points.length);n.points=Object.fromEntries(n.points.map((t,r)=>{const i=e[r];return[i,{id:i,index:i,x:t.x,y:t.y}]}))},down:n=>{const e=Object.values(n.points).sort(fr);n.points=e.map(({x:t,y:r})=>({x:t,y:r}))}},{id:Eh.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},eD={color:Ai,size:Co,font:ko,fontSizeAdjustment:ry,align:ly,verticalAlign:cy,growY:ry,url:Mi,text:ze,scale:fn},uc=zs("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7}),tD={sequence:[{id:uc.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:uc.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:uc.MigrateLegacyAlign,up:n=>{switch(n.align){case"start":n.align="start-legacy";return;case"end":n.align="end-legacy";return;default:n.align="middle-legacy";return}},down:"retired"},{id:uc.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:uc.MakeUrlsValid,up:n=>{Mi.isValid(n.url)||(n.url="")},down:n=>{}},{id:uc.AddFontSizeAdjustment,up:n=>{n.fontSizeAdjustment=0},down:n=>{delete n.fontSizeAdjustment}},{id:uc.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},n4=er.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),nD={color:Ai,size:Co,font:ko,textAlign:n4,w:fn,text:ze,scale:fn,autoSize:qe},ZC=zs("text",{RemoveJustify:1,AddTextAlign:2}),rD={sequence:[{id:ZC.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:ZC.AddTextAlign,up:n=>{n.textAlign=n.align,delete n.align},down:n=>{n.align=n.textAlign,delete n.textAlign}}]},iD={w:fn,h:fn,time:Me,playing:qe,url:Mi,assetId:Dv.nullable()},JC=zs("video",{AddUrlProp:1,MakeUrlsValid:2}),sD={sequence:[{id:JC.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:JC.MakeUrlsValid,up:n=>{Mi.isValid(n.url)||(n.url="")},down:n=>{}}]},rg=ai("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),zre=od({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:rg.RemoveCodeAndIconShapeTypes,scope:"store",up:n=>{for(const[e,t]of Kn(n))t.typeName==="shape"&&(t.type==="icon"||t.type==="code")&&delete n[e]}},{id:rg.AddInstancePresenceType,scope:"store",up(n){}},{id:rg.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:n=>{for(const[e,t]of Kn(n))t.typeName.match(/^(user|user_presence)$/)&&delete n[e]}},{id:rg.RemoveUserDocument,scope:"store",up:n=>{for(const[e,t]of Kn(n))t.typeName.match("user_document")&&delete n[e]}}]}),Nre={arrow:{migrations:IR,props:ER},bookmark:{migrations:LR,props:jR},draw:{migrations:$R,props:NR},embed:{migrations:BR,props:FR},frame:{migrations:HR,props:UR},geo:{migrations:qR,props:QR},group:{migrations:VR,props:WR},highlight:{migrations:XR,props:GR},image:{migrations:YR,props:KR},line:{migrations:JR,props:ZR},note:{migrations:tD,props:eD},text:{migrations:rD,props:nD},video:{migrations:sD,props:iD}},$re={arrow:{migrations:AR,props:MR}};function Fre({shapes:n=Nre,bindings:e=$re,migrations:t}={}){const r=new Map;for(const a of Gt(n))for(const l of bR(a.props??{}).keys()){if(r.has(l.id)&&r.get(l.id)!==l)throw new Error(`Multiple StyleProp instances with the same id: ${l.id}`);r.set(l.id,l)}const i=Gne(n),s=qne(e),o=are(r);return T6.create({asset:bc,binding:s,camera:Os,document:D6,instance:o,instance_page_state:Gi,page:ba,instance_presence:e4,pointer:R6,shape:i},{migrations:[zre,Are,Yne,vre,lre,ure,sre,gre,fre,Vne,kre,Pre,Ere,...qC("shape",n),...qC("binding",e),...t??[]],onValidationFailure:xre,createIntegrityChecker:bre})}const hp=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Catal"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espaol"},{locale:"fr",label:"Franais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugus - Brasil"},{locale:"pt-pt",label:"Portugus - Europeu"},{locale:"ro",label:"Romn"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"Trke"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ku",label:""},{locale:"ne",label:""},{locale:"hi-in",label:""},{locale:"te",label:""},{locale:"th",label:""},{locale:"my",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function Bre(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return Ure(n)}function Ure(n){for(const e of n){const t=Hre(e);if(t)return t}return"en"}const eP={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function Hre(n){const e=hp.find(i=>i.locale===n.toLowerCase());if(e)return e.locale;const[t,r]=n.split(/[-_]/).map(i=>i.toLowerCase());if(r){const i=hp.find(s=>s.locale===t);if(i)return i.locale}return t in eP?eP[t]:null}function jv(n,e){const t=Qe.useRef(e);t.current=e;const[r,i,s]=Qe.useMemo(()=>{let o=null;const a=u=>(o=u,()=>{o=null}),l=new Kd(`useStateTracking(${n})`,()=>{var u;return(u=t.current)==null?void 0:u.call(t)},{scheduleEffect(){o==null||o()}});return[l,a,()=>l.scheduleCount]},[n]);return Qe.useSyncExternalStore(i,s,s),Qe.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const tP={apply(n,e,t){return jv(n.displayName??n.name??"tracked(???)",()=>n.apply(e,t))}},Qre=Symbol.for("react.memo"),qre=Symbol.for("react.forward_ref");function zn(n){let e=null;const t=n.$$typeof;return t===Qre&&(n=n.type,e=n.compare),t===qre?k.memo(k.forwardRef(new Proxy(n.render,tP))):k.memo(new Proxy(n,tP),e)}function Wre(n,e,t){return k.useState(()=>{const r=typeof e=="function"?e():e;return mn(`useAtom(${n})`,r,t)})[0]}function Vre(){const n=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return k.useMemo(()=>te(`useComputed(${n})`,e,t),r)}function bl(n,e,t=ua){k.useEffect(()=>{const r=new Kd(n,e);return r.attach(),r.execute(),()=>{r.detach()}},t)}function ee(){const n=arguments,e=n.length===3?n[2]:[n[0]],t=n.length===3?n[0]:`useValue(${n[0].name})`,r=k.useRef(!0);r.current=!0;const i=k.useMemo(()=>n.length===1?n[0]:te(t,()=>{if(r.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:s,getSnapshot:o}=k.useMemo(()=>({subscribe:a=>Xl(`useValue(${t})`,()=>{i.get(),a()}),getSnapshot:()=>i.get()}),[i]);return k.useSyncExternalStore(s,o,o)}finally{r.current=!1}}var oD={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var s="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(s=i(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var a in s)e.call(s,a)&&s[a]&&(o=i(o,a));return o}function i(s,o){return o?s?s+" "+o:s+o:s}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(oD);var Gre=oD.exports;const Te=Ul(Gre),aD="2.4.4",nP={major:"2024-06-28T10:56:07.893Z",minor:"2024-07-22T16:42:50.301Z",patch:"2024-08-05T17:56:04.722Z"},Xre={error:null};class lD extends k.Component{constructor(){super(...arguments);v(this,"state",Xre)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var r,i;(i=(r=this.props).onError)==null||i.call(r,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:r}=this.props;return f.jsx(r,{error:t})}return this.props.children}}function fp({children:n,fallback:e,...t}){return e===null?n:f.jsx(lD,{fallback:e,...t,children:n})}const Lv=k.createContext(null);function G(){const n=Qe.useContext(Lv);if(!n)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return n}function Kre(){return f.jsx("div",{className:"tl-background"})}function Jd(n,e,t,r,i,s){k.useLayoutEffect(()=>{const o=n.current;if(!o||e===void 0)return;let a=`translate(${e}px, ${t}px)`;r!==void 0&&(a+=` scale(${r})`),i!==void 0&&(a+=` rotate(${i}rad)`),s&&(a+=` translate(${s.x}px, ${s.y}px)`),o.style.transform=a})}const Rn={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class b{constructor(e=0,t=0,r=1){this.x=e,this.y=t,this.z=r}get pressure(){return this.z}set(e=this.x,t=this.y,r=this.z){return this.x=e,this.y=t,this.z=r,this}setTo({x:e=0,y:t=0,z:r=1}){return this.x=e,this.y=t,this.z=r,this}rot(e){if(e===0)return this;const{x:t,y:r}=this,i=Math.sin(e),s=Math.cos(e);return this.x=t*s-r*i,this.y=t*i+r*s,this}rotWith(e,t){if(t===0)return this;const r=this.x-e.x,i=this.y-e.y,s=Math.sin(t),o=Math.cos(t);return this.x=e.x+(r*o-i*s),this.y=e.y+(r*s+i*o),this}clone(){const{x:e,y:t,z:r}=this;return new b(e,t,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const r=b.Tan(e,this);return this.add(r.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return b.Dpr(this,e)}cpr(e){return b.Cpr(this,e)}len2(){return b.Len2(this)}len(){return b.Len(this)}pry(e){return b.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return b.Uni(this)}tan(e){return b.Tan(this,e)}dist(e){return b.Dist(this,e)}distanceToLineSegment(e,t){return b.DistanceToLineSegment(e,t,this)}slope(e){return b.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return b.Angle(this,e)}toAngle(){return b.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return b.Equals(this,e)}equalsXY(e,t){return b.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return b.ToFixed(this)}toString(){return b.ToString(b.ToFixed(this))}toJson(){return b.ToJson(this)}toArray(){return b.ToArray(this)}static Add(e,t){return new b(e.x+t.x,e.y+t.y)}static AddXY(e,t,r){return new b(e.x+t,e.y+r)}static Sub(e,t){return new b(e.x-t.x,e.y-t.y)}static SubXY(e,t,r){return new b(e.x-t,e.y-r)}static AddScalar(e,t){return new b(e.x+t,e.y+t)}static SubScalar(e,t){return new b(e.x-t,e.y-t)}static Div(e,t){return new b(e.x/t,e.y/t)}static Mul(e,t){return new b(e.x*t,e.y*t)}static DivV(e,t){return new b(e.x/t.x,e.y/t.y)}static MulV(e,t){return new b(e.x*t.x,e.y*t.y)}static Neg(e){return new b(-e.x,-e.y)}static Per(e){return new b(e.y,-e.x)}static Abs(e){return new b(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,r){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<r**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new b(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return b.Dpr(e,t)/b.Len(t)}static Uni(e){return b.Div(e,b.Len(e))}static Tan(e,t){return b.Uni(b.Sub(e,t))}static Min(e,t){return new b(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new b(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:r=1}){return new b(e,t,r)}static FromArray(e){return new b(e[0],e[1])}static Rot(e,t=0){const r=Math.sin(t),i=Math.cos(t);return new b(e.x*i-e.y*r,e.x*r+e.y*i)}static RotWith(e,t,r){const i=e.x-t.x,s=e.y-t.y,o=Math.sin(r),a=Math.cos(r);return new b(t.x+(i*a-s*o),t.y+(i*o+s*a))}static NearestPointOnLineThroughPoint(e,t,r){return b.Mul(t,b.Sub(r,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,r,i=!0){if(b.Equals(e,r)||b.Equals(t,r))return b.From(r);const s=b.Tan(t,e),o=b.Add(e,b.Mul(s,b.Sub(r,e).pry(s)));if(i){if(o.x<Math.min(e.x,t.x))return b.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return b.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return b.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return b.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,r){return b.Dist(r,b.NearestPointOnLineThroughPoint(e,t,r))}static DistanceToLineSegment(e,t,r,i=!0){return b.Dist(r,b.NearestPointOnLineSegment(e,t,r,i))}static Snap(e,t=1){return new b(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof b?e:b.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,r){return b.Sub(t,e).mul(r).add(e)}static Med(e,t){return new b((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,r){return e.x===t&&e.y===r}static Clockwise(e,t,r){return(r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y)<0}static Rescale(e,t){const r=b.Len(e);return new b(t*e.x/r,t*e.y/r)}static ScaleWithOrigin(e,t,r){return b.Sub(e,r).mul(t).add(r)}static ToFixed(e){return new b(na(e.x),na(e.y))}static ToInt(e){return new b(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,r){return b.Add(e,b.Tan(t,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new b(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:r,z:i}=e;return{x:t,y:r,z:i}}static Average(e){const t=e.length,r=new b(0,0);if(t===0)return r;for(let i=0;i<t;i++)r.add(e[i]);return r.div(t)}static Clamp(e,t,r){return r===void 0?new b(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new b(Math.min(Math.max(e.x,t),r),Math.min(Math.max(e.y,t),r))}static PointsBetween(e,t,r=6){const i=[];for(let s=0;s<r;s++){const o=Rn.easeInQuad(s/(r-1)),a=b.Lrp(e,t,o);a.z=Math.min(1,.5+Math.abs(.5-Yre(o))*.65),i.push(a)}return i}static SnapToGrid(e,t=8){return new b(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const Yre=n=>n<.5?2*n*n:-1+(4-2*n)*n;function st(n){return`${q(n.x)},${q(n.y)} `}function Vr(n,e){return`${q((n.x+e.x)/2)},${q((n.y+e.y)/2)} `}const at=Math.PI,Mt=at/2,pt=at*2,Zre=Math.sin;function An(n,e,t){return Math.max(e,typeof t<"u"?Math.min(n,t):n)}function ig(n,e=1e10){return n?Math.round(n*e)/e:0}function Ol(n,e,t=1e-6){return Math.abs(n-e)<=t}function cD(n,e){const t=Math.pow(n-e,2)/Math.pow(n+e,2);return at*(n+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function kl(n){return n=n%pt,n<0?n=n+pt:n===0&&(n=0),n}function Xp(n,e){return n=kl(n),e=kl(e),n>e&&(e+=pt),e-n}function uD(n,e){return pt-Xp(n,e)}function Tm(n,e){const t=(e-n)%pt;return 2*t%pt-t}function r4(n){return(pt+n)%pt}function dy(n,e){const t=pt/e;let r=Math.floor((r4(n)+t/2)/t)*t%pt;return r<at&&(r+=pt),r>at&&(r-=pt),r}function dD(n,e){return n===e||Ol(n%(Math.PI/2)-e%(Math.PI/2),0)}function Jre(n){return n*at/180}function eie(n){return n*180/at}function Hc(n,e,t){return new b(n.x,n.y).add(b.FromAngle(t,e))}function qx(n,e,t){const r=n/2,i=e/2,s=[];let o=1/0,a=-1/0,l=1/0,c=-1/0;for(let g=0;g<t;g++){const m=pt/t,S=-Mt+g*m,y=r+r*Math.cos(S),x=i+i*Math.sin(S);y<o&&(o=y),x<l&&(l=x),y>a&&(a=y),x>c&&(c=x),s.push(new b(y,x))}const u=a-o,d=c-l,h=n-u,p=e-d;if(h!==0||p!==0)for(let g=0;g<s.length;g++){const m=s[g];m.x=(m.x-o)/u*n,m.y=(m.y-l)/d*e}return s}function Ih(n,e,t,r){return n<r&&t<e}function vs(n,e,t,r){const i=Math.max(n,t),s=Math.min(e,r);return i<=s?[i,s]:null}function rP(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}function Pi(n,e){let t=0,r,i;for(let s=0;s<e.length;s++){if(r=e[s],r.x===n.x&&r.y===n.y||(i=e[(s+1)%e.length],b.Dist(n,r)+b.Dist(n,i)===b.Dist(r,i)))return!0;r.y<=n.y?i.y>n.y&&rP(r,i,n)>0&&(t+=1):i.y<=n.y&&rP(r,i,n)<0&&(t-=1)}return t!==0}function q(n){return Math.round(n*1e4)/1e4}function na(n){return Math.round(n*100)/100}const iP=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER;function nl(n,e,t){return t<0?Xp(n,e):uD(n,e)}function i4(n,e,t,r){let i;if(Math.abs(n)>at){i=Tm(e,r);const s=Tm(r,t);return Math.abs(i)<Math.abs(s)?i/n:(n-s)/n}else{i=Tm(e,r);const s=i/n;return Math.sign(i)!==Math.sign(n)?Math.abs(s)>.5?1:0:s}}function tie(n,e,t,r){const i=2*((e-n)%pt)%pt-(e-n)%pt;return r?(pt-Math.abs(i))*(t?1:-1):i}function j6(n,e,t){const r=-2*(n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y);return new b(((n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y))/r,((n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x))/r)}function nie(n,e,t,r,i){if(t===null)return[b.From(n),b.From(e)];const s=[],o=b.Angle(t,n),a=b.Angle(t,e),l=Xp(o,a);for(let c=0;c<i;c++){const u=c/(i-1),d=o+l*u,h=Hc(t,r,d);s.push(h)}return s}const Wx=({brush:n,color:e,opacity:t,className:r})=>{const i=k.useRef(null);Jd(i,n.x,n.y);const s=q(Math.max(1,n.w)),o=q(Math.max(1,n.h));return f.jsx("svg",{className:"tl-overlays__item",ref:i,children:e?f.jsxs("g",{className:"tl-brush",opacity:t,children:[f.jsx("rect",{width:s,height:o,fill:e,opacity:.75}),f.jsx("rect",{width:s,height:o,fill:"none",stroke:e,opacity:.1})]}):f.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:s,height:o})})},sP={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},Vx={duration:0,easing:Rn.easeInOutCubic},oP={CAMERA_MOVE:-10},rie=["top","right","bottom","left"],aP=0,L6=2,sg=1,lP=5,iie=128;function hy(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return hy(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function tt(n){n.preventDefault(),un.logPreventDefaults.get()&&console.warn("preventDefault called on event:",n)}function Kp(n,e){if(n.setPointerCapture(e.pointerId),un.logPointerCaptures.get()){const t=fR.get();t.set(n,(t.get(n)??0)+1),console.warn("setPointerCapture called on element:",n,e)}}function Yp(n,e){if(n.hasPointerCapture(e.pointerId)&&(n.releasePointerCapture(e.pointerId),un.logPointerCaptures.get())){const t=fR.get();t.get(n)===1?t.delete(n):t.has(n)?t.set(n,t.get(n)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",n,e)}}const Tn=n=>n.stopPropagation(),sr=(n,e,t)=>{n&&n.style.setProperty(e,t)};function Zr(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}function hD(){const n=G();return k.useMemo(function(){let r,i;function s(m){if(!m.isKilled){if(m.button===L6){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...Zr(m)});return}m.button!==0&&m.button!==1&&m.button!==5||(Kp(m.currentTarget,m),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Zr(m)}))}}function o(m){m.isKilled||m.clientX===r&&m.clientY===i||(r=m.clientX,i=m.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Zr(m)}))}function a(m){m.isKilled||m.button!==0&&m.button!==1&&m.button!==2&&m.button!==5||(r=m.clientX,i=m.clientY,Yp(m.currentTarget,m),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Zr(m)}))}function l(m){if(m.isKilled||n.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const S=m.pointerType==="mouse"||m.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:S?!0:null})}function c(m){if(m.isKilled||n.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const S=m.pointerType==="mouse"||m.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:S?!1:null})}function u(m){m.isKilled=!0,tt(m)}function d(m){m.isKilled=!0,m.target instanceof HTMLElement&&m.target.tagName!=="A"&&m.target.tagName!=="TEXTAREA"&&!(n.getEditingShape()&&m.target.className.includes("tl-text-content"))&&tt(m)}function h(m){tt(m)}async function p(m){var y,x;if(tt(m),!((x=(y=m.dataTransfer)==null?void 0:y.files)!=null&&x.length))return;const S=Array.from(m.dataTransfer.files);await n.putExternalContent({type:"files",files:S,point:n.screenToPage({x:m.clientX,y:m.clientY}),ignoreParent:!1})}function g(m){Tn(m)}return{onPointerDown:s,onPointerMove:o,onPointerUp:a,onPointerEnter:l,onPointerLeave:c,onDragOver:h,onDrop:p,onTouchStart:u,onTouchEnd:d,onClick:g}},[n])}function sie(){const n=G();k.useEffect(()=>{let e=n.getInstanceState().isCoarsePointer;const t=o=>{const a=o.pointerType!=="mouse";e!==a&&(e=a,n.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",t,{capture:!0});const r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),i=n.environment.isFirefox&&!n.environment.isAndroid&&!n.environment.isIos,s=()=>{const o=i?!1:r.matches;e===o&&(e=o,n.updateInstanceState({isCoarsePointer:o}))};return r&&(r.addEventListener("change",s),s()),()=>{window.removeEventListener("pointerdown",t,{capture:!0}),r&&r.removeEventListener("change",s)}},[n])}const fD=k.createContext(null);function oie({container:n,children:e}){return f.jsx(fD.Provider,{value:n,children:e})}function Nn(){return Qi(k.useContext(fD),"useContainer used outside of <Tldraw />")}function aie(){const n=G(),e=Nn(),t=ee("isFocused",()=>n.getIsFocused(),[n]);k.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let r=null;const i=()=>{r!=null&&r();const s=`(resolution: ${window.devicePixelRatio}dppx)`,o=matchMedia(s),a=l=>{l.type==="change"&&i()};o.addEventListener?o.addEventListener("change",i):o.addListener&&o.addListener(a),r=()=>{o.removeEventListener?o.removeEventListener("change",i):o.removeListener&&o.removeListener(a)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return i(),()=>{r==null||r()}},[n]),k.useEffect(()=>{if(!t)return;const r=a=>{if(a.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!og()&&tt(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){tt(a);return}break}case"Tab":{if(og()||n.getIsMenuOpen())return;break}case",":return;case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&a.preventDefault(),n.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),n.focus());return}default:if(og()||n.getIsMenuOpen())return}const l={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(l)},i=a=>{if(a.isKilled||(a.isKilled=!0,og()||n.getIsMenuOpen())||a.key===",")return;const l={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(l)};function s(a){var l,c;if(e.contains(a.target)){const u=a.touches[0].pageX,d=a.touches[0].radiusX||0;(u-d<10||u+d>n.getViewportScreenBounds().width-10)&&(((l=a.target)==null?void 0:l.tagName)==="BUTTON"&&((c=a.target)==null||c.click()),tt(a))}}const o=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&tt(a)};return e.addEventListener("touchstart",s,{passive:!1}),e.addEventListener("wheel",o,{passive:!1}),document.addEventListener("gesturestart",tt),document.addEventListener("gesturechange",tt),document.addEventListener("gestureend",tt),e.addEventListener("keydown",r),e.addEventListener("keyup",i),()=>{e.removeEventListener("touchstart",s),e.removeEventListener("wheel",o),document.removeEventListener("gesturestart",tt),document.removeEventListener("gesturechange",tt),document.removeEventListener("gestureend",tt),e.removeEventListener("keydown",r),e.removeEventListener("keyup",i)}},[n,e,t])}const lie=["input","select","button","textarea"];function og(){const{activeElement:n}=document;return!!(n&&(n.getAttribute("contenteditable")||lie.indexOf(n.tagName.toLowerCase())>-1))}const cie=["textarea","input"];function uie(n){const e=G();k.useEffect(()=>{const t=n.current;if(!t)return;const r=i=>{var s;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:o}=i;if(cie.includes((s=o.tagName)==null?void 0:s.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;tt(i)}};return t.addEventListener("touchstart",r),t.addEventListener("touchend",r),()=>{t.removeEventListener("touchstart",r),t.removeEventListener("touchend",r)}},[e,n])}function die(n,e,t){return Math.max(e,Math.min(n,t))}const Gn={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function cP(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function uP(n,e,t,r=.15){return r===0?die(n,e,t):n<e?-cP(e-n,t-e,r)+e:n>t?+cP(n-t,t-e,r)+t:n}function hie(n,[e,t],[r,i]){const[[s,o],[a,l]]=n;return[uP(e,s,o,r),uP(t,a,l,i)]}function fie(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function pie(n){var e=fie(n,"string");return typeof e=="symbol"?e:String(e)}function ar(n,e,t){return e=pie(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function dP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Yt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dP(Object(t),!0).forEach(function(r){ar(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):dP(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const pD={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function hP(n){return n?n[0].toUpperCase()+n.slice(1):""}const gie=["enter","leave"];function mie(n=!1,e){return n&&!gie.includes(e)}function yie(n,e="",t=!1){const r=pD[n],i=r&&r[e]||e;return"on"+hP(n)+hP(i)+(mie(t,i)?"Capture":"")}const vie=["gotpointercapture","lostpointercapture"];function Sie(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const r=vie.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function xie(n,e=""){const t=pD[n],r=t&&t[e]||e;return n+r}function gD(n){return"touches"in n}function wie(n){return gD(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function bie(n){return Array.from(n.touches).filter(e=>{var t,r;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(r=t.contains)===null||r===void 0?void 0:r.call(t,e.target))})}function s4(n,e){try{const t=e.clientX-n.clientX,r=e.clientY-n.clientY,i=(e.clientX+n.clientX)/2,s=(e.clientY+n.clientY)/2,o=Math.hypot(t,r);return{angle:-(Math.atan2(t,r)*180)/Math.PI,distance:o,origin:[i,s]}}catch{}return null}function Oie(n){return bie(n).map(e=>e.identifier)}function fP(n,e){const[t,r]=Array.from(n.touches).filter(i=>e.includes(i.identifier));return s4(t,r)}const pP=40,gP=800;function mD(n){let{deltaX:e,deltaY:t,deltaMode:r}=n;return r===1?(e*=pP,t*=pP):r===2&&(e*=gP,t*=gP),[e,t]}function kie(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:r,metaKey:i,ctrlKey:s}=n;Object.assign(e,{shiftKey:t,altKey:r,metaKey:i,ctrlKey:s})}return e}function fy(n,...e){return typeof n=="function"?n(...e):n}function Cie(){}function Pie(...n){return n.length===0?Cie:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function mP(n,e){return Object.assign({},e,n||{})}const Tie=32;class yD{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?fy(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:i}=this;t.args=this.args;let s=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,kie(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const E=t._delta.map(Math.abs);Gn.addTo(t._distance,E)}this.axisIntent&&this.axisIntent(e);const[o,a]=t._movement,[l,c]=r.threshold,{_step:u,values:d}=t;if(r.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=l&&d[0]),u[1]===!1&&(u[1]=Math.abs(a)>=c&&d[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=l&&Math.sign(o)*l),u[1]===!1&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=u[0]!==!1||u[1]!==!1,!t.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[E,C]=d;h[0]=u[0]!==!1?E-u[0]:0,h[1]=u[1]!==!1?C-u[1]:0}else h[0]=u[0]!==!1?o-u[0]:0,h[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);const p=t.offset,g=t._active&&!t._blocked||t.active;g&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=fy(r.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));const[m,S]=t.offset,[[y,x],[w,O]]=t._bounds;t.overflow=[m<y?-1:m>x?1:0,S<w?-1:S>O?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const T=t._active?r.rubberband||[0,0]:[0,0];if(t.offset=hie(t._bounds,t.offset,T),t.delta=Gn.sub(t.offset,p),this.computeMovement(),g&&(!t.last||s>Tie)){t.delta=Gn.sub(t.offset,p);const E=t.delta.map(Math.abs);Gn.addTo(t.distance,E),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[E[0]/s,E[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(Yt(Yt(Yt({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function Eie([n,e],t){const r=Math.abs(n),i=Math.abs(e);if(r>i&&r>t)return"x";if(i>r&&i>t)return"y"}class Iie extends yD{constructor(...e){super(...e),ar(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Gn.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Gn.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[wie(e)]:r.axisThreshold;t.axis=Eie(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const Mie=n=>n,yP=.15,vD={enabled(n=!0){return n},eventOptions(n,e,t){return Yt(Yt({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[yP,yP];case!1:return[0,0];default:return Gn.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return Gn.toVector(n)},transform(n,e,t){const r=n||t.shared.transform;return this.hasCustomTransform=!!r,r||Mie},threshold(n){return Gn.toVector(n,0)}},Aie=0,Zp=Yt(Yt({},vD),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=Aie){return n},bounds(n={}){if(typeof n=="function")return s=>Zp.bounds(n(s));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:r=-1/0,bottom:i=1/0}=n;return[[e,t],[r,i]]}}),Jp=typeof window<"u"&&window.document&&window.document.createElement;function SD(){return Jp&&"ontouchstart"in window}function _ie(){return SD()||Jp&&window.navigator.maxTouchPoints>1}function Rie(){return Jp&&"onpointerdown"in window}function Die(){return Jp&&"exitPointerLock"in window.document}function jie(){try{return"constructor"in GestureEvent}catch{return!1}}const qi={isBrowser:Jp,gesture:jie(),touch:SD(),touchscreen:_ie(),pointer:Rie(),pointerLock:Die()},Lie=250,zie=180,Nie=.5,$ie=50,Fie=250,Bie=10,vP={mouse:0,touch:0,pen:8};Yt(Yt({},Zp),{},{device(n,e,{pointer:{touch:t=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&qi.pointerLock,qi.touch&&t?"touch":this.pointerLock?"mouse":qi.pointer&&!i?"pointer":qi.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?Lie:void 0,!(!qi.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:r=3,axis:i=void 0}){const s=Gn.toVector(n,t?r:i?1:0);return this.filterTaps=t,this.tapsThreshold=r,s},swipe({velocity:n=Nie,distance:e=$ie,duration:t=Fie}={}){return{velocity:this.transform(Gn.toVector(n)),distance:this.transform(Gn.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return zie;case!1:return 0;default:return n}},axisThreshold(n){return n?Yt(Yt({},vP),n):vP},keyboardDisplacement(n=Bie){return n}});function xD(n){const[e,t]=n.overflow,[r,i]=n._delta,[s,o]=n._direction;(e<0&&r>0&&s<0||e>0&&r<0&&s>0)&&(n._movement[0]=n._movementBound[0]),(t<0&&i>0&&o<0||t>0&&i<0&&o>0)&&(n._movement[1]=n._movementBound[1])}const Uie=30,Hie=100;class Qie extends yD{constructor(...e){super(...e),ar(this,"ingKey","pinching"),ar(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:r}=this.state;e==="wheel"?this.state.offset=Gn.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,r]=e._movement;if(!e.axis){const i=Math.abs(t)*Uie-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(s=>r.has(s))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);const i=fP(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(o=>i.has(o))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const s=s4(...Array.from(r.values()));s&&this.pinchStart(e,s)}pinchStart(e,t){const r=this.state;r.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=fP(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const r=s4(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){const r=this.state,i=r._values[1],s=t.angle-i;let o=0;Math.abs(s)>270&&(o+=Math.sign(s)),this.computeValues([t.distance,t.angle-360*o]),r.origin=t.origin,r.turns=o,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=Gn.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(r=>e[r]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const r=this.state;r._delta=[-mD(e)[1]/Hie*r.offset[0],0],Gn.addTo(r._movement,r._delta),xD(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const qie=Yt(Yt({},vD),{},{device(n,e,{shared:t,pointer:{touch:r=!1}={}}){if(t.target&&!qi.touch&&qi.gesture)return"gesture";if(qi.touch&&r)return"touch";if(qi.touchscreen){if(qi.pointer)return"pointer";if(qi.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:r={}}){const i=o=>{const a=mP(fy(t,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=mP(fy(r,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof r!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",Gn.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});Yt(Yt({},Zp),{},{mouseOnly:(n=!0)=>n});class Wie extends Iie{constructor(...e){super(...e),ar(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=mD(e),Gn.addTo(t._movement,t._delta),xD(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const Vie=Zp;Yt(Yt({},Zp),{},{mouseOnly:(n=!0)=>n});const z6=new Map,o4=new Map;function Gie(n){z6.set(n.key,n.engine),o4.set(n.key,n.resolver)}const Xie={key:"pinch",engine:Qie,resolver:qie},Kie={key:"wheel",engine:Wie,resolver:Vie};function Yie(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function Zie(n,e){if(n==null)return{};var t=Yie(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}const Jie={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=qi.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},ese=["target","eventOptions","window","enabled","transform"];function Em(n={},e){const t={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":t[r]=i.call(t,n[r],r,n);break;case"object":t[r]=Em(n[r],i);break;case"boolean":i&&(t[r]=n[r]);break}return t}function tse(n,e,t={}){const r=n,{target:i,eventOptions:s,window:o,enabled:a,transform:l}=r,c=Zie(r,ese);if(t.shared=Em({target:i,eventOptions:s,window:o,enabled:a,transform:l},Jie),e){const u=o4.get(e);t[e]=Em(Yt({shared:t.shared},c),u)}else for(const u in c){const d=o4.get(u);d&&(t[u]=Em(Yt({shared:t.shared},c[u]),d))}return t}class wD{constructor(e,t){ar(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,s){const o=this._listeners,a=xie(t,r),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=Yt(Yt({},l),s);e.addEventListener(a,i,c);const u=()=>{e.removeEventListener(a,i,c),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class nse{constructor(){ar(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class rse{constructor(e){ar(this,"gestures",new Set),ar(this,"_targetEventStore",new wD(this)),ar(this,"gestureEventStores",{}),ar(this,"gestureTimeoutStores",{}),ar(this,"handlers",{}),ar(this,"config",{}),ar(this,"pointerIds",new Set),ar(this,"touchIds",new Set),ar(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),ise(this,e)}setEventIds(e){if(gD(e))return this.touchIds=new Set(Oie(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=tse(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const o of this.gestures){const a=this.config[o],l=SP(r,a.eventOptions,!!i);if(a.enabled){const c=z6.get(o);new c(this,e,o).bind(l)}}const s=SP(r,t.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](Yt(Yt({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in r)r[s]=Pie(...r[s]);if(!i)return r;for(const s in r){const{device:o,capture:a,passive:l}=Sie(s);this._targetEventStore.add(i,o,"",r[s],{capture:a,passive:l})}}}}function yu(n,e){n.gestures.add(e),n.gestureEventStores[e]=new wD(n,e),n.gestureTimeoutStores[e]=new nse}function ise(n,e){e.drag&&yu(n,"drag"),e.wheel&&yu(n,"wheel"),e.scroll&&yu(n,"scroll"),e.move&&yu(n,"move"),e.pinch&&yu(n,"pinch"),e.hover&&yu(n,"hover")}const SP=(n,e,t)=>(r,i,s,o={},a=!1)=>{var l,c;const u=(l=o.capture)!==null&&l!==void 0?l:e.capture,d=(c=o.passive)!==null&&c!==void 0?c:e.passive;let h=a?r:yie(r,i,u);t&&d&&(h+="Passive"),n[h]=n[h]||[],n[h].push(s)},sse=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function ose(n){const e={},t={},r=new Set;for(let i in n)sse.test(i)?(r.add(RegExp.lastMatch),t[i]=n[i]):e[i]=n[i];return[t,e,r]}function vu(n,e,t,r,i,s){if(!n.has(t)||!z6.has(r))return;const o=t+"Start",a=t+"End",l=c=>{let u;return c.first&&o in e&&e[o](c),t in e&&(u=e[t](c)),c.last&&a in e&&e[a](c),u};i[r]=l,s[r]=s[r]||{}}function ase(n,e){const[t,r,i]=ose(n),s={};return vu(i,t,"onDrag","drag",s,e),vu(i,t,"onWheel","wheel",s,e),vu(i,t,"onScroll","scroll",s,e),vu(i,t,"onPinch","pinch",s,e),vu(i,t,"onMove","move",s,e),vu(i,t,"onHover","hover",s,e),{handlers:s,config:e,nativeHandlers:r}}function lse(n,e={},t,r){const i=Qe.useMemo(()=>new rse(n),[]);if(i.applyHandlers(n,r),i.applyConfig(e,t),Qe.useEffect(i.effect.bind(i)),Qe.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function cse(n){return n.forEach(Gie),function(t,r){const{handlers:i,nativeHandlers:s,config:o}=ase(t,r||{});return lse(i,o,void 0,s)}}const xP=10,use=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function bD(n){let{deltaY:e,deltaX:t}=n,r=0;return n.ctrlKey||n.altKey||n.metaKey?r=(Math.abs(e)>xP?xP*Math.sign(e):e)/100:n.shiftKey&&!use&&(t=e,e=0),{x:-t,y:-e,z:-r}}const dse=cse([Kie,Xie]);let Su;const hse=n=>Su===void 0?(Su=n,!1):n-Su>120&&n-Su<160?(Su=n,!0):(Su=n,!1);function fse(n){const e=G(),t=k.useMemo(()=>{let r="not sure";const i=({event:m})=>{if(!e.getInstanceState().isFocused||(r="not sure",hse(Date.now())))return;const S=e.getEditingShapeId();if(S){const w=e.getShape(S);if(w&&e.getShapeUtil(w).canScroll(w)){const T=e.getShapePageBounds(S);if(T!=null&&T.containsPoint(e.inputs.currentPagePoint))return}}tt(m),Tn(m);const y=bD(m);if(y.x===0&&y.y===0)return;const x={type:"wheel",name:"wheel",delta:y,point:new b(m.clientX,m.clientY),shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey};e.dispatch(x)};let s=1,o=1,a=1,l=0;const c=new b,u=new b,d=m=>{const S=n.current;r="not sure";const{event:y,origin:x,da:w}=m;y instanceof WheelEvent||(y.target===S||S!=null&&S.contains(y.target))&&(u.x=x[0],u.y=x[1],c.x=x[0],c.y=x[1],s=w[0],o=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:x[0],y:x[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey}))},h=m=>{if(m&&(r="zooming"),r==="zooming")return;const S=Math.abs(l-s),y=b.Dist(c,u);switch(r){case"not sure":{S>24?r="zooming":y>16&&(r="panning");break}case"panning":{S>64&&(r="zooming");break}}};return{onWheel:i,onPinchStart:d,onPinchEnd:m=>{const S=n.current,{event:y,origin:x,offset:w}=m;if(y instanceof WheelEvent||!(y.target===S||S!=null&&S.contains(y.target)))return;const O=w[0];r="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:x[0],y:x[1],z:O},delta:{x:x[0],y:x[1]},shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey})})},onPinch:m=>{const S=n.current,{event:y,origin:x,offset:w,da:O}=m;if(y instanceof WheelEvent||!(y.target===S||S!=null&&S.contains(y.target)))return;const T=m.type==="gesturechange"||m.type==="gestureend";l=O[0];const E=x[0]-u.x,C=x[1]-u.y;switch(u.x=x[0],u.y=x[1],h(T),r){case"zooming":{a=w[0],e.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:a},delta:{x:E,y:C},shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:o},delta:{x:E,y:C},shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey});break}}}}},[e,n]);dse(t,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>({from:e.getZoomLevel(),max:8,min:.05})}})}function Gx(n,e,t){const r=n.getShape(e),i=n.getShapeHandles(r);return{shape:r,handle:i.find(s=>s.id===t)}}function pse(n,e){const t=G();return k.useMemo(()=>{const r=l=>{if(l.isKilled)return;const c=hy(l.currentTarget);Kp(c,l);const{shape:u,handle:d}=Gx(t,n,e);d&&t.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_down",...Zr(l)})};let i,s;return{onPointerDown:r,onPointerMove:l=>{if(l.isKilled||l.clientX===i&&l.clientY===s)return;i=l.clientX,s=l.clientY;const{shape:c,handle:u}=Gx(t,n,e);u&&t.dispatch({type:"pointer",target:"handle",handle:u,shape:c,name:"pointer_move",...Zr(l)})},onPointerUp:l=>{if(l.isKilled)return;const c=hy(l.currentTarget);Yp(c,l);const{shape:u,handle:d}=Gx(t,n,e);d&&t.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_up",...Zr(l)})}}},[t,n,e])}const Lt=class Lt{constructor(e=0,t=0,r=0,i=0){v(this,"x",0);v(this,"y",0);v(this,"w",0);v(this,"h",0);this.x=e,this.y=t,this.w=r,this.h=i}get point(){return new b(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new b(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new b(this.minX,this.minY),new b(this.maxX,this.minY),new b(this.maxX,this.maxY),new b(this.minX,this.maxY)]}get cornersAndCenter(){return[new b(this.minX,this.minY),new b(this.maxX,this.minY),new b(this.maxX,this.maxY),new b(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new b(this.w,this.h)}toFixed(){return this.x=ig(this.x),this.y=ig(this.y),this.w=ig(this.w),this.h=ig(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,r=0,i=0){return this.x=e,this.y=t,this.w=r,this.h=i,this}expand(e){const t=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),i=Math.max(this.maxX,e.maxX),s=Math.max(this.maxY,e.maxY);return this.x=t,this.y=r,this.w=i-t,this.h=s-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:r,h:i}=this;return new Lt(e,t,r,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,i=Math.round(this.maxX/e)*e,s=Math.round(this.maxY/e)*e;this.minX=t,this.minY=r,this.width=Math.max(1,i-t),this.height=Math.max(1,s-r)}collides(e){return Lt.Collides(this,e)}contains(e){return Lt.Contains(this,e)}includes(e){return Lt.Includes(this,e)}containsPoint(e,t=0){return Lt.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new b(this.minX,this.minY);case"top_right":return new b(this.maxX,this.minY);case"bottom_left":return new b(this.minX,this.maxY);case"bottom_right":return new b(this.maxX,this.maxY);case"top":return new b(this.midX,this.minY);case"right":return new b(this.maxX,this.midY);case"bottom":return new b(this.midX,this.maxY);case"left":return new b(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,r){const{minX:i,minY:s,maxX:o,maxY:a}=this;let{minX:l,minY:c,maxX:u,maxY:d}=this;switch(e){case"left":case"top_left":case"bottom_left":{l+=t;break}case"right":case"top_right":case"bottom_right":{u+=t;break}}switch(e){case"top":case"top_left":case"top_right":{c+=r;break}case"bottom":case"bottom_left":case"bottom_right":{d+=r;break}}const h=(u-l)/(o-i),p=(d-c)/(a-s),g=h<0,m=p<0;if(g){const S=u;u=l,l=S}if(m){const S=d;d=c,c=S}this.minX=l,this.minY=c,this.width=Math.abs(u-l),this.height=Math.abs(d-c)}union(e){const t=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),i=Math.max(this.maxX,e.w+e.x),s=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=r,this.width=i-t,this.height=s-r,this}static From(e){return new Lt(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new Lt(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){if(e.length===0)return new Lt;let t=1/0,r=1/0,i=-1/0,s=-1/0,o;for(let a=0,l=e.length;a<l;a++)o=e[a],t=Math.min(o.x,t),r=Math.min(o.y,r),i=Math.max(o.x,i),s=Math.max(o.y,s);return new Lt(t,r,i-t,s-r)}static Expand(e,t){const r=Math.min(t.minX,e.minX),i=Math.min(t.minY,e.minY),s=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return new Lt(r,i,s-r,o-i)}static ExpandBy(e,t){return new Lt(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Resize(e,t,r,i,s=!1){const{minX:o,minY:a,maxX:l,maxY:c}=e;let{minX:u,minY:d,maxX:h,maxY:p}=e;switch(t){case"left":case"top_left":case"bottom_left":{u+=r;break}case"right":case"top_right":case"bottom_right":{h+=r;break}}switch(t){case"top":case"top_left":case"top_right":{d+=i;break}case"bottom":case"bottom_left":case"bottom_right":{p+=i;break}}const g=(h-u)/(l-o),m=(p-d)/(c-a),S=g<0,y=m<0;if(s){const w=(l-o)/(c-a),O=Math.abs(h-u),T=Math.abs(p-d),E=O*(m<0?1:-1)*(1/w),C=T*(g<0?1:-1)*w,M=w<O/T;switch(t){case"top_left":{M?d=p+E:u=h+C;break}case"top_right":{M?d=p+E:h=u-C;break}case"bottom_right":{M?p=d-E:h=u-C;break}case"bottom_left":{M?p=d-E:u=h+C;break}case"bottom":case"top":{const A=(u+h)/2,D=T*w;u=A-D/2,h=A+D/2;break}case"left":case"right":{const A=(d+p)/2,D=O/w;d=A-D/2,p=A+D/2;break}}}if(S){const w=h;h=u,u=w}if(y){const w=p;p=d,d=w}const x=new Lt(u,d,Math.abs(h-u),Math.abs(p-d));return{box:x,scaleX:+(x.width/e.width*(g>0?1:-1)).toFixed(5),scaleY:+(x.height/e.height*(m>0?1:-1)).toFixed(5)}}equals(e){return Lt.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new Lt(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};v(Lt,"Collides",(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)),v(Lt,"Contains",(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX),v(Lt,"Includes",(e,t)=>Lt.Collides(e,t)||Lt.Contains(e,t)),v(Lt,"ContainsPoint",(e,t,r=0)=>!(t.x<e.minX-r||t.y<e.minY-r||t.x>e.maxX+r||t.y>e.maxY+r)),v(Lt,"Common",e=>{let t=1/0,r=1/0,i=-1/0,s=-1/0;for(let o=0;o<e.length;o++){const a=e[o];t=Math.min(t,a.minX),r=Math.min(r,a.minY),i=Math.max(i,a.maxX),s=Math.max(s,a.maxY)}return new Lt(t,r,i-t,s-r)}),v(Lt,"Sides",(e,t=0)=>{const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]});let ye=Lt;function gse(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function mse(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function yse(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}function vse(n){const e=G();k.useLayoutEffect(()=>{let t=new ye;function r(){const c=n.current;if(!c)return null;const u=c.getBoundingClientRect(),d=new ye(u.left||u.x,u.top||u.y,Math.max(u.width,1),Math.max(u.height,1));t.equals(d)||(e.updateViewportScreenBounds(d),t=d)}r();const i=Q_(r,200,{trailing:!0}),s=e.timers.setInterval(i,1e3);window.addEventListener("resize",i);const o=new ResizeObserver(c=>{c[0].contentRect&&i()}),a=n.current;let l=null;return a&&(o.observe(a),l=Sse(a),l.addEventListener("scroll",i)),()=>{clearInterval(s),window.removeEventListener("resize",i),o.disconnect(),l==null||l.removeEventListener("scroll",i),i.cancel()}},[e,n])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const Sse=n=>{let e=n.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document},ht=class ht{constructor(e,t,r,i,s,o){v(this,"a",1);v(this,"b",0);v(this,"c",0);v(this,"d",1);v(this,"e",0);v(this,"f",0);this.a=e,this.b=t,this.c=r,this.d=i,this.e=s,this.f=o}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:r,b:i,c:s,d:o,e:a,f:l}=this;return this.a=r*t.a+s*t.b,this.c=r*t.c+s*t.d,this.e=r*t.e+s*t.f+a,this.b=i*t.a+o*t.b,this.d=i*t.c+o*t.d,this.f=i*t.e+o*t.f+l,this}rotate(e,t,r){return e===0?this:t===void 0?this.multiply(ht.Rotate(e)):this.translate(t,r).multiply(ht.Rotate(e)).translate(-t,-r)}translate(e,t){return this.multiply(ht.Translate(e,t))}scale(e,t){return this.multiply(ht.Scale(e,t))}invert(){const{a:e,b:t,c:r,d:i,e:s,f:o}=this,a=e*i-t*r;return this.a=i/a,this.b=t/-a,this.c=r/-a,this.d=e/a,this.e=(i*s-r*o)/-a,this.f=(t*s-e*o)/a,this}applyToPoint(e){return ht.applyToPoint(this,e)}applyToPoints(e){return ht.applyToPoints(this,e)}rotation(){return ht.Rotation(this)}point(){return ht.Point(this)}decomposed(){return ht.Decompose(this)}toCssString(){return ht.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return ht.Decompose(this)}clone(){return new ht(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new ht(1,0,0,1,0,0)}static Translate(e,t){return new ht(1,0,0,1,e,t)}static Rotate(e,t,r){if(e===0)return ht.Identity();const i=Math.cos(e),s=Math.sin(e),o=new ht(i,s,-s,i,0,0);return t===void 0?o:ht.Compose(ht.Translate(t,r),o,ht.Translate(-t,-r))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=ht.Identity();for(let r=0,i=e.length;r<i;r++)t.multiply(e[r]);return t}static Point(e){return new b(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;t=Mt+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0;return r4(t)}static Decompose(e){let t,r,i;if(e.a!==0||e.c!==0){const s=(e.a*e.a+e.c*e.c)**.5;t=s,r=(e.a*e.d-e.b*e.c)/s,i=Math.acos(e.a/s)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const s=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/s,r=s,i=Mt+Math.acos(e.b/s)*(e.d>0?-1:1)}else t=0,r=0,i=0;return{x:e.e,y:e.f,scaleX:t,scaleY:r,rotation:r4(i)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${q(e.a)}, ${q(e.b)}, ${q(e.c)}, ${q(e.d)}, ${q(e.e)}, ${q(e.f)})`}static applyToPoint(e,t){return new b(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,r){return[e.a*t+e.c*r+e.e,e.b*t+e.d*r+e.f]}static applyToPoints(e,t){return t.map(r=>new b(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,t){return new ye(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new ht(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof ht?e:ht.From(e)}};v(ht,"Scale",(e,t,r,i)=>{const s=new ht(e,0,0,t,0,0);return r===void 0?s:ht.Compose(ht.Translate(r,i),s,ht.Translate(-r,-i))});let ke=ht;function OD(n,e){return e===0?n:OD(e,n%e)}function kD(n){const e=n.toString().split(".")[1];if(!e)return 1;const t=Math.pow(10,e.length),r=parseInt(e,10);return t/OD(r,t)}class Kl{constructor(e){v(this,"isFilled",!1);v(this,"isClosed",!0);v(this,"isLabel",!1);v(this,"debugColor");v(this,"ignore");v(this,"_vertices");v(this,"_bounds");v(this,"_area");v(this,"_length");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,r=!1){return this.isClosed&&(this.isFilled||r)&&Pi(e,this.vertices)?!0:b.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&Pi(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){if(e.equals(t))return this.distanceToPoint(e);const{vertices:r}=this;let i,s=1/0,o,a,l;for(let c=0;c<r.length;c++)a=r[c],l=b.NearestPointOnLineSegment(e,t,a,!0),o=b.Dist2(a,l),o<s&&(s=o,i=l);if(!i)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&Pi(i,this.vertices)?-s:s}hitTestLineSegment(e,t,r=0){return this.distanceToLineSegment(e,t)<=r}nearestPointOnLineSegment(e,t){const{vertices:r}=this;let i,s=1/0,o,a,l;for(let c=0;c<r.length;c++)a=r[c],l=b.NearestPointOnLineSegment(e,t,a,!0),o=b.Dist2(a,l),o<s&&(s=o,i=l);if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,t=0){const{bounds:r}=this;return!(e.x<r.minX-t||e.y<r.minY-t||e.x>r.maxX+t||e.y>r.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return ye.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let r=0,i=e.length;r<i;r++){const s=e[r],o=e[(r+1)%i];t+=s.x*o.y-o.x*s.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,r=t.length;if(r===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let i=1;i<r;i++)e+=`L${t[i].x},${t[i].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let t,r=e[0],i=0;for(let s=1;s<e.length;s++)t=e[s],i+=b.Dist2(r,t),r=t;return Math.sqrt(i)}}class Ms extends Kl{constructor(t){super({...t,isClosed:!0,isFilled:!1});v(this,"children",[]);v(this,"ignoredChildren",[]);for(const r of t.children)r.ignore?this.ignoredChildren.push(r):this.children.push(r);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let r=1/0,i;const{children:s}=this;if(s.length===0)throw Error("no children");let o,a;for(const l of s)o=l.nearestPoint(t),a=b.Dist2(o,t),a<r&&(r=a,i=o);if(!i)throw Error("nearest point not found");return i}distanceToPoint(t,r=!1){return Math.min(...this.children.map((i,s)=>i.distanceToPoint(t,r||s>0)))}hitTestPoint(t,r,i){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestPoint(t,r,i))}hitTestLineSegment(t,r,i){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestLineSegment(t,r,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const i of this.children)t+=i.toSimpleSvgPath();const r=ye.FromPoints(this.vertices).corners;for(let i=0,s=r.length;i<s;i++){const o=r[i],a=r[(i-1+s)%s],l=o.dist(a),c=r[(i+1)%s],u=o.dist(c),d=o.clone().lrp(a,4/l),h=o,p=o.clone().lrp(c,4/u);t+=`M${d.x},${d.y} L${h.x},${h.y} L${p.x},${p.y} `}return t}getLength(){return this.children.reduce((t,r)=>r.isLabel?t:t+r.length,0)}getSvgPathData(){return this.children.map((t,r)=>t.isLabel?"":t.getSvgPathData(r===0)).join(" ")}}function xse(n=!0){const[e,t]=k.useState(0),r=G();k.useEffect(()=>{if(!n)return;const i=()=>t(s=>s+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,n])}const wse=zn(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:r=!0}){const i=G();xse(r);const s=i.getZoomLevel(),o=i.getRenderingShapes(),{inputs:{currentPagePoint:a}}=i;return f.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(l=>{const c=i.getShape(l.id);if(c.type==="group")return null;const u=i.getShapeGeometry(c),d=i.getShapePageTransform(c),h=i.getPointInShapeSpace(c,a),p=u.nearestPoint(h),g=u.distanceToPoint(h,!0),m=Math.abs(g)*s,S=g<0,{vertices:y}=u;return f.jsxs("g",{transform:d.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&f.jsx("g",{stroke:u.debugColor??"red",opacity:"1",strokeWidth:2/s,fill:"none",children:f.jsx(CD,{geometry:u})}),t&&y.map((x,w)=>f.jsx("circle",{cx:x.x,cy:x.y,r:2/s,fill:`hsl(${Pd(w,[0,y.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/s},`v${w}`)),r&&m<150&&f.jsx("line",{x1:p.x,y1:p.y,x2:h.x,y2:h.y,opacity:1-m/150,stroke:S?"goldenrod":"dodgerblue",strokeWidth:2/s})]},l.id+"_outline")})})});function CD({geometry:n}){return n instanceof Ms?f.jsx(f.Fragment,{children:[...n.children,...n.ignoredChildren].map((e,t)=>f.jsx(CD,{geometry:e},t))}):f.jsx("path",{d:n.toSimpleSvgPath()})}function PD(n){return Wte(n)}function TD(){const n=G(),e=Vre("userIds",()=>PD(n.getCollaborators().map(t=>t.userId)).sort(),{isEqual:(t,r)=>{var i;return t.join(",")===((i=r.join)==null?void 0:i.call(r,","))}},[n]);return ee(e)}function zv(n){const e=G();return ee(`latestPresence:${n}`,()=>e.getCollaborators().find(r=>r.userId===n),[e,n])??null}const bse=zn(function(){return TD().map(t=>f.jsx(Ose,{collaboratorId:t},t))}),Ose=zn(function({collaboratorId:e}){const t=G(),r=zv(e),i=Cse(t,r);if(!(r&&r.currentPageId===t.getCurrentPageId()))return null;switch(i){case"inactive":{const{followingUserId:s,highlightedUserIds:o}=t.getInstanceState();if(!(s===r.userId||o.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:s}=t.getInstanceState();if(r.followingUserId===t.user.getId()&&!(r.chatMessage||s.includes(r.userId)))return null;break}}return f.jsx(kse,{latestPresence:r})}),kse=zn(function({latestPresence:e}){const t=G(),{CollaboratorBrush:r,CollaboratorScribble:i,CollaboratorCursor:s,CollaboratorHint:o,CollaboratorShapeIndicator:a}=Qt(),l=t.getZoomLevel(),c=t.getViewportPageBounds(),{userId:u,chatMessage:d,brush:h,scribbles:p,selectedShapeIds:g,userName:m,cursor:S,color:y}=e,x=!(S.x<c.minX-12/l||S.y<c.minY-16/l||S.x>c.maxX-12/l||S.y>c.maxY-16/l);return f.jsxs(f.Fragment,{children:[h&&r?f.jsx(r,{className:"tl-collaborator__brush",brush:h,color:y,opacity:.1},u+"_brush"):null,x&&s?f.jsx(s,{className:"tl-collaborator__cursor",point:S,color:y,zoom:l,name:m!=="New User"?m:null,chatMessage:d},u+"_cursor"):o?f.jsx(o,{className:"tl-collaborator__cursor-hint",point:S,color:y,zoom:l,viewport:c},u+"_cursor_hint"):null,i&&p.length?f.jsx(f.Fragment,{children:p.map(w=>f.jsx(i,{className:"tl-collaborator__scribble",scribble:w,color:y,zoom:l,opacity:w.color==="laser"?.5:.1},u+"_scribble_"+w.id))}):null,a&&g.map(w=>f.jsx(a,{className:"tl-collaborator__shape-indicator",shapeId:w,color:y,opacity:.5},u+"_"+w))]})});function wP(n,e){return e>n.options.collaboratorInactiveTimeoutMs?"inactive":e>n.options.collaboratorIdleTimeoutMs?"idle":"active"}function Cse(n,e){const t=k.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[r,i]=k.useState(()=>wP(n,Date.now()-t.current));return k.useEffect(()=>{const s=n.timers.setInterval(()=>{i(wP(n,Date.now()-t.current))},n.options.collaboratorCheckIntervalMs);return()=>clearInterval(s)},[n]),e&&(t.current=e.lastActivityTimestamp),r}const ED=k.memo(function({id:e,shape:t,util:r,index:i,backgroundIndex:s,opacity:o,dprMultiple:a}){const l=G(),{ShapeErrorFallback:c}=Qt(),u=k.useRef(null),d=k.useRef(null),h=k.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});bl("set shape stuff",()=>{const m=l.getShape(e);if(!m)return;const S=h.current,y=l.getShapeClipPath(e)??"none";y!==S.clipPath&&(sr(u.current,"clip-path",y),sr(d.current,"clip-path",y),S.clipPath=y);const x=l.getShapePageTransform(e),w=ke.toCssString(x),O=l.getShapeGeometry(m).bounds;w!==S.transform&&(sr(u.current,"transform",w),sr(d.current,"transform",w),S.transform=w);const T=O.w%a,E=O.h%a,C=T===0?O.w:O.w+(a-T),M=E===0?O.h:O.h+(a-E);(C!==S.width||M!==S.height)&&(sr(u.current,"width",Math.max(C,a)+"px"),sr(u.current,"height",Math.max(M,a)+"px"),sr(d.current,"width",Math.max(C,a)+"px"),sr(d.current,"height",Math.max(M,a)+"px"),S.width=C,S.height=M)},[l]),bl("set opacity and z-index",()=>{const m=u.current,S=d.current;sr(m,"opacity",o),sr(S,"opacity",o),sr(m,"z-index",i),sr(S,"z-index",s)},[o,i,s]),bl("set display",()=>{if(!l.getShape(e))return;const y=l.getCulledShapes().has(e);y!==h.current.isCulled&&(sr(u.current,"display",y?"none":"block"),sr(d.current,"display",y?"none":"block"),h.current.isCulled=y)},[l]);const p=k.useCallback(m=>l.annotateError(m,{origin:"shape",willCrashApp:!1}),[l]);if(!t)return null;const g="fill"in t.props&&t.props.fill!=="none";return f.jsxs(f.Fragment,{children:[r.backgroundComponent&&f.jsx("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":t.type,draggable:!1,children:f.jsx(fp,{fallback:c,onError:p,children:f.jsx(Tse,{shape:t,util:r})})}),f.jsx("div",{ref:u,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":g,draggable:!1,children:f.jsx(fp,{fallback:c,onError:p,children:f.jsx(Pse,{shape:t,util:r})})})]})}),Pse=k.memo(function({shape:e,util:t}){return jv("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta),Tse=k.memo(function({shape:e,util:t}){return jv("InnerShape:"+e.type,()=>{var r;return(r=t.backgroundComponent)==null?void 0:r.call(t,t.editor.store.unsafeGetWithoutCapture(e.id))})},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta);function Ese({className:n}){const e=G(),{Background:t,SvgDefs:r,ShapeIndicators:i}=Qt(),s=k.useRef(null),o=k.useRef(null),a=k.useRef(null),l=Nn();vse(s),aie(),sie(),fse(s),uie(s);const c=k.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});bl("position layers",function(){const{x,y:w,z:O}=e.getCamera();if(c.current.allowTextOutline&&e.environment.isSafari&&(l.style.setProperty("--tl-text-outline","none"),c.current.allowTextOutline=!1),c.current.allowTextOutline&&O<e.options.textShadowLod!==c.current.lodDisableTextOutline){const C=O<e.options.textShadowLod;l.style.setProperty("--tl-text-outline",C?"none":"var(--tl-text-outline-reference)"),c.current.lodDisableTextOutline=C}const T=O>=1?Pd(O,[1,8],[.125,.5],!0):Pd(O,[.1,1],[-2,.125],!0),E=`scale(${q(O)}) translate(${q(x+T)}px,${q(w+T)}px)`;sr(o.current,"transform",E),sr(a.current,"transform",E)},[e,l]);const u=hD(),d=ee("shapeSvgDefs",()=>{const y=new Map;for(const x of Gt(e.shapeUtils)){if(!x)return;const w=x.getCanvasSvgDefs();for(const{key:O,component:T}of w)y.has(O)||y.set(O,f.jsx(T,{},O))}return[...y.values()]},[e]),h=ee("debug_shapes",()=>un.hideShapes.get(),[un]),p=ee("debug_svg",()=>un.debugSvg.get(),[un]),g=ee("debug_geometry",()=>un.debugGeometry.get(),[un]),m=ee("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),S=ee("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return f.jsxs(f.Fragment,{children:[f.jsxs("div",{ref:s,draggable:!1,"data-iseditinganything":m,"data-isselectinganything":S,className:Te("tl-canvas",n),"data-testid":"canvas",...u,children:[f.jsx("svg",{className:"tl-svg-context",children:f.jsxs("defs",{children:[d,f.jsx(Use,{}),f.jsx(Hse,{}),r&&f.jsx(r,{})]})}),t&&f.jsx("div",{className:"tl-background__wrapper",children:f.jsx(t,{})}),f.jsx(Mse,{}),f.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[f.jsx(Vse,{}),f.jsx(Wse,{}),h?null:p?f.jsx(Nse,{}):f.jsx(Fse,{})]}),f.jsx("div",{className:"tl-overlays",children:f.jsxs("div",{ref:a,className:"tl-html-layer",children:[g?f.jsx(wse,{}):null,f.jsx(jse,{}),f.jsx(_se,{}),f.jsx(Ase,{}),f.jsx(Rse,{}),i&&f.jsx(i,{}),f.jsx(Bse,{}),f.jsx(Dse,{}),f.jsx(qse,{}),f.jsx(bse,{})]})}),f.jsx(Gse,{})]}),f.jsx(Ise,{})]})}function Ise(){const{InFrontOfTheCanvas:n}=Qt();return n?f.jsx(n,{}):null}function Mse(){const n=G(),e=ee("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:t,y:r,z:i}=ee("camera",()=>n.getCamera(),[n]),s=ee("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:o}=Qt();return o&&s?f.jsx(o,{x:t,y:r,z:i,size:e}):null}function Ase(){const n=G(),e=ee("scribbles",()=>n.getInstanceState().scribbles,[n]),t=ee("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:r}=Qt();return r&&e.length?e.map(i=>f.jsx(r,{className:"tl-user-scribble",scribble:i,zoom:t},i.id)):null}function _se(){const n=G(),e=ee("brush",()=>n.getInstanceState().brush,[n]),{Brush:t}=Qt();return t&&e?f.jsx(t,{className:"tl-user-brush",brush:e}):null}function Rse(){const n=G(),e=ee("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:t}=Qt();return t&&e?f.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function Dse(){const n=G(),e=ee("snapLines",()=>n.snaps.getIndicators(),[n]),t=ee("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapIndicator:r}=Qt();return r&&e.length>0?e.map(i=>f.jsx(r,{className:"tl-user-snapline",line:i,zoom:t},i.id)):null}function jse(){const n=G(),e=ee("handles shapeIdWithHandles",()=>{const{isReadonly:t,isChangingStyle:r}=n.getInstanceState();if(t||r)return!1;const i=n.getOnlySelectedShape();return!i||!n.getShapeHandles(i)?!1:i.id},[n]);return e?f.jsx(Lse,{shapeId:e}):null}function Lse({shapeId:n}){const e=G(),{Handles:t}=Qt(),r=ee("zoomLevel",()=>e.getZoomLevel(),[e]),i=ee("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),s=ee("handles transform",()=>e.getShapePageTransform(n),[e,n]),o=ee("handles",()=>{const a=e.getShapeHandles(n);if(!a)return null;const l=(i?e.options.coarseHandleRadius:e.options.handleRadius)/r*2;return a.filter(c=>c.type!=="virtual"||!a.some(u=>u!==c&&u.type==="vertex"&&b.Dist(c,u)<l)).sort(c=>c.type==="vertex"?1:-1)},[e,r,i,n]);return!t||!o||!s?null:f.jsx(t,{children:f.jsx("g",{transform:ke.toCssString(s),children:o.map(a=>f.jsx(zse,{shapeId:n,handle:a,zoom:r,isCoarse:i},a.id))})})}function zse({shapeId:n,handle:e,zoom:t,isCoarse:r}){const i=pse(n,e.id),{Handle:s}=Qt();return s?f.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:f.jsx(s,{shapeId:n,handle:e,zoom:t,isCoarse:r})}):null}function Nse(){const n=G(),e=ee("rendering shapes",()=>n.getRenderingShapes(),[n]),t=ee("dpr multiple",()=>kD(Math.floor(n.getInstanceState().devicePixelRatio*100)/100),[n]);return e.map(r=>f.jsxs(k.Fragment,{children:[f.jsx(ED,{...r,dprMultiple:t}),f.jsx(Qse,{id:r.id})]},r.id+"_fragment"))}function $se(){const n=G(),e=k.useRef(new Set);return bl("reflow for culled shapes",()=>{const t=n.getCulledShapes();if(e.current.size===t.size&&[...t].every(i=>e.current.has(i)))return;e.current=t;const r=document.getElementsByClassName("tl-canvas");r.length!==0&&r[0].offsetHeight},[n]),null}function Fse(){const n=G(),e=ee("rendering shapes",()=>n.getRenderingShapes(),[n]),t=ee("dpr multiple",()=>kD(Math.floor(n.getInstanceState().devicePixelRatio*100)/100),[n]);return f.jsxs(f.Fragment,{children:[e.map(r=>f.jsx(ED,{...r,dprMultiple:t},r.id+"_shape")),n.environment.isSafari&&f.jsx($se,{})]})}function Bse(){const n=G(),{ShapeIndicator:e}=Qt(),t=ee("hinting shape ids",()=>y6(n.getHintingShapeIds()),[n]);return!t.length||!e?null:t.map(r=>f.jsx(e,{className:"tl-user-indicator__hint",shapeId:r},r+"_hinting"))}function Use(){return f.jsxs("g",{id:"cursor",children:[f.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[f.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),f.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),f.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[f.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),f.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),f.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[f.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),f.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function Hse(){return f.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function Qse({id:n}){const e=G(),[t,r]=k.useState(null),i=ee("is in root",()=>{const s=e.getShape(n);return(s==null?void 0:s.parentId)===e.getCurrentPageId()},[e,n]);return k.useEffect(()=>{if(!i)return;let s=null;const o=Xl("shape to svg",async()=>{const a=Math.random();s=a;const c=e.isShapeOfType(n,"frame")?0:10;let u=e.getShapePageBounds(n);if(!u)return;u=u.clone().expandBy(c);const d=await e.getSvgString([n],{padding:c,background:e.getInstanceState().exportBackground});if(s!==a||!d)return;const h=`data:image/svg+xml;utf8,${encodeURIComponent(d.svg)}`;r({src:h,bounds:u})});return()=>{s=null,o()}},[e,n,i]),!i||!t?null:f.jsx("img",{src:t.src,width:t.bounds.width,height:t.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${t.bounds.x}px, ${t.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function qse(){const n=G(),e=ee("selection rotation",()=>n.getSelectionRotation(),[n]),t=ee("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:r}=Qt();return!t||!r?null:f.jsx(r,{bounds:t,rotation:e})}function Wse(){const n=G(),e=ee("selection rotation",()=>n.getSelectionRotation(),[n]),t=ee("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:r}=Qt();return!t||!r?null:f.jsx(r,{bounds:t,rotation:e})}function Vse(){const{OnTheCanvas:n}=Qt();return n?f.jsx(n,{}):null}function Gse(){const n=G(),e=ee("camera state",()=>n.getCameraState(),[n]);return f.jsx("div",{className:Te("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function Xse({className:n,zoom:e,point:t,color:r,viewport:i,opacity:s=1}){const o=k.useRef(null);return Jd(o,An(t.x,i.minX+5/e,i.maxX-5/e),An(t.y,i.minY+5/e,i.maxY-5/e),1/e,b.Angle(i.center,t)),f.jsxs("svg",{ref:o,className:Te("tl-overlays__item",n),children:[f.jsx("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),f.jsx("use",{href:"#cursor_hint",color:r,opacity:s})]})}const bP=k.memo(function({className:e,zoom:t,point:r,color:i,name:s,chatMessage:o}){const a=k.useRef(null);return Jd(a,r==null?void 0:r.x,r==null?void 0:r.y,1/t),r?f.jsxs("div",{ref:a,className:Te("tl-overlays__item",e),children:[f.jsx("svg",{className:"tl-cursor",children:f.jsx("use",{href:"#cursor",color:i})}),o?f.jsxs(f.Fragment,{children:[s&&f.jsx("div",{className:"tl-nametag-title",style:{color:i},children:s}),f.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:o})]}):s&&f.jsx("div",{className:"tl-nametag",style:{backgroundColor:i},children:s})]}):null});function ID(){return k.useId().replace(/:/g,"_")}function Kse({x:n,y:e,z:t,size:r}){const i=`grid_${ID()}`,s=G(),{gridSteps:o}=s.options;return f.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[f.jsx("defs",{children:o.map(({min:a,mid:l,step:c},u)=>{const d=c*r*t,h=.5+n*t,p=.5+e*t,g=h>0?h%d:d+h%d,m=p>0?p%d:d+p%d,S=t<l?Pd(t,[a,l],[0,1]):1;return f.jsx("pattern",{id:`${i}_${c}`,width:d,height:d,patternUnits:"userSpaceOnUse",children:f.jsx("circle",{className:"tl-grid-dot",cx:g,cy:m,r:1,opacity:S})},u)})}),o.map(({step:a},l)=>f.jsx("rect",{width:"100%",height:"100%",fill:`url(#${i}_${a})`},l))]})}function Yse({handle:n,isCoarse:e,className:t,zoom:r}){const i=G(),s=(e?i.options.coarseHandleRadius:i.options.handleRadius)/r;if(n.type==="clone"){const a=3/r,l=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,c=rie.indexOf(n.id);return f.jsxs("g",{className:Te(`tl-handle tl-handle__${n.type}`,t),children:[f.jsx("circle",{className:"tl-handle__bg",r:s}),f.jsx("path",{className:"tl-handle__fg",d:l,transform:`rotate(${-90+90*c})`})]})}const o=(n.type==="create"&&e?3:4)/Math.max(r,.25);return f.jsxs("g",{className:Te(`tl-handle tl-handle__${n.type}`,t),children:[f.jsx("circle",{className:"tl-handle__bg",r:s}),f.jsx("circle",{className:"tl-handle__fg",r:o})]})}const Zse=({children:n})=>f.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),Jse=()=>{const{Spinner:n}=Qt();return f.jsx(Z6,{children:n?f.jsx(n,{}):null})};function N6(n,e=!0){const t=n.length;if(t<2)return"";let r=n[0],i=n[1];if(t===2)return`M${st(r)}L${st(i)}`;let s="";for(let o=2,a=t-1;o<a;o++)r=n[o],i=n[o+1],s+=Vr(r,i);return e?`M${Vr(n[0],n[1])}Q${st(n[1])}${Vr(n[1],n[2])}T${s}${Vr(n[t-1],n[0])}${Vr(n[0],n[1])}Z`:`M${st(n[0])}Q${st(n[1])}${Vr(n[1],n[2])}${n.length>3?"T":""}${s}L${st(n[t-1])}`}function OP({scribble:n,zoom:e,color:t,opacity:r,className:i}){return n.points.length?f.jsx("svg",{className:i&&Te("tl-overlays__item",i),children:f.jsx("path",{className:"tl-scribble",d:N6(n.points,!1),stroke:t??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:r??n.opacity})}):null}function MD({bounds:n,rotation:e}){const t=k.useRef(null);return Jd(t,n.x,n.y,1,e),k.useLayoutEffect(()=>{const r=t.current;r&&(r.style.width=q(Math.max(1,n.width))+"px",r.style.height=q(Math.max(1,n.height))+"px")},[n.width,n.height]),f.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})}function eoe({bounds:n,rotation:e}){const t=G(),r=k.useRef(null),i=ee("only selected shape",()=>t.getOnlySelectedShape(),[t]),s=i?t.getShapeUtil(i).expandSelectionOutlinePx(i):0;return Jd(r,n==null?void 0:n.x,n==null?void 0:n.y,1,e,{x:-s,y:-s}),n=n.clone().expandBy(s).zeroFix(),f.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:f.jsx("rect",{className:Te("tl-selection__fg__outline"),width:q(n.width),height:q(n.height)})})}const toe=()=>f.jsx("div",{className:"tl-shape-error-boundary"}),noe=({shape:n,util:e})=>jv("Indicator: "+n.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(n.id))),roe=({editor:n,id:e})=>{const t=ee("shape for indicator",()=>n.store.get(e),[n,e]),{ShapeIndicatorErrorFallback:r}=Qt();return!t||t.isLocked?null:f.jsx(fp,{fallback:r,onError:i=>n.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:f.jsx(noe,{shape:t,util:n.getShapeUtil(t)},t.id)})},kP=k.memo(function({shapeId:e,className:t,color:r,hidden:i,opacity:s}){const o=G(),a=k.useRef(null);return bl("indicator transform",()=>{const l=a.current;if(!l)return;const c=o.getShapePageTransform(e);c&&l.style.setProperty("transform",c.toCssString())},[o,e]),k.useLayoutEffect(()=>{const l=a.current;l&&l.style.setProperty("display",i?"none":"block")},[i]),f.jsx("svg",{ref:a,className:Te("tl-overlays__item",t),children:f.jsx("g",{className:"tl-shape-indicator",stroke:r??"var(--color-selected)",opacity:s,children:f.jsx(roe,{editor:o,id:e})})})}),ioe=()=>f.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),AD=k.memo(function(){const e=G(),t=k.useRef(new Set),r=ee("should display selected ids",()=>{const o=t.current,a=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const l=e.getSelectedShapeIds();for(const c of l)a.add(c);if(e.isInAny("select.idle","select.editing_shape")){const c=e.getInstanceState();if(c.isHoveringCanvas&&!c.isCoarsePointer){const u=e.getHoveredShapeId();u&&a.add(u)}}}if(o.size!==a.size)return t.current=a,a;for(const l of a)if(!o.has(l))return t.current=a,a;return o},[e]),i=ee("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:s}=Qt();return s?i.map(({id:o})=>f.jsx(s,{shapeId:o,hidden:!r.has(o)},o+"_indicator")):null});function soe({points:n,zoom:e}){const t=2.5/e,r=n.reduce((h,p)=>Math.min(h,p.x),1/0),i=n.reduce((h,p)=>Math.max(h,p.x),-1/0),s=n.reduce((h,p)=>Math.min(h,p.y),1/0),o=n.reduce((h,p)=>Math.max(h,p.y),-1/0),a=n.some(h=>h.x===r&&h.y===s);let l,c,u,d;return a?(l=r,c=s,u=i,d=o):(l=r,c=o,u=i,d=s),f.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[f.jsx("line",{x1:l,y1:c,x2:u,y2:d}),n.map((h,p)=>f.jsx("g",{transform:`translate(${h.x},${h.y})`,children:f.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},p))]})}function ooe({gaps:n,direction:e,zoom:t}){const r=3.5/t;let i=[-1/0,1/0],s=null;const o=e==="horizontal";for(const l of n){if(s=vs(i[0],i[1],o?l.startEdge[0].y:l.startEdge[0].x,o?l.startEdge[1].y:l.startEdge[1].x),s)i=s;else continue;if(s=vs(i[0],i[1],o?l.endEdge[0].y:l.endEdge[0].x,o?l.endEdge[1].y:l.endEdge[1].x),s)i=s;else continue}if(i===null)return null;const a=(i[0]+i[1])/2;return f.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:n.map(({startEdge:l,endEdge:c},u)=>f.jsx(k.Fragment,{children:o?f.jsxs(f.Fragment,{children:[f.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),f.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),f.jsx("line",{x1:l[0].x,y1:a,x2:c[0].x,y2:a}),f.jsx("line",{x1:(l[0].x+c[0].x)/2,y1:a-r,x2:(l[0].x+c[0].x)/2,y2:a+r})]}):f.jsxs(f.Fragment,{children:[f.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),f.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),f.jsx("line",{x1:a,y1:l[0].y,x2:a,y2:c[0].y}),f.jsx("line",{x1:a-r,y1:(l[0].y+c[0].y)/2,x2:a+r,y2:(l[0].y+c[0].y)/2})]})},u))})}function aoe({className:n,line:e,zoom:t}){return f.jsx("svg",{className:Te("tl-overlays__item",n),children:e.type==="points"?f.jsx(soe,{...e,zoom:t}):e.type==="gaps"?f.jsx(ooe,{...e,zoom:t}):null})}function $6(){return f.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:f.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[f.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),f.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:f.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const loe=()=>null;function _D(n,e){const t=k.useRef(n);return e(n,t.current)?t.current:(t.current=n,n)}function Af(n){return _D(n,Xte)}const coe=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:x6(n,e));function e0(n){return _D(n,coe)}const RD=k.createContext(null);function uoe({overrides:n={},children:e}){const t=e0(n),r=k.useMemo(()=>({Background:Kre,SvgDefs:loe,Brush:Wx,ZoomBrush:Wx,CollaboratorBrush:Wx,Cursor:bP,CollaboratorCursor:bP,CollaboratorHint:Xse,CollaboratorShapeIndicator:kP,Grid:Kse,Scribble:OP,SnapIndicator:aoe,Handles:Zse,Handle:Yse,CollaboratorScribble:OP,ErrorFallback:jD,ShapeErrorFallback:toe,ShapeIndicatorErrorFallback:ioe,Spinner:$6,SelectionBackground:MD,SelectionForeground:eoe,ShapeIndicators:AD,ShapeIndicator:kP,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:Ese,LoadingScreen:Jse,...t}),[t]);return f.jsx(RD.Provider,{value:r,children:e})}function Qt(){const n=k.useContext(RD);if(!n)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return n}const F6={openWindow:(n,e)=>window.open(n,e,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function DD(){F6.hardReset()}function doe(){F6.refreshPage()}const hoe="https://github.com/tldraw/tldraw/issues/new",jD=({error:n,editor:e})=>{const t=k.useRef(null),[r,i]=k.useState(!1),[s,o]=k.useState(!1),[a,l]=k.useState(!1);let c=null;try{c=Qt().Canvas??null}catch{}const u=n instanceof Error?n.message:String(n),d=n instanceof Error?n.stack:null,h=ee("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[p,g]=k.useState(null);k.useLayoutEffect(()=>{var T;h!==null&&g(h);let w=(T=t.current)==null?void 0:T.parentElement,O=!1;for(;w;){if(w.classList.contains("tl-theme__dark")||w.classList.contains("tl-theme__light")){O=!0;break}w=w.parentElement}if(O){g(null);return}typeof window<"u"&&"matchMedia"in window&&g(window.matchMedia("(prefers-color-scheme: dark)").matches)},[h]),k.useEffect(()=>{if(s){const w=e==null?void 0:e.timers.setTimeout(()=>{o(!1)},2e3);return()=>clearTimeout(w)}},[s,e]);const m=()=>{const w=document.createElement("textarea");w.value=d??u,document.body.appendChild(w),w.select(),document.execCommand("copy"),w.remove(),o(!0)},S=()=>{doe()},y=async()=>{DD()},x=new URL(hoe);return x.searchParams.set("title",u),x.searchParams.set("labels","bug"),x.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${d??u}
\`\`\`

My browser: ${navigator.userAgent}`),f.jsxs("div",{ref:t,className:Te("tl-container tl-error-boundary",p===null?"":p?"tl-theme__dark":"tl-theme__light"),children:[f.jsx("div",{className:"tl-error-boundary__overlay"}),e&&f.jsx(lD,{onError:op,fallback:()=>null,children:f.jsx(Lv.Provider,{value:e,children:f.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:c?f.jsx(c,{}):null})})}),f.jsx("div",{className:Te("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?f.jsxs(f.Fragment,{children:[f.jsx("h2",{children:"Are you sure?"}),f.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),f.jsxs("div",{className:"tl-error-boundary__content__actions",children:[f.jsx("button",{onClick:()=>l(!1),children:"Cancel"}),f.jsx("button",{className:"tl-error-boundary__reset",onClick:y,children:"Reset data"})]})]}):f.jsxs(f.Fragment,{children:[f.jsx("h2",{children:"Something's gone wrong."}),f.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",f.jsx("a",{href:x.toString(),children:"create a GitHub issue"})," or"," ",f.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&f.jsxs(f.Fragment,{children:["Message:",f.jsx("h4",{children:f.jsx("code",{children:u})}),"Stack trace:",f.jsxs("div",{className:"tl-error-boundary__content__error",children:[f.jsx("pre",{children:f.jsx("code",{children:d??u})}),f.jsx("button",{onClick:m,children:s?"Copied!":"Copy"})]})]}),f.jsxs("div",{className:"tl-error-boundary__content__actions",children:[f.jsx("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),f.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[f.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),f.jsx("button",{className:"tl-error-boundary__refresh",onClick:S,children:"Refresh Page"})]})]})]})})]})};let foe=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function wt(){return foe()}const LD="TLDRAW_USER_DATA_v3",zD=Ve({id:ze,name:ze.nullable().optional(),locale:ze.nullable().optional(),color:ze.nullable().optional(),colorScheme:Rv("light","dark","system").optional(),animationSpeed:Me.nullable().optional(),edgeScrollSpeed:Me.nullable().optional(),isSnapMode:qe.nullable().optional(),isWrapMode:qe.nullable().optional(),isDynamicSizeMode:qe.nullable().optional(),isPasteAtCursorMode:qe.nullable().optional()}),Qo={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},B6=Math.max(...Object.values(Qo));function poe(n){n.version<Qo.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<Qo.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version<Qo.MakeFieldsNullable,n.version<Qo.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<Qo.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<Qo.AllowSystemColorScheme&&(n.user.isDarkMode===!0?n.user.colorScheme="dark":n.user.isDarkMode===!1&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<Qo.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version<Qo.AddPasteAtCursor&&(n.user.isPasteAtCursorMode=!1),n.version=B6}const a4=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function ND(){return a4[Math.floor(Math.random()*a4.length)]}function goe(){var n,e;return typeof window<"u"&&"matchMedia"in window?((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const gs=Object.freeze({name:"New User",locale:Bre(),color:ND(),edgeScrollSpeed:1,animationSpeed:goe()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"system"});function Xx(){return{id:wt(),color:ND()}}function $D(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return Xx();const e=It(n);poe(e);try{return zD.validate(e.user)}catch{return Xx()}}function moe(){const n=JSON.parse(w6(LD)||"null")??null;return $D(n)}const Nv=mn("globalUserData",null);function yoe(){b6(LD,JSON.stringify({version:B6,user:Nv.get()}))}function FD(n){zD.validate(n),Nv.set(n),yoe(),Soe()}const voe=typeof process<"u"&&!1,ad=typeof BroadcastChannel<"u"&&!voe?new BroadcastChannel("tldraw-user-sync"):null;ad==null||ad.addEventListener("message",n=>{const e=n.data;(e==null?void 0:e.type)===UD&&(e==null?void 0:e.origin)!==BD()&&Nv.set($D(e.data))});let Kx=null;function BD(){return Kx===null&&(Kx=wt()),Kx}const UD="tldraw-user-preferences-change";function Soe(){ad==null||ad.postMessage({type:UD,origin:BD(),data:{user:U6(),version:B6}})}function U6(){let n=Nv.get();return n||(n=moe(),FD(n)),n}const xoe=te("defaultLocalStorageUserPrefs",()=>U6());function HD(n={}){return{userPreferences:n.userPreferences??xoe,setUserPreferences:n.setUserPreferences??FD}}var QD={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new i(u,d||l,h),g=t?t+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],p]:l._events[g].push(p):(l._events[g]=p,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,p=d.length,g=new Array(p);h<p;h++)g[h]=d[h].fn;return g},a.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,h,p,g){var m=t?t+c:c;if(!this._events[m])return!1;var S=this._events[m],y=arguments.length,x,w;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),y){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,u),!0;case 3:return S.fn.call(S.context,u,d),!0;case 4:return S.fn.call(S.context,u,d,h),!0;case 5:return S.fn.call(S.context,u,d,h,p),!0;case 6:return S.fn.call(S.context,u,d,h,p,g),!0}for(w=1,x=new Array(y-1);w<y;w++)x[w-1]=arguments[w];S.fn.apply(S.context,x)}else{var O=S.length,T;for(w=0;w<O;w++)switch(S[w].once&&this.removeListener(c,S[w].fn,void 0,!0),y){case 1:S[w].fn.call(S[w].context);break;case 2:S[w].fn.call(S[w].context,u);break;case 3:S[w].fn.call(S[w].context,u,d);break;case 4:S[w].fn.call(S[w].context,u,d,h);break;default:if(!x)for(T=1,x=new Array(y-1);T<y;T++)x[T-1]=arguments[T];S[w].fn.apply(S[w].context,x)}}return!0},a.prototype.on=function(c,u,d){return s(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return s(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,h){var p=t?t+c:c;if(!this._events[p])return this;if(!u)return o(this,p),this;var g=this._events[p];if(g.fn)g.fn===u&&(!h||g.once)&&(!d||g.context===d)&&o(this,p);else{for(var m=0,S=[],y=g.length;m<y;m++)(g[m].fn!==u||h&&!g[m].once||d&&g[m].context!==d)&&S.push(g[m]);S.length?this._events[p]=S.length===1?S[0]:S:o(this,p)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(QD);var woe=QD.exports;const boe=Ul(woe),ld="TLDRAW_TAB_ID_v2",xo=globalThis.window;function Ooe(){return xo?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(xo.navigator.platform)||xo.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const pp=xo?xo[ld]??lR(ld)??"TLDRAW_INSTANCE_STATE_V1_"+wt():"<error>";xo&&(xo[ld]=pp,Ooe()?O6(ld,pp):cR(ld));xo==null||xo.addEventListener("beforeunload",()=>{O6(ld,pp)});const qD={Initial:0},$v=Math.max(...Object.values(qD));function koe(n){n.version<qD.Initial,n.version=$v}const WD=Ve({version:Me,currentPageId:up,isFocusMode:qe,exportBackground:qe,isDebugMode:qe,isToolLocked:qe,isGridMode:qe,pageStates:qn(Ve({pageId:up,camera:Ve({x:Me,y:Me,z:Me}),selectedShapeIds:qn(Fi),focusedGroupId:Fi.nullable()}))});function Coe(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;n.version!==$v&&(n=It(n),koe(n));try{return WD.validate(n)}catch(e){return console.warn(e),null}}function VD(n){const e=n.query.ids("page");return te("sessionStateSnapshot",()=>{const t=n.get(cr);if(!t)return null;const r=[...e.get()];return{version:$v,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:r.map(i=>{const s=n.get(Gi.createId(i)),o=n.get(Os.createId(i));return{pageId:i,camera:{x:(o==null?void 0:o.x)??0,y:(o==null?void 0:o.y)??0,z:(o==null?void 0:o.z)??1},selectedShapeIds:(s==null?void 0:s.selectedShapeIds)??[],focusedGroupId:(s==null?void 0:s.focusedGroupId)??null}})}})}function GD(n,e){const t=Coe(e);if(!t)return;const r=n.schema.types.instance.create({id:cr,...DR(n.get(cr)),currentPageId:t.currentPageId,isDebugMode:t.isDebugMode,isFocusMode:t.isFocusMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,exportBackground:t.exportBackground}),i=n.allRecords().filter(s=>s.typeName==="instance_page_state"||s.typeName==="camera");n.atomic(()=>{n.remove(i.map(s=>s.id));for(const s of t.pageStates)n.put([Os.create({id:Os.createId(s.pageId),x:s.camera.x,y:s.camera.y,z:s.camera.z}),Gi.create({id:Gi.createId(s.pageId),pageId:s.pageId,selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId})]);n.put([r]),n.ensureStoreIsUsable()})}function Poe(n){var i;const e=[];for(const s of Object.values(n))(i=s.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&e.push(s);const t=e.filter(s=>s.typeName==="instance"&&s.id!==cr)[0];if(!t)return null;const r={version:$v,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(s=>s.typeName==="instance_page_state"&&s.instanceId===t.id).map(s=>{const o=n[s.cameraId]??{x:0,y:0,z:1};return{pageId:s.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId}})};try{return WD.validate(r),r}catch{return null}}function XD(n,e){let t={};if("store"in e){const i=n.schema.migrateStoreSnapshot(e);if(i.type!=="success")throw new Error("Failed to migrate store snapshot: "+i.reason);t.document={schema:n.schema.serialize(),store:Tf(i.value,(s,{typeName:o})=>n.scopedTypes.document.has(o))}}else t=e;const r=DR(n.get(cr));n.atomic(()=>{t.document&&n.loadStoreSnapshot(t.document),r&&n.update(cr,i=>({...i,...r})),t.session&&GD(n,t.session)})}const Toe=new wa;function Eoe(n){const t=Toe.get(n,VD).get();if(!t)throw new Error("Session state is not ready yet");return{document:n.getStoreSnapshot(),session:t}}function KD(n){const e=[],t=new Set;for(const r of n){if(t.has(r.type))throw new Error(`Binding type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}function Il({children:n,className:e="",...t}){return f.jsx("svg",{...t,className:Te("tl-svg-container",e),children:n})}function H6(n,e,t,r){const i=n.x-t.x,s=n.y-t.y,o=r.x-t.x,a=r.y-t.y,l=e.x-n.x,c=e.y-n.y,u=o*s-a*i,d=l*s-c*i,h=a*l-o*c;if(u===0||d===0||h===0)return null;if(h!==0){const p=u/h,g=d/h;if(0<=p&&p<=1&&0<=g&&g<=1)return b.AddXY(n,p*l,p*c)}return null}function t0(n,e,t,r){const i=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),s=2*((e.x-n.x)*(n.x-t.x)+(e.y-n.y)*(n.y-t.y)),o=t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-r*r,a=s*s-4*i*o;if(a<0||a===0)return null;const l=Math.sqrt(a),c=(-s+l)/(2*i),u=(-s-l)/(2*i);if((c<0||c>1)&&(u<0||u>1))return null;const d=[];return 0<=c&&c<=1&&d.push(b.Lrp(n,e,c)),0<=u&&u<=1&&d.push(b.Lrp(n,e,u)),d.length===0?null:d}function Ioe(n,e,t){const r=[];let i;for(let s=0,o=t.length-1;s<o;s++)i=H6(n,e,t[s],t[s+1]),i&&r.push(i);return r.length===0?null:r}function Q6(n,e,t){const r=[];let i;for(let s=1,o=t.length;s<o+1;s++)i=H6(n,e,t[s-1],t[s%t.length]),i&&r.push(i);return r.length===0?null:r}function Moe(n,e,t,r){let i=t.x-n.x,s=t.y-n.y;const o=Math.sqrt(i*i+s*s),a=(o*o-r*r+e*e)/(2*o),l=Math.sqrt(e*e-a*a);return i/=o,s/=o,[new b(n.x+i*a-s*l,n.y+s*a+i*l),new b(n.x+i*a+s*l,n.y+s*a-i*l)]}function l4(n,e,t){const r=[];let i,s,o;for(let a=0,l=t.length;a<l;a++)i=t[a],s=t[(a+1)%t.length],o=t0(i,s,n,e),o&&r.push(...o);return r.length===0?null:r}function CP(n,e,t){const r=[];let i,s,o;for(let a=1,l=t.length;a<l;a++)i=t[a-1],s=t[a],o=t0(i,s,n,e),o&&r.push(...o);return r.length===0?null:r}function ag(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function q6(n,e,t,r){return ag(n,t,r)!==ag(e,t,r)&&ag(n,e,t)!==ag(n,e,r)}function PP(n,e){const t=new Map;let r,i,s,o;for(let a=0,l=n.length;a<l;a++)if(r=n[a],Pi(r,e)){const c=Yx(r);t.has(c)||t.set(c,r)}for(let a=0,l=e.length;a<l;a++)if(r=e[a],Pi(r,n)){const c=Yx(r);t.has(c)||t.set(c,r)}for(let a=0,l=n.length;a<l;a++){r=n[a],i=n[(a+1)%n.length];for(let c=0,u=e.length;c<u;c++){s=e[c],o=e[(c+1)%e.length];const d=H6(r,i,s,o);if(d!==null){const h=Yx(d);t.has(h)||t.set(h,d)}}}return t.size===0?null:Aoe([...t.values()])}function Yx(n){return`${n.x},${n.y}`}function Aoe(n){const e=b.Average(n);return n.sort((t,r)=>b.Angle(e,t)-b.Angle(e,r))}function YD(n,e){let t,r,i,s;for(let o=0,a=n.length;o<a;o++){t=n[o],r=n[(o+1)%a];for(let l=0,c=e.length;l<c;l++)if(i=e[l],s=e[(l+1)%c],q6(t,r,i,s))return!0}return!1}function _oe(n,e){let t,r,i,s;for(let o=0,a=n.length;o<a;o++){t=n[o],r=n[(o+1)%a];for(let l=1,c=e.length;l<c;l++)if(i=e[l-1],s=e[l],q6(t,r,i,s))return!0}return!1}class oa extends Kl{constructor(t){super({...t,isClosed:!1,isFilled:!1});v(this,"start");v(this,"end");v(this,"d");v(this,"u");v(this,"ul");const{start:r,end:i}=t;this.start=r,this.end=i,this.d=r.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:r,end:i,u:s,ul:o}=this;if(o===0)return r;const a=b.Sub(t,r).dpr(s)/o,l=r.x+s.x*a;if(l<Math.min(r.x,i.x))return r.x<i.x?r:i;if(l>Math.max(r.x,i.x))return r.x>i.x?r:i;const c=r.y+s.y*a;return c<Math.min(r.y,i.y)?r.y<i.y?r:i:c>Math.max(r.y,i.y)?r.y>i.y?r:i:new b(l,c)}hitTestLineSegment(t,r,i=0){return q6(t,r,this.start,this.end)||this.distanceToLineSegment(t,r)<=i}getSvgPathData(t=!0){const{start:r,end:i}=this;return`${t?`M${r.toFixed()}`:""} L${i.toFixed()}`}}class eh extends Kl{constructor(t){super({isClosed:!1,isFilled:!1,...t});v(this,"points");v(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let r=0,i=t.length-1;r<i;r++){const s=t[r],o=t[r+1];this._segments.push(new oa({start:s,end:o}))}this.isClosed&&this._segments.push(new oa({start:t[t.length-1],end:t[0]}))}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){return this.points}nearestPoint(t){const{segments:r}=this;let i=this.points[0],s=1/0,o,a;for(let l=0;l<r.length;l++)o=r[l].nearestPoint(t),a=b.Dist2(o,t),a<s&&(i=o,s=a);if(!i)throw Error("nearest point not found");return i}hitTestLineSegment(t,r,i=0){const{segments:s}=this;for(let o=0,a=s.length;o<a;o++)if(s[o].hitTestLineSegment(t,r,i))return!0;return!1}getSvgPathData(){const{vertices:t}=this;return t.length<2?"":t.reduce((r,i,s)=>s===0?`M ${i.x} ${i.y}`:`${r} L ${i.x} ${i.y}`,"")}}class an extends eh{constructor(e){super({...e}),this.isClosed=!0}}class As extends an{constructor(t){const{x:r=0,y:i=0,width:s,height:o}=t;super({...t,points:[new b(r,i),new b(r+s,i),new b(r+s,i+o),new b(r,i+o)]});v(this,"x");v(this,"y");v(this,"w");v(this,"h");this.x=r,this.y=i,this.w=s,this.h=o}getBounds(){return new ye(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:t,y:r,w:i,h:s}=this;return`M${t},${r} h${i} v${s} h-${i}z`}}class Ti{constructor(e){v(this,"canSnap",()=>!0);v(this,"canScroll",()=>!1);v(this,"canEdit",()=>!1);v(this,"canResize",()=>!0);v(this,"canEditInReadOnly",()=>!1);v(this,"canCrop",()=>!1);v(this,"canBeLaidOut",()=>!0);v(this,"hideResizeHandles",()=>!1);v(this,"hideRotateHandle",()=>!1);v(this,"hideSelectionBoundsBg",()=>!1);v(this,"hideSelectionBoundsFg",()=>!1);v(this,"isAspectRatioLocked",()=>!1);v(this,"onBeforeCreate");v(this,"onBeforeUpdate");v(this,"onDragShapesOver");v(this,"onDragShapesOut");v(this,"onDropShapesOver");v(this,"onResizeStart");v(this,"onResize");v(this,"onResizeEnd");v(this,"onTranslateStart");v(this,"onTranslate");v(this,"onTranslateEnd");v(this,"onHandleDrag");v(this,"onRotateStart");v(this,"onRotate");v(this,"onRotateEnd");v(this,"onBindingChange");v(this,"onChildrenChange");v(this,"onDoubleClickHandle");v(this,"onDoubleClickEdge");v(this,"onDoubleClick");v(this,"onClick");v(this,"onEditEnd");this.editor=e}canBind(e){return!0}providesBackgroundForChildren(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}}v(Ti,"props"),v(Ti,"migrations"),v(Ti,"type");function Roe(n,e,t={}){const{closed:r=!1,snap:i=1,start:s="outset",end:o="outset",lengthRatio:a=2,style:l="dashed"}=t;let c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":{d=1,c=Math.min(e*a,n/4);break}case"dotted":{d=100,c=e/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(s==="outset"?(n+=c/2,p+=c/2):s==="skip"&&(n-=c,p-=c),o==="outset"?n+=c/2:o==="skip"&&(n-=c)),u=Math.floor(n/c/(2*d)),u-=u%i,u<3&&l==="dashed"?n/e<5?(c=n,u=1,h=0):(c=n*.333,h=n*.333):(u=Math.max(u,3),c=n/u/(2*d),r?(p=c/2,h=(n-u*c)/u):h=(n-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function TP({bounds:n,className:e}){const t=G(),r=ee("zoom level",()=>t.getZoomLevel(),[t]);return f.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((i,s)=>{const{strokeDasharray:o,strokeDashoffset:a}=Roe(i[0].dist(i[1]),1/r,{style:"dashed",lengthRatio:4});return f.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:o,strokeDashoffset:a},s)})})}class Im extends Ti{constructor(){super(...arguments);v(this,"hideSelectionBoundsFg",()=>!0);v(this,"canBind",()=>!1);v(this,"onChildrenChange",t=>{const r=this.editor.getSortedChildIdsForParent(t.id);if(r.length===0){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([t.id]);return}else if(r.length===1){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(r,t.parentId),this.editor.deleteShapes([t.id]);return}})}getDefaultProps(){return{}}getGeometry(t){const r=this.editor.getSortedChildIdsForParent(t.id);return r.length===0?new As({width:1,height:1,isFilled:!1}):new Ms({children:r.map(i=>{const s=this.editor.getShape(i),o=this.editor.getShapeGeometry(i),a=this.editor.getShapeLocalTransform(s).applyToPoints(o.vertices);return o.isClosed?new an({points:a,isFilled:!0}):new eh({points:a})})})}component(t){const r=this.editor.getErasingShapeIds().includes(t.id),{hintingShapeIds:i}=this.editor.getCurrentPageState(),s=i.length>0&&i.some(l=>l!==t.id&&this.editor.isShapeOfType(this.editor.getShape(l),"group")),o=this.editor.getCurrentPageState().focusedGroupId!==t.id;if(!r&&(o||s))return null;const a=this.editor.getShapeGeometry(t).bounds;return f.jsx(Il,{id:t.id,children:f.jsx(TP,{className:"tl-group",bounds:a})})}indicator(t){const r=this.editor.getShapeGeometry(t).bounds;return f.jsx(TP,{className:"",bounds:r})}}v(Im,"type","group"),v(Im,"props",WR),v(Im,"migrations",VR);const ZD=[Im],Doe=new Set(ZD.map(n=>n.type));function JD(n){const e=[...ZD],t=new Set;for(const r of n){if(Doe.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(t.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}const joe={maxShapesPerPage:4e3,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16};function EP(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw Vn(n)}}class Loe{constructor(e){v(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[r,i]of this){if(!EP(i,e.get(r)))return!1;t.add(r)}for(const[r,i]of e)if(!t.has(r)&&!EP(i,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class c4 extends Loe{set(e,t){this.map.set(e,t)}applyValue(e,t){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:t});return}switch(r.type){case"mixed":return;case"shared":r.value!==t&&this.set(e,{type:"mixed"});return;default:Vn(r,"type")}}}function zoe(n,e,t){return Oo(n).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:t})})}const Noe="https://cdn.tldraw.com";function al(){return`${Noe}/${aD}`}function $oe(n,e){var i;let t=n;const r=new Set(e);for(;r.has(t);)t=(i=/^.*(\d+)$/.exec(t))!=null&&i[1]?t.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${t} 1`;return t}function lg(n,e,t){if(t.length===0)return[];const r=new Map;for(const s of He(t.map(o=>n.getShape(o)))){const{parentId:o}=s;r.has(o)||r.set(o,{children:He(n.getSortedChildIdsForParent(o).map(a=>n.getShape(a))),moving:new Set}),r.get(o).moving.add(s)}const i=[];switch(e){case"toBack":{r.forEach(({moving:s,children:o})=>Foe(s,o,i));break}case"toFront":{r.forEach(({moving:s,children:o})=>Boe(s,o,i));break}case"forward":{r.forEach(({moving:s,children:o})=>Uoe(s,o,i));break}case"backward":{r.forEach(({moving:s,children:o})=>Hoe(s,o,i));break}}return i}function Foe(n,e,t){const r=e.length;if(n.size===r)return;let i,s;for(let o=0;o<r;o++){const a=e[o];if(n.has(a))i=a.index,n.delete(a);else{s=a.index;break}}if(n.size!==0){const o=Td(i,s,n.size);t.push(...Array.from(n.values()).sort(fr).map((a,l)=>({...a,index:o[l]})))}}function Boe(n,e,t){const r=e.length;if(n.size===r)return;let i,s;for(let o=r-1;o>-1;o--){const a=e[o];if(n.has(a))s=a.index,n.delete(a);else{i=a.index;break}}if(n.size!==0){const o=Td(i,s,n.size);t.push(...Array.from(n.values()).sort(fr).map((a,l)=>({...a,index:o[l]})))}}function Uoe(n,e,t){var s;const r=e.length;if(n.size===r)return;let i={name:"skipping"};for(let o=0;o<r;o++){const a=n.has(e[o]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:o};break}case"selecting":{if(a)continue;const{selectIndex:l}=i;Td(e[o].index,(s=e[o+1])==null?void 0:s.index,o-l).forEach((c,u)=>t.push({...e[l+u],index:c})),i={name:"skipping"};break}}}}function Hoe(n,e,t){var s;const r=e.length;if(n.size===r)return;let i={name:"skipping"};for(let o=r-1;o>-1;o--){const a=n.has(e[o]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:o};break}case"selecting":{if(a)continue;Td((s=e[o-1])==null?void 0:s.index,e[o].index,i.selectIndex-o).forEach((l,c)=>{t.push({...e[o+c+1],index:l})}),i={name:"skipping"};break}}}}function ej({editor:n}){const e=n.getSelectedShapes(),t=n.getSelectionRotation(),r=n.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:i}}=n;if(!r)return null;const s=r.center.clone().rotWith(r.point,t);return{selectionPageCenter:s,initialCursorAngle:s.angle(i),initialSelectionRotation:t,shapeSnapshots:e.map(o=>({shape:It(o),initialPagePoint:n.getShapePageTransform(o.id).point()}))}}function Mm({delta:n,editor:e,snapshot:t,stage:r}){const{selectionPageCenter:i,shapeSnapshots:s}=t;e.updateShapes(s.map(({shape:a,initialPagePoint:l})=>{const c=Qr(a.parentId)?e.getShapePageTransform(a.parentId):ke.Identity(),u=b.RotWith(l,i,n),d=ke.applyToPoint(ke.Inverse(c),u),h=kl(a.rotation+n);return{id:a.id,type:a.type,x:d.x,y:d.y,rotation:h}}));const o=[];s.forEach(({shape:a})=>{var d,h,p;const l=e.getShape(a.id);if(!l)return;const c=e.getShapeUtil(a);if(r==="start"||r==="one-off"){const g=(d=c.onRotateStart)==null?void 0:d.call(c,a);g&&o.push(g)}const u=(h=c.onRotate)==null?void 0:h.call(c,a,l);if(u&&o.push(u),r==="end"||r==="one-off"){const g=(p=c.onRotateEnd)==null?void 0:p.call(c,a,l);g&&o.push(g)}}),o.length>0&&e.updateShapes(o)}const Qoe=n=>{const{store:e}=n,t=e.query.filterHistory("binding"),r=e.query.records("binding");function i(){const s=r.get(),o=new Map;for(const a of s){const{fromId:l,toId:c}=a,u=o.get(l);u?u.push(a):o.set(l,[a]);const d=o.get(c);d?d.push(a):o.set(c,[a])}return o}return te("arrowBindingsIndex",(s,o)=>{if(Ec(s))return i();const a=s,l=t.getDiffSince(o);if(l===ki)return i();let c;function u(p){c??(c=new Map(a));const g=c.get(p.fromId),m=g==null?void 0:g.filter(x=>x.id!==p.id);m!=null&&m.length?c.set(p.fromId,m):c.delete(p.fromId);const S=c.get(p.toId),y=S==null?void 0:S.filter(x=>x.id!==p.id);y!=null&&y.length?c.set(p.toId,y):c.delete(p.toId)}function d(p){c??(c=new Map(a));let g=c.get(p);return g?g===a.get(p)&&(g=g.slice(0),c.set(p,g)):(g=[],c.set(p,g)),g}function h(p){d(p.fromId).push(p),d(p.toId).push(p)}for(const p of l){for(const g of Gt(p.added))h(g);for(const[g,m]of Gt(p.updated))u(g),h(m);for(const g of Gt(p.removed))u(g)}return c??a})};function qoe(n,e,t){const r=n.getShapeMaskedPageBounds(e);return r===void 0?!0:!t.includes(r)}const Woe=n=>{function e(t){const r=t.getCurrentPageShapeIds(),i=t.getViewportPageBounds(),s=new Set;return r.forEach(o=>{qoe(t,o,i)&&s.add(o)}),s}return te("getCulledShapes",t=>{if(Ec(t))return e(n);const r=e(n);if(t.size!==r.size)return r;for(const i of t)if(!r.has(i))return r;return t})},Voe=n=>{const e=n.query.ids("shape"),t=n.query.filterHistory("shape");function r(){const i={},s=e.get(),o=Array(s.size);return s.forEach(a=>o.push(n.get(a))),o.sort(fr),o.forEach(a=>{i[a.parentId]||(i[a.parentId]=[]),i[a.parentId].push(a.id)}),i}return te("parentsToChildrenWithIndexes",(i,s)=>{if(Ec(i))return r();const o=t.getDiffSince(s);if(o===ki)return r();if(o.length===0)return i;let a=null;const l=d=>{a||(a={...i}),a[d]?a[d]===i[d]&&(a[d]=[...a[d]]):a[d]=[]},c=new Set;let u;for(let d=0,h=o.length;d<h;d++){u=o[d];for(const p of Object.values(u.added))qu(p)&&(l(p.parentId),a[p.parentId].push(p.id),c.add(a[p.parentId]));for(const[p,g]of Object.values(u.updated))if(qu(g)&&qu(p)){if(p.parentId!==g.parentId)l(p.parentId),l(g.parentId),a[p.parentId].splice(a[p.parentId].indexOf(g.id),1),a[g.parentId].push(g.id),c.add(a[g.parentId]);else if(p.index!==g.index){l(g.parentId);const m=a[g.parentId].indexOf(g.id);a[g.parentId][m]=g.id,c.add(a[g.parentId])}}for(const p of Object.values(u.removed))qu(p)&&(l(p.parentId),a[p.parentId].splice(a[p.parentId].indexOf(p.id),1))}for(const d of c){const h=He(d.map(p=>n.get(p)));h.sort(fr),d.splice(0,d.length,...h.map(p=>p.id))}return a??i})},Zx=(n,e,t)=>{for(;!Br(t.parentId);){const r=n.get(t.parentId);if(!r)return!1;t=r}return t.parentId===e},Goe=(n,e)=>{const t=n.query.ids("shape");let r=null;function i(){const s=e();return r=s,new Set([...t.get()].filter(o=>Zx(n,s,n.get(o))))}return te("_shapeIdsInCurrentPage",(s,o)=>{if(Ec(s))return i();const a=e();if(a!==r)return i();const l=n.history.getDiffSince(o);if(l===ki)return i();const c=new Cm(s);for(const d of l){for(const h of Object.values(d.added))qu(h)&&Zx(n,a,h)&&c.add(h.id);for(const[h,p]of Object.values(d.updated))qu(p)&&(Zx(n,a,p)?c.add(p.id):c.remove(p.id));for(const h of Object.keys(d.removed))Qr(h)&&c.remove(h)}const u=c.get();return u?Xh(u.value,u.diff):s})},tj=k.createContext(null);function Xoe({context:n,editor:e,children:t}){return f.jsx(Lv.Provider,{value:e,children:f.jsx(tj.Provider,{value:n,children:t})})}function nj(){const n=k.useContext(tj);return n?{isDarkMode:n.isDarkMode}:null}async function Koe(n,e,t={}){var T,E;const r=typeof e[0]=="string"?e:e.map(C=>C.id);if(r.length===0)return;if(!window.document)throw Error("No document");const{scale:i=1,background:s=!1,padding:o=n.options.defaultSvgPadding,preserveAspectRatio:a=!1}=t,l=t.darkMode??n.user.getIsDarkMode(),c=Ra({isDarkMode:l}),u=n.getShapeAndDescendantIds(r),d=n.getUnorderedRenderingShapes(!1).filter(({id:C})=>u.has(C));let h=null;if(t.bounds)h=t.bounds;else for(const{id:C}of d){const M=n.getShapeMaskedPageBounds(C);M&&(h?h.union(M):h=M.clone())}if(!h)return;const p=r.length===1&&n.isShapeOfType(n.getShape(r[0]),"frame")?r[0]:null;p||h.expandBy(o);const g=h.width*i,m=h.height*i;try{(E=(T=document.body).focus)==null||E.call(T)}catch{}const S=[],y=new Map,x={isDarkMode:l,addExportDef:C=>{if(y.has(C.key))return;const M=(async()=>{const A=await C.getElement();A&&S.push(f.jsx(k.Fragment,{children:A},S.length))})();y.set(C.key,M)}},w=(await Promise.all(d.map(async({id:C,opacity:M,index:A,backgroundIndex:D})=>{var W,J;if(C===p)return[];const N=n.getShape(C);if(n.isShapeOfType(N,"group"))return[];const F=n.getShapeUtil(N);let j=await((W=F.toSvg)==null?void 0:W.call(F,N,x)),L=await((J=F.toBackgroundSvg)==null?void 0:J.call(F,N,x));if(!j&&!L){const ne=n.getShapePageBounds(N);j=f.jsx("rect",{width:ne.w,height:ne.h,fill:c.solid,stroke:c.grey.pattern,strokeWidth:1})}let U=n.getShapePageTransform(N).toCssString();"scale"in N.props&&N.props.scale!==1&&(U=`${U} scale(${N.props.scale}, ${N.props.scale})`),j&&(j=f.jsx("g",{transform:U,opacity:M,children:j},N.id)),L&&(L=f.jsx("g",{transform:U,opacity:M,children:L},`bg_${N.id}`));const Y=n.getShapeMask(N.id);if(Y){const ne=`mask_${N.id.replace(":","_")}`;S.push(f.jsx("clipPath",{id:ne,children:f.jsx("path",{d:`M${Y.map(({x:le,y:ue})=>`${le},${ue}`).join("L")}Z`})},S.length)),j&&(j=f.jsx("g",{clipPath:`url(#${ne})`,children:j},N.id)),L&&(L=f.jsx("g",{clipPath:`url(#${ne})`,children:L},`bg_${N.id}`))}const V=[];return j&&V.push({zIndex:A,element:j}),L&&V.push({zIndex:D,element:L}),V}))).flat();return await Promise.all(y.values()),{jsx:f.jsx(Xoe,{editor:n,context:x,children:f.jsxs("svg",{preserveAspectRatio:a||void 0,direction:"ltr",width:g,height:m,viewBox:`${h.minX} ${h.minY} ${h.width} ${h.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:s?p?c.solid:c.background:"transparent"},children:[f.jsx("defs",{children:S}),w.sort((C,M)=>C.zIndex-M.zIndex).map(({element:C})=>C)]})}),width:g,height:m}}const Yoe=40;class Zoe{constructor(e){v(this,"_clickId","");v(this,"_clickTimeout");v(this,"_clickScreenPoint");v(this,"_previousScreenPoint");v(this,"_getClickTimeout",(e,t=wt())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)});v(this,"_clickState","idle");v(this,"lastPointerInfo",{});v(this,"handlePointerEvent",e=>{switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=b.From(e.point),this._previousScreenPoint&&b.Dist2(this._previousScreenPoint,this._clickScreenPoint)>Yoe**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=b.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&b.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e});v(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});this.editor=e}get clickState(){return this._clickState}}class Joe{constructor(e){v(this,"_isEdgeScrolling",!1);v(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:t}=this,r=this.getEdgeScroll();if(r.x===0&&r.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const i=t.options.edgeScrollEaseDuration>0?Rn.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:r.x*i,y:r.y*i})}}getEdgeProximityFactors(e,t,r,i,s){const{editor:o}=this,a=o.options.edgeScrollDistance,l=r?o.options.coarsePointerWidth:0,c=e-l,u=e+l,d=i?0:a,h=s?t:t-a;return c<d?Math.min(1,(d-c)/a):u>h?-Math.min(1,(u-h)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:r}}}=e,i=e.getViewportScreenBounds(),{isCoarsePointer:s,insets:[o,a,l,c]}=e.getInstanceState(),u=this.getEdgeProximityFactors(t,i.w,s,c,a),d=this.getEdgeProximityFactors(r,i.h,s,o,l);return{x:u,y:d}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const r=t.getViewportScreenBounds(),i=r.w<1e3?.612:1,s=r.h<1e3?.612:1,o=t.getZoomLevel(),a=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,l=a*e.x*i/o,c=a*e.y*s/o,{x:u,y:d,z:h}=t.getCamera();t.setCamera(new b(u+l,d+c,h))}}class eae{constructor(e){v(this,"isSafari");v(this,"isIos");v(this,"isChromeForIos");v(this,"isFirefox");v(this,"isAndroid");this.editor=e,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}class tae{constructor(e,t){v(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(i,s)=>{i.isFocused!==s.isFocused&&(s.isFocused?this.focus():this.blur(),this.updateContainerClass())});const r=e.getInstanceState().isFocused;t!==r&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;(e=this.disposeSideEffectListener)==null||e.call(this)}}function Mh(n){return rae}class nae{constructor(){v(this,"length",0);v(this,"head",null);v(this,"tail",this)}push(e){return new W6(e,this)}toArray(){return ua}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const rae=new nae;class W6{constructor(e,t){v(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new W6(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class iae{constructor(e){v(this,"store");v(this,"dispose");v(this,"state","recording");v(this,"pendingDiff",new oae);v(this,"stacks",mn("HistoryManager.stacks",{undos:Mh(),redos:Mh()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos}));v(this,"annotateError");v(this,"_isInBatch",!1);v(this,"batch",(e,t)=>{const r=this.state;r!=="paused"&&(t!=null&&t.history)&&(this.state=sae[t.history]);try{if(this._isInBatch)return Es(e),this;this._isInBatch=!0;try{Es(e)}catch(i){throw this.annotateError(i),i}finally{this._isInBatch=!1}return this}finally{this.state=r}});v(this,"_undo",({pushToRedoStack:e,toMark:t=void 0})=>{var i;const r=this.state;this.state="paused";try{let{undos:s,redos:o}=this.stacks.get();const a=this.pendingDiff.clear(),l=mR(a),c=cp(a);e&&!l&&(o=o.push({type:"diff",diff:a}));let u=!1;if(l)for(;((i=s.head)==null?void 0:i.type)==="stop";){const d=s.head;if(s=s.tail,e&&(o=o.push(d)),d.id===t){u=!0;break}}if(!u)e:for(;s.head;){const d=s.head;switch(s=s.tail,e&&(o=o.push(d)),d.type){case"diff":If(c,[cp(d.diff)]);break;case"stop":if(!t||d.id===t)break e;break;default:Vn(d)}}this.store.applyDiff(c,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:o})}finally{this.state=r}return this});v(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));v(this,"redo",()=>{var t;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:r,redos:i}=this.stacks.get();if(i.length===0)return this;for(;((t=i.head)==null?void 0:t.type)==="stop";)r=r.push(i.head),i=i.tail;const s=J1();for(;i.head;){const o=i.head;if(r=r.push(o),i=i.tail,o.type==="diff")If(s,[o.diff]);else break}this.store.applyDiff(s,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:i})}finally{this.state=e}return this});v(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));v(this,"bailToMark",e=>(this._undo({pushToRedoStack:!1,toMark:e}),this));v(this,"squashToMark",e=>{var s;let t=this.stacks.get().undos;const r=[];for(;t.head&&!(t.head.type==="stop"&&t.head.id===e);)t.head.type==="diff"&&r.push(t.head.diff),t=t.tail;if(!t.head||((s=t.head)==null?void 0:s.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(r.length===0)return this;const i=J1();return If(i,r.reverse()),this.stacks.update(({redos:o})=>({undos:t.push({type:"diff",diff:i}),redos:o})),this});v(this,"mark",(e=wt())=>(Es(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"stop",id:e}),redos:r}))}),e));this.store=e.store,this.annotateError=e.annotateError??op,this.dispose=this.store.addHistoryInterceptor((t,r)=>{if(r==="user")switch(this.state){case"recording":this.pendingDiff.apply(t.changes),this.stacks.update(({undos:i})=>({undos:i,redos:Mh()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(t.changes);break;case"paused":break;default:Vn(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"diff",diff:e}),redos:r}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}clear(){this.stacks.set({undos:Mh(),redos:Mh()}),this.pendingDiff.clear()}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const sae={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class oae{constructor(){v(this,"diff",J1());v(this,"isEmptyAtom",mn("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=J1(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){If(this.diff,[e]),this.isEmptyAtom.set(mR(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class aae{constructor(e){v(this,"scribbleItems",new Map);v(this,"state","paused");v(this,"addScribble",(e,t=wt())=>{const r={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,r),r});v(this,"stop",e=>{const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t});v(this,"addPoint",(e,t,r)=>{const i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);const{prev:s}=i,o={x:t,y:r,z:.5};return(!s||b.Dist(s,o)>=1)&&(i.next=o),i});v(this,"tick",e=>{this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:l,prev:c}=t;l&&l!==c&&(t.prev=l,t.scribble.points.push(l)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:r,timeoutMs:i,prev:s,next:o,scribble:a}=t;switch(a.state){case"active":{o&&o!==s?(t.prev=o,a.points.push(o),r===0&&a.points.length>8&&a.points.shift()):i===0&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break}case"stopping":{if(t.delayRemaining===0&&i===0){if(a.points.length===1){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)})})});this.editor=e}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}}var lae=Object.defineProperty,cae=Object.getOwnPropertyDescriptor,Fv=(n,e,t,r)=>{for(var i=cae(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&lae(e,t,i),i};const _e=n=>Math.round(n*10**8)/10**8;function qo(n,e,t,r,i){const s=n.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&_e(a.length)===_e(t)&&vs(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));if(s.length===0)return[];const o=new Set;return s.forEach(a=>{const l=r==="forward"?a.endNode.id:a.startNode.id;if(!o.has(l)){o.add(l);const c=qo(n,l,t,r,vs(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));s.push(...c)}}),s}function uae(n){n.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const t=n[e];for(let r=e-1;r>=0;r--){const i=n[r];if(i.direction===t.direction&&t.gaps.every(s=>i.gaps.some(o=>_e(s.startEdge[0].x)===_e(o.startEdge[0].x)&&_e(s.startEdge[0].y)===_e(o.startEdge[0].y)&&_e(s.startEdge[1].x)===_e(o.startEdge[1].x)&&_e(s.startEdge[1].y)===_e(o.startEdge[1].y))&&i.gaps.some(o=>_e(s.endEdge[0].x)===_e(o.endEdge[0].x)&&_e(s.endEdge[0].y)===_e(o.endEdge[0].y)&&_e(s.endEdge[1].x)===_e(o.endEdge[1].x)&&_e(s.endEdge[1].y)===_e(o.endEdge[1].y)))){n.splice(e,1);break}}}}class n0{constructor(e){v(this,"editor");this.manager=e,this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const r=e.getShapePageTransform(t.id);if(!r)return;const s=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(!(!r||!s))return s.map((o,a)=>{const{x:l,y:c}=ke.applyToPoint(r,o);return{x:l,y:c,id:`${t.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),r=[];for(const i of t){const s=e.get(i);s&&r.push(...s)}return r}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:Qi(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],t=[];let r,i;const s=this.getSnappableGapNodes().sort((a,l)=>a.pageBounds.minX-l.pageBounds.minX);for(let a=0;a<s.length;a++){r=s[a];for(let l=a+1;l<s.length;l++)i=s[l],r.pageBounds.maxX<i.pageBounds.minX&&Ih(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:r,endNode:i,startEdge:[new b(r.pageBounds.maxX,r.pageBounds.minY),new b(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new b(i.pageBounds.minX,i.pageBounds.minY),new b(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:vs(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const o=s.sort((a,l)=>a.pageBounds.minY-l.pageBounds.minY);for(let a=0;a<o.length;a++){r=o[a];for(let l=a+1;l<o.length;l++)i=o[l],r.pageBounds.maxY<i.pageBounds.minY&&Ih(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&t.push({startNode:r,endNode:i,startEdge:[new b(r.pageBounds.minX,r.pageBounds.maxY),new b(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new b(i.pageBounds.minX,i.pageBounds.minY),new b(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:vs(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:r,dragDelta:i}){var S,y;const s=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),a=t.clone().translate(i),l=r.map(({x,y:w},O)=>({id:"selection:"+O,x:x+i.x,y:w+i.y})),c=o,u=[],d=[],h=new b(s,s);this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const p=new b(e==="x"?0:((S=u[0])==null?void 0:S.nudge)??0,e==="y"?0:((y=d[0])==null?void 0:y.nudge)??0);h.x=0,h.y=0,u.length=0,d.length=0,l.forEach(x=>{x.x+=p.x,x.y+=p.y}),a.translate(p),this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const g=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:d}),m=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d});return this.manager.setIndicators([...m,...g]),{nudge:p}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:r,isAspectRatioLocked:i,isResizingFromCenter:s}){var C,M;const o=this.manager.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=ye.Resize(e,r,s?t.x*2:t.x,s?t.y*2:t.y,i);let u=r;l<0&&(u=mse(u)),c<0&&(u=gse(u)),s&&(a.center=e.center);const d=u==="top"||u==="bottom",h=u==="left"||u==="right",p=IP(u,a),g=this.getSnappablePoints(),m=[],S=[],y=new b(o,o);this.collectPointSnaps({minOffset:y,nearestSnapsX:m,nearestSnapsY:S,otherNodeSnapPoints:g,selectionSnapPoints:p});const x=new b(d?0:((C=m[0])==null?void 0:C.nudge)??0,h?0:((M=S[0])==null?void 0:M.nudge)??0);if(i&&yse(u)&&x.len()!==0){const A=m.length&&S.length?Math.abs(x.x)<Math.abs(x.y)?"x":"y":m.length?"x":"y",D=e.aspectRatio;A==="x"?(S.length=0,x.y=x.x/D,(u==="bottom_left"||u==="top_right")&&(x.y=-x.y)):(m.length=0,x.x=x.y*D,(u==="bottom_left"||u==="top_right")&&(x.x=-x.x))}const w=b.Add(t,x),{box:O}=ye.Resize(e,r,s?w.x*2:w.x,s?w.y*2:w.y,i);s&&(O.center=e.center);const T=IP("any",O);m.length=0,S.length=0,y.x=0,y.y=0,this.collectPointSnaps({minOffset:y,nearestSnapsX:m,nearestSnapsY:S,otherNodeSnapPoints:g,selectionSnapPoints:T});const E=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:S});return this.manager.setIndicators([...E]),{nudge:x}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:r,nearestSnapsX:i,nearestSnapsY:s}){for(const o of e)for(const a of t){const l=b.Sub(o,a),c=Math.abs(l.x),u=Math.abs(l.y);_e(c)<=_e(r.x)&&(_e(c)<_e(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.x-o.x}),r.x=c),_e(u)<=_e(r.y)&&(_e(u)<_e(r.y)&&(s.length=0),s.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.y-o.y}),r.y=u)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:r,nearestSnapsY:i}){const{horizontal:s,vertical:o}=this.getVisibleGaps();for(const a of s){if(!Ih(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const c=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&_e(Math.abs(c))<=_e(t.x)){_e(Math.abs(c))<_e(t.x)&&(r.length=0),t.x=Math.abs(c);const y={type:"gap_center",gap:a,nudge:c},x=r.find(({type:O})=>O==="gap_center"),w=x&&vs(a.breadthIntersection[0],a.breadthIntersection[1],x.gap.breadthIntersection[0],x.gap.breadthIntersection[1]);x&&x.gap.length>a.length&&w?r[r.indexOf(x)]=y:(!x||!w)&&r.push(y)}const d=a.startNode.pageBounds.minX-a.length,h=e.maxX,p=d-h;_e(Math.abs(p))<=_e(t.x)&&(_e(Math.abs(p))<_e(t.x)&&(r.length=0),t.x=Math.abs(p),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:p}));const g=a.endNode.pageBounds.maxX+a.length,m=e.minX,S=g-m;_e(Math.abs(S))<=_e(t.x)&&(_e(Math.abs(S))<_e(t.x)&&(r.length=0),t.x=Math.abs(S),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:S}))}for(const a of o){if(!Ih(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const c=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&_e(Math.abs(c))<=_e(t.y)){_e(Math.abs(c))<_e(t.y)&&(i.length=0),t.y=Math.abs(c);const y={type:"gap_center",gap:a,nudge:c},x=i.find(({type:O})=>O==="gap_center"),w=x&&Ih(x.gap.breadthIntersection[0],x.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);x&&x.gap.length>a.length&&w?i[i.indexOf(x)]=y:(!x||!w)&&i.push(y);continue}const d=a.startNode.pageBounds.minY-a.length,h=e.maxY,p=d-h;_e(Math.abs(p))<=_e(t.y)&&(_e(Math.abs(p))<_e(t.y)&&(i.length=0),t.y=Math.abs(p),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:p}));const g=a.endNode.pageBounds.maxY+a.length,m=e.minY,S=g-m;_e(Math.abs(S))<=_e(t.y)&&(_e(Math.abs(S))<_e(t.y)&&(i.length=0),t.y=Math.abs(S),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:S}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const r={},i={};if(e.length>0){for(const s of e)if(s.type==="points"){const o=_e(s.points.otherPoint.x);r[o]||(r[o]=[]),r[o].push(s.points)}}if(t.length>0){for(const s of t)if(s.type==="points"){const o=_e(s.points.otherPoint.y);i[o]||(i[o]=[]),i[o].push(s.points)}}return Object.values(r).concat(Object.values(i)).map(s=>({id:wt(),type:"points",points:y6(s.map(o=>b.From(o.otherPoint)).concat(s.map(o=>b.From(o.thisPoint))),(o,a)=>o.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:r}){const{vertical:i,horizontal:s}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(const l of t){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:p,endEdge:g}}=l;switch(l.type){case"gap_center":{const m=(p-e.width)/2,S=vs(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:wt(),gaps:[...qo(s,d.id,m,"backward",S),{startEdge:u,endEdge:o.left},{startEdge:o.right,endEdge:g},...qo(s,h.id,m,"forward",S)]});break}case"gap_duplicate":{const m=vs(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:wt(),gaps:l.protrusionDirection==="left"?[{startEdge:o.right,endEdge:u.map(S=>S.clone().addXY(-d.pageBounds.width,0))},{startEdge:u,endEdge:g},...qo(s,h.id,p,"forward",m)]:[...qo(s,d.id,p,"backward",m),{startEdge:u,endEdge:g},{startEdge:g.map(S=>S.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:o.left}]});break}}}if(r.length>0)for(const l of r){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:p,endEdge:g}}=l;switch(l.type){case"gap_center":{const m=(p-e.height)/2,S=vs(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:wt(),gaps:[...qo(i,d.id,m,"backward",S),{startEdge:u,endEdge:o.top},{startEdge:o.bottom,endEdge:g},...qo(i,l.gap.endNode.id,m,"forward",S)]});break}case"gap_duplicate":{const m=vs(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:wt(),gaps:l.protrusionDirection==="top"?[{startEdge:o.bottom,endEdge:u.map(S=>S.clone().addXY(0,-d.pageBounds.height))},{startEdge:u,endEdge:g},...qo(i,h.id,p,"forward",m)]:[...qo(i,d.id,p,"backward",m),{startEdge:u,endEdge:g},{startEdge:g.map(S=>S.clone().addXY(0,h.pageBounds.height)),endEdge:o.top}]})}break}}return uae(a),a}}Fv([te],n0.prototype,"getSnapPointsCache");Fv([te],n0.prototype,"getSnappablePoints");Fv([te],n0.prototype,"getSnappableGapNodes");Fv([te],n0.prototype,"getVisibleGaps");function IP(n,e){const{minX:t,maxX:r,minY:i,maxY:s}=e,o=[];switch(n){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:t,y:i})}switch(n){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(n){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:r,y:s})}switch(n){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:t,y:s})}return o}var dae=Object.defineProperty,hae=Object.getOwnPropertyDescriptor,fae=(n,e,t,r)=>{for(var i=hae(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&dae(e,t,i),i};const pae=()=>null,gae=()=>[];class rj{constructor(e){v(this,"editor");this.manager=e,this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{const r=e.getShapeUtil(t).getHandleSnapGeometry(t);return{outline:r.outline===void 0?e.getShapeGeometry(t):r.outline,points:r.points??[],getSelfSnapOutline:r.getSelfSnapOutline??pae,getSelfSnapPoints:r.getSelfSnapPoints??gae}})}*iterateSnapPointsInPageSpace(e,t){var i,s;const r=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapPoints(t);if(r&&r.length){const o=Qi(this.editor.getShapePageTransform(e));for(const a of r)yield o.applyToPoint(a)}for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const a=(s=this.getSnapGeometryCache().get(o))==null?void 0:s.points;if(!a||!a.length)continue;const l=Qi(this.editor.getShapePageTransform(o));for(const c of a)yield l.applyToPoint(c)}}*iterateSnapOutlines(e,t){var i,s;const r=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapOutline(t);r&&(yield{shapeId:e,outline:r});for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const a=(s=this.getSnapGeometryCache().get(o))==null?void 0:s.outline;a&&(yield{shapeId:o,outline:a})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:r}){const i=this.manager.getSnapThreshold();let s=i,o=null;for(const c of this.iterateSnapPointsInPageSpace(e,t))b.DistMin(r,c,s)&&(s=b.Dist(r,c),o=c);if(o)return o;let a=i,l=null;for(const{shapeId:c,outline:u}of this.iterateSnapOutlines(e,t)){const d=Qi(this.editor.getShapePageTransform(c)),h=this.editor.getPointInShapeSpace(c,r),p=u.nearestPoint(h),g=d.applyToPoint(p);b.DistMin(r,g,a)&&(a=b.Dist(r,g),l=g)}return l||null}snapHandle({currentShapeId:e,handle:t}){const i=Qi(this.editor.getShapePageTransform(e)).applyToPoint(t),s=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:i});return s?(this.manager.setIndicators([{id:wt(),type:"points",points:[s]}]),{nudge:b.Sub(s,i)}):null}}fae([te],rj.prototype,"getSnapGeometryCache");var mae=Object.defineProperty,yae=Object.getOwnPropertyDescriptor,V6=(n,e,t,r)=>{for(var i=yae(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&mae(e,t,i),i};class Bv{constructor(e){v(this,"shapeBounds");v(this,"handles");v(this,"_snapIndicators",mn("snapLines",void 0));this.editor=e,this.shapeBounds=new n0(this),this.handles=new rj(this)}getIndicators(){return this._snapIndicators.get()??ua}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getViewportPageBounds(),r=e.getSelectedShapeIds(),i=new Set,s=o=>{if(Qr(o)){const l=e.getShape(o);l&&e.isShapeOfType(l,"frame")&&i.add(o)}const a=e.getSortedChildIdsForParent(o);for(const l of a){if(r.includes(l))continue;const c=e.getShape(l);if(!c||!e.getShapeUtil(c).canSnap(c))continue;const d=e.getShapePageBounds(l);if(d&&t.includes(d)){if(e.isShapeOfType(c,"group")){s(l);continue}i.add(l)}}};return s(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}V6([te],Bv.prototype,"getSnapThreshold");V6([te],Bv.prototype,"getSnappableShapes");V6([te],Bv.prototype,"getCurrentCommonAncestor");const vae=/\r?\n|\r/g;function MP(n){return n.replace(vae,`
`).split(`
`).map(e=>e||" ").join(`
`)}const Sae={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},xae=/\s/;class wae{constructor(e){v(this,"baseElm");v(this,"measureText",(e,t)=>{var o;const r=(o=this.baseElm)==null?void 0:o.cloneNode();this.baseElm.insertAdjacentElement("afterend",r),r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),r.style.setProperty("min-width",t.minWidth===null?null:t.minWidth+"px"),r.style.setProperty("padding",t.padding),r.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),r.textContent=MP(e);const i=r.scrollWidth,s=r.getBoundingClientRect();return r.remove(),{x:0,y:0,w:s.width,h:s.height,scrollWidth:i}});this.editor=e;const t=this.editor.getContainer(),r=document.createElement("div");r.classList.add("tl-text"),r.classList.add("tl-text-measure"),r.tabIndex=-1,t.appendChild(r),this.baseElm=r,e.disposables.add(()=>{r.remove()})}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const r=[],i=e.getBoundingClientRect(),s=-i.left,o=-i.top,a=new Range,l=e.childNodes[0];let c=0,u=null,d=null,h=0,p=0,g=!1;for(const m of e.childNodes)if(m.nodeType===Node.TEXT_NODE)for(const S of m.textContent??""){a.setStart(l,c),a.setEnd(l,c+S.length);const y=a.getClientRects(),x=y[y.length-1],w=x.top+o,O=x.left+s,T=x.right+s,E=O<p,C=xae.test(S);if(C!==d||w!==h||!u){if(u){if(t&&w!==h){g=!0;break}r.push(u)}u={box:{x:O,y:w,w:x.width,h:x.height},text:S},p=O}else E&&(u.box.x=O),u.box.w=E?u.box.w+x.width:T-u.box.x,u.text+=S;S===`
`&&(p=0),d=C,h=w,c+=S.length}return u&&r.push(u),{spans:r,didTruncate:g}}measureTextSpans(e,t){var c;if(e==="")return[];const r=(c=this.baseElm)==null?void 0:c.cloneNode();this.baseElm.insertAdjacentElement("afterend",r);const i=Math.ceil(t.width-t.padding*2);r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("width",`${i}px`),r.style.setProperty("height","min-content"),r.style.setProperty("font-size",`${t.fontSize}px`),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),r.style.setProperty("text-align",Sae[t.textAlign]);const s=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip";s&&(r.style.setProperty("overflow-wrap","anywhere"),r.style.setProperty("word-break","break-all"));const o=MP(e);r.textContent=o;const{spans:a,didTruncate:l}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:s});if(t.overflow==="truncate-ellipsis"&&l){r.textContent="";const u=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width",`${i-u}px`),r.textContent=o;const d=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,h=d[d.length-1];return d.push({text:"",box:{x:Math.min(h.box.x+h.box.w,t.width-t.padding-u),y:h.box.y,w:u,h:h.box.h}}),d}return r.remove(),a}}const AP=(typeof process<"u",dR);class bae{constructor(e){v(this,"cancelRaf");v(this,"isPaused",!0);v(this,"now",0);v(this,"start",()=>{var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=AP(this.tick),this.now=Date.now()});v(this,"tick",()=>{if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=AP(this.tick)});v(this,"dispose",()=>{var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)});v(this,"prevPoint",new b);v(this,"updatePointerVelocity",e=>{const{prevPoint:t,editor:{inputs:{currentScreenPoint:r,pointerVelocity:i}}}=this;if(e===0)return;const s=b.Sub(r,t);this.prevPoint=r.clone();const o=s.len(),a=o?s.div(o):new b(0,0),l=i.clone().lrp(a.mul(o/e),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),i.equals(l)||(this.editor.inputs.pointerVelocity=l)});this.editor=e,this.editor.disposables.add(this.dispose),this.start()}}var Oae=Object.defineProperty,kae=Object.getOwnPropertyDescriptor,us=(n,e,t,r)=>{for(var i=kae(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&Oae(e,t,i),i};class ji{constructor(e,t){v(this,"systemColorScheme",mn("systemColorScheme","light"));v(this,"updateUserPreferences",e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})});if(this.user=e,this.inferDarkMode=t,typeof window>"u"||!("matchMedia"in window))return;const r=window.matchMedia("(prefers-color-scheme: dark)");r!=null&&r.matches&&this.systemColorScheme.set("dark"),r==null||r.addEventListener("change",i=>{i.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??gs.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??gs.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??gs.name}getLocale(){return this.user.userPreferences.get().locale??gs.locale}getColor(){return this.user.userPreferences.get().color??gs.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??gs.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??gs.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??gs.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??gs.isPasteAtCursorMode}}us([te],ji.prototype,"getUserPreferences");us([te],ji.prototype,"getIsDarkMode");us([te],ji.prototype,"getEdgeScrollSpeed");us([te],ji.prototype,"getAnimationSpeed");us([te],ji.prototype,"getId");us([te],ji.prototype,"getName");us([te],ji.prototype,"getLocale");us([te],ji.prototype,"getColor");us([te],ji.prototype,"getIsSnapMode");us([te],ji.prototype,"getIsWrapMode");us([te],ji.prototype,"getIsDynamicResizeMode");us([te],ji.prototype,"getIsPasteAtCursorMode");const Cae={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},Pae=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class Oe{constructor(e,t){v(this,"performanceTracker");v(this,"id");v(this,"type");v(this,"shapeType");v(this,"initial");v(this,"children");v(this,"isLockable");v(this,"parent");v(this,"_path");v(this,"_current");v(this,"_isActive");v(this,"transition",(e,t={})=>{var s;const r=e.split(".");let i=this;for(let o=0;o<r.length;o++){const a=r[o],l=i.getCurrent(),c=(s=i.children)==null?void 0:s[a];if(!c)throw Error(`${i.id} - no child state exists with the id ${a}.`);if((l==null?void 0:l.id)!==c.id&&(l==null||l.exit(t,a),i._current.set(c),c.enter(t,(l==null?void 0:l.id)||"initial"),!c.getIsActive()))break;i=c}return this});v(this,"handleEvent",e=>{var i;const t=Cae[e.name],r=this._current.__unsafe__getWithoutCapture();(i=this[t])==null||i.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&r&&r===this._current.__unsafe__getWithoutCapture()&&r.handleEvent(e)});v(this,"enter",(e,t)=>{var r;if(un.measurePerformance.get()&&Pae.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,t)}});v(this,"exit",(e,t)=>{var r,i;un.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(r=this.onExit)==null||r.call(this,e,t),this.getIsActive()||(i=this.getCurrent())==null||i.exit(e,t)});v(this,"_currentToolIdMask",mn("curent tool id mask",void 0));v(this,"onWheel");v(this,"onPointerDown");v(this,"onPointerMove");v(this,"onLongPress");v(this,"onPointerUp");v(this,"onDoubleClick");v(this,"onTripleClick");v(this,"onQuadrupleClick");v(this,"onRightClick");v(this,"onMiddleClick");v(this,"onKeyDown");v(this,"onKeyUp");v(this,"onKeyRepeat");v(this,"onCancel");v(this,"onComplete");v(this,"onInterrupt");v(this,"onTick");v(this,"onEnter");v(this,"onExit");this.editor=e;const{id:r,children:i,initial:s,isLockable:o}=this.constructor;this.id=r,this._isActive=mn("toolIsActive"+this.id,!1),this._current=mn("toolState"+this.id,void 0),this._path=te("toolPath"+this.id,()=>{const a=this.getCurrent();return this.id+(a?`.${a.getPath()}`:"")}),this.parent=t??{},this.parent?i&&s?(this.type="branch",this.initial=s,this.children=Object.fromEntries(i().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&s&&(this.initial=s,this.children=Object.fromEntries(i().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=o,this.performanceTracker=new X_}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}v(Oe,"id"),v(Oe,"initial"),v(Oe,"children"),v(Oe,"isLockable",!0);class Am extends Oe{constructor(){super(...arguments);v(this,"onKeyDown",t=>{var r;switch(t.code){case"KeyZ":{if(!(t.shiftKey||t.ctrlKey)){const i=this.getCurrent();i&&((r=i.getCurrent())==null?void 0:r.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...t,onInteractionEnd:i.id})}break}}})}}v(Am,"id","root"),v(Am,"initial",""),v(Am,"children",()=>[]);var Tae=Object.defineProperty,Eae=Object.getOwnPropertyDescriptor,we=(n,e,t,r)=>{for(var i=Eae(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&Tae(e,t,i),i};class ge extends boe{constructor({store:t,user:r,shapeUtils:i,bindingUtils:s,tools:o,getContainer:a,cameraOptions:l,initialState:c,autoFocus:u,inferDarkMode:d,options:h}){super();v(this,"options");v(this,"store");v(this,"root");v(this,"disposables",new Set);v(this,"isDisposed",!1);v(this,"_tickManager");v(this,"snaps");v(this,"timers");v(this,"user");v(this,"textMeasure");v(this,"environment");v(this,"scribbles");v(this,"sideEffects");v(this,"edgeScrollManager");v(this,"focusManager");v(this,"getContainer");v(this,"shapeUtils");v(this,"styleProps");v(this,"bindingUtils");v(this,"history");v(this,"_shouldIgnoreShapeLock",!1);v(this,"_crashingError",null);v(this,"_updateInstanceState",(t,r)=>{this.run(()=>{this.store.put([{...this.getInstanceState(),...t}])},r)});v(this,"_isChangingStyleTimeout",-1);v(this,"setCursor",t=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...t}}),this));v(this,"_updateCurrentPageState",t=>{this.store.update(t.id??this.getCurrentPageState().id,r=>({...r,...t}))});v(this,"_cameraOptions",mn("camera options",sP));v(this,"_viewportAnimation",null);v(this,"_willSetInitialBounds",!0);v(this,"_isLockedOnFollowingUser",mn("isLockedOnFollowingUser",!1));v(this,"_cameraState",mn("camera state","idle"));v(this,"_cameraStateTimeoutRemaining",0);v(this,"_decayCameraStateTimeout",t=>{this._cameraStateTimeoutRemaining-=t,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))});v(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))});v(this,"_currentPageShapeIds");v(this,"_parentIdsToChildIds");v(this,"animatingShapes",new Map);v(this,"_updateShapes",t=>{this.getInstanceState().isReadonly||this.run(()=>{var o,a;const r=[];let i,s;for(let l=0,c=t.length;l<c;l++){const u=t[l];u&&(i=this.getShape(u.id),i&&(s=Vs(i,u),s!==i&&(s=((a=(o=this.getShapeUtil(i)).onBeforeUpdate)==null?void 0:a.call(o,i,s))??s,r.push(s))))}this.store.put(r)})});v(this,"externalAssetContentHandlers",{file:null,url:null});v(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});v(this,"inputs",{originPagePoint:new b,originScreenPoint:new b,previousPagePoint:new b,previousScreenPoint:new b,currentPagePoint:new b,currentScreenPoint:new b,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new b});v(this,"_clickManager",new Zoe(this));v(this,"_prevCursor","default");v(this,"_shiftKeyTimeout",-1);v(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});v(this,"_altKeyTimeout",-1);v(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});v(this,"_ctrlKeyTimeout",-1);v(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});v(this,"_restoreToolId","select");v(this,"_pinchStart",1);v(this,"_didPinch",!1);v(this,"_selectedShapeIdsAtPointerDown",[]);v(this,"_longPressTimeout",-1);v(this,"capturedPointerId",null);v(this,"performanceTracker");v(this,"performanceTrackerTimeout",-1);v(this,"dispatch",t=>(this._pendingEventsForNextTick.push(t),t.type==="pointer"&&t.name==="pointer_move"||t.type==="wheel"||t.type==="pinch"||this._flushEventsForTick(0),this));v(this,"_pendingEventsForNextTick",[]);v(this,"_flushEventForTick",t=>{if(this.getCrashingError())return this;const{inputs:r}=this,{type:i}=t;if(t.type==="misc"){(t.name==="cancel"||t.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(t);return}t.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,r.shiftKey=!0):!t.shiftKey&&r.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),t.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,r.altKey=!0):!t.altKey&&r.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),t.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,r.ctrlKey=!0):!t.ctrlKey&&r.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:s,currentPagePoint:o}=r;r.isPointing||(r.isDragging=!1);const a=this.store.unsafeGetWithoutCapture(cr),l=this.store.get(this._getCurrentPageStateId()),c=this._cameraOptions.__unsafe__getWithoutCapture();switch(i){case"pinch":{if(c.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(t),t.name){case"pinch_start":{if(r.isPinching)return;r.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...l.selectedShapeIds]),this._didPinch=!0,r.isPinching=!0,this.interrupt());return}case"pinch":{if(!r.isPinching)return;const{point:{z:u=1},delta:{x:d,y:h}}=t,{x:p,y:g}=b.SubXY(t.point,a.screenBounds.x,a.screenBounds.y);this.stopCameraAnimation(),a.followingUserId&&this.stopFollowingUser();const{x:m,y:S,z:y}=Z0(()=>this.getCamera()),{panSpeed:x,zoomSpeed:w}=c;this._setCamera(new b(m+d*x/y-p/y+p/(u*w),S+h*x/y-g/y+g/(u*w),u*w),{immediate:!0});return}case"pinch_end":{if(!r.isPinching)return this;r.isPinching=!1;const{_selectedShapeIdsAtPointerDown:u}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,u.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(u)}));return}}}case"wheel":{if(c.isLocked)return;if(this._updateInputsFromEvent(t),!this.getIsMenuOpen()){const{panSpeed:u,zoomSpeed:d,wheelBehavior:h}=c;if(h!=="none"){this.stopCameraAnimation(),a.followingUserId&&this.stopFollowingUser();const{x:p,y:g,z:m}=Z0(()=>this.getCamera()),{x:S,y,z:x=0}=t.delta;let w=h;switch(r.ctrlKey&&(w=h==="pan"?"zoom":"pan"),w){case"zoom":{const{x:O,y:T}=this.inputs.currentScreenPoint;let E=x;h==="zoom"&&(Math.abs(y)>10?E=10*Math.sign(y)/100:E=y/100);const C=m+(E??0)*d*m;this._setCamera(new b(p+(O/C-O)-(O/m-O),g+(T/C-T)-(T/m-T),C),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new b(p+S*u/m,g+y*u/m,m),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}}break}case"pointer":{if(r.isPinching)return;this._updateInputsFromEvent(t);const{isPen:u}=t,{isPenMode:d}=a;switch(t.name){case"pointer_down":{if(d&&!u)return;if(this.clearOpenMenus(),this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{this.dispatch({...t,point:this.inputs.currentScreenPoint,name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),t.button===aP&&(this.capturedPointerId=t.pointerId),r.buttons.add(t.button),r.isPointing=!0,r.isDragging=!1,!d&&u&&this.updateInstanceState({isPenMode:!0}),t.button===lP?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):t.button===sg&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!u&&d)return;const{x:h,y:p,z:g}=Z0(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:m,previousScreenPoint:S}=this.inputs,{panSpeed:y}=c,x=b.Sub(m,S);this.setCamera(new b(h+x.x*y/g,p+x.y*y/g,g),{immediate:!0}),this.maybeTrackPerformance("Panning");return}r.isPointing&&!r.isDragging&&b.Dist2(s,o)*this.getZoomLevel()>(a.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/g&&(r.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(r.isDragging=!1,r.isPointing=!1,clearTimeout(this._longPressTimeout),r.buttons.delete(t.button),this.getIsMenuOpen()||a.isPenMode&&!u)return;if(this.capturedPointerId===t.pointerId&&(this.capturedPointerId=null,t.button=0),r.isPanning){r.keys.has("Space")||(r.isPanning=!1);const h=this.inputs.pointerVelocity,p=Math.min(2,h.len());switch(t.button){case aP:{this.setCursor({type:"grab",rotation:0});break}case sg:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}p>0&&this.slideCamera({speed:p,direction:h})}else t.button===lP&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(t.key==="ShiftRight"&&(t.key="ShiftLeft"),t.key==="AltRight"&&(t.key="AltLeft"),t.code==="ControlRight"&&(t.code="ControlLeft"),t.name){case"key_down":{r.keys.add(t.code),t.code==="Space"&&!t.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=a.cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0}));break}case"key_up":{r.keys.delete(t.code),t.code==="Space"&&(this.inputs.buttons.has(sg)||(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(t.type==="pointer"){t.button===sg?t.name="middle_click":t.button===L6&&(t.name="right_click");const{isPenMode:u}=this.store.unsafeGetWithoutCapture(cr);if(t.isPen===u){const d=this._clickManager.handlePointerEvent(t);if(t.name!==d.name){this.root.handleEvent(t),this.emit("event",t),this.root.handleEvent(d),this.emit("event",d);return}}}return this.root.handleEvent(t),this.emit("event",t),this});this.options={...joe,...h},this.store=t,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new iae({store:t,annotateError:A=>{this.annotateError(A,{origin:"history.batch",willCrashApp:!0}),this.crash(A)}}),this.snaps=new Bv(this),this.timers=new fne,this.disposables.add(this.timers.dispose.bind(this.timers)),this._cameraOptions.set({...sP,...l}),this.user=new ji(r??HD(),d??!1),this.getContainer=a??(()=>document.body),this.textMeasure=new wae(this),this._tickManager=new bae(this);class p extends Am{}v(p,"initial",c??""),this.root=new p(this),this.root.children={};const g=JD(i),m={},S={},y=new Map;for(const A of g){const D=new A(this);m[A.type]=D;const N=bR(A.props??{});S[A.type]=N;for(const F of N.keys())if(!y.has(F.id))y.set(F.id,F);else if(y.get(F.id)!==F)throw Error(`Multiple style props with id "${F.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=m,this.styleProps=S;const x=KD(s),w={};for(const A of x){const D=new A(this);w[A.type]=D}this.bindingUtils=w;for(const A of[...o]){if(So(this.root.children,A.id))throw Error(`Can't override tool with id "${A.id}"`);this.root.children[A.id]=new A(this,this.root)}this.environment=new eae(this),this.scribbles=new aae(this);const O=(A,D)=>{let N=null;const F=A.selectedShapeIds.filter(U=>!D.has(U));F.length!==A.selectedShapeIds.length&&(N||(N={...A}),N.selectedShapeIds=F);const j=A.erasingShapeIds.filter(U=>!D.has(U));j.length!==A.erasingShapeIds.length&&(N||(N={...A}),N.erasingShapeIds=j),A.hoveredShapeId&&D.has(A.hoveredShapeId)&&(N||(N={...A}),N.hoveredShapeId=null),A.editingShapeId&&D.has(A.editingShapeId)&&(N||(N={...A}),N.editingShapeId=null);const L=A.hintingShapeIds.filter(U=>!D.has(U));return L.length!==A.hintingShapeIds.length&&(N||(N={...A}),N.hintingShapeIds=L),A.focusedGroupId&&D.has(A.focusedGroupId)&&(N||(N={...A}),N.focusedGroupId=null),N};this.sideEffects=this.store.sideEffects;let T=new Map;const E=new Set,C=new Set;let M=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var A,D,N,F;E.clear();for(const j of C){C.delete(j);const L=this.getShape(j);if(!L)continue;const U=this.getShapeUtil(L),Y=(A=U.onChildrenChange)==null?void 0:A.call(U,L);Y!=null&&Y.length&&this.updateShapes(Y)}if(M.size){const j=M;M=new Set;for(const L of j){const U=this.getBindingUtil(L);(D=U.onOperationComplete)==null||D.call(U)}}if(T.size){const j=T;T=new Map;for(const L of j.values())(F=(N=this.getBindingUtil(L.binding)).onAfterDelete)==null||F.call(N,L)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(A,D)=>{var N,F,j,L;for(const U of this.getBindingsInvolvingShape(D))M.add(U.type),U.fromId===D.id&&((F=(N=this.getBindingUtil(U)).onAfterChangeFromShape)==null||F.call(N,{binding:U,shapeBefore:A,shapeAfter:D})),U.toId===D.id&&((L=(j=this.getBindingUtil(U)).onAfterChangeToShape)==null||L.call(j,{binding:U,shapeBefore:A,shapeAfter:D}));if(A.parentId!==D.parentId){const U=Y=>{var W,J,ne,le;const V=this.getShape(Y);if(V)for(const ue of this.getBindingsInvolvingShape(V))M.add(ue.type),ue.fromId===V.id&&((J=(W=this.getBindingUtil(ue)).onAfterChangeFromShape)==null||J.call(W,{binding:ue,shapeBefore:V,shapeAfter:V})),ue.toId===V.id&&((le=(ne=this.getBindingUtil(ue)).onAfterChangeToShape)==null||le.call(ne,{binding:ue,shapeBefore:V,shapeAfter:V}))};U(D.id),this.visitDescendants(D.id,U)}if(A.parentId!==D.parentId&&Br(D.parentId)){const U=new Set([A.id]);this.visitDescendants(A.id,Y=>{U.add(Y)});for(const Y of this.getPageStates()){if(Y.pageId===D.parentId)continue;const V=O(Y,U);V&&this.store.put([V])}}A.parentId&&Qr(A.parentId)&&C.add(A.parentId),D.parentId!==A.parentId&&Qr(D.parentId)&&C.add(D.parentId)},beforeDelete:A=>{var j,L,U,Y;if(E.has(A.id))return;A.parentId&&Qr(A.parentId)&&C.add(A.parentId),E.add(A.id);const D=[];for(const V of this.getBindingsInvolvingShape(A)){M.add(V.type),D.push(V.id);const W=this.getBindingUtil(V);V.fromId===A.id?((j=W.onBeforeIsolateToShape)==null||j.call(W,{binding:V,removedShape:A}),(L=W.onBeforeDeleteFromShape)==null||L.call(W,{binding:V,shape:A})):((U=W.onBeforeIsolateFromShape)==null||U.call(W,{binding:V,removedShape:A}),(Y=W.onBeforeDeleteToShape)==null||Y.call(W,{binding:V,shape:A}))}D.length&&this.deleteBindings(D);const N=new Set([A.id]),F=He(this.getPageStates().map(V=>O(V,N)));F.length&&this.store.put(F)}},binding:{beforeCreate:A=>{var N,F;const D=(F=(N=this.getBindingUtil(A)).onBeforeCreate)==null?void 0:F.call(N,{binding:A});return D||A},afterCreate:A=>{var D,N;M.add(A.type),(N=(D=this.getBindingUtil(A)).onAfterCreate)==null||N.call(D,{binding:A})},beforeChange:(A,D)=>{var F,j;const N=(j=(F=this.getBindingUtil(D)).onBeforeChange)==null?void 0:j.call(F,{bindingBefore:A,bindingAfter:D});return N||D},afterChange:(A,D)=>{var N,F;M.add(D.type),(F=(N=this.getBindingUtil(D)).onAfterChange)==null||F.call(N,{bindingBefore:A,bindingAfter:D})},beforeDelete:A=>{var D,N;(N=(D=this.getBindingUtil(A)).onBeforeDelete)==null||N.call(D,{binding:A})},afterDelete:A=>{var D,N;(N=(D=this.getBindingUtil(A)).onAfterDelete)==null||N.call(D,{binding:A}),M.add(A.type)}},page:{afterCreate:A=>{const D=Os.createId(A.id),N=Gi.createId(A.id);this.store.has(D)||this.store.put([Os.create({id:D})]),this.store.has(N)||this.store.put([Gi.create({id:N,pageId:A.id})])},afterDelete:(A,D)=>{var j,L;if(((j=this.getInstanceState())==null?void 0:j.currentPageId)===A.id){const U=(L=this.getPages().find(Y=>Y.id!==A.id))==null?void 0:L.id;U?this.store.put([{...this.getInstanceState(),currentPageId:U}]):D==="user"&&this.store.ensureStoreIsUsable()}const N=Os.createId(A.id),F=Gi.createId(A.id);this.store.remove([N,F])}},instance:{afterChange:(A,D,N)=>{var F;if(!this.store.has(D.currentPageId)){const j=this.store.has(A.currentPageId)?A.currentPageId:(F=this.getPages()[0])==null?void 0:F.id;j?this.store.update(D.id,L=>({...L,currentPageId:j})):N==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(A,D)=>{if((A==null?void 0:A.selectedShapeIds)!==(D==null?void 0:D.selectedShapeIds)){const N=D.selectedShapeIds.filter(j=>{var U,Y;let L=(U=this.getShape(j))==null?void 0:U.parentId;for(;Qr(L);){if(D.selectedShapeIds.includes(L))return!1;L=(Y=this.getShape(L))==null?void 0:Y.parentId}return!0});let F=null;if(N.length>0){const j=this.findCommonAncestor(He(N.map(L=>this.getShape(L))),L=>this.isShapeOfType(L,"group"));j&&(F=j)}else D!=null&&D.focusedGroupId&&(F=D.focusedGroupId);(N.length!==D.selectedShapeIds.length||F!==D.focusedGroupId)&&this.store.put([{...D,selectedShapeIds:N,focusedGroupId:F??null}])}}}})),this._currentPageShapeIds=Goe(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=Voe(this.store),this.disposables.add(this.store.listen(A=>{this.emit("change",A)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),c&&this.root.children[c]===void 0)throw Error(`No state found for initialState "${c}".`);this.root.enter(void 0,"initial"),this.edgeScrollManager=new Joe(this),this.focusManager=new tae(this,u),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new X_}dispose(){this.disposables.forEach(t=>t()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(t){const r=typeof t=="string"?t:t.type,i=Yr(this.shapeUtils,r);return Ye(i,`No shape util found for type "${r}"`),i}getBindingUtil(t){const r=typeof t=="string"?t:t.type,i=Yr(this.bindingUtils,r);return Ye(i,`No binding util found for type "${r}"`),i}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(t){return this.history.mark(t),this}squashToMark(t){return this.history.squashToMark(t),this}bail(){return this.history.bail(),this}bailToMark(t){return this.history.bailToMark(t),this}run(t,r){const i=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(r==null?void 0:r.ignoreShapeLock)??i;try{this.history.batch(t,r)}finally{this._shouldIgnoreShapeLock=i}return this}batch(t,r){return this.run(t,r)}annotateError(t,{origin:r,willCrashApp:i,tags:s,extras:o}){const a=this.createErrorAnnotations(r,i);return v6(t,{tags:{...a.tags,...s},extras:{...a.extras,...o}}),i&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(t,r){try{const i=this.getEditingShapeId();return{tags:{origin:t,willCrashApp:r},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:i?this.getShape(i):void 0,inputs:this.inputs}}}catch{return{tags:{origin:t,willCrashApp:r},extras:{}}}}getCrashingError(){return this._crashingError}crash(t){return this._crashingError=t,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:t}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(t){const r=t.split(".").reverse();let i=this.root;for(;r.length>0;){const s=r.pop();if(!s)return!0;const o=i.getCurrent();if((o==null?void 0:o.id)===s){if(r.length===0)return!0;i=o;continue}else return!1}return!1}isInAny(...t){return t.some(r=>this.isIn(r))}setCurrentTool(t,r={}){return this.root.transition(t,r),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const t=this.getCurrentTool();return t?t.getCurrentToolIdMask()??t.id:""}getStateDescendant(t){var s;const r=t.split(".").reverse();let i=this.root;for(;r.length>0;){const o=r.pop();if(!o)return i;const a=(s=i.children)==null?void 0:s[o];if(!a)return;i=a}return i}getDocumentSettings(){return this.store.get(t4)}updateDocumentSettings(t){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...t}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(cr)}updateInstanceState(t,r){return this._updateInstanceState(t,{history:"ignore",...r}),t.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),t.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(t){const r=new Set(this.getOpenMenus());return r.has(t)||(r.add(t),this.updateInstanceState({openMenus:[...r]})),this}deleteOpenMenu(t){const r=new Set(this.getOpenMenus());return r.has(t)&&(r.delete(t),this.updateInstanceState({openMenus:[...r]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Gi.createId(this.getCurrentPageId())}updateCurrentPageState(t){return this._updateCurrentPageState(t),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:t}=this.getCurrentPageState();return He(t.map(r=>this.store.get(r)))}setSelectedShapes(t){return this.run(()=>{const r=t.map(o=>typeof o=="string"?o:o.id),{selectedShapeIds:i}=this.getCurrentPageState(),s=new Set(i);if(r.length===s.size&&r.every(o=>s.has(o)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:r}])},{history:"record-preserveRedoStack"})}isAncestorSelected(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null,i=this.getShape(r);if(!i)return!1;const s=this.getSelectedShapeIds();return!!this.findShapeAncestor(i,o=>s.includes(o.id))}select(...t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this.setSelectedShapes(r),this}deselect(...t){const r=typeof t[0]=="string"?t:t.map(s=>s.id),i=this.getSelectedShapeIds();return i.length>0&&r.length>0&&this.setSelectedShapes(i.filter(s=>!r.includes(s))),this}selectAll(){const t=this.getSortedChildIdsForParent(this.getCurrentPageId());return t.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(t)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var t;return((t=this.getOnlySelectedShape())==null?void 0:t.id)??null}getOnlySelectedShape(){const t=this.getSelectedShapes();return t.length===1?t[0]:null}getSelectionPageBounds(){const t=this.getCurrentPageState().selectedShapeIds;return t.length===0?null:ye.Common(He(t.map(r=>this.getShapePageBounds(r))))}getSelectionRotation(){const t=this.getSelectedShapeIds();let r=!1,i=0;for(let s=0,o=t.length;s<o;s++){const a=this.getShapePageTransform(t[s]);if(a)if(r){if(a.rotation()!==i)return 0}else r=!0,i=a.rotation()}return i}getSelectionRotatedPageBounds(){const t=this.getSelectedShapeIds();if(t.length===0)return;const r=this.getSelectionRotation();if(r===0)return this.getSelectionPageBounds();if(t.length===1){const s=this.getShapeGeometry(t[0]).bounds.clone(),o=this.getShapePageTransform(t[0]);return s.point=o.applyToPoint(s.point),s}const i=ye.FromPoints(this.getSelectedShapeIds().flatMap(s=>{const o=this.getShapePageTransform(s);return o?o.applyToPoints(this.getShapeGeometry(s).bounds.corners):[]}).map(s=>s.rot(-r)));return i.point=i.point.rot(r),i}getSelectionRotatedScreenBounds(){const t=this.getSelectionRotatedPageBounds();if(!t)return;const{x:r,y:i}=this.pageToScreen(t.point),s=this.getZoomLevel();return new ye(r,i,t.width*s,t.height*s)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const t=this.getFocusedGroupId();return t?this.getShape(t):void 0}setFocusedGroup(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==null){const i=this.getShape(r);if(!i)throw Error(`Editor.setFocusedGroup: Shape with id ${r} does not exist`);if(!this.isShapeOfType(i,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${i.type}`)}return r===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,i=>({...i,focusedGroupId:r}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const t=this.getFocusedGroup();if(t){const r=this.findShapeAncestor(t,i=>this.isShapeOfType(i,"group"));this.setFocusedGroup((r==null?void 0:r.id)??null),this.select(t.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const t=this.getEditingShapeId();return t?this.getShape(t):void 0}setEditingShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==this.getEditingShapeId()){if(r){const i=this.getShape(r);if(i&&this.getShapeUtil(i).canEdit(i))return this.run(()=>{this._updateCurrentPageState({editingShapeId:r})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const t=this.getHoveredShapeId();return t?this.getShape(t):void 0}setHoveredShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;return r===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:r})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const t=this.getHintingShapeIds();return He(t.map(r=>this.getShape(r)))}setHintingShapes(t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:y6(r)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const t=this.getErasingShapeIds();return He(t.map(r=>this.getShape(r)))}setErasingShapes(t){const r=typeof t[0]=="string"?t:t.map(s=>s.id);r.sort();const i=this.getErasingShapeIds();return this.run(()=>{if(r.length===i.length){for(let s=0;s<r.length;s++)if(r[s]!==i[s]){this._updateCurrentPageState({erasingShapeIds:r});break}}else this._updateCurrentPageState({erasingShapeIds:r})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;return r!==this.getCroppingShapeId()&&this.run(()=>{if(!r)this.updateCurrentPageState({croppingShapeId:null});else{const i=this.getShape(r),s=this.getShapeUtil(i);i&&s.canCrop(i)&&this.updateCurrentPageState({croppingShapeId:r})}},{history:"ignore"}),this}_unsafe_getCameraId(){return Os.createId(this.getCurrentPageId())}getCamera(){const t=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const r=this.getCameraForFollowing();if(r)return{...t,...r}}return t}getViewportPageBoundsForFollowing(){const t=this.getInstanceState().followingUserId;if(!t)return null;const r=this.getCollaborators().find(h=>h.userId===t);if(!r)return null;const{w:i,h:s}=r.screenBounds,{x:o,y:a,z:l}=r.camera,c=new ye(-o,-a,i/l,s/l),u=this.getViewportScreenBounds().clone(),d=u.width/u.height;return u.width=c.width,u.height=u.width/d,u.height<c.height&&(u.height=c.height,u.width=u.height*d),u.center=c.center,u}getCameraForFollowing(){const t=this.getViewportPageBoundsForFollowing();return t?{x:-t.x,y:-t.y,z:this.getViewportScreenBounds().w/t.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const t=this.getCameraOptions();if(!t.constraints||t.constraints.initialZoom==="default")return 1;const{zx:r,zy:i}=RP(this,t);switch(t.constraints.initialZoom){case"fit-min":return Math.max(r,i);case"fit-max":return Math.min(r,i);case"fit-x":return r;case"fit-y":return i;case"fit-min-100":return Math.min(1,Math.max(r,i));case"fit-max-100":return Math.min(1,Math.min(r,i));case"fit-x-100":return Math.min(1,r);case"fit-y-100":return Math.min(1,i);default:throw Vn(t.constraints.initialZoom)}}getBaseZoom(){const t=this.getCameraOptions();if(!t.constraints||t.constraints.baseZoom==="default")return 1;const{zx:r,zy:i}=RP(this,t);switch(t.constraints.baseZoom){case"fit-min":return Math.max(r,i);case"fit-max":return Math.min(r,i);case"fit-x":return r;case"fit-y":return i;case"fit-min-100":return Math.min(1,Math.max(r,i));case"fit-max-100":return Math.min(1,Math.min(r,i));case"fit-x-100":return Math.min(1,r);case"fit-y-100":return Math.min(1,i);default:throw Vn(t.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(t){var i;const r=It({...this._cameraOptions.__unsafe__getWithoutCapture(),...t});return((i=r.zoomSteps)==null?void 0:i.length)<1&&(r.zoomSteps=[1]),this._cameraOptions.set(r),this}getConstrainedCamera(t,r){const i=this.getCamera();let{x:s,y:o,z:a=i.z}=t;if(!(r!=null&&r.force)){const l=this.getCameraOptions(),c=l.zoomSteps[0],u=Hn(l.zoomSteps),d=this.getViewportScreenBounds();if(l.constraints){const{constraints:h}=l,p=Math.min(h.padding.y,d.w/2),g=Math.min(h.padding.x,d.h/2),m=ye.From(l.constraints.bounds),S=(d.w-g*2)/m.w,y=(d.h-p*2)/m.h,x=this.getBaseZoom(),w=u*x,O=c*x;if(r!=null&&r.reset&&(a=this.getInitialZoom()),a<O||a>w){const{x:j,y:L,z:U}=i,Y=-j+d.w/U/2,V=-L+d.h/U/2;a=An(a,O,w);const W=-j+d.w/a/2,J=-L+d.h/a/2;s=j+W-Y,o=L+J-V}const T=g/a-m.x,E=p/a-m.y,C=(d.w-g*2)/a-m.w,M=(d.h-p*2)/a-m.h,A=T+C*h.origin.x,D=E+M*h.origin.y,N=typeof h.behavior=="string"?h.behavior:h.behavior.x,F=typeof h.behavior=="string"?h.behavior:h.behavior.y;if(r!=null&&r.reset)s=A,o=D;else{switch(N){case"fixed":{s=A;break}case"contain":{a<S?s=A:s=An(s,T+C,T);break}case"inside":{a<S?s=An(s,T,(d.w-g)/a-m.w):s=An(s,T+C,T);break}case"outside":{s=An(s,g/a-m.w,(d.w-g)/a);break}case"free":break;default:throw Vn(N)}switch(F){case"fixed":{o=D;break}case"contain":{a<y?o=D:o=An(o,E+M,E);break}case"inside":{a<y?o=An(o,E,(d.h-p)/a-m.h):o=An(o,E+M,E);break}case"outside":{o=An(o,p/a-m.h,(d.h-p)/a);break}case"free":break;default:throw Vn(F)}}}else if(a>u||a<c){const{x:h,y:p,z:g}=i;a=An(a,c,u),s=h+(-h+d.w/a/2)-(-h+d.w/g/2),o=p+(-p+d.h/a/2)-(-p+d.h/g/2)}}return{x:s,y:o,z:a}}_setCamera(t,r){const i=this.getCamera(),{x:s,y:o,z:a}=this.getConstrainedCamera(t,r);return i.x===s&&i.y===o&&i.z===a?this:(Es(()=>{const l={...i,x:s,y:o,z:a};this.run(()=>{this.store.put([l])},{history:"ignore"});const{currentScreenPoint:c,currentPagePoint:u}=this.inputs,{screenBounds:d}=this.store.unsafeGetWithoutCapture(cr);if(c.x/a-s!==u.x||c.y/a-o!==u.y){const h={type:"pointer",target:"canvas",name:"pointer_move",point:b.AddXY(c,d.x,d.y),pointerId:oP.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1};r!=null&&r.immediate?this._flushEventForTick(h):this.dispatch(h)}this._tickCameraState()}),this)}setCamera(t,r){const{isLocked:i}=this._cameraOptions.__unsafe__getWithoutCapture();if(i&&!(r!=null&&r.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const s=b.Cast(t);Number.isFinite(s.x)||(s.x=0),Number.isFinite(s.y)||(s.y=0),(s.z===void 0||!Number.isFinite(s.z))&&(t.z=this.getZoomLevel());const o=this.getConstrainedCamera(s,r);if(r!=null&&r.animation){const{width:a,height:l}=this.getViewportScreenBounds();this._animateToViewport(new ye(-o.x,-o.y,a/o.z,l/o.z),r)}else this._setCamera(o,{...r,force:!0});return this}centerOnPoint(t,r){const{isLocked:i}=this.getCameraOptions();if(i&&!(r!=null&&r.force))return this;const{width:s,height:o}=this.getViewportPageBounds();return this.setCamera(new b(-(t.x-s/2),-(t.y-o/2),this.getCamera().z),r),this}zoomToFit(t){const r=[...this.getCurrentPageShapeIds()];if(r.length<=0)return this;const i=ye.Common(He(r.map(s=>this.getShapePageBounds(s))));return this.zoomToBounds(i,t),this}resetZoom(t=this.getViewportScreenCenter(),r){const{isLocked:i,constraints:s}=this.getCameraOptions();if(i&&!(r!=null&&r.force))return this;const o=this.getCamera(),{x:a,y:l,z:c}=o,{x:u,y:d}=t;let h=1;if(s){const p=this.getInitialZoom();c!==p&&(h=p)}return this.setCamera(new b(a+(u/h-u)-(u/c-u),l+(d/h-d)-(d/c-d),h),r),this}zoomIn(t=this.getViewportScreenCenter(),r){const{isLocked:i}=this.getCameraOptions();if(i&&!(r!=null&&r.force))return this;const{x:s,y:o,z:a}=this.getCamera(),{zoomSteps:l}=this.getCameraOptions();if(l!==null&&l.length>1){const c=this.getBaseZoom();let u=Hn(l)*c;for(let d=1;d<l.length;d++){const h=l[d-1]*c,p=l[d]*c;if(!(p-a<=(p-h)/2)){u=p;break}}this.setCamera(new b(s+(t.x/u-t.x)-(t.x/a-t.x),o+(t.y/u-t.y)-(t.y/a-t.y),u),r)}return this}zoomOut(t=this.getViewportScreenCenter(),r){const{isLocked:i}=this.getCameraOptions();if(i&&!(r!=null&&r.force))return this;const{zoomSteps:s}=this.getCameraOptions();if(s!==null&&s.length>1){const o=this.getBaseZoom(),{x:a,y:l,z:c}=this.getCamera();let u=s[0]*o;for(let d=s.length-1;d>0;d--){const h=s[d-1]*o,p=s[d]*o;if(!(p-c>=(p-h)/2)){u=h;break}}this.setCamera(new b(a+(t.x/u-t.x)-(t.x/c-t.x),l+(t.y/u-t.y)-(t.y/c-t.y),u),r)}return this}zoomToSelection(t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const i=this.getSelectionPageBounds();return i&&this.zoomToBounds(i,{targetZoom:Math.max(1,this.getZoomLevel()),...t}),this}zoomToBounds(t,r){const i=this._cameraOptions.__unsafe__getWithoutCapture();if(i.isLocked&&!(r!=null&&r.force))return this;const s=this.getViewportScreenBounds(),o=(r==null?void 0:r.inset)??Math.min(iie,s.width*.28),a=this.getBaseZoom(),l=i.zoomSteps[0],c=Hn(i.zoomSteps);let u=An(Math.min((s.width-o)/t.w,(s.height-o)/t.h),l*a,c*a);return(r==null?void 0:r.targetZoom)!==void 0&&(u=Math.min(r.targetZoom,u)),this.setCamera(new b(-t.x+(s.width-t.w*u)/2/u,-t.y+(s.height-t.h*u)/2/u,u),r),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(t){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=t;const{elapsed:r,easing:i,duration:s,start:o,end:a}=this._viewportAnimation;if(r>s){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new b(-a.x,-a.y,this.getViewportScreenBounds().width/a.width));return}const l=s-r,c=i(1-l/s),u=o.minX+(a.minX-o.minX)*c,d=o.minY+(a.minY-o.minY)*c,h=o.maxX+(a.maxX-o.maxX)*c;this._setCamera(new b(-u,-d,this.getViewportScreenBounds().width/(h-u)),{force:!0})}_animateToViewport(t,r={animation:Vx}){const{animation:i,...s}=r;if(!i)return;const{duration:o=0,easing:a=Rn.easeInOutCubic}=i,l=this.user.getAnimationSpeed(),c=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),o===0||l===0?this._setCamera(new b(-t.x,-t.y,this.getViewportScreenBounds().width/t.width),{...s}):(this._viewportAnimation={elapsed:0,duration:o/l,easing:a,start:c.clone(),end:t.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(t={}){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:s,friction:o=this.options.cameraSlideFriction,direction:a,speedThreshold:l=.01}=t;let c=Math.min(s,1);const u=()=>{this.off("tick",d),this.off("stop-camera-animation",u)};this.once("stop-camera-animation",u);const d=h=>{const{x:p,y:g,z:m}=this.getCamera(),S=b.Mul(a,c*h/m);c*=1-o,c<l?u():this._setCamera(new b(p+S.x,g+S.y,m))};return this.on("tick",d),this}zoomToUser(t,r={animation:{duration:500}}){const i=this.getCollaborators().find(s=>s.userId===t);return i?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const s=i.currentPageId===this.getCurrentPageId();s||this.setCurrentPage(i.currentPageId),r&&r.animation&&!s&&(r.animation=void 0),this.centerOnPoint(i.cursor,r);const{highlightedUserIds:o}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...o,t]}),this.timers.setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],l=a.indexOf(t);l<0||(a.splice(l,1),this.updateInstanceState({highlightedUserIds:a}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(t,r=!1){t.width=Math.max(t.width,1),t.height=Math.max(t.height,1);const i=[t.minY!==0,!Ol(document.body.scrollWidth,t.maxX,1),!Ol(document.body.scrollHeight,t.maxY,1),t.minX!==0],{screenBounds:s,insets:o}=this.getInstanceState();if(t.equals(s)&&i.every((l,c)=>l===o[c]))return this;const{_willSetInitialBounds:a}=this;if(this._willSetInitialBounds=!1,a)this.updateInstanceState({screenBounds:t.toJson(),insets:i}),this.setCamera(this.getCamera());else if(r&&!this.getInstanceState().followingUserId){const l=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:t.toJson(),insets:i}),this.centerOnPoint(l)}else this.updateInstanceState({screenBounds:t.toJson(),insets:i}),this._setCamera(b.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:t,y:r,w:i,h:s}=this.getInstanceState().screenBounds;return new ye(t,r,i,s)}getViewportScreenCenter(){const t=this.getViewportScreenBounds();return new b(t.midX-t.minX,t.midY-t.minY)}getViewportPageBounds(){const{w:t,h:r}=this.getViewportScreenBounds(),{x:i,y:s,z:o}=this.getCamera();return new ye(-i,-s,t/o,r/o)}screenToPage(t){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(cr),{x:i,y:s,z:o=1}=this.getCamera();return new b((t.x-r.x)/o-i,(t.y-r.y)/o-s,t.z??.5)}pageToScreen(t){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(cr),{x:i,y:s,z:o=1}=this.getCamera();return new b((t.x+i)*o+r.x,(t.y+s)*o+r.y,t.z??.5)}pageToViewport(t){const{x:r,y:i,z:s=1}=this.getCamera();return new b((t.x+r)*s,(t.y+i)*s,t.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const t=this._getCollaboratorsQuery().get();return t.length?[...new Set(t.map(i=>i.userId))].sort().map(i=>t.filter(o=>o.userId===i).sort((o,a)=>a.lastActivityTimestamp-o.lastActivityTimestamp)[0]):ua}getCollaboratorsOnCurrentPage(){const t=this.getCurrentPageId();return this.getCollaborators().filter(r=>r.currentPageId===t)}startFollowingUser(t){this.stopFollowingUser();const r=this._getCollaboratorsQuery().get().filter(o=>o.userId===t);if(!r.length)return console.warn("User not found"),this;const i=this.user.getId();if(i||console.warn("You should set the userId for the current instance before following a user"),r.some(o=>o.followingUserId===i))return this;const s=te("latestLeaderPresence",()=>this.getCollaborators().find(o=>o.userId===t));return Es(()=>{this.updateInstanceState({followingUserId:t},{history:"ignore"});const o=Xl("update current page",()=>{const c=s.get();if(!c){this.stopFollowingUser();return}c.currentPageId!==this.getCurrentPageId()&&this.getPage(c.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:c.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),a=()=>{o(),this._isLockedOnFollowingUser.set(!1),this.off("frame",l),this.off("stop-following",a)},l=()=>{if(!s.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const u=this.user.getAnimationSpeed();if(u===0){this._isLockedOnFollowingUser.set(!0);return}const d=this.getViewportPageBoundsForFollowing();if(!d){this.stopFollowingUser();return}const h=this.getViewportPageBounds(),p=Math.abs(d.minX-h.minX)+Math.abs(d.maxX-h.maxX),g=Math.abs(d.minY-h.minY)+Math.abs(d.maxY-h.maxY);if(p<this.options.followChaseViewportSnap&&g<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const m=An(u*.5,.1,.8),S=new ye(Wr(h.minX,d.minX,m),Wr(h.minY,d.minY,m),Wr(h.width,d.width,m),Wr(h.height,d.height,m)),y=new b(-S.x,-S.y,this.getViewportScreenBounds().width/S.width);this.stopCameraAnimation(),this._setCamera(y)};this.once("stop-following",a),this.addListener("frame",l),l()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(t){const r=[];let i=this.options.maxShapesPerPage*2,s=this.options.maxShapesPerPage;const o=this.getErasingShapeIds(),a=(c,u,d)=>{const h=this.getShape(c);if(!h)return;u*=h.opacity;let p=!1;const g=this.getShapeUtil(h);t&&(p=!d&&o.includes(c),p&&(u*=.32)),r.push({id:c,shape:h,util:g,index:i,backgroundIndex:s,opacity:u}),i+=1,s+=1;const m=this.getSortedChildIdsForParent(c);if(!m.length)return;let S=null;g.providesBackgroundForChildren(h)&&(S=s,s=i,i+=this.options.maxShapesPerPage);for(const y of m)a(y,u,d||p);S!==null&&(s=S)},l=t?[this.getCurrentPage()]:this.getPages();for(const c of l)for(const u of this.getSortedChildIdsForParent(c.id))a(u,1,!1);return r}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(lne)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(fr)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(t){return this.store.get(typeof t=="string"?t:t.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(t){const r=typeof t=="string"?t:t.id,i=this.store.query.exec("shape",{parentId:{eq:r}});return this.getShapeAndDescendantIds(i.map(s=>s.id))}setCurrentPage(t){const r=typeof t=="string"?t:t.id;return this.store.has(r)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:r}])},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(t){return this.getInstanceState().isReadonly?this:this.getPage(t.id)?this.run(()=>this.store.update(t.id,i=>({...i,...t}))):this}createPage(t){return this.run(()=>{if(this.getInstanceState().isReadonly||this.getPages().length>=this.options.maxPages)return;const r=this.getPages(),i=$oe(t.name??"Page 1",r.map(a=>a.name));let s=t.index;(!s||r.some(a=>a.index===s))&&(s=bs(r[r.length-1].index));const o=ba.create({meta:{},...t,name:i,index:s});this.store.put([o])}),this}deletePage(t){const r=typeof t=="string"?t:t.id;return this.run(()=>{if(this.getInstanceState().isReadonly)return;const i=this.getPages();if(i.length===1)return;const s=this.getPage(r);if(s){if(r===this.getCurrentPageId()){const o=i.findIndex(l=>l.id===r),a=i[o-1]??i[o+1];this.setCurrentPage(a.id)}this.store.remove([s.id])}}),this}duplicatePage(t,r=ba.createId()){if(this.getPages().length>=this.options.maxPages)return this;const i=typeof t=="string"?t:t.id,s=this.getPage(i);if(!s)return this;const o={...this.getCamera()},a=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(s.id));return this.run(()=>{var u;const l=this.getPages(),c=ap(s.index,(u=l[l.indexOf(s)+1])==null?void 0:u.index);if(this.createPage({name:s.name+" Copy",id:r,index:c}),this.setCurrentPage(r),this.setCamera(o),a)return this.putContentOntoCurrentPage(a)}),this}renamePage(t,r){const i=typeof t=="string"?t:t.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:i,name:r}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(t){return this.getInstanceState().isReadonly?this:t.length<=0?this:(this.run(()=>this.store.put(t),{history:"ignore"}),this)}updateAssets(t){return this.getInstanceState().isReadonly?this:t.length<=0?this:(this.run(()=>{this.store.put(t.map(r=>({...this.store.get(r.id),...r})))},{history:"ignore"}),this)}deleteAssets(t){if(this.getInstanceState().isReadonly)return this;const r=typeof t[0]=="string"?t:t.map(i=>i.id);return r.length<=0?this:(this.run(()=>this.store.remove(r),{history:"ignore"}),this)}getAsset(t){return this.store.get(typeof t=="string"?t:t.id)}async resolveAssetUrl(t,r){if(!t)return null;const i=this.getAsset(t);if(!i)return null;const{screenScale:s=1,shouldResolveToOriginal:o=!1}=r,l=Math.max(.125,(d=>Math.pow(2,Math.ceil(Math.log2(d))))(s)),c="connection"in navigator?navigator.connection.effectiveType:null,u=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(i,{screenScale:s||1,steppedScreenScale:l,dpr:u,networkEffectiveType:c,shouldResolveToOriginal:o})}async uploadAsset(t,r){return await this.store.props.assets.upload(t,r)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",t=>this.getShapeUtil(t).getGeometry(t),(t,r)=>t.props===r.props)}getShapeGeometry(t){return this._getShapeGeometryCache().get(typeof t=="string"?t:t.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",t=>{var r,i;return(i=(r=this.getShapeUtil(t)).getHandles)==null?void 0:i.call(r,t)})}getShapeHandles(t){return this._getShapeHandlesCache().get(typeof t=="string"?t:t.id)}getShapeLocalTransform(t){const r=typeof t=="string"?t:t.id,i=this.getShape(r);if(!i)throw Error("Editor.getTransform: shape not found");return ke.Identity().translate(i.x,i.y).rotate(i.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",t=>{if(Br(t.parentId))return this.getShapeLocalTransform(t);const r=this._getShapePageTransformCache().get(t.parentId)??ke.Identity();return ke.Compose(r,this.getShapeLocalTransform(t))})}getShapeParentTransform(t){const r=typeof t=="string"?t:t.id,i=this.getShape(r);return!i||Br(i.parentId)?ke.Identity():this._getShapePageTransformCache().get(i.parentId)??ke.Identity()}getShapePageTransform(t){const r=typeof t=="string"?t:t.id;return this._getShapePageTransformCache().get(r)??ke.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",t=>{const r=this._getShapePageTransformCache().get(t.id);return r?ye.FromPoints(ke.applyToPoints(r,this.getShapeGeometry(t).vertices)):new ye})}getShapePageBounds(t){return this._getShapePageBoundsCache().get(typeof t=="string"?t:t.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",t=>{const r=this._getShapeMaskCache().get(t.id);if(!r)return;if(r.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const i=this._getShapePageTransformCache().get(t.id);return i?`polygon(${ke.applyToPoints(ke.Inverse(i),r).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(t){return this._getShapeClipPathCache().get(typeof t=="string"?t:t.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",t=>{if(Br(t.parentId))return;const r=this.getShapeAncestors(t.id).filter(s=>this.isShapeOfType(s,"frame"));return r.length===0?void 0:r.map(s=>this._getShapePageTransformCache().get(s.id).applyToPoints(this.getShapeGeometry(s).vertices)).reduce((s,o)=>{if(!(o&&s))return;const a=PP(s,o);return a?a.map(b.Cast):[]})})}getShapeMask(t){return this._getShapeMaskCache().get(typeof t=="string"?t:t.id)}getShapeMaskedPageBounds(t){return typeof t!="string"&&(t=t.id),this._getShapeMaskedPageBoundsCache().get(t)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",t=>{const r=this._getShapePageBoundsCache().get(t.id);if(!r)return;const i=this._getShapeMaskCache().get(t.id);if(i){if(i.length===0)return;const{corners:s}=r;if(s.every((a,l)=>a&&b.Equals(a,i[l])))return r.clone();const o=PP(i,s);return o?ye.FromPoints(o):void 0}return r})}getShapeAncestors(t,r=[]){const i=typeof t=="string"?t:t.id,s=this.getShape(i);if(!s)return r;const o=s.parentId;if(Br(o))return r.reverse(),r;const a=this.store.get(o);return a?(r.push(a),this.getShapeAncestors(a,r)):r}findShapeAncestor(t,r){const i=typeof t=="string"?t:t.id,s=this.getShape(i);if(!s)return;const o=s.parentId;if(Br(o))return;const a=this.getShape(o);if(a)return r(a)?a:this.findShapeAncestor(a,r)}hasAncestor(t,r){const i=typeof t=="string"?t:t==null?void 0:t.id,s=i&&this.getShape(i);return s?s.parentId===r?!0:this.hasAncestor(this.getShapeParent(s),r):!1}findCommonAncestor(t,r){var c;if(t.length===0)return;const i=typeof t[0]=="string"?t:t.map(u=>u.id),s=He(i.map(u=>this.getShape(u)));if(s.length===1){const u=s[0].parentId;return Br(u)?void 0:r?(c=this.findShapeAncestor(s[0],r))==null?void 0:c.id:u}const[o,...a]=s;let l=this.getShapeParent(o);for(;l;){if(r&&!r(l)){l=this.getShapeParent(l);continue}if(a.every(u=>this.hasAncestor(u,l.id)))return l.id;l=this.getShapeParent(l)}}isShapeOrAncestorLocked(t){const r=typeof t=="string"?this.getShape(t):t;return r===void 0?!1:r.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(r))}_notVisibleShapes(){return Woe(this)}getCulledShapes(){const t=this._notVisibleShapes().get(),r=this.getSelectedShapeIds(),i=this.getEditingShapeId(),s=new Set(t);return i&&s.delete(i),r.forEach(o=>{s.delete(o)}),s}getCurrentPageBounds(){let t;return this.getCurrentPageShapeIdsSorted().forEach(r=>{const i=this.getShapeMaskedPageBounds(r);i&&(t?t=t.expand(i):t=i.clone())}),t}getSelectedShapeAtPoint(t){const r=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(i=>i.type!=="group"&&r.includes(i.id)).reverse().find(i=>this.isPointInShape(i,t,{hitInside:!0,margin:0}))}getShapeAtPoint(t,r={}){const i=this.getZoomLevel(),s=this.getViewportPageBounds(),{filter:o,margin:a=0,hitLocked:l=!1,hitLabels:c=!1,hitInside:u=!1,hitFrameInside:d=!1}=r;let h=1/0,p=null,g=1/0,m=null;const S=(r.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(y=>{if(y.isLocked&&!l||this.isShapeOfType(y,"group"))return!1;const x=this.getShapeMask(y);return x&&!Pi(t,x)?!1:o?o(y):!0});for(let y=S.length-1;y>=0;y--){const x=S[y],w=this.getShapeGeometry(x),O=w instanceof Ms,T=this.getPointInShapeSpace(x,t);if((this.isShapeOfType(x,"arrow")||this.isShapeOfType(x,"geo")&&x.props.fill==="none")&&x.props.text.trim()){for(const C of w.children)if(C.isLabel&&C.isPointInBounds(T))return x}if(this.isShapeOfType(x,"frame")){const C=w.distanceToPoint(T,u);if(Math.abs(C)<=a)return m||x;if(w.hitTestPoint(T,0,!0))return m||p||(d?x:void 0);continue}let E;if(O){let C=1/0;for(const M of w.children){if(M.isLabel&&!c)continue;const A=M.distanceToPoint(T,u);A<C&&(C=A)}E=C}else a===0&&(w.bounds.w<1||w.bounds.h<1)||w.bounds.containsPoint(T,a)?E=w.distanceToPoint(T,u):E=1/0;if(w.isClosed){if(E<=a){if(w.isFilled||O&&w.children[0].isFilled)return m||x;if(this.getShapePageBounds(x).contains(s))continue;if(Math.abs(E)<a)Math.abs(E)<g&&(g=Math.abs(E),m=x);else if(!m){const{area:C}=w;C<h&&(h=C,p=x)}}}else if(E<this.options.hitTestMargin/i)return x}return m||p||void 0}getShapesAtPoint(t,r={}){return this.getCurrentPageShapes().filter(i=>this.isPointInShape(i,t,r))}isPointInShape(t,r,i={}){const{hitInside:s=!1,margin:o=0}=i,a=typeof t=="string"?t:t.id,l=this.getShapeMask(a);return l&&!Pi(r,l)?!1:this.getShapeGeometry(a).hitTestPoint(this.getPointInShapeSpace(t,r),o,s)}getPointInShapeSpace(t,r){const i=typeof t=="string"?t:t.id;return this._getShapePageTransformCache().get(i).clone().invert().applyToPoint(r)}getPointInParentSpace(t,r){const i=typeof t=="string"?t:t.id,s=this.getShape(i);if(!s)return new b(0,0);if(Br(s.parentId))return b.From(r);const o=this.getShapePageTransform(s.parentId);return o?o.clone().invert().applyToPoint(r):b.From(r)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),t=>this.store.get(t))}getCurrentPageShapesSorted(){const t=[],r=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let i=0,s=r.length;i<s;i++)ij(this,r[i],t);return t}getCurrentPageRenderingShapesSorted(){const t=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:r})=>!t.has(r))}isShapeOfType(t,r){const i=typeof t=="string"?this.getShape(t):t;return i?i.type===r:!1}getShape(t){const r=typeof t=="string"?t:t.id;if(Qr(r))return this.store.get(r)}getShapeParent(t){const r=typeof t=="string"?t:t==null?void 0:t.id;if(!r)return;const i=this.getShape(r);if(!(i===void 0||!Qr(i.parentId)))return this.store.get(i.parentId)}getShapeNearestSibling(t,r){return r?r.parentId===t.parentId?r:this.findShapeAncestor(r,s=>s.parentId===t.parentId):void 0}isShapeInPage(t,r=this.getCurrentPageId()){const i=typeof t=="string"?t:t.id,s=this.getShape(i);if(!s)return!1;let o=!1;if(s.parentId===r)o=!0;else{let a=this.getShape(s.parentId);e:for(;a;){if(a.parentId===r){o=!0;break e}a=this.getShape(a.parentId)}}return o}getAncestorPageId(t){const r=typeof t=="string"?t:t==null?void 0:t.id,i=r&&this.getShape(r);if(i)return Br(i.parentId)?i.parentId:this.getAncestorPageId(this.getShape(i.parentId))}reparentShapes(t,r,i){const s=typeof t[0]=="string"?t:t.map(p=>p.id);if(s.length===0)return this;const o=[],a=Br(r)?ke.Identity():this.getShapePageTransform(r),l=a.rotation();let c=[];const u=He(this.getSortedChildIdsForParent(r).map(p=>this.getShape(p)));if(i){const p=u.find(g=>g.index===i);if(p){const g=u[u.indexOf(p)+1];g?c=Td(i,g.index,s.length):c=Bx(i,s.length)}else{const g=u.sort(fr).find(m=>m.index>i);g?c=Td(i,g.index,s.length):c=Bx(i,s.length)}}else{const p=u.length&&u[u.length-1];c=p?Bx(p.index,s.length):lp(s.length)}const d=a.clone().invert(),h=He(s.map(p=>this.getShape(p)));return this.run(()=>{for(let p=0;p<h.length;p++){const g=h[p],m=this.getShapePageTransform(g);if(!m)continue;const S=m.point();if(!S)continue;const y=d.applyToPoint(S),x=m.rotation()-l;o.push({id:g.id,type:g.type,parentId:r,x:y.x,y:y.y,rotation:x,index:c[p]})}this.updateShapes(o)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(t){const r=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[r];if(!i||i.length===0)return"a1";const s=this.getShape(i[i.length-1]);return bs(s.index)}getSortedChildIdsForParent(t){const r=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[r];return i||ua}visitDescendants(t,r){const i=typeof t=="string"?t:t.id,s=this.getSortedChildIdsForParent(i);for(const o of s)r(o)!==!1&&this.visitDescendants(o,r);return this}getShapeAndDescendantIds(t){const r=new Set;for(const i of t.map(s=>this.getShape(s)).sort(fr))r.add(i.id),this.visitDescendants(i,s=>{r.add(s)});return r}getDroppingOverShape(t,r=[]){const i=this.getCurrentPageShapesSorted();for(let s=i.length-1;s>=0;s--){const o=i[s];if(this.getSelectedShapeIds().includes(o.id)||!this.getShapeUtil(o).canDropShapes(o,r)||r.find(l=>l.id===o.id||this.hasAncestor(o,l.id)))continue;const a=this.getShapeMaskedPageBounds(o.id);if(a&&a.containsPoint(t)&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(o,t),0,!0))return o}}getOutermostSelectableShape(t,r){const i=typeof t=="string"?t:t.id,s=this.getShape(i);let o=s,a=s;const l=this.getFocusedGroup();for(;a;){if(this.isShapeOfType(a,"group")&&(l==null?void 0:l.id)!==a.id&&!this.hasAncestor(l,a.id)&&((r==null?void 0:r(a))??!0))o=a;else if((l==null?void 0:l.id)===a.id)break;a=this.getShapeParent(a)}return o}_getBindingsIndexCache(){const t=Qoe(this);return this.store.createComputedCache("bindingsIndex",r=>t.get().get(r.id))}getBinding(t){return this.store.get(t)}getBindingsFromShape(t,r){const i=typeof t=="string"?t:t.id;return this.getBindingsInvolvingShape(i).filter(s=>s.fromId===i&&s.type===r)}getBindingsToShape(t,r){const i=typeof t=="string"?t:t.id;return this.getBindingsInvolvingShape(i).filter(s=>s.toId===i&&s.type===r)}getBindingsInvolvingShape(t,r){const i=typeof t=="string"?t:t.id,s=this._getBindingsIndexCache().get(i)??ua;return r?s.filter(o=>o.type===r):s}createBindings(t){const r=[];for(const i of t){const s=this.getShape(i.fromId),o=this.getShape(i.toId);if(!s||!o||!this.canBindShapes({fromShape:s,toShape:o,binding:i}))continue;const l=this.getBindingUtil(i.type).getDefaultProps(),c=this.store.schema.types.binding.create({...i,id:i.id??Mc(),props:{...l,...i.props}});r.push(c)}return this.store.put(r),this}createBinding(t){return this.createBindings([t])}updateBindings(t){const r=[];for(const i of t){if(!i)continue;const s=this.getBinding(i.id);if(!s)continue;const o=Vs(s,i);if(o===s)continue;const a=this.getShape(o.fromId),l=this.getShape(o.toId);!a||!l||this.canBindShapes({fromShape:a,toShape:l,binding:o})&&r.push(o)}return this.store.put(r),this}updateBinding(t){return this.updateBindings([t])}deleteBindings(t,{isolateShapes:r=!1}={}){const i=t.map(s=>typeof s=="string"?s:s.id);return r?this.store.atomic(()=>{var s,o;for(const a of i){const l=this.getBinding(a);if(!l)continue;const c=this.getBindingUtil(l);(s=c.onBeforeIsolateFromShape)==null||s.call(c,{binding:l,removedShape:this.getShape(l.toId)}),(o=c.onBeforeIsolateToShape)==null||o.call(c,{binding:l,removedShape:this.getShape(l.fromId)}),this.store.remove([a])}}):this.store.remove(i),this}deleteBinding(t,r){return this.deleteBindings([t],r)}canBindShapes({fromShape:t,toShape:r,binding:i}){const s=typeof t=="string"?t:t.type,o=typeof r=="string"?r:r.type,a=typeof i=="string"?i:i.type,l={fromShapeType:s,toShapeType:o,bindingType:a};return s===o?this.getShapeUtil(s).canBind(l):this.getShapeUtil(s).canBind(l)&&this.getShapeUtil(o).canBind(l)}rotateShapesBy(t,r){if((typeof t[0]=="string"?t:t.map(o=>o.id)).length<=0)return this;const s=ej({editor:this});return s?(Mm({delta:r,snapshot:s,editor:this,stage:"one-off"}),this):this}getChangesToTranslateShape(t,r){var o,a,l;let i=t;const s=this.getShapeUtil(t);return i=Vs(i,((o=s.onTranslateStart)==null?void 0:o.call(s,i))??void 0),i=Vs(i,{id:t.id,type:t.type,x:r.x,y:r.y}),i=Vs(i,((a=s.onTranslate)==null?void 0:a.call(s,t,i))??void 0),i=Vs(i,((l=s.onTranslateEnd)==null?void 0:l.call(s,t,i))??void 0),i}nudgeShapes(t,r){const i=typeof t[0]=="string"?t:t.map(o=>o.id);if(i.length<=0)return this;const s=[];for(const o of i){const a=this.getShape(o),l=b.From(r),c=this.getShapeParentTransform(a);c&&l.rot(-c.rotation()),s.push(this.getChangesToTranslateShape(a,l.add(a)))}return this.updateShapes(s),this}duplicateShapes(t,r){return this.run(()=>{const i=typeof t[0]=="string"?t:t.map(h=>h.id);if(i.length<=0)return this;const s=new Set(i),o=this.getShapeAndDescendantIds(i),a=[...o].reverse(),l=new Map;for(const h of o)l.set(h,mt());const{shapesToCreate:c,bindingsToCreate:u}=_P(this,o,h=>{const p=[];for(const m of h){const S=this.getBinding(m);if(!S)continue;const y=Mc();p.push({...S,id:y,fromId:Qi(l.get(S.fromId)),toId:Qi(l.get(S.toId))})}const g=[];for(const m of a){const S=Qi(l.get(m)),y=this.getShape(m);if(!y)continue;let x=0,w=0;if(r&&s.has(m)){const D=this.getShapeParentTransform(y),N=new b(r.x,r.y).rot(-D.rotation());x=N.x,w=N.y}const O=y.parentId,T=this.getSortedChildIdsForParent(O),E=T.indexOf(y.id),C=T[E+1],M=C?this.getShape(C):null,A=M?ap(y.index,M.index):bs(y.index);g.push({...y,id:S,x:y.x+x,y:y.y+w,index:A,parentId:l.get(y.parentId)??y.parentId})}return{shapesToCreate:g,bindingsToCreate:p}});if(c.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){cg(this);return}if(this.createShapes(c),this.createBindings(u),this.setSelectedShapes(He(i.map(h=>l.get(h)))),r!==void 0){const h=this.getSelectionPageBounds(),p=this.getViewportPageBounds();h&&!p.contains(h)&&this.centerOnPoint(h.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(t,r){const i=typeof t[0]=="string"?t:t.map(l=>l.id);if(i.length===0)return this;if(this.getInstanceState().isReadonly)return this;const s=this.getCurrentPageId();if(r===s)return this;if(!this.store.has(r))return this;const o=this.getContentFromCurrentPage(i);if(!o)return this;if(this.getPageShapeIds(r).size+o.shapes.length>this.options.maxShapesPerPage)return cg(this,r),this;const a=this.getCamera().z;return this.run(()=>{this.deleteShapes(i),this.setCurrentPage(r),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(o,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:a}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(t){const r=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly||r.length===0)return this;let i=!0,s=!0;const o=[];for(const a of r){const l=this.getShape(a);l&&(o.push(l),l.isLocked?s=!1:i=!1)}return this.run(()=>{s?(this.updateShapes(o.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):i?this.updateShapes(o.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(o.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(t){const r=typeof t[0]=="string"?t:t.map(s=>s.id),i=lg(this,"toBack",r);return i&&this.updateShapes(i),this}sendBackward(t){const r=typeof t[0]=="string"?t:t.map(s=>s.id),i=lg(this,"backward",r);return i&&this.updateShapes(i),this}bringForward(t){const r=typeof t[0]=="string"?t:t.map(s=>s.id),i=lg(this,"forward",r);return i&&this.updateShapes(i),this}bringToFront(t){const r=typeof t[0]=="string"?t:t.map(s=>s.id),i=lg(this,"toFront",r);return i&&this.updateShapes(i),this}flipShapes(t,r){const i=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;let s=He(i.map(a=>this.getShape(a)));if(!s.length)return this;s=He(s.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(l=>this.getShape(l)):a).flat());const o=ye.Common(He(s.map(a=>this.getShapePageBounds(a)))).center;return this.run(()=>{for(const a of s){const l=this.getShapeGeometry(a).bounds,c=this.getShapePageTransform(a.id);c&&this.resizeShape(a.id,{x:r==="horizontal"?-1:1,y:r==="vertical"?-1:1},{initialBounds:l,initialPageTransform:c,initialShape:a,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(a).isAspectRatioLocked(a),scaleOrigin:o,scaleAxisRotation:0})}}),this}stackShapes(t,r,i){const s=typeof t[0]=="string"?t:t.map(S=>S.id);if(this.getInstanceState().isReadonly)return this;const o=s.map(S=>this.getShape(S)).filter(S=>S?this.getShapeUtil(S).canBeLaidOut(S):!1),a=o.length;if(i===0&&a<3||a<2)return this;const l=Object.fromEntries(o.map(S=>[S.id,this.getShapePageBounds(S)]));let c,u,d,h;r==="horizontal"?(c="x",u="minX",d="maxX",h="width"):(c="y",u="minY",d="maxY",h="height");let p;if(i===0){const S=[];o.sort((x,w)=>l[x.id][u]-l[w.id][u]);for(let x=0;x<a-1;x++){const w=o[x],O=o[x+1],T=l[w.id],C=l[O.id][u]-T[d],M=S.find(A=>A.gap===C);M?M.count++:S.push({gap:C,count:1})}let y=0;S.forEach(x=>{x.count>y&&(y=x.count,p=x.gap)}),y===1&&(p=Math.max(0,S.reduce((x,w)=>x+w.gap*w.count,0)/(a-1)))}else p=i;const g=[];let m=l[o[0].id][d];return o.forEach((S,y)=>{var E,C;if(y===0)return;const x={x:0,y:0};x[c]=m+p-l[S.id][c];const w=this.getShapeParent(S),O=w?b.Rot(x,-this.getShapePageTransform(w).decompose().rotation):x,T=(C=(E=this.getShapeUtil(S)).onTranslateStart)==null?void 0:C.call(E,S);g.push(T?{...T,[c]:S[c]+O[c]}:{id:S.id,type:S.type,[c]:S[c]+O[c]}),m+=l[S.id][h]+p}),this.updateShapes(g),this}packShapes(t,r){var C,M;const i=typeof t[0]=="string"?t:t.map(A=>A.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const s=i.map(A=>this.getShape(A)).filter(A=>A?this.getShapeUtil(A).canBeLaidOut(A):!1),o={},a={};let l,c,u=0;for(let A=0;A<s.length;A++)l=s[A],c=this.getShapePageBounds(l),o[l.id]=c,a[l.id]=c.clone(),u+=c.width*c.height;const d=ye.Common(He(Object.values(o))),h=d.width;s.sort((A,D)=>o[D.id].height-o[A.id].height);const p=Math.max(Math.ceil(Math.sqrt(u/.95)),h),g=[new ye(d.x,d.y,p,1/0)];let m=0,S=0,y,x;for(let A=0;A<s.length;A++){l=s[A],c=a[l.id];for(let D=g.length-1;D>=0;D--)if(y=g[D],!(c.width>y.width||c.height>y.height)){c.x=y.x,c.y=y.y,S=Math.max(S,c.maxY),m=Math.max(m,c.maxX),c.width===y.width&&c.height===y.height?(x=g.pop(),D<g.length&&(g[D]=x)):c.height===y.height?(y.x+=c.width+r,y.width-=c.width+r):c.width===y.width?(y.y+=c.height+r,y.height-=c.height+r):(g.push(new ye(y.x+(c.width+r),y.y,y.width-(c.width+r),c.height)),y.y+=c.height+r,y.height-=c.height+r);break}}const w=ye.Common(Object.values(a)),O=b.Sub(d.center,w.center);let T;const E=[];for(let A=0;A<s.length;A++){l=s[A],c=o[l.id],T=a[l.id];const D=b.Sub(T.point,c.point).add(O),N=this.getShapeParentTransform(l);N&&D.rot(-N.rotation());const F={id:l.id,type:l.type,x:l.x+D.x,y:l.y+D.y},j=(M=(C=this.getShapeUtil(l)).onTranslateStart)==null?void 0:M.call(C,{...l,...F});j?E.push({...F,...j}):E.push(F)}return E.length&&this.updateShapes(E),this}alignShapes(t,r){const i=typeof t[0]=="string"?t:t.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const s=He(i.map(c=>this.getShape(c))),o=Object.fromEntries(s.map(c=>[c.id,this.getShapePageBounds(c)])),a=ye.Common(He(Object.values(o))),l=[];return s.forEach(c=>{const u=o[c.id];if(!u)return;const d={x:0,y:0};switch(r){case"top":{d.y=a.minY-u.minY;break}case"center-vertical":{d.y=a.midY-u.minY-u.height/2;break}case"bottom":{d.y=a.maxY-u.minY-u.height;break}case"left":{d.x=a.minX-u.minX;break}case"center-horizontal":{d.x=a.midX-u.minX-u.width/2;break}case"right":{d.x=a.maxX-u.minX-u.width;break}}const h=this.getShapeParent(c),p=h?b.Rot(d,-this.getShapePageTransform(h).decompose().rotation):d;l.push(this.getChangesToTranslateShape(c,b.Add(c,p)))}),this.updateShapes(l),this}distributeShapes(t,r){const i=typeof t[0]=="string"?t:t.map(w=>w.id);if(this.getInstanceState().isReadonly)return this;if(i.length<3)return this;const s=i.length,o=He(i.map(w=>this.getShape(w))),a=Object.fromEntries(o.map(w=>[w.id,this.getShapePageBounds(w)]));let l,c,u,d,h;r==="horizontal"?(l="x",c="minX",u="maxX",d="midX",h="width"):(l="y",c="minY",u="maxY",d="midY",h="height");const p=[],g=o.sort((w,O)=>a[w.id][c]-a[O.id][c])[0],m=o.sort((w,O)=>a[O.id][u]-a[w.id][u])[0],S=a[g.id][d],y=(a[m.id][d]-S)/(s-1),x=S+y;return o.filter(w=>w!==g&&w!==m).sort((w,O)=>a[w.id][d]-a[O.id][d]).forEach((w,O)=>{const T={x:0,y:0};T[l]=x+y*O-a[w.id][h]/2-a[w.id][l];const E=this.getShapeParent(w),C=E?b.Rot(T,-this.getShapePageTransform(E).rotation()):T;p.push(this.getChangesToTranslateShape(w,b.Add(w,C)))}),this.updateShapes(p),this}stretchShapes(t,r){const i=typeof t[0]=="string"?t:t.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const s=He(i.map(c=>this.getShape(c))),o=Object.fromEntries(i.map(c=>[c,this.getShapeGeometry(c).bounds])),a=Object.fromEntries(i.map(c=>[c,this.getShapePageBounds(c)])),l=ye.Common(He(Object.values(a)));switch(r){case"vertical":{this.run(()=>{for(const c of s){if(this.getShapePageTransform(c).rotation()%pt)continue;const d=o[c.id],h=a[c.id],p=new b(0,l.minY-h.minY),g=this.getShapeParentTransform(c);g&&p.rot(-g.rotation());const{x:m,y:S}=b.Add(p,c);this.updateShapes([{id:c.id,type:c.type,x:m,y:S}]);const y=new b(1,l.height/h.height);this.resizeShape(c.id,y,{initialBounds:d,scaleOrigin:new b(h.center.x,l.minY),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const c of s){const u=o[c.id],d=a[c.id];if(this.getShapePageTransform(c).rotation()%pt)continue;const p=new b(l.minX-d.minX,0),g=this.getShapeParentTransform(c);g&&p.rot(-g.rotation());const{x:m,y:S}=b.Add(p,c);this.updateShapes([{id:c.id,type:c.type,x:m,y:S}]);const y=new b(l.width/d.width,1);this.resizeShape(c.id,y,{initialBounds:u,scaleOrigin:new b(l.minX,d.center.y),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}}return this}resizeShape(t,r,i={}){var g,m,S;const s=typeof t=="string"?t:t.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(r.x)||(r=new b(1,r.y)),Number.isFinite(r.y)||(r=new b(r.x,1));const o=i.initialShape??this.getShape(s);if(!o)return this;const a=i.scaleOrigin??((g=this.getShapePageBounds(s))==null?void 0:g.center);if(!a)return this;const l=i.initialPageTransform?ke.Cast(i.initialPageTransform):this.getShapePageTransform(s);if(!l)return this;const c=l.rotation();if(c==null)return this;const u=i.scaleAxisRotation??c,d=i.initialBounds??this.getShapeGeometry(s).bounds;if(!d)return this;const h=i.isAspectRatioLocked??this.getShapeUtil(o).isAspectRatioLocked(o);if(!dD(c,u))return this._resizeUnalignedShape(s,r,{...i,initialBounds:d,scaleOrigin:a,scaleAxisRotation:u,initialPageTransform:l,isAspectRatioLocked:h,initialShape:o});const p=this.getShapeUtil(o);if(h&&(Math.abs(r.x)>Math.abs(r.y)?r=new b(r.x,Math.sign(r.y)*Math.abs(r.x)):r=new b(Math.sign(r.x)*Math.abs(r.y),r.y)),p.onResize&&p.canResize(o)){const y=this._scalePagePoint(ke.applyToPoint(l,new b(0,0)),a,r,u),x=this.getPointInParentSpace(o.id,y),w=new b(r.x,r.y),O=Ol((c-u)%Math.PI,0);w.x=O?r.x:r.y,w.y=O?r.y:r.x;const T=ke.applyToPoint(l,new b),{x:E,y:C}=this.getPointInParentSpace(o.id,T);let M=o;i.skipStartAndEndCallbacks||(M=Vs(o,((m=p.onResizeStart)==null?void 0:m.call(p,o))??void 0)),M=Vs(M,{id:s,type:o.type,x:x.x,y:x.y,...p.onResize({...o,x:E,y:C},{newPoint:x,handle:i.dragHandle??"bottom_right",mode:i.mode??"scale_shape",scaleX:w.x,scaleY:w.y,initialBounds:d,initialShape:o})}),i.skipStartAndEndCallbacks||(M=Vs(M,((S=p.onResizeEnd)==null?void 0:S.call(p,o,M))??void 0)),this.updateShapes([M])}else{const y=ke.applyToPoint(l,d.center),x=this._scalePagePoint(y,a,r,u),w=this.getPointInParentSpace(o.id,y),O=this.getPointInParentSpace(o.id,x),T=b.Sub(O,w);this.updateShapes([{id:s,type:o.type,x:o.x+T.x,y:o.y+T.y}])}return this}_scalePagePoint(t,r,i,s){const o=b.RotWith(t,r,-s).sub(r),a=b.MulV(o,i);return b.Add(a,r).rotWith(r,s)}_resizeUnalignedShape(t,r,i){const{type:s}=i.initialShape,o=new b(r.x,r.y);if(Math.abs(r.x)>Math.abs(r.y)?o.x=Math.sign(r.x)*Math.abs(r.y):o.y=Math.sign(r.y)*Math.abs(r.x),this.resizeShape(t,o,{initialShape:i.initialShape,initialBounds:i.initialBounds,isAspectRatioLocked:i.isAspectRatioLocked}),Math.sign(r.x)*Math.sign(r.y)<0){let{rotation:y}=ke.Decompose(i.initialPageTransform);y-=2*y,this.updateShapes([{id:t,type:s,rotation:y}])}const a=ke.applyToPoint(i.initialPageTransform,i.initialBounds.center),l=this._scalePagePoint(a,i.scaleOrigin,r,i.scaleAxisRotation),c=this.getShapePageBounds(t),u=this.getShapePageTransform(t),d=c.center,h=u.point();if(!d||!h)return this;const p=b.Sub(l,d),g=b.Add(h,p),{x:m,y:S}=this.getPointInParentSpace(t,g);return this.updateShapes([{id:t,type:s,x:m,y:S}]),this}getInitialMetaForShape(t){return{}}createShape(t){return this.createShapes([t]),this}createShapes(t){if(!Array.isArray(t))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getInstanceState().isReadonly)return this;if(t.length<=0)return this;const r=this.getCurrentPageShapeIds();if(t.length+r.size>this.options.maxShapesPerPage)return cg(this),this;const s=this.getFocusedGroupId();return this.run(()=>{var d,h;const o=this.getCurrentPageShapesSorted(),a=t.map(p=>{if(p.id||(p={id:mt(),...p}),!p.parentId||!(this.store.has(p.parentId)||t.some(g=>g.id===p.parentId))){let g=this.getFocusedGroupId();for(let S=o.length-1;S>=0;S--){const y=o[S];if(this.getShapeUtil(y).canReceiveNewChildrenOfType(y,p.type)&&this.isPointInShape(y,{x:p.x??0,y:p.y??0},{margin:0,hitInside:!0})){g=y.id;break}}const m=p.parentId;if(g===p.id&&(g=s),g!==m&&(p={...p},p.parentId=g,Qr(g))){const S=this.getPointInShapeSpace(this.getShape(g),{x:p.x??0,y:p.y??0});p.x=S.x,p.y=S.y,p.rotation=-this.getShapePageTransform(g).rotation()+(p.rotation??0)}}return p}),l=new Map,c=[],{opacityForNextShape:u}=this.getInstanceState();for(const p of a){const g=this.getShapeUtil(p);let m=p.index;if(!m){const w=p.parentId??s;l.has(w)||l.set(w,this.getHighestIndexForParent(w)),m=l.get(w),l.set(w,bs(m))}const S=g.getDefaultProps();for(const[w,O]of this.styleProps[p.type])S[O]=this.getStyleForNextShape(w);let y=this.store.schema.types.shape.create({...p,index:m,opacity:p.opacity??u,parentId:p.parentId??s,props:"props"in p?{...S,...p.props}:S});if(y.index===void 0)throw Error("no index!");const x=(h=(d=this.getShapeUtil(y)).onBeforeCreate)==null?void 0:h.call(d,y);x&&(y=x),c.push(y)}c.forEach(p=>{p.meta={...this.getInitialMetaForShape(p),...p.meta}}),this.store.put(c)}),this}animateShape(t,r={animation:Vx}){return this.animateShapes([t],r)}animateShapes(t,r={animation:Vx}){if(!r.animation)return this;const{duration:i=500,easing:s=Rn.linear}=r.animation,o=wt();let a=i,l;const c=[];let u,d;for(let p=0,g=t.length;p<g;p++){if(u=t[p],!u)continue;const m=this.getShape(u.id);m&&(d={start:It(m),end:Vs(It(m),u)},c.push(d),this.animatingShapes.set(m.id,o))}const h=p=>{var y,x;if(a-=p,a<0){const{animatingShapes:w}=this,O=t.filter(T=>T&&w.get(T.id)===o);O.length&&this.updateShapes(O),this.off("tick",h);return}l=s(1-a/i);const{animatingShapes:g}=this,m=[];let S;for(let w=0,O=c.length;w<O;w++){const{start:T,end:E}=c[w];S=g.get(T.id),S===o&&m.push({...E,x:T.x+(E.x-T.x)*l,y:T.y+(E.y-T.y)*l,opacity:T.opacity+(E.opacity-T.opacity)*l,rotation:T.rotation+(E.rotation-T.rotation)*l,props:((x=(y=this.getShapeUtil(E)).getInterpolatedProps)==null?void 0:x.call(y,T,E,l))??E.props})}this._updateShapes(m)};return this.on("tick",h),this}groupShapes(t,r={}){var m;const{groupId:i=mt(),select:s=!0}=r;if(!Array.isArray(t))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const o=typeof t[0]=="string"?t:t.map(S=>S.id);if(o.length<=1)return this;const a=He((this._shouldIgnoreShapeLock?o:this._getUnlockedShapeIds(o)).map(S=>this.getShape(S))),l=a.sort(fr).map(S=>S.id),c=ye.Common(He(a.map(S=>this.getShapePageBounds(S)))),{x:u,y:d}=c.point,h=this.findCommonAncestor(a)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const p=a.filter(S=>S.parentId===h).sort(fr),g=(m=p[p.length-1])==null?void 0:m.index;return this.run(()=>{this.createShapes([{id:i,type:"group",parentId:h,index:g,x:u,y:d,opacity:1,props:{}}]),this.reparentShapes(l,i),s&&this.select(i)}),this}ungroupShapes(t,r={}){if(this.getInstanceState().isReadonly)return this;const{select:i=!0}=r,s=typeof t[0]=="string"?t:t.map(c=>c.id),o=He((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(c=>this.getShape(c)));if(o.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const a=new Set,l=[];return o.forEach(c=>{this.isShapeOfType(c,"group")?l.push(c):a.add(c.id)}),l.length===0?this:(this.run(()=>{let c;for(let u=0,d=l.length;u<d;u++){c=l[u];const h=this.getSortedChildIdsForParent(c.id);for(let p=0,g=h.length;p<g;p++)a.add(h[p]);this.reparentShapes(h,c.parentId,c.index)}this.deleteShapes(l.map(u=>u.id)),i&&this.select(...a)}),this)}updateShape(t){return this.updateShapes([t]),this}updateShapes(t){const r=Array(t.length);for(let i=0,s=t.length;i<s;i++){const o=t[i];if(!o)continue;const a=this.getShape(o.id);if(a){if(!this._shouldIgnoreShapeLock){if(a.isLocked){if(!(Object.hasOwn(o,"isLocked")&&!o.isLocked))continue}else if(this.isShapeOrAncestorLocked(a))continue}this.animatingShapes.delete(o.id),r.push(o)}}return this._updateShapes(r),this}_getUnlockedShapeIds(t){return t.filter(r=>{var i;return!((i=this.getShape(r))!=null&&i.isLocked)})}deleteShapes(t){if(this.getInstanceState().isReadonly)return this;if(!Array.isArray(t))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=this._shouldIgnoreShapeLock?r:this._getUnlockedShapeIds(r);if(i.length===0)return this;const s=new Set(i);for(const o of i)this.visitDescendants(o,a=>{s.add(a)});return this.run(()=>this.store.remove([...s]))}deleteShape(t){return this.deleteShapes([typeof t=="string"?t:t.id]),this}_extractSharedStyles(t,r){if(this.isShapeOfType(t,"group")){const i=this._parentIdsToChildIds.get()[t.id];if(!i)return;for(let s=0,o=i.length;s<o;s++)this._extractSharedStyles(this.getShape(i[s]),r)}else for(const[i,s]of this.styleProps[t.type])r.applyValue(i,Yr(t.props,s))}_getSelectionSharedStyles(){const t=this.getSelectedShapes(),r=new c4;for(const i of t)this._extractSharedStyles(i,r);return r}getStyleForNextShape(t){const r=this.getInstanceState().stylesForNextShape[t.id];return r===void 0?t.defaultValue:r}getShapeStyleIfExists(t,r){const i=this.styleProps[t.type].get(r);if(i!==void 0)return Yr(t.props,i)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const t=this.root.getCurrent(),r=new c4;if(!t)return r;if(t.shapeType)for(const i of this.styleProps[t.shapeType].keys())r.applyValue(i,this.getStyleForNextShape(i));return r}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const t=[],r=s=>{const o=this.getShape(s);if(o)if(this.isShapeOfType(o,"group"))for(const a of this.getSortedChildIdsForParent(o.id))r(a);else t.push(o)};for(const s of this.getSelectedShapeIds())r(s);let i=null;for(const s of t)if(i===null)i=s.opacity;else if(i!==s.opacity)return{type:"mixed"};if(i!==null)return{type:"shared",value:i}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(t,r){return this.updateInstanceState({opacityForNextShape:t},r),this}setOpacityForSelectedShapes(t){const r=this.getSelectedShapes();if(r.length>0){const i=[],s=o=>{if(this.isShapeOfType(o,"group")){const a=this.getSortedChildIdsForParent(o);for(const l of a)s(this.getShape(l))}else i.push(o)};for(const o of r)s(o);this.updateShapes(i.map(o=>({id:o.id,type:o.type,opacity:t})))}return this}setStyleForNextShapes(t,r,i){const s=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...s,[t.id]:r}},i),this}setStyleForSelectedShapes(t,r){const i=this.getSelectedShapes();if(i.length>0){const s=[],o=a=>{if(this.isShapeOfType(a,"group")){const l=this.getSortedChildIdsForParent(a.id);for(const c of l)o(this.getShape(c))}else{const l=this.getShapeUtil(a),c=this.styleProps[a.type].get(t);if(c){const u={id:a.id,type:a.type,props:{[c]:r}};s.push({util:l,originalShape:a,updatePartial:u})}}};for(const a of i)o(a);this.updateShapes(s.map(({updatePartial:a})=>a))}return this}registerExternalAssetHandler(t,r){return this.externalAssetContentHandlers[t]=r,this}async getAssetForExternalContent(t){var r,i;return await((i=(r=this.externalAssetContentHandlers)[t.type])==null?void 0:i.call(r,t))}hasExternalAssetHandler(t){return!!this.externalAssetContentHandlers[t]}registerExternalContentHandler(t,r){return this.externalContentHandlers[t]=r,this}async putExternalContent(t){var r,i;return(i=(r=this.externalContentHandlers)[t.type])==null?void 0:i.call(r,t)}getContentFromCurrentPage(t){const r=typeof t[0]=="string"?t:t.map(s=>s.id);if(!r||r.length===0)return;const i=this.getShapeAndDescendantIds(r);return _P(this,i,s=>{const o=[];for(const d of s){const h=this.getBinding(d);h&&o.push(h)}const a=[],l=[];for(const d of i){const h=this.getShape(d);if(!h)continue;if(!i.has(h.parentId)){const g=this.getShapePageTransform(h.id),m=g.point();l.push({...h,x:m.x,y:m.y,rotation:g.rotation(),parentId:this.getCurrentPageId()}),a.push(h.id)}else l.push(h)}const c=[],u=new Set;for(const d of l){if(!("assetId"in d.props))continue;const h=d.props.assetId;if(!h||u.has(h))continue;u.add(h);const p=this.getAsset(h);p&&c.push(p)}return{schema:this.store.schema.serialize(),shapes:l,rootShapeIds:a,bindings:o,assets:c}})}async resolveAssetsInContent(t){if(!t)return;const r=[];return await Promise.allSettled(t.assets.map(async i=>{var s,o;if((i.type==="image"||i.type==="video")&&!((s=i.props.src)!=null&&s.startsWith("data:image"))&&!((o=i.props.src)!=null&&o.startsWith("http"))){const a=It(i),l=await this.store.props.assets.resolve(i,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});a.props.src=await Ic.blobToDataUrl(await Oo(l).then(c=>c.blob())),r.push(a)}else r.push(i)})),t.assets=r,t}putContentOntoCurrentPage(t,r={}){var N,F;if(this.getInstanceState().isReadonly)return this;if(!t.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:i=!1,preserveIds:s=!1,preservePosition:o=!1}=r;let{point:a=void 0}=r;const l=this.getCurrentPageId(),{rootShapeIds:c}=t,u=[],d=[],h=[],p={store:{...Object.fromEntries(t.assets.map(j=>[j.id,j])),...Object.fromEntries(t.shapes.map(j=>[j.id,j])),...Object.fromEntries(((N=t.bindings)==null?void 0:N.map(j=>[j.id,j]))??[])},schema:t.schema},g=this.store.schema.migrateStoreSnapshot(p);if(g.type==="error")throw Error("Could not put content: could not migrate content");for(const j of Object.values(g.value))switch(j.typeName){case"asset":{u.push(j);break}case"shape":{d.push(j);break}case"binding":{h.push(j);break}}const m=new Map(s?d.map(j=>[j.id,j.id]):d.map(j=>[j.id,mt()])),S=new Map(s?h.map(j=>[j.id,j.id]):h.map(j=>[j.id,Mc()]));let y=this.getCurrentPageId(),x=1/0,w=[];for(const j of this.getSelectedShapes()){if(x===0)break;const L=this.isShapeOfType(j,"frame"),U=this.getShapeAncestors(j);L&&U.push(j);const Y=L?U.length+1:U.length;if(Y<x)x=Y,w=U,y=L?j.id:j.parentId;else if(Y===x){if(w.length!==U.length)throw Error(`Ancestors: ${w.length} !== ${U.length}`);if(w.length===0){y=l;break}else{y=l;for(let V=0;V<w.length&&U[V]===w[V];V++)y=U[V].id}}}let O=!1;if(!Br(y)){const j=this.getShape(y);if(j){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(j)))y=l;else if(c.length===1){const L=d.find(U=>U.id===c[0]);this.isShapeOfType(j,"frame")&&this.isShapeOfType(L,"frame")&&L.props.w===(j==null?void 0:j.props.w)&&L.props.h===(j==null?void 0:j.props.h)&&(O=!0)}}else y=l}O||(O=m.has(y)),O&&(y=this.getShape(y).parentId);let T=this.getHighestIndexForParent(y);const E=[],C=d.map(j=>{const L=m.get(j.id),U={...j,id:L};return c.includes(j.id)&&(U.parentId=l,E.push(U)),m.has(U.parentId)?U.parentId=m.get(j.parentId):(c.push(U.id),U.index=T,T=bs(T)),U});if(C.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return cg(this),this;const M=h.map(j=>({...j,id:Qi(S.get(j.id)),fromId:Qi(m.get(j.fromId)),toId:Qi(m.get(j.toId))})),A=[],D=[];for(const j of u)this.store.has(j.id)||((j.type==="image"||j.type==="video")&&((F=j.props.src)!=null&&F.startsWith("data:image"))&&(D.push(It(j)),j.props.src=null),A.push(j));return Promise.allSettled(D.map(async j=>{const L=await zoe(j.props.src,j.props.name,j.props.mimeType??"image/png"),U=await this.getAssetForExternalContent({type:"file",file:L});if(!U){this.deleteAssets([j.id]);return}this.updateAssets([{...U,id:j.id}])})),this.run(()=>{A.length>0&&this.createAssets(A),this.createShapes(C),this.createBindings(M),i&&this.select(...E.map(V=>V.id)),y!==l&&this.reparentShapes(E.map(V=>V.id),y);const j=C.map(V=>this.getShape(V.id)),L=ye.Common(j.map(V=>this.getShapePageBounds(V)));if(a===void 0)if(Br(y)){const V=this.getViewportPageBounds();o||V.includes(ye.From(L))?a=L.center:a=V.center}else{const V=this.getShape(y);a=ke.applyToPoint(this.getShapePageTransform(V),this.getShapeGeometry(V).bounds.center)}if(E.length===1){const V=E[0];if(this.isShapeOfType(V,"frame"))for(;this.getShapesAtPoint(a).some(W=>this.isShapeOfType(W,"frame")&&W.props.w===V.props.w&&W.props.h===V.props.h);)a.x+=L.w+16}const U=ye.Common(He(E.map(({id:V})=>this.getShapePageBounds(V)))).center,Y=b.Sub(a,U);this.updateShapes(E.map(({id:V})=>{const W=this.getShape(V),J=this.getShapeParentTransform(V).decompose().rotation,ne=b.Rot(Y,-J);return{id:W.id,type:W.type,x:W.x+ne.x,y:W.y+ne.y}}))}),this}async getSvgElement(t,r={}){const i=await Koe(this,t,r);if(!i)return;const s=document.createDocumentFragment(),o=NA(s);su.flushSync(()=>{o.render(i.jsx)});const a=s.firstElementChild;return Ye(a instanceof SVGSVGElement,"Expected an SVG element"),o.unmount(),{svg:a,width:i.width,height:i.height}}async getSvgString(t,r={}){const i=await this.getSvgElement(t,r);return i?{svg:new XMLSerializer().serializeToString(i.svg),width:i.width,height:i.height}:void 0}async getSvg(t,r={}){const i=await this.getSvgElement(t,r);if(i)return i.svg}_updateInputsFromEvent(t){const{pointerVelocity:r,previousScreenPoint:i,previousPagePoint:s,currentScreenPoint:o,currentPagePoint:a}=this.inputs,{screenBounds:l}=this.store.unsafeGetWithoutCapture(cr),{x:c,y:u,z:d}=Z0(()=>this.getCamera()),h=t.point.x-l.x,p=t.point.y-l.y,g=t.point.z??.5;i.setTo(o),s.setTo(a),o.set(h,p);const m=h/d-c,S=p/d-u;isFinite(m)&&isFinite(S)&&a.set(m,S,g),this.inputs.isPen=t.type==="pointer"&&t.isPen,(t.name==="pointer_down"||this.inputs.isPinching)&&(r.set(0,0),this.inputs.originScreenPoint.setTo(o),this.inputs.originPagePoint.setTo(a)),this.run(()=>{var y;this.store.put([{id:dp,typeName:"pointer",x:a.x,y:a.y,lastActivityTimestamp:t.type==="pointer"&&t.pointerId===oP.CAMERA_MOVE?((y=this.store.unsafeGetWithoutCapture(dp))==null?void 0:y.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:t=!0}={}){return this.getIsFocused()?this:(t&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:t=!0}={}){return this.getIsFocused()?(t?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getSnapshot(){return Eoe(this.store)}loadSnapshot(t){return XD(this.store,t),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_flushEventsForTick(t){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const r=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const i of r)this._flushEventForTick(i)}t>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:t}),this.scribbles.tick(t)})}maybeTrackPerformance(t){un.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(t),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}we([te],ge.prototype,"getCanUndo");we([te],ge.prototype,"getCanRedo");we([te],ge.prototype,"getPath");we([te],ge.prototype,"getCurrentTool");we([te],ge.prototype,"getCurrentToolId");we([te],ge.prototype,"getDocumentSettings");we([te],ge.prototype,"getInstanceState");we([te],ge.prototype,"getOpenMenus");we([te],ge.prototype,"getIsMenuOpen");we([te],ge.prototype,"getPageStates");we([te],ge.prototype,"_getPageStatesQuery");we([te],ge.prototype,"getCurrentPageState");we([te],ge.prototype,"_getCurrentPageStateId");we([te],ge.prototype,"getSelectedShapeIds");we([te],ge.prototype,"getSelectedShapes");we([te],ge.prototype,"getOnlySelectedShapeId");we([te],ge.prototype,"getOnlySelectedShape");we([te],ge.prototype,"getSelectionPageBounds");we([te],ge.prototype,"getSelectionRotation");we([te],ge.prototype,"getSelectionRotatedPageBounds");we([te],ge.prototype,"getSelectionRotatedScreenBounds");we([te],ge.prototype,"getFocusedGroupId");we([te],ge.prototype,"getFocusedGroup");we([te],ge.prototype,"getEditingShapeId");we([te],ge.prototype,"getEditingShape");we([te],ge.prototype,"getHoveredShapeId");we([te],ge.prototype,"getHoveredShape");we([te],ge.prototype,"getHintingShapeIds");we([te],ge.prototype,"getHintingShape");we([te],ge.prototype,"getErasingShapeIds");we([te],ge.prototype,"getErasingShapes");we([te],ge.prototype,"_unsafe_getCameraId");we([te],ge.prototype,"getCamera");we([te],ge.prototype,"getViewportPageBoundsForFollowing");we([te],ge.prototype,"getCameraForFollowing");we([te],ge.prototype,"getZoomLevel");we([te],ge.prototype,"getViewportScreenBounds");we([te],ge.prototype,"getViewportScreenCenter");we([te],ge.prototype,"getViewportPageBounds");we([te],ge.prototype,"_getCollaboratorsQuery");we([te],ge.prototype,"getCollaborators");we([te],ge.prototype,"getCollaboratorsOnCurrentPage");we([te],ge.prototype,"getRenderingShapes");we([te],ge.prototype,"_getAllPagesQuery");we([te],ge.prototype,"getPages");we([te],ge.prototype,"getCurrentPageId");we([te],ge.prototype,"getCurrentPageShapeIdsSorted");we([te],ge.prototype,"_getAllAssetsQuery");we([te],ge.prototype,"_getShapeGeometryCache");we([te],ge.prototype,"_getShapeHandlesCache");we([te],ge.prototype,"_getShapePageTransformCache");we([te],ge.prototype,"_getShapePageBoundsCache");we([te],ge.prototype,"_getShapeClipPathCache");we([te],ge.prototype,"_getShapeMaskCache");we([te],ge.prototype,"_getShapeMaskedPageBoundsCache");we([te],ge.prototype,"_notVisibleShapes");we([te],ge.prototype,"getCulledShapes");we([te],ge.prototype,"getCurrentPageBounds");we([te],ge.prototype,"getCurrentPageShapes");we([te],ge.prototype,"getCurrentPageShapesSorted");we([te],ge.prototype,"getCurrentPageRenderingShapesSorted");we([te],ge.prototype,"_getBindingsIndexCache");we([te],ge.prototype,"_getSelectionSharedStyles");we([te({isEqual:(n,e)=>n.equals(e)})],ge.prototype,"getSharedStyles");we([te],ge.prototype,"getSharedOpacity");we([te],ge.prototype,"getIsFocused");function cg(n,e=n.getCurrentPageId()){const t=n.getPage(e).name;n.emit("max-shapes",{name:t,pageId:e,count:n.options.maxShapesPerPage})}function Vs(n,e){if(!e)return n;let t=null;const r=Object.entries(e);for(let i=0,s=r.length;i<s;i++){const[o,a]=r[i];if(a!==void 0&&!(o==="id"||o==="type"||o==="typeName")&&a!==n[o]){if(t||(t={...n}),o==="props"||o==="meta"){t[o]={...n[o]};for(const[l,c]of Object.entries(a))c!==void 0&&(t[o][l]=c);continue}t[o]=a}}return t||n}function ij(n,e,t){const r=n.getShape(e);if(!r)return;t.push(r);const i=n.getSortedChildIdsForParent(e);for(let s=0,o=i.length;s<o;s++)ij(n,i[s],t)}function _P(n,e,t){let r;if(n.run(()=>{const i=n.store.extractingChanges(()=>{const s=new Set,o=new Set;for(const a of e)if(n.getShape(a))for(const c of n.getBindingsInvolvingShape(a)){const u=e.has(c.fromId),d=e.has(c.toId);if(u&&d){s.add(c.id);continue}(!u||!d)&&o.add(c.id)}n.deleteBindings([...o],{isolateShapes:!0});try{r=wl.ok(t(s))}catch(a){r=wl.err(a)}});n.store.applyDiff(cp(i))},{history:"ignore"}),r.ok)return r.value;throw r.error}function RP(n,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:t,y:r}}=e.constraints,i=n.getViewportScreenBounds(),s=ye.From(e.constraints.bounds),o=(i.w-t*2)/s.w,a=(i.h-r*2)/s.h;return{zx:o,zy:a}}function r0(){const n=G(),e=nj();return ee("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??n.user.getIsDarkMode(),[e,n])}const DP="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",jP="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",ug='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Qa(n,e,t,r,i,s=16,o=16){const a=(-t-e)*(at/180),l=Math.sin(a),c=Math.cos(a),u=1*c-1*l,d=1*l+1*c;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${d}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${s} ${o}, pointer`}const Iae=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],Mae={none:()=>"none","ew-resize":(n,e,t)=>Qa(jP,n,0,e,t),"ns-resize":(n,e,t)=>Qa(jP,n,90,e,t),"nesw-resize":(n,e,t)=>Qa(DP,n,0,e,t),"nwse-resize":(n,e,t)=>Qa(DP,n,90,e,t),"nwse-rotate":(n,e,t)=>Qa(ug,n,0,e,t),"nesw-rotate":(n,e,t)=>Qa(ug,n,90,e,t),"senw-rotate":(n,e,t)=>Qa(ug,n,180,e,t),"swne-rotate":(n,e,t)=>Qa(ug,n,270,e,t)};function pi(n,e=0,t="black"){return Mae[n](eie(e),!1,t)}function Aae(){const n=G(),e=Nn(),t=r0();bl("useCursor",()=>{const{type:r,rotation:i}=n.getInstanceState().cursor;if(Iae.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",pi(r,i,t?"white":"black"))},[n,e,t])}function _ae(){const n=G(),e=Nn(),t=r0(),r=ee(un.forceSrgb);Qe.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,r,t])}function sj(n){const e=k.useRef();return k.useLayoutEffect(()=>{e.current=n}),k.useDebugValue(n),k.useCallback((...t)=>{const r=e.current;return Ye(r,"fn does not exist"),r(...t)},[])}function Rae(){const[n,e]=k.useState(0);k.useEffect(()=>e(t=>t+1),[])}const Dae=n=>n.props.src,jae={upload:(n,e)=>Ic.blobToDataUrl(e)};function u4(n){return"schema"in n&&n.schema?n.schema:Fre({shapes:"shapeUtils"in n&&n.shapeUtils?LP(JD(n.shapeUtils)):void 0,bindings:"bindingUtils"in n&&n.bindingUtils?LP(KD(n.bindingUtils)):void 0,migrations:"migrations"in n?n.migrations:void 0})}function gp({initialData:n,defaultName:e="",id:t,assets:r=jae,onMount:i,collaboration:s,...o}={}){const a=u4(o),l=new P6({id:t,schema:a,initialData:n,props:{defaultName:e,assets:{upload:r.upload,resolve:r.resolve??Dae},onMount:c=>{Ye(c instanceof ge),i==null||i(c)},collaboration:s}});if(o.snapshot){if(n)throw new Error("Cannot provide both initialData and snapshot");XD(l,o.snapshot)}return l}function LP(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const Lae=(n,e)=>e.some(t=>n instanceof t);let zP,NP;function zae(){return zP||(zP=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Nae(){return NP||(NP=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const oj=new WeakMap,d4=new WeakMap,aj=new WeakMap,Jx=new WeakMap,G6=new WeakMap;function $ae(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(da(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&oj.set(t,n)}).catch(()=>{}),G6.set(e,n),e}function Fae(n){if(d4.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});d4.set(n,e)}let h4={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return d4.get(n);if(e==="objectStoreNames")return n.objectStoreNames||aj.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return da(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Bae(n){h4=n(h4)}function Uae(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(e2(this),e,...t);return aj.set(r,e.sort?e.sort():[e]),da(r)}:Nae().includes(n)?function(...e){return n.apply(e2(this),e),da(oj.get(this))}:function(...e){return da(n.apply(e2(this),e))}}function Hae(n){return typeof n=="function"?Uae(n):(n instanceof IDBTransaction&&Fae(n),Lae(n,zae())?new Proxy(n,h4):n)}function da(n){if(n instanceof IDBRequest)return $ae(n);if(Jx.has(n))return Jx.get(n);const e=Hae(n);return e!==n&&(Jx.set(n,e),G6.set(e,n)),e}const e2=n=>G6.get(n);function lj(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=da(o);return r&&o.addEventListener("upgradeneeded",l=>{r(da(o.result),l.oldVersion,l.newVersion,da(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function cj(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),da(t).then(()=>{})}const Qae=["get","getKey","getAll","getAllKeys","count"],qae=["put","add","delete","clear"],t2=new Map;function $P(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(t2.get(e))return t2.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=qae.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Qae.includes(t)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return t2.set(e,s),s}Bae(n=>({...n,get:(e,t,r)=>$P(e,t)||n.get(e,t,r),has:(e,t)=>!!$P(e,t)||n.has(e,t)}));const Wae="TLDRAW_DOCUMENT_v2",Vae="TLDRAW_ASSET_STORE_v1",uj="TLDRAW_DB_NAME_INDEX_v2",Ke={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function dj(n){const e=Wae+n;return Xae(e),await lj(e,4,{upgrade(t){t.objectStoreNames.contains(Ke.Records)||t.createObjectStore(Ke.Records),t.objectStoreNames.contains(Ke.Schema)||t.createObjectStore(Ke.Schema),t.objectStoreNames.contains(Ke.SessionState)||t.createObjectStore(Ke.SessionState),t.objectStoreNames.contains(Ke.Assets)||t.createObjectStore(Ke.Assets)}})}async function Gae(n){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(h=>h.name):X6(),t=Vae+n;if(!e.find(h=>h===t))return;const i=await lj(t,1,{upgrade(h){h.objectStoreNames.contains("assets")||h.createObjectStore("assets")}}),s=i.transaction(["assets"],"readonly"),o=s.objectStore("assets"),a=await o.getAllKeys(),l=await Promise.all(a.map(async h=>[h,await o.get(h)]));await s.done;const c=await dj(n),u=c.transaction([Ke.Assets],"readwrite"),d=u.objectStore(Ke.Assets);for(const[h,p]of l)d.put(p,h);await u.done,i.close(),c.close(),await cj(t)}const Ff=class Ff{constructor(e){v(this,"getDbPromise");v(this,"isClosed",!1);v(this,"pendingTransactionSet",new Set);Ff.connectedInstances.add(this),this.getDbPromise=(async()=>(await Gae(e),await dj(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(op)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),Ff.connectedInstances.delete(this))}tx(e,t,r){const i=(async()=>{Ye(!this.isClosed,"db is closed");const o=(await this.getDb()).transaction(t,e);try{return await r(o)}finally{this.isClosed?o.abort():await o.done}})();return this.pendingTransactionSet.add(i),i.finally(()=>this.pendingTransactionSet.delete(i)),i}async load({sessionId:e}={}){return await this.tx("readonly",[Ke.Records,Ke.Schema,Ke.SessionState],async t=>{var l,c;const r=t.objectStore(Ke.Records),i=t.objectStore(Ke.Schema),s=t.objectStore(Ke.SessionState);let o=e?(l=await s.get(e))==null?void 0:l.snapshot:null;return o||(o=(c=(await s.getAll()).sort((d,h)=>d.updatedAt-h.updatedAt).pop())==null?void 0:c.snapshot),{records:await r.getAll(),schema:await i.get(Ke.Schema),sessionStateSnapshot:o}})}async storeChanges({schema:e,changes:t,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[Ke.Records,Ke.Schema,Ke.SessionState],async s=>{const o=s.objectStore(Ke.Records),a=s.objectStore(Ke.Schema),l=s.objectStore(Ke.SessionState);for(const[c,u]of Object.entries(t.added))await o.put(u,c);for(const[c,u]of Object.values(t.updated))await o.put(u,u.id);for(const c of Object.keys(t.removed))await o.delete(c);a.put(e.serialize(),Ke.Schema),i&&r?l.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[Ke.Records,Ke.Schema,Ke.SessionState],async s=>{const o=s.objectStore(Ke.Records),a=s.objectStore(Ke.Schema),l=s.objectStore(Ke.SessionState);await o.clear();for(const[c,u]of Object.entries(t))await o.put(u,c);a.put(e.serialize(),Ke.Schema),i&&r?l.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Ke.SessionState],async e=>{const t=e.objectStore(Ke.SessionState),r=(await t.getAll()).sort((s,o)=>s.updatedAt-o.updatedAt);if(r.length<10){await e.done;return}const i=r.slice(0,r.length-10);for(const{id:s}of i)await t.delete(s)})}async getAsset(e){return await this.tx("readonly",[Ke.Assets],async t=>await t.objectStore(Ke.Assets).get(e))}async storeAsset(e,t){await this.tx("readwrite",[Ke.Assets],async r=>{await r.objectStore(Ke.Assets).put(t,e)})}};v(Ff,"connectedInstances",new Set);let py=Ff;function X6(){const n=JSON.parse(w6(uj)||"[]")??[];return Array.isArray(n)?n:[]}function Xae(n){const e=new Set(X6());e.add(n),b6(uj,JSON.stringify([...e]))}function Kae(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
 If your hard disk is full, try clearing up some space and then reload the page.`)}function Yae(){window.alert(`Oops! We could not access your browser's storageand the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const Zae=350,Jae=1e4,FP=Symbol("UPDATE_INSTANCE_STATE"),ele=n=>n;class tle{constructor(e){v(this,"onmessage")}postMessage(e){}close(){}}const nle=typeof BroadcastChannel>"u"?tle:BroadcastChannel;class rle{constructor(e,{persistenceKey:t,sessionId:r=pp,onLoad:i,onLoadError:s},o=new nle(`tldraw-tab-sync-${t}`)){v(this,"disposables",new Set);v(this,"diffQueue",[]);v(this,"didDispose",!1);v(this,"shouldDoFullDBWrite",!0);v(this,"isReloading",!1);v(this,"persistenceKey");v(this,"sessionId");v(this,"serializedSchema");v(this,"isDebugging",!1);v(this,"documentTypes");v(this,"$sessionStateSnapshot");v(this,"db");v(this,"initTime",Date.now());v(this,"isPersisting",!1);v(this,"didLastWriteError",!1);v(this,"scheduledPersistTimeout",null);this.store=e,this.channel=o,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=r,this.db=new py(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=VD(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(ele({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(FP),this.schedulePersist()},{scope:"session"})),this.connect(i,s),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let r;try{r=await this.db.load({sessionId:this.sessionId})}catch(i){t(i),Yae();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const i=Object.fromEntries(r.records.map(a=>[a.id,a])),s=r.sessionStateSnapshot??Poe(i),o=this.store.schema.migrateStoreSnapshot({store:i,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(o.type==="error"){console.error("failed to migrate store",o),t(new Error(`Failed to migrate store: ${o.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(o.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),s&&GD(this.store,s)}this.channel.onmessage=({data:i})=>{var a,l;this.debug("got message",i);const s=i,o=this.store.schema.getMigrationsSince(s.schema);if(o.ok){if(o.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(l=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||l.call(a);return}s.type==="diff"&&(this.debug("applying diff"),Es(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(s.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;t(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?Jae:Zae))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(Ye(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=Mv(e.filter(r=>r!==FP));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),Kae(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function K6(n){const e=k.useRef(n),[t,r]=k.useState(n);t!==e.current&&r(e.current);const i=k.useCallback(s=>{typeof s=="function"?e.current=s(e.current):e.current=s,r(e.current)},[]);return[t,i]}function ile(n){const[e,t]=K6({status:"loading"});return n=e0(n),k.useEffect(()=>{const{persistenceKey:r,sessionId:i,...s}=n;if(!r){t({status:"not-synced",store:gp(s)});return}t({status:"loading"});const o=new wa,a={upload:async(d,h)=>(await u.db.storeAsset(d.id,h),d.id),resolve:async d=>d.props.src?d.props.src.startsWith("asset:")?await o.get(d,async()=>{const h=await u.db.getAsset(d.id);return h?URL.createObjectURL(h):null}):d.props.src:null,...s.assets},l=gp({...s,assets:a});let c=!1;const u=new rle(l,{sessionId:i,persistenceKey:r,onLoad(){c||t({store:l,status:"synced-local"})},onLoadError(d){c||t({status:"error",error:d})}});return()=>{c=!0,u.close()}},[n,t]),e}function sle(){const n=G(),e=Nn();k.useEffect(()=>{const t=s=>e.style.setProperty("--tl-zoom",s.toString()),r=Y_(t,100),i=new Kd("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?t(n.getZoomLevel()):r(n.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach(),r.cancel()}},[n,e])}function f4(n){const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0,i=n.length;r<i;r++)t[r]=n.charCodeAt(r);return e}function ole(n){const e=atob(n),t=f4(e);return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const ale=5,_m={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4},lle=Math.max(...Object.values(_m)),Zh={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},cle=Object.keys(Zh).length,dg="sales@tldraw.com";class Y6{constructor(e,t,r){v(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");v(this,"isDevelopment");v(this,"isTest");v(this,"isCryptoAvailable");v(this,"state",mn("license state","pending"));this.isTest=!1,this.isDevelopment=this.getIsDevelopment(r),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,C6.enableLicensing.get()?this.getLicenseFromKey(e).then(i=>{const s=ule(i);this.state.set(s?"unlicensed":"licensed")}):this.state.set("licensed")}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[t,r]=e.split("."),[i,s]=t.split("/");if(!i.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${i}'`);const o=await ole(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,new Uint8Array(f4(atob(r))),new Uint8Array(f4(atob(s))))}catch(c){throw console.error(c),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let l;try{l=JSON.parse(atob(s))}catch{throw new Error("Could not parse object")}return l.length>cle&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:l[Zh.ID],hosts:l[Zh.HOSTS],flags:l[Zh.FLAGS],expiryDate:l[Zh.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately."),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{const r=await this.extractLicenseKey(t),i=new Date(r.expiryDate),s=this.isFlagEnabled(r.flags,_m.ANNUAL_LICENSE),o=this.isFlagEnabled(r.flags,_m.PERPETUAL_LICENSE),a={license:r,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(r),expiryDate:i,isAnnualLicense:s,isAnnualLicenseExpired:s&&this.isAnnualLicenseExpired(i),isPerpetualLicense:o,isPerpetualLicenseExpired:o&&this.isPerpetualLicenseExpired(i),isInternalLicense:this.isFlagEnabled(r.flags,_m.INTERNAL_LICENSE)};return this.outputLicenseInfoIfNeeded(a),a}catch(r){return this.outputInvalidLicenseKey(r.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const t=window.location.hostname.toLowerCase();return e.hosts.some(r=>{const i=r.toLowerCase().trim();return i===t||`www.${i}`===t||i===`www.${t}`||r==="*"?!0:r.includes("*")?new RegExp(r.replace(/\*/g,".*?")).test(t):!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+ale+1)}isAnnualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r=new Date>=t;return!r&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${dg} if you would like to renew your license.`]),r}isPerpetualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r={major:new Date(nP.major),minor:new Date(nP.minor)};return r.major>=t||r.minor>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){this.outputMessages(["No tldraw license key provided!",`Please reach out to ${dg} if you would like to license tldraw or if you'd like a trial.`])}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${dg} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${dg} if you would like to use tldraw on other domains.`]),e.license.flags>=lle*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest){this.outputDelimiter();for(const t of e)console.log(`%c${t}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}v(Y6,"className","tl-watermark_SEE-LICENSE");function ule(n){if(!n.isLicenseParseable||!n.isDomainValid&&!n.isDevelopment)return!0;if(n.isPerpetualLicenseExpired||n.isAnnualLicenseExpired){if(n.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const hj=k.createContext({}),dle=()=>k.useContext(hj);function hle({licenseKey:n,children:e}){const[t]=k.useState(()=>new Y6(n));return f.jsx(hj.Provider,{value:t,children:e})}const fle='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',ple=`${al()}/watermarks/watermark-desktop.svg`,hg=`data:image/svg+xml;utf8,${encodeURIComponent(fle)}`;let n2=null;async function gle(n){return n?hg:(n2||(n2=Promise.race([(async()=>{try{const e=await Oo(ple);if(!e.ok)return hg;const t=await e.blob();return URL.createObjectURL(t)}catch{return hg}})(),new Promise(e=>{setTimeout(()=>{e(hg)},3e3)})])),n2)}const mle=Qe.memo(function({forceLocal:e=!1}){const t=hD(),r=G(),i=dle(),s=ee("show watermark",()=>C6.enableLicensing.get()&&r.getViewportScreenBounds().width>760&&i.state.get()==="unlicensed",[r,i]),o=ee("debug mode",()=>r.getInstanceState().isDebugMode,[r]),a=ee("is menu open",()=>r.getIsMenuOpen(),[r]),[l,c]=k.useState(null),u=e||i.isDevelopment;if(k.useEffect(()=>{if(!s)return;let p=!1;return(async()=>{const g=await gle(u);p||c(g)})(),()=>{p=!0}},[u,s]),!s||!l)return null;const d=Y6.className,h=`url('${l}') center 100% / 100% no-repeat`;return f.jsxs(f.Fragment,{children:[f.jsx("style",{children:`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
users. By using this library, you agree to keep the watermark's behavior, 
keeping it visible, unobscured, and available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${d} {
	position: absolute;
	bottom: var(--space-2);
	right: var(--space-2);
	width: 96px;
	height: 32px;
	z-index: 2147483647 !important;
	pointer-events: ${a?"none":"all"};
	background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
	border-radius: 5px;
	padding: 2px;
	box-sizing: content-box;
}

.${d}[data-debug='true'] {
	bottom: 46px;
}

.${d} > a {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: none;
	cursor: inherit;
	color: var(--color-text);
	background-color: currentColor;
	opacity: .28;
}

@media (hover: hover) {
	.${d}:hover {
		background-color: var(--color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}
	.${d}:hover > a {
		animation: delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}
}

@keyframes delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}
`}),f.jsx("div",{className:d,"data-debug":o,draggable:!1,...t,children:f.jsx("a",{href:"https://tldraw.dev",target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:Tn,style:{mask:h,WebkitMask:h}})})]})}),yle=[],vle=[],Sle=[],xle="tl-container",wle=k.memo(function({store:e,components:t,className:r,user:i,...s}){const[o,a]=Qe.useState(null),l=k.useMemo(()=>i??HD(),[i]),c=(t==null?void 0:t.ErrorFallback)===void 0?jD:t==null?void 0:t.ErrorFallback,u={...s,shapeUtils:s.shapeUtils??yle,bindingUtils:s.bindingUtils??vle,tools:s.tools??Sle,components:t};return f.jsx("div",{ref:a,"data-tldraw":aD,draggable:!1,className:Te(`${xle} tl-theme__light`,r),onPointerDown:Tn,tabIndex:-1,children:f.jsx(fp,{fallback:c,onError:d=>v6(d,{tags:{origin:"react.tldraw-before-app"}}),children:o&&f.jsx(hle,{licenseKey:s.licenseKey,children:f.jsx(oie,{container:o,children:f.jsx(uoe,{overrides:t,children:e?e instanceof P6?f.jsx(pj,{...u,store:e,user:l}):f.jsx(fj,{...u,store:e,user:l}):f.jsx(ble,{...u,store:e,user:l})})})})})})});function ble(n){const{defaultName:e,snapshot:t,initialData:r,shapeUtils:i,bindingUtils:s,persistenceKey:o,sessionId:a,user:l,assets:c}=n,u=ile({shapeUtils:i,bindingUtils:s,initialData:r,persistenceKey:o,sessionId:a,defaultName:e,snapshot:t,assets:c});return f.jsx(fj,{...n,store:u,user:l})}const fj=k.memo(function({store:e,user:t,...r}){const i=Nn();k.useLayoutEffect(()=>{t.userPreferences.get().colorScheme==="dark"&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))},[i,t]);const{LoadingScreen:s}=Qt();switch(e.status){case"error":throw e.error;case"loading":return s?f.jsx(s,{}):null}return f.jsx(pj,{...r,store:e.store,user:t})}),r2=()=>document.location.search.includes("tldraw_preserve_focus");function pj({onMount:n,children:e,store:t,tools:r,shapeUtils:i,bindingUtils:s,user:o,initialState:a,autoFocus:l=!0,inferDarkMode:c,cameraOptions:u,options:d,licenseKey:h}){const{ErrorFallback:p}=Qt(),g=Nn(),[m,S]=K6(null),y=k.useRef({autoFocus:l&&!r2(),inferDarkMode:c,initialState:a,cameraOptions:u});k.useLayoutEffect(()=>{y.current={autoFocus:l&&!r2(),inferDarkMode:c,initialState:a,cameraOptions:u}},[l,c,a,u]),k.useLayoutEffect(()=>{const{autoFocus:O,inferDarkMode:T,initialState:E,cameraOptions:C}=y.current,M=new ge({store:t,shapeUtils:i,bindingUtils:s,tools:r,getContainer:()=>g,user:o,initialState:E,autoFocus:O,inferDarkMode:T,cameraOptions:C,options:d,licenseKey:h});return S(M),()=>{M.dispose()}},[s,g,d,i,t,r,o,S,h]),k.useLayoutEffect(()=>{m&&u&&m.setCameraOptions(u)},[m,u]);const x=k.useSyncExternalStore(k.useCallback(O=>m?(m.on("crash",O),()=>m.off("crash",O)):()=>{},[m]),()=>(m==null?void 0:m.getCrashingError())??null);k.useEffect(function(){if(!m)return;function T(){m&&m.focus()}function E(){m&&m.blur()}if(l&&r2())return m.getContainer().addEventListener("pointerdown",T),document.body.addEventListener("pointerdown",E),()=>{var C;(C=m.getContainer())==null||C.removeEventListener("pointerdown",T),document.body.removeEventListener("pointerdown",E)}},[m,l]);const{Canvas:w}=Qt();return m?f.jsx(fp,{fallback:p,onError:O=>m.annotateError(O,{origin:"react.tldraw",willCrashApp:!0}),children:x?f.jsx(kle,{crashingError:x}):f.jsx(Lv.Provider,{value:m,children:f.jsxs(Ole,{onMount:n,children:[e??(w?f.jsx(w,{}):null),f.jsx(mle,{})]})})}):null}function Ole({children:n,onMount:e}){return sle(),Aae(),_ae(),Rae(),mj(t=>{const r=t.store.props.onMount(t),i=e==null?void 0:e(t);return()=>{r==null||r(),i==null||i()}}),n}function kle({crashingError:n}){throw n}function Z6({children:n}){return f.jsx("div",{className:"tl-loading",children:n})}function gj({children:n}){return f.jsx("div",{className:"tl-loading",children:n})}function mj(n){const e=G(),t=sj(r=>{let i;return r.run(()=>{i=n==null?void 0:n(r),r.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,i});Qe.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function Oa({children:n,className:e="",...t}){return f.jsx("div",{...t,className:Te("tl-html-container",e),children:n})}class Rm{constructor(e){this.editor=e}}v(Rm,"props"),v(Rm,"migrations"),v(Rm,"type");function i0(n,e,t={}){const{newPoint:r,handle:i,scaleX:s,scaleY:o}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=t;let d=n.props.w*s,h=n.props.h*o;const p=new b(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=d-a;break}case"top":case"bottom":{p.x=(d-a)/2;break}default:p.x=0}d=a}}else if(p.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-d;break}default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:g,y:m}=p.rot(n.rotation).add(r);return{...n,x:g,y:m,props:{w:Math.min(l,d),h:Math.min(u,h)}}}class th extends Ti{constructor(){super(...arguments);v(this,"onResize",(t,r)=>i0(t,r))}getGeometry(t){return new As({width:t.props.w,height:t.props.h,isFilled:!0})}getHandleSnapGeometry(t){return{points:this.getGeometry(t).bounds.cornersAndCenter}}getInterpolatedProps(t,r,i){return{...r.props,w:Wr(t.props.w,r.props.w,i),h:Wr(t.props.h,r.props.h,i)}}}var ww;let Cle=(ww=class extends Oe{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(ww,"id","idle"),ww);var bw;let Ple=(bw=class extends Oe{constructor(){super(...arguments);v(this,"markId","");v(this,"wasFocusedOnEnter",!1);v(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()});v(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){const{originPagePoint:r}=this.editor.inputs,i=this.parent.shapeType,s=mt();this.markId=`creating:${s}`,this.editor.mark(this.markId),this.editor.createShapes([{id:s,type:i,x:r.x,y:r.y,props:{w:1,h:1}}]).select(s),this.editor.setCurrentTool("select.resizing",{...t,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:t}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const r=this.parent.shapeType,i=mt();this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:r,x:t.x,y:t.y}]);const s=this.editor.getShape(i);if(!s){this.cancel();return}let{w:o,h:a}=s.props;const l=new b(o/2,a/2),c=this.editor.getShapeParentTransform(s);c&&l.rot(-c.rotation());let u=1;this.editor.user.getIsDynamicResizeMode()&&(u=1/this.editor.getZoomLevel(),o*=u,a*=u,l.mul(u));const d=It(s);d.x=s.x-l.x,d.y=s.y-l.y,d.props.w=o,d.props.h=a,"scale"in s.props&&(d.props.scale=u),this.editor.updateShape(d),this.editor.setSelectedShapes([i]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},v(bw,"id","pointing"),bw);class cd extends Oe{constructor(){super(...arguments);v(this,"onCreate")}}v(cd,"id","box"),v(cd,"initial","idle"),v(cd,"children",()=>[Cle,Ple]);function Uv(n){const e=G();return ee("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function Js(n){const e=G();return k.useMemo(function(){const i=c=>{if(c.isKilled)return;if(c.button===L6){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...Zr(c)});return}if(c.button!==0)return;const u=hy(c.currentTarget);function d(){u.removeEventListener("pointerup",d),Yp(u,c)}Kp(u,c),u.addEventListener("pointerup",d),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...Zr(c)}),Tn(c)};let s,o;function a(c){c.isKilled||c.button===0&&(c.clientX===s&&c.clientY===o||(s=c.clientX,o=c.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...Zr(c)})))}return{onPointerDown:i,onPointerMove:a,onPointerUp:c=>{c.isKilled||c.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...Zr(c)})}}},[e,n])}function Tle(n){const[e,t]=k.useState(()=>({store:gp(n),opts:n}));if(!x6(e.opts,n)){const r={store:gp(n),opts:n};return t(r),r.store}return e.store}function Ele(n){const[e,t]=k.useState(()=>({opts:n,schema:u4(n)}));if(!x6(e.opts,n)){const r=u4(n);return t({opts:n,schema:r}),r}return e.schema}const Ile=20,Mle=8;function J6(n,e=Ile){return Math.max(Mle,Math.ceil(n/e))}class Wu extends Kl{constructor(t){super({...t,isFilled:!1,isClosed:!1});v(this,"_center");v(this,"radius");v(this,"start");v(this,"end");v(this,"largeArcFlag");v(this,"sweepFlag");v(this,"measure");v(this,"angleStart");v(this,"angleEnd");const{center:r,sweepFlag:i,largeArcFlag:s,start:o,end:a}=t;if(o.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=b.Angle(r,o),this.angleEnd=b.Angle(r,a),this.radius=b.Dist(r,o),this.measure=tie(this.angleStart,this.angleEnd,i,s),this.start=o,this.end=a,this.sweepFlag=i,this.largeArcFlag=s,this._center=r}nearestPoint(t){const{_center:r,measure:i,radius:s,angleEnd:o,angleStart:a,start:l,end:c}=this,u=i4(i,a,o,r.angle(t));if(u<=0)return l;if(u>=1)return c;const d=r.clone().add(t.clone().sub(r).uni().mul(s));let h,p=1/0,g;for(const m of[l,c,d])g=b.Dist2(t,m),g<p&&(h=m,p=g);if(!h)throw Error("nearest point not found");return h}hitTestLineSegment(t,r){const{_center:i,radius:s,measure:o,angleStart:a,angleEnd:l}=this,c=t0(t,r,i,s);return c===null?!1:c.some(u=>{const d=i4(o,a,l,i.angle(u));return d>=0&&d<=1})}getVertices(){const{_center:t,measure:r,length:i,radius:s,angleStart:o}=this,a=[];for(let l=0,c=J6(Math.abs(i));l<c+1;l++){const u=l/c*r,d=o+u;a.push(Hc(t,s,d))}return a}getSvgPathData(t=!0){const{start:r,end:i,radius:s,largeArcFlag:o,sweepFlag:a}=this;return`${t?`M${r.toFixed()}`:""} A${s} ${s} 0 ${o} ${a} ${i.toFixed()}`}getLength(){return this.measure*this.radius}}class eO extends Kl{constructor(t){super({isClosed:!0,...t});v(this,"_center");v(this,"radius");v(this,"x");v(this,"y");this.config=t;const{x:r=0,y:i=0,radius:s}=t;this.x=r,this.y=i,this._center=new b(s+r,s+i),this.radius=s}getBounds(){return new ye(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:r}=this,i=pt*r,s=[];for(let o=0,a=J6(i);o<a;o++){const l=o/a*pt;s.push(Hc(t,r,l))}return s}nearestPoint(t){const{_center:r,radius:i}=this;return r.equals(t)?b.AddXY(r,i,0):r.clone().add(t.clone().sub(r).uni().mul(i))}hitTestLineSegment(t,r,i=0){const{_center:s,radius:o}=this;return t0(t,r,s,o+i)!==null}getSvgPathData(){const{_center:t,radius:r}=this;return`M${t.x+r},${t.y} a${r},${r} 0 1,0 ${r*2},0a${r},${r} 0 1,0 -${r*2},0`}}class lr extends eh{constructor(t){const{start:r,cp1:i,cp2:s,end:o}=t;super({...t,points:[r,o]});v(this,"a");v(this,"b");v(this,"c");v(this,"d");this.a=r,this.b=i,this.c=s,this.d=o}getVertices(){const t=[],{a:r,b:i,c:s,d:o}=this;for(let a=0,l=10;a<=l;a++){const c=a/l;t.push(new b((1-c)*(1-c)*(1-c)*r.x+3*((1-c)*(1-c))*c*i.x+3*(1-c)*(c*c)*s.x+c*c*c*o.x,(1-c)*(1-c)*(1-c)*r.y+3*((1-c)*(1-c))*c*i.y+3*(1-c)*(c*c)*s.y+c*c*c*o.y))}return t}midPoint(){return lr.GetAtT(this,.5)}nearestPoint(t){let r,i=1/0,s,o;for(const a of this.segments)o=a.nearestPoint(t),s=b.Dist2(o,t),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}getSvgPathData(t=!0){const{a:r,b:i,c:s,d:o}=this;return`${t?`M ${r.toFixed()} `:""} C${i.toFixed()} ${s.toFixed()} ${o.toFixed()}`}static GetAtT(t,r){const{a:i,b:s,c:o,d:a}=t;return new b((1-r)*(1-r)*(1-r)*i.x+3*((1-r)*(1-r))*r*s.x+3*(1-r)*(r*r)*o.x+r*r*r*a.x,(1-r)*(1-r)*(1-r)*i.y+3*((1-r)*(1-r))*r*s.y+3*(1-r)*(r*r)*o.y+r*r*r*a.y)}getLength(t=32){let r,i=this.a,s=0;for(let o=1;o<=t;o++)r=lr.GetAtT(this,o/t),s+=b.Dist(i,r),i=r;return s}}class Ale extends Kl{constructor(t){super({...t,isClosed:!1,isFilled:!1});v(this,"points");v(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,r=t.length,i=r-2,s=1.25;for(let o=0;o<r-1;o++){const a=o===0?t[0]:t[o-1],l=t[o],c=t[o+1],u=o===i?c:t[o+2],d=l,h=o===0?a:new b(l.x+(c.x-a.x)/6*s,l.y+(c.y-a.y)/6*s),p=o===i?c:new b(c.x-(u.x-l.x)/6*s,c.y-(u.y-l.y)/6*s),g=c;this._segments.push(new lr({start:d,cp1:h,cp2:p,end:g}))}}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){const t=this.segments.reduce((r,i)=>r.concat(i.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let r,i=1/0,s,o;for(const a of this.segments)o=a.nearestPoint(t),s=b.Dist2(o,t),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.segments.some(i=>i.hitTestLineSegment(t,r))}getSvgPathData(){let t=this.segments.reduce((r,i,s)=>r+i.getSvgPathData(s===0),"");return this.isClosed&&(t+="Z"),t}}class _le extends Kl{constructor(t){super({...t,isClosed:!0});v(this,"w");v(this,"h");v(this,"_edges");this.config=t;const{width:r,height:i}=t;this.w=r,this.h=i}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let r=0,i=t.length;r<i;r++){const s=t[r],o=t[(r+1)%i];this._edges.push(new oa({start:s,end:o}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),r=Math.max(1,this.h),i=t/2,s=r/2,o=Math.pow(i-s,2)/Math.pow(i+s,2),a=at*(i+s)*(1+3*o/(10+Math.sqrt(4-3*o))),l=J6(a),c=pt/l,u=Math.cos(c),d=Math.sin(c);let h=0,p=1,g=0,m=1;const S=Array(l);for(let y=0;y<l;y++)S[y]=new b(i+i*p,s+s*h),g=d*p+u*h,m=u*p-d*h,h=g,p=m;return S}nearestPoint(t){let r,i=1/0,s,o;for(const a of this.edges)o=a.nearestPoint(t),s=b.Dist2(o,t),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.edges.some(i=>i.hitTestLineSegment(t,r))}getBounds(){return new ye(0,0,this.w,this.h)}getLength(){const{w:t,h:r}=this,i=t/2,s=r/2,o=Math.max(0,i),a=Math.max(0,s);return cD(o,a)}getSvgPathData(t=!1){const{w:r,h:i}=this,s=r/2,o=i/2,a=Math.max(0,s),l=Math.max(0,o);return`${t?`M${s-a},${o}`:""} a${a},${l},0,1,1,${a*2},0a${a},${l},0,1,1,-${a*2},0`}}class Rle extends Kl{constructor(t){super({...t,isClosed:!0});v(this,"w");v(this,"h");v(this,"a");v(this,"b");v(this,"c");v(this,"d");this.config=t;const{width:r,height:i}=t;if(this.w=r,this.h=i,i>r){const s=r/2;this.a=new Wu({start:new b(0,s),end:new b(r,s),center:new b(r/2,s),sweepFlag:1,largeArcFlag:1}),this.b=new oa({start:new b(r,s),end:new b(r,i-s)}),this.c=new Wu({start:new b(r,i-s),end:new b(0,i-s),center:new b(r/2,i-s),sweepFlag:1,largeArcFlag:1}),this.d=new oa({start:new b(0,i-s),end:new b(0,s)})}else{const s=i/2;this.a=new Wu({start:new b(s,i),end:new b(s,0),center:new b(s,s),sweepFlag:1,largeArcFlag:1}),this.b=new oa({start:new b(s,0),end:new b(r-s,0)}),this.c=new Wu({start:new b(r-s,0),end:new b(r-s,i),center:new b(r-s,s),sweepFlag:1,largeArcFlag:1}),this.d=new oa({start:new b(r-s,i),end:new b(s,i)})}}nearestPoint(t){let r,i=1/0,s,o;const{a,b:l,c,d:u}=this;for(const d of[a,l,c,u])o=d.nearestPoint(t),s=b.Dist2(o,t),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){const{a:i,b:s,c:o,d:a}=this;return[i,s,o,a].some(l=>l.hitTestLineSegment(t,r))}getVertices(){const{a:t,b:r,c:i,d:s}=this;return[t,r,i,s].reduce((o,a)=>(o.push(...a.vertices),o),[])}getBounds(){return new ye(0,0,this.w,this.h)}getLength(){const{h:t,w:r}=this;return t>r?(at*(r/2)+(t-r))*2:(at*(t/2)+(r-t))*2}getSvgPathData(){const{a:t,b:r,c:i,d:s}=this;return[t,r,i,s].map((o,a)=>o.getSvgPathData(a===0)).join(" ")+" Z"}}async function Dle({shouldReload:n=!0}={}){une();for(const e of py.connectedInstances)await e.close();await Promise.all(X6().map(e=>cj(e))),cne(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=Dle);function jle(n,e="_blank"){F6.openWindow(n,e)}function Lle({children:n}){const e=G();return ee("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const r=e.getOnlySelectedShape();return r&&e.isShapeOfType(r,"note")}return!1},[e])?f.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null}const{PI:zle}=Math,ud=zle+1e-4;function yj(n,e={}){const{size:t=16,smoothing:r=.5}=e;if(n.length===0||t<=0)return{left:[],right:[]};const i=n[0],s=n[n.length-1],o=s.runningLength,a=Math.pow(t*r,2),l=[],c=[];let u=n[0].vector,d=n[0].point,h=d,p=d,g=h,m=!1,S;for(let y=0;y<n.length;y++){S=n[y];const{point:x,vector:w}=n[y],O=S.vector.dpr(u),T=(y<n.length-1?n[y+1]:n[y]).vector,E=y<n.length-1?T.dpr(S.vector):1,C=O<0&&!m,M=E!==null&&E<.2;if(C||M){if(E>-.62&&o-S.runningLength>S.radius){const D=u.clone().mul(S.radius);u.clone().cpr(T)<0?(p=b.Add(x,D),g=b.Sub(x,D)):(p=b.Sub(x,D),g=b.Add(x,D)),l.push(p),c.push(g)}else{const D=u.clone().mul(S.radius).per(),N=b.Sub(S.input,D);for(let F=1/13,j=0;j<1;j+=F)p=b.RotWith(N,S.input,ud*j),l.push(p),g=b.RotWith(N,S.input,ud+ud*-j),c.push(g)}d=p,h=g,M&&(m=!0);continue}if(m=!1,S===i||S===s){const D=b.Per(w).mul(S.radius);l.push(b.Sub(x,D)),c.push(b.Add(x,D));continue}const A=b.Lrp(T,w,E).per().mul(S.radius);p=b.Sub(x,A),(y<=1||b.Dist2(d,p)>a)&&(l.push(p),d=p),g=b.Add(x,A),(y<=1||b.Dist2(h,g)>a)&&(c.push(g),h=g),u=w}return{left:l,right:c}}function tO(n,e={}){const{size:t=16,start:r={},end:i={},last:s=!1}=e,{cap:o=!0}=r,{cap:a=!0}=i;if(n.length===0||t<=0)return[];const l=n[0],c=n[n.length-1],u=c.runningLength,d=r.taper===!1?0:r.taper===!0?Math.max(t,u):r.taper,h=i.taper===!1?0:i.taper===!0?Math.max(t,u):i.taper,{left:p,right:g}=yj(n,e),m=l.point,S=n.length>1?n[n.length-1].point:b.AddXY(l.point,1,1);if(n.length===1&&(!(d||h)||s)){const O=b.Add(m,b.Sub(m,S).uni().per().mul(-l.radius)),T=[];for(let E=1/13,C=E;C<=1;C+=E)T.push(b.RotWith(O,m,ud*2*C));return T}const y=[];if(!(d||h&&n.length===1))if(o)for(let O=1/8,T=O;T<=1;T+=O){const E=b.RotWith(g[0],m,ud*T);y.push(E)}else{const O=b.Sub(p[0],g[0]),T=b.Mul(O,.5),E=b.Mul(O,.51);y.push(b.Sub(m,T),b.Sub(m,E),b.Add(m,E),b.Add(m,T))}const x=[],w=c.vector.clone().per().neg();if(h||d&&n.length===1)x.push(S);else if(a){const O=b.Add(S,b.Mul(w,c.radius));for(let T=1/29,E=T;E<1;E+=T)x.push(b.RotWith(O,S,ud*3*E))}else x.push(b.Add(S,b.Mul(w,c.radius)),b.Add(S,b.Mul(w,c.radius*.99)),b.Sub(S,b.Mul(w,c.radius*.99)),b.Sub(S,b.Mul(w,c.radius)));return p.concat(x,g.reverse(),y)}const Nle=.025,$le=.01;function Po(n,e={}){var S;const{streamline:t=.5,size:r=16,simulatePressure:i=!1}=e;if(n.length===0)return[];const s=.15+(1-t)*.85;let o=n.map(b.From),a=0;if(!i){let y=o[0];for(;y&&!(y.z>=Nle);)o.shift(),y=o[0]}if(!i){let y=o[o.length-1];for(;y&&!(y.z>=$le);)o.pop(),y=o[o.length-1]}if(o.length===0)return[{point:b.From(n[0]),input:b.From(n[0]),pressure:i?.5:.15,vector:new b(1,1),distance:0,runningLength:0,radius:1}];let l=o[1];for(;l&&!(b.Dist2(l,o[0])>(r/3)**2);)o[0].z=Math.max(o[0].z,l.z),o.splice(1,1),l=o[1];const c=o.pop();for(l=o[o.length-1];l&&!(b.Dist2(l,c)>(r/3)**2);)o.pop(),l=o[o.length-1],a++;o.push(c);const u=e.last||!e.simulatePressure||o.length>1&&b.Dist2(o[o.length-1],o[o.length-2])<r**2||a>0;if(o.length===2&&e.simulatePressure){const y=o[1];o=o.slice(0,-1);for(let x=1;x<5;x++){const w=b.Lrp(o[0],y,x/4);w.z=(o[0].z+(y.z-o[0].z))*x/4,o.push(w)}}const d=[{point:o[0],input:o[0],pressure:i?.5:o[0].z,vector:new b(1,1),distance:0,runningLength:0,radius:1}];let h=0,p=d[0],g,m;u&&t>0&&o.push(o[o.length-1].clone());for(let y=1,x=o.length;y<x;y++)g=!s||e.last&&y===x-1?o[y].clone():o[y].clone().lrp(p.point,1-s),!p.point.equals(g)&&(m=b.Dist(g,p.point),h+=m,!(y<4&&h<r)&&(p={input:o[y],point:g,pressure:i?.5:o[y].z,vector:b.Sub(p.point,g).uni(),distance:m,runningLength:h,radius:1},d.push(p)));if((S=d[1])!=null&&S.vector&&(d[0].vector=d[1].vector.clone()),h<1){const y=Math.max(.5,...d.map(x=>x.pressure));d.forEach(x=>x.pressure=y)}return d}const{min:qa}=Math,i2=.275;function Hv(n,e){const{size:t=16,thinning:r=.5,simulatePressure:i=!0,easing:s=S=>S,start:o={},end:a={}}=e,{easing:l=Rn.easeOutQuad}=o,{easing:c=Rn.easeOutCubic}=a,u=n[n.length-1].runningLength;let d,h=n[0].pressure,p;if(!i&&u<t){const S=n.reduce((y,x)=>Math.max(y,x.pressure),.5);return n.forEach(y=>{y.pressure=S,y.radius=t*s(.5-r*(.5-y.pressure))}),n}else{let S;for(let y=0,x=n.length;y<x&&(p=n[y],!(p.runningLength>t*5));y++){const w=qa(1,p.distance/t);if(i){const O=qa(1,1-w);S=qa(1,h+(O-h)*(w*i2))}else S=qa(1,h+(p.pressure-h)*.5);h=h+(S-h)*.5}for(let y=0;y<n.length;y++){if(p=n[y],r){let{pressure:x}=p;const w=qa(1,p.distance/t);if(i){const O=qa(1,1-w);x=qa(1,h+(O-h)*(w*i2))}else x=qa(1,h+(x-h)*(w*i2));p.radius=t*s(.5-r*(.5-x)),h=x}else p.radius=t/2;d===void 0&&(d=p.radius)}}const g=o.taper===!1?0:o.taper===!0?Math.max(t,u):o.taper,m=a.taper===!1?0:a.taper===!0?Math.max(t,u):a.taper;if(g||m)for(let S=0;S<n.length;S++){p=n[S];const{runningLength:y}=p,x=y<g?l(y/g):1,w=u-y<m?c((u-y)/m):1;p.radius=Math.max(.01,p.radius*Math.min(x,w))}return n}function Fle(n,e={}){return tO(Hv(Po(n,e),e),e)}function BP({scribble:n,zoom:e,color:t,opacity:r,className:i}){if(!n.points.length)return null;const s=Fle(n.points,{size:n.size/e,start:{taper:n.taper,easing:Rn.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let o;if(s.length<4){const a=n.size/e/2,{x:l,y:c}=n.points[n.points.length-1];o=`M ${l-a},${c} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else o=N6(s);return f.jsx("svg",{className:i&&Te("tl-overlays__item",i),children:f.jsx("path",{className:"tl-scribble",d:o,fill:t??`var(--color-${n.color})`,opacity:r??n.opacity})})}const Ble=({bounds:n,rotation:e})=>{const t=G();return ee("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?f.jsx(MD,{bounds:n,rotation:e}):null};function Da(){const n=G();return ee("isReadonlyMode",()=>n.getInstanceState().isReadonly,[n])}function Ule({size:n,width:e,height:t,hideAlternateHandles:r}){const i=q(n/3),s=i/2;return f.jsxs("svg",{className:"tl-overlays__item",children:[f.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${q(0-s)},${q(n)} 
						${q(0-s)},${q(0-s)} 
						${q(n)},${q(0-s)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),f.jsx("line",{className:Te("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:q(e/2-n),y1:q(0-s),x2:q(e/2+n),y2:q(0-s),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),f.jsx("polyline",{className:Te("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${q(e-n)},${q(0-s)} 
						${q(e+s)},${q(0-s)} 
						${q(e+s)},${q(n)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),f.jsx("line",{className:Te("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:q(e+s),y1:q(t/2-n),x2:q(e+s),y2:q(t/2+n),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),f.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${q(e+s)},${q(t-n)} 
						${q(e+s)},${q(t+s)}
						${q(e-n)},${q(t+s)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),f.jsx("line",{className:Te("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:q(e/2-n),y1:q(t+s),x2:q(e/2+n),y2:q(t+s),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),f.jsx("polyline",{className:Te("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${q(0+n)},${q(t+s)} 
						${q(0-s)},${q(t+s)}
						${q(0-s)},${q(t-n)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),f.jsx("line",{className:Te("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:q(0-s),y1:q(t/2-n),x2:q(0-s),y2:q(t/2+n),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const Hle=zn(function({bounds:e,rotation:t}){const r=G(),i=k.useRef(null),s=Da(),o=Js("top"),a=Js("right"),l=Js("bottom"),c=Js("left"),u=Js("top_left"),d=Js("top_right"),h=Js("bottom_right"),p=Js("bottom_left"),g=!r.getIsMenuOpen()&&r.getInstanceState().cursor.type==="default",m=r.getInstanceState().isCoarsePointer,S=r.getOnlySelectedShape(),y=S&&r.isShapeOrAncestorLocked(S),x=S?r.getShapeUtil(S).expandSelectionOutlinePx(S):0;if(Jd(i,e==null?void 0:e.x,e==null?void 0:e.y,1,r.getSelectionRotation(),{x:-x,y:-x}),!e)return null;e=e.clone().expandBy(x).zeroFix();const w=r.getZoomLevel(),O=r.getInstanceState().isChangingStyle,T=e.width,E=e.height,C=8/w,M=T<C*2,A=E<C*2,D=T<C*4,N=E<C*4,F=T<C*5,j=E<C*5,L=m?1.75:1,U=6/w*L,Y=(D?U/2:U)*(L*.75),V=(N?U/2:U)*(L*.75),W=(S?!r.getShapeUtil(S).hideSelectionBoundsFg(S):!0)&&!O;let J=W&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||W&&r.isIn("select.resizing")&&S&&r.isShapeOfType(S,"text");S&&J&&r.environment.isFirefox&&r.isShapeOfType(S,"embed")&&(J=!1);const ne=r.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!O&&!s,le=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!O&&!s,ue=!m&&!(M||A)&&(le||ne)&&(S?!r.getShapeUtil(S).hideRotateHandle(S):!0)&&!y,Pe=m&&(!D||!N)&&(le||ne)&&(S?!r.getShapeUtil(S).hideRotateHandle(S):!0)&&!y,je=le&&(S?r.getShapeUtil(S).canResize(S)&&!r.getShapeUtil(S).hideResizeHandles(S):!0)&&!ne&&!y,he=M||A,et=M&&A,Ue=F||j,ct=je||ne,Je=!ue,vt=!le||!Pe,ut=!le||!ct,wr=!le||!ct||he,xn=!le||!ct||he,In=!le||!ct||et&&!ne;let Bt=!0,wn=!0;if(ne)Bt=Ue,wn=Ue;else if(je){Bt=he||et||m;const di=m&&S&&S.type==="text";wn=Bt&&!di}const ui=Math.min(24/w,E-V*3),Hs=le&&m&&S&&r.isShapeOfType(S,"text")&&ui*w>=4;return f.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:f.jsxs("g",{ref:i,children:[J&&f.jsx("rect",{className:"tl-selection__fg__outline",width:q(T),height:q(E)}),f.jsx(fg,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:U,corner:"top_left_rotate",cursor:g?pi("nwse-rotate",t):void 0,isHidden:Je}),f.jsx(fg,{"data-testid":"selection.rotate.top-right",cx:T+U*3,cy:0,targetSize:U,corner:"top_right_rotate",cursor:g?pi("nesw-rotate",t):void 0,isHidden:Je}),f.jsx(fg,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:E+U*3,targetSize:U,corner:"bottom_left_rotate",cursor:g?pi("swne-rotate",t):void 0,isHidden:Je}),f.jsx(fg,{"data-testid":"selection.rotate.bottom-right",cx:T+U*3,cy:E+U*3,targetSize:U,corner:"bottom_right_rotate",cursor:g?pi("senw-rotate",t):void 0,isHidden:Je}),f.jsx(qle,{"data-testid":"selection.rotate.mobile",cx:D?-U*1.5:T/2,cy:D?E/2:-U*1.5,size:C,isHidden:vt}),f.jsx("rect",{className:Te("tl-transparent",{"tl-hidden":Bt}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:q(0-(N?V*2:V)),width:q(T),height:q(Math.max(1,V*2)),style:g?{cursor:pi("ns-resize",t)}:void 0,...o}),f.jsx("rect",{className:Te("tl-transparent",{"tl-hidden":wn}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:q(T-(D?0:Y)),y:0,height:q(E),width:q(Math.max(1,Y*2)),style:g?{cursor:pi("ew-resize",t)}:void 0,...a}),f.jsx("rect",{className:Te("tl-transparent",{"tl-hidden":Bt}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:q(E-(N?0:V)),width:q(T),height:q(Math.max(1,V*2)),style:g?{cursor:pi("ns-resize",t)}:void 0,...l}),f.jsx("rect",{className:Te("tl-transparent",{"tl-hidden":wn}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:q(0-(D?Y*2:Y)),y:0,height:q(E),width:q(Math.max(1,Y*2)),style:g?{cursor:pi("ew-resize",t)}:void 0,...c}),f.jsx("rect",{className:Te("tl-transparent",{"tl-hidden":ut}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:q(0-(D?Y*2:Y*1.5)),y:q(0-(N?V*2:V*1.5)),width:q(Y*3),height:q(V*3),style:g?{cursor:pi("nwse-resize",t)}:void 0,...u}),f.jsx("rect",{className:Te("tl-transparent",{"tl-hidden":wr}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:q(T-(D?0:Y*1.5)),y:q(0-(N?V*2:V*1.5)),width:q(Y*3),height:q(V*3),style:g?{cursor:pi("nesw-resize",t)}:void 0,...d}),f.jsx("rect",{className:Te("tl-transparent",{"tl-hidden":In}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:q(T-(D?Y:Y*1.5)),y:q(E-(N?V:V*1.5)),width:q(Y*3),height:q(V*3),style:g?{cursor:pi("nwse-resize",t)}:void 0,...h}),f.jsx("rect",{className:Te("tl-transparent",{"tl-hidden":xn}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:q(0-(D?Y*3:Y*1.5)),y:q(E-(N?0:V*1.5)),width:q(Y*3),height:q(V*3),style:g?{cursor:pi("nesw-resize",t)}:void 0,...p}),je&&f.jsxs(f.Fragment,{children:[f.jsx("rect",{"data-testid":"selection.resize.top-left",className:Te("tl-corner-handle",{"tl-hidden":ut}),"aria-label":"top_left handle",x:q(0-C/2),y:q(0-C/2),width:q(C),height:q(C)}),f.jsx("rect",{"data-testid":"selection.resize.top-right",className:Te("tl-corner-handle",{"tl-hidden":wr}),"aria-label":"top_right handle",x:q(T-C/2),y:q(0-C/2),width:q(C),height:q(C)}),f.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:Te("tl-corner-handle",{"tl-hidden":In}),"aria-label":"bottom_right handle",x:q(T-C/2),y:q(E-C/2),width:q(C),height:q(C)}),f.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:Te("tl-corner-handle",{"tl-hidden":xn}),"aria-label":"bottom_left handle",x:q(0-C/2),y:q(E-C/2),width:q(C),height:q(C)})]}),Hs&&f.jsxs(f.Fragment,{children:[f.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:q(0-C/4),y:q(E/2-ui/2),rx:C/4,width:q(C/2),height:q(ui)}),f.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:C/4,x:q(T-C/4),y:q(E/2-ui/2),width:q(C/2),height:q(ui)})]}),ne&&f.jsx(Ule,{size:C,width:T,height:E,hideAlternateHandles:Ue})]})})}),fg=function({cx:e,cy:t,targetSize:r,corner:i,cursor:s,isHidden:o,"data-testid":a}){const l=Js(i);return f.jsx("rect",{className:Te("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,"aria-label":`${i} target`,pointerEvents:"all",x:q(e-r*3),y:q(t-r*3),width:q(Math.max(1,r*3)),height:q(Math.max(1,r*3)),cursor:s,...l})},Qle=Math.sqrt(Math.PI),qle=function({cx:e,cy:t,size:r,isHidden:i,"data-testid":s}){const o=Js("mobile_rotate"),a=G(),l=ee("zoom level",()=>a.getZoomLevel(),[a]),c=Math.max(14*(1/l),20/Math.max(1,l));return f.jsxs("g",{children:[f.jsx("circle",{"data-testid":s,pointerEvents:"all",className:Te("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:e,cy:t,r:c,...o}),f.jsx("circle",{className:Te("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:e,cy:t,r:r/Qle})]})};function Wle(){const n=G();return ee("is in a valid select state",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[n])?f.jsx(AD,{}):null}function p4(n,e,t){const{arrowheadStart:r,arrowheadEnd:i}=e.props,s=Vu(n,e,t),o=s.start.clone(),a=s.end.clone(),l=b.Med(o,a);if(b.Equals(o,a))return{bindings:t,isStraight:!0,start:{handle:o,point:o,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:!1,length:0};const c=b.Sub(a,o).uni(),u=gy(n,e,"start"),d=gy(n,e,"end"),h=n.getShapePageTransform(e);UP(a,s.start,h,d),UP(o,s.end,h,u);let p=0,g=0,m=0,S=0,y=Gu*e.props.scale;const x=u&&d&&u.shape===d.shape,w=u&&d?nO(n,u.shape.id,d.shape.id):"safe";w==="safe"&&u&&d&&!x&&!u.isExact&&!d.isExact&&(d.didIntersect&&!u.didIntersect?u.isClosed&&o.setTo(a.clone().add(c.clone().mul(Gu*e.props.scale))):d.didIntersect||d.isClosed&&a.setTo(o.clone().sub(c.clone().mul(Gu*e.props.scale))));const O=b.Sub(a,o),T=b.Len(O)?O.uni():b.From(O),E=!b.Equals(T,c);x||(w!=="start-contains-end"&&u&&r!=="none"&&!u.isExact&&(m=ll[e.props.size]/2+("size"in u.shape.props?ll[u.shape.props.size]/2:0),p=(my+m)*e.props.scale,y+=m*e.props.scale),w!=="end-contains-start"&&d&&i!=="none"&&!d.isExact&&(S=ll[e.props.size]/2+("size"in d.shape.props?ll[d.shape.props.size]/2:0),g=(my+S)*e.props.scale,y+=S*e.props.scale));const C=o.clone().add(T.clone().mul(p*(E?-1:1))),M=a.clone().sub(T.clone().mul(g*(E?-1:1)));b.DistMin(C,M,y)&&(p!==0&&g!==0?(p*=-1.5,g*=-1.5):p!==0?p*=-1:g!==0&&(g*=-1)),o.add(T.clone().mul(p*(E?-1:1))),a.sub(T.clone().mul(g*(E?-1:1))),E?(u&&d&&a.setTo(b.Add(o,T.clone().mul(-Gu*e.props.scale))),l.setTo(b.Med(s.start,s.end))):l.setTo(b.Med(o,a));const A=b.Dist(o,a);return{bindings:t,isStraight:!0,start:{handle:s.start,point:o,arrowhead:e.props.arrowheadStart},end:{handle:s.end,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:A>0,length:A}}function UP(n,e,t,r){if(r===void 0||r.isExact)return;const i=ke.applyToPoint(t,e),s=ke.applyToPoint(t,n),o=ke.applyToPoint(ke.Inverse(r.transform),i),a=ke.applyToPoint(ke.Inverse(r.transform),s),l=r.isClosed,u=(l?Q6:Ioe)(o,a,r.outline);let d;if(u!==null&&(d=u.sort((g,m)=>b.Dist2(g,o)-b.Dist2(m,o))[0]??(l?void 0:a)),d===void 0)return;const h=ke.applyToPoint(r.transform,d),p=ke.applyToPoint(ke.Inverse(t),h);n.setTo(p),r.didIntersect=!0}function Vle(n,e,t){const{arrowheadEnd:r,arrowheadStart:i}=e.props,s=e.props.bend;if(Math.abs(s)>Math.abs(e.props.bend*(Zle*e.props.scale)))return p4(n,e,t);const o=Vu(n,e,t),a=b.Med(o.start,o.end),l=b.Sub(o.end,o.start),c=b.Len(l)?l.uni():b.From(l),u=b.Add(a,c.per().mul(-s)),d=gy(n,e,"start"),h=gy(n,e,"end"),p=o.start.clone(),g=o.end.clone(),m=u.clone();if(b.Equals(p,g))return{bindings:t,isStraight:!0,start:{handle:p,point:p,arrowhead:e.props.arrowheadStart},end:{handle:g,point:g,arrowhead:e.props.arrowheadEnd},middle:m,isValid:!1,length:0};const S=e.props.bend<0,y=S?Xp:uD,x=HP(p,g,m),w=b.Angle(x.center,p),O=b.Angle(x.center,g),T=y(w,O);if(x.length===0||x.size===0||!iP(x.length)||!iP(x.size))return p4(n,e,t);const E=p.clone(),C=g.clone(),M=m.clone(),A=n.getShapePageTransform(e);let D=0,N=0,F=Gu*e.props.scale;if(d&&!d.isExact){const ne=ke.applyToPoint(A,E),le=ke.applyToPoint(A,x.center),ue=ke.applyToPoint(A,C),Pe=ke.Inverse(d.transform),je=ke.applyToPoint(Pe,ne),he=ke.applyToPoint(Pe,le),et=ke.applyToPoint(Pe,ue),{isClosed:Ue}=d,ct=Ue?l4:CP;let Je,vt=ct(he,x.radius,d.outline);if(vt){const ut=he.angle(je),wr=he.angle(et),xn=y(ut,wr);vt=vt.filter(Bt=>y(ut,he.angle(Bt))<=xn);const In=xn*.25;vt.sort(Ue?(Bt,wn)=>Math.abs(y(ut,he.angle(Bt))-In)<Math.abs(y(ut,he.angle(wn))-In)?-1:1:(Bt,wn)=>y(ut,he.angle(Bt))<y(ut,he.angle(wn))?-1:1),Je=vt[0]??(Ue?void 0:je)}else Je=Ue?void 0:je;if(Je&&(E.setTo(n.getPointInShapeSpace(e,ke.applyToPoint(d.transform,Je))),d.didIntersect=!0,i!=="none")){const ut=ll[e.props.size]/2+("size"in d.shape.props?ll[d.shape.props.size]/2:0);D=(my+ut)*e.props.scale,F+=ut*e.props.scale}}if(h&&!h.isExact){const ne=ke.applyToPoint(A,E),le=ke.applyToPoint(A,C),ue=ke.applyToPoint(A,x.center),Pe=ke.Inverse(h.transform),je=ke.applyToPoint(Pe,ne),he=ke.applyToPoint(Pe,ue),et=ke.applyToPoint(Pe,le),Ue=h.isClosed,ct=Ue?l4:CP;let Je,vt=ct(he,x.radius,h.outline);if(vt){const ut=he.angle(je),wr=he.angle(et),xn=y(ut,wr),In=xn*.75;vt=vt.filter(Bt=>y(ut,he.angle(Bt))<=xn),vt.sort(Ue?(Bt,wn)=>Math.abs(y(ut,he.angle(Bt))-In)<Math.abs(y(ut,he.angle(wn))-In)?-1:1:(Bt,wn)=>y(ut,he.angle(Bt))<y(ut,he.angle(wn))?-1:1),vt[0]?Je=vt[0]:Je=Ue?void 0:et}else Je=Ue?void 0:et;if(Je&&(C.setTo(n.getPointInShapeSpace(e,ke.applyToPoint(h.transform,Je))),h.didIntersect=!0,r!=="none")){const ut=ll[e.props.size]/2+("size"in h.shape.props?ll[h.shape.props.size]/2:0);N=(my+ut)*e.props.scale,F+=ut*e.props.scale}}let j=b.Angle(x.center,E),L=b.Angle(x.center,C),U=y(j,L),Y=U*x.radius;const V=E.clone(),W=C.clone();if(D!==0&&V.setTo(x.center).add(b.FromAngle(j+U*(D/Y*(S?1:-1))).mul(x.radius)),N!==0&&W.setTo(x.center).add(b.FromAngle(L+U*(N/Y*(S?-1:1))).mul(x.radius)),b.DistMin(V,W,F)&&(D!==0&&N!==0?(D*=-1.5,N*=-1.5):D!==0?D*=-2:N!==0&&(N*=-2)),D!==0&&E.setTo(x.center).add(b.FromAngle(j+U*(D/Y*(S?1:-1))).mul(x.radius)),N!==0&&C.setTo(x.center).add(b.FromAngle(L+U*(N/Y*(S?-1:1))).mul(x.radius)),d&&h&&!d.isExact&&!h.isExact){j=b.Angle(x.center,E),L=b.Angle(x.center,C),U=y(j,L),Y=U*x.radius;const ne=nO(n,d.shape.id,h.shape.id);ne==="double-bound"&&Y<30?(E.setTo(p),C.setTo(g),M.setTo(m)):ne==="safe"&&(d&&!d.didIntersect&&E.setTo(p),(h&&!h.didIntersect||y(w,j)>y(w,L))&&C.setTo(x.center).add(b.FromAngle(j+U*(Math.min(.9,Gu*e.props.scale/Y)*(S?1:-1))).mul(x.radius)))}Gle(x.center,x.radius,E,C,M,T,S),E.equals(C)&&(E.setTo(M.clone().addXY(1,1)),C.setTo(M.clone().subXY(1,1))),p.setTo(E),g.setTo(C),m.setTo(M);const J=HP(p,g,m);return{bindings:t,isStraight:!1,start:{point:p,handle:o.start,arrowhead:e.props.arrowheadStart},end:{point:g,handle:o.end,arrowhead:e.props.arrowheadEnd},middle:m,handleArc:x,bodyArc:J,isValid:J.length!==0&&isFinite(J.center.x)&&isFinite(J.center.y)}}function HP(n,e,t){const r=j6(n,e,t),i=b.Dist(r,n),s=+b.Clockwise(n,t,e),o=((n.y-e.y)**2+(n.x-e.x)**2)**.5,a=((e.y-t.y)**2+(e.x-t.x)**2)**.5,l=((t.y-n.y)**2+(t.x-n.x)**2)**.5,c=Math.acos((a*a+l*l-o*o)/(2*a*l))*2,u=+(at>c),d=(pt-c)*(s?1:-1),h=d*i;return{center:r,radius:i,size:d,length:h,largeArcFlag:u,sweepFlag:s}}function Gle(n,e,t,r,i,s,o){const a=b.Angle(n,t),l=b.Angle(n,r);let c=Xp(a,l);if(o||(c=pt-c),i.setTo(n).add(b.FromAngle(a+c*(.5*(o?1:-1))).mul(e)),c>s){i.rotWith(n,at);const u=r.clone();r.setTo(t),t.setTo(u)}}const Xle=8;function Kle(n){return Math.abs(n.props.bend)<Xle*n.props.scale}function gy(n,e,t){const r=n.getBindingsFromShape(e,"arrow").find(l=>l.props.terminal===t);if(!r)return;const i=n.getShape(r.toId);if(!i)return;const s=n.getShapePageTransform(i),o=n.getShapeGeometry(i),a=o instanceof Ms?o.children[0].vertices:o.vertices;return{shape:i,transform:s,isClosed:o.isClosed,isExact:r.props.isExact,didIntersect:!1,outline:a}}function QP(n,e,t,r){const i=n.getShape(t.toId);if(i){const{point:s,size:o}=n.getShapeGeometry(i).bounds,a=b.Add(s,b.MulV(t.props.isPrecise||r?t.props.normalizedAnchor:{x:.5,y:.5},o)),l=ke.applyToPoint(n.getShapePageTransform(i),a);return ke.applyToPoint(ke.Inverse(e),l)}else return new b(0,0)}function Xr(n,e){const t=n.getBindingsFromShape(e,"arrow");return{start:t.find(r=>r.props.terminal==="start"),end:t.find(r=>r.props.terminal==="end")}}const Yle=Ene("arrow info",(n,e)=>{const t=Xr(n,e);return Kle(e)?p4(n,e,t):Vle(n,e,t)});function co(n,e){const t=typeof e=="string"?e:e.id;return Yle.get(n,t)}function Vu(n,e,t){var a,l;const r=n.getShapePageTransform(e),i=nO(n,(a=t.start)==null?void 0:a.toId,(l=t.end)==null?void 0:l.toId),s=t.start?QP(n,r,t.start,i==="double-bound"||i==="start-contains-end"):b.From(e.props.start),o=t.end?QP(n,r,t.end,i==="double-bound"||i==="end-contains-start"):b.From(e.props.end);return{start:s,end:o}}function Ah(n,e,t,r){const i=typeof e=="string"?e:e.id,s=typeof t=="string"?t:t.id,o=n.getBindingsFromShape(i,"arrow").filter(l=>l.props.terminal===r.terminal);o.length>1&&n.deleteBindings(o.slice(1));const a=o[0];a?n.updateBinding({...a,toId:s,props:r}):n.createBinding({type:"arrow",fromId:i,toId:s,props:r})}function Dm(n,e,t){const r=n.getBindingsFromShape(e,"arrow").filter(i=>i.props.terminal===t);n.deleteBindings(r)}const Gu=10,my=10,Zle=10,ll={s:2,m:3.5,l:5,xl:10};function nO(n,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const r=n.getShapePageBounds(e),i=n.getShapePageBounds(t);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}class jm extends Rm{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){s2(this.editor,this.editor.getShape(e.fromId))}onAfterChange({bindingAfter:e}){s2(this.editor,this.editor.getShape(e.fromId))}onAfterChangeFromShape({shapeAfter:e}){s2(this.editor,e)}onAfterChangeToShape({binding:e}){vj(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const t=this.editor.getShape(e.fromId);t&&yy({editor:this.editor,arrow:t,terminal:e.props.terminal})}}v(jm,"type","arrow"),v(jm,"props",MR),v(jm,"migrations",AR);function vj(n,e){var S;const t=n.getShape(e);if(!t)return;const r=Xr(n,t),{start:i,end:s}=r,o=i?n.getShape(i.toId):void 0,a=s?n.getShape(s.toId):void 0,l=n.getAncestorPageId(t);if(!l)return;let c;if(o&&a)c=n.findCommonAncestor([o,a])??l;else if(o||a){const y=(S=o||a)==null?void 0:S.parentId;y&&y===t.parentId?c=t.parentId:c=l}else return;c&&c!==t.parentId&&n.reparentShapes([e],c);const u=n.getShape(e);if(!u)throw Error("no reparented arrow");const d=n.getShapeNearestSibling(u,o),h=n.getShapeNearestSibling(u,a);let p;if(d&&h)p=d.index>h.index?d:h;else if(d&&!h)p=d;else if(h&&!d)p=h;else return;let g;const m=n.getSortedChildIdsForParent(p.parentId).map(y=>n.getShape(y)).filter(y=>y.index>p.index);if(m.length){const y=m.find(x=>x.type!=="arrow");if(u.index>p.index&&(!y||u.index<y.index))return;g=ap(p.index,m[0].index)}else g=bs(p.index);g!==u.index&&n.updateShapes([{id:e,type:"arrow",index:g}])}function s2(n,e){const t=Xr(n,e);for(const r of["start","end"]){const i=t[r];if(!i)continue;const s=n.getShape(i.toId),o=n.getAncestorPageId(e)===n.getAncestorPageId(s);(!s||!o)&&yy({editor:n,arrow:e,terminal:r,unbind:!0})}vj(n,e.id)}function yy({editor:n,arrow:e,terminal:t,unbind:r=!1,useHandle:i=!1}){const s=co(n,e);if(!s)throw new Error("expected arrow info");const o=i?s.start.handle:s.start.point,a=i?s.end.handle:s.end.point,l=t==="start"?o:a,c={id:e.id,type:"arrow",props:{[t]:{x:l.x,y:l.y},bend:e.props.bend}};if(!s.isStraight){const u=t==="start"?o:s.start.handle,d=t==="end"?a:s.end.handle,h=b.Med(u,d),p=b.Sub(u,d).per().uni().mul(s.handleArc.radius*2*Math.sign(e.props.bend)),g=t0(s.handleArc.center,b.Add(h,p),s.handleArc.center,s.handleArc.radius);Ye((g==null?void 0:g.length)===1);const m=b.Dist(h,g[0])*Math.sign(e.props.bend);Ol(m,c.props.bend)||(c.props.bend=m)}n.updateShape(c),r&&Dm(n,e,t)}const Sj=[jm],Yn={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Dn={s:2,m:3.5,l:5,xl:10},Ed={s:18,m:24,l:36,xl:44},ha={s:18,m:22,l:26,xl:32},Jle={s:18,m:20,l:24,xl:28},wo={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},ece=20,tce=4.25,Bi=16;/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function nce(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],l=!0,c=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw i}}return a}}function qP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function gi(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?qP(Object(t),!0).forEach(function(r){rce(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):qP(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function rce(n,e,t){return e=hce(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ice(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function sce(n,e){if(n==null)return{};var t=ice(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function WP(n,e){return ace(n)||nce(n,e)||xj(n,e)||uce()}function pg(n){return oce(n)||lce(n)||xj(n)||cce()}function oce(n){if(Array.isArray(n))return g4(n)}function ace(n){if(Array.isArray(n))return n}function lce(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function xj(n,e){if(n){if(typeof n=="string")return g4(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return g4(n,e)}}function g4(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function cce(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dce(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function hce(n){var e=dce(n,"string");return typeof e=="symbol"?e:String(e)}function _f(n){var e=n.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),i=[t-1,r-1,1,1],s=Date.now(),o=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,l;o?(a=new OffscreenCanvas(1,1),l=new OffscreenCanvas(t,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,l=document.createElement("canvas"),l.width=t,l.height=r);var c=a.getContext("2d"),u=l.getContext("2d");u&&(u.fillRect.apply(u,i),c.drawImage(l,t-1,r-1,1,1,0,0,1,1));var d=c&&c.getImageData(0,0,1,1).data[3]!==0,h=Date.now()-s;return[a,l].forEach(function(p){p.height=0,p.width=0}),o?(postMessage({width:t,height:r,benchmark:h,isTestPass:d}),!d&&n.sizes.length&&_f(n)):d?n.onSuccess(t,r,h):(n.onError(t,r,h),n.sizes.length&&_f(n)),d}var o2={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},fce=["onError","onSuccess"],Xu={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},_h={};function a2(n){var e=n.width===n.height,t=n.height===1,r=n.width===1,i=[];if(!n.width||!n.height)n.sizes.forEach(function(u){var d=e||t?u:1,h=e||r?u:1;i.push([d,h])});else for(var s=n.min||Xu.min,o=n.step||Xu.step,a=Math.max(n.width,n.height);a>=s;){var l=e||t?a:1,c=e||r?a:1;i.push([l,c]),a-=o}return i}function gg(n){var e=window&&"HTMLCanvasElement"in window,t=window&&"OffscreenCanvas"in window,r=Date.now(),i=n.onError,s=n.onSuccess,o=sce(n,fce),a=null;if(!e)return!1;if(n.useWorker&&t){var l=`
            var canvasTest = `.concat(_f.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),c=new Blob([l],{type:"application/javascript"}),u=URL.createObjectURL(c);a=new Worker(u),URL.revokeObjectURL(u),a.onmessage=function(d){var h=d.data,p=h.width,g=h.height,m=h.benchmark,S=h.isTestPass;S?(_h[r].onSuccess(p,g,m),delete _h[r]):_h[r].onError(p,g,m)}}if(n.usePromise)return new Promise(function(d,h){var p=gi(gi({},n),{},{onError:function(y,x,w){var O;if(n.sizes.length===0)O=!0;else{var T=n.sizes.slice(-1),E=WP(T,1),C=WP(E[0],2),M=C[0],A=C[1];O=y===M&&x===A}i(y,x,w),O&&h({width:y,height:x,benchmark:w})},onSuccess:function(y,x,w){s(y,x,w),d({width:y,height:x,benchmark:w})}});if(a){var g=p.onError,m=p.onSuccess;_h[r]={onError:g,onSuccess:m},a.postMessage(o)}else _f(p)});if(a)_h[r]={onError:i,onSuccess:s},a.postMessage(o);else return _f(n)}var l2={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=a2({width:e.max,height:e.max,min:e.min,step:e.step,sizes:pg(o2.area)}),r=gi(gi(gi({},Xu),e),{},{sizes:t});return gg(r)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=a2({width:1,height:e.max,min:e.min,step:e.step,sizes:pg(o2.height)}),r=gi(gi(gi({},Xu),e),{},{sizes:t});return gg(r)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=a2({width:e.max,height:1,min:e.min,step:e.step,sizes:pg(o2.width)}),r=gi(gi(gi({},Xu),e),{},{sizes:t});return gg(r)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=gi(gi({},Xu),e);return t.sizes=pg(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),gg(t)}};let c2=null;function pce(){return c2||(c2=gce()),c2}async function gce(){const n=await l2.maxWidth({usePromise:!0}),e=await l2.maxHeight({usePromise:!0}),t=await l2.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:t.width*t.height}}const VP=8192,mce=4096*4096;async function yce(n,e){if(n<=VP&&e<=VP&&n*e<=mce)return[n,e];const{maxWidth:t,maxHeight:r,maxArea:i}=await pce(),s=n/e;if(n>t&&(n=t,e=n/s),e>r&&(e=r,n=e*s),n*e>i){const o=Math.sqrt(i/(n*e));n*=o,e*=o}return[n,e]}function vce(n,e){const t=n.w/e.w,r=n.h/e.h;return t<=1&&r<=1?n:t>r?{w:n.w/t,h:n.h/t}:{w:n.w/r,h:n.h/r}}function Sce(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function xce(n){const e=new URL(n).host.replace("www.","");for(const t of Gp)if(wj(t.hostnames,e)){const r=t.fromEmbedUrl(n);if(r)return{definition:t,url:r,embedUrl:n}}}const wce=n=>n.split("*").map(e=>Sce(e)).join(".+"),wj=(n,e)=>!!n.find(t=>{const r=new RegExp(wce(t));return e.match(r)});function bce(n){const e=new URL(n).host.replace("www.","");for(const t of Gp)if(wj(t.hostnames,e)){const r=t.toEmbedUrl(n);if(r)return{definition:t,embedUrl:r,url:n}}}function bj(n){return bce(n)??xce(n)}function cl(n){try{return bj(n)}catch(e){console.error(e)}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const Ku="  ",Or=class Or{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const r=e.ownerDocument,i=r.activeElement;i!==e&&e.focus(),r.execCommand("insertText",!1,t)||Or.insertTextFirefox(e,t),i===r.body?e.blur():i instanceof HTMLElement&&i!==e&&i.focus()}static set(e,t){e.select(),Or.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:r}=e;return e.value.slice(t||void 0,r||void 0)}static wrapSelection(e,t,r){const{selectionStart:i,selectionEnd:s}=e,o=Or.getSelection(e);Or.insert(e,t+o+(r??t)),e.selectionStart=(i||0)+t.length,e.selectionEnd=(s||0)+t.length}static replace(e,t,r){let i=0;e.value.replace(t,(...s)=>{const o=i+s[s.length-2],a=s[0].length;e.selectionStart=o,e.selectionEnd=o+a;const l=typeof r=="string"?r:r(...s);return Or.insert(e,l),e.selectionStart=o,i+=l.length-a,l})}static findLineEnd(e,t){const r=e.lastIndexOf(`
`,t-1)+1;return e.charAt(r)!=="	"?t:r+1}static indent(e){var a;const{selectionStart:t,selectionEnd:r,value:i}=e,s=i.slice(t,r),o=(a=/\n/g.exec(s))==null?void 0:a.length;if(o&&o>0){const l=i.lastIndexOf(`
`,t-1)+1,c=e.value.slice(l,r-1),u=c.replace(/^|\n/g,`$&${Ku}`),d=u.length-c.length;e.setSelectionRange(l,r-1),Or.insert(e,u),e.setSelectionRange(t+1,r+d)}else Or.insert(e,Ku)}static unindent(e){const{selectionStart:t,selectionEnd:r,value:i}=e,s=i.lastIndexOf(`
`,t-1)+1,o=Or.findLineEnd(i,r),a=e.value.slice(s,o),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;e.setSelectionRange(s,o),Or.insert(e,l);const u=/\t| {1,2}/.exec(i.slice(s,t)),d=u?u[0].length:0,h=t-d;e.setSelectionRange(t-d,Math.max(h,r-c))}static indentCE(e){var l;const t=window.getSelection(),r=e.innerText,i=mg(e)??0,s=mg(e)??0,o=r.slice(i,s),a=(l=/\n/g.exec(o))==null?void 0:l.length;if(a&&a>0){const c=r.lastIndexOf(`
`,i-1)+1,u=r.slice(c,s-1),h=u.replace(/^|\n/g,`$&${Ku}`).length-u.length;t&&t.setBaseAndExtent(e,i+1,e,s+h)}else{const c=window.getSelection();e.innerText=r.slice(0,i)+Ku+r.slice(i),c==null||c.setBaseAndExtent(e,i+1,e,i+2)}}static unindentCE(e){const t=window.getSelection(),r=e.innerText,i=mg(e)??0,s=mg(e)??0,o=r.lastIndexOf(`
`,i-1)+1,a=Or.findLineEnd(r,s),l=r.slice(o,a),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=l.length-c.length;if(t){t.setBaseAndExtent(e,o,e,a);const d=/\t| {1,2}/.exec(r.slice(o,i)),h=d?d[0].length:0,p=i-h;t.setBaseAndExtent(e,i-h,e,Math.max(p,s-u))}}static normalizeText(e){return e.replace(Or.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(Or.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};v(Or,"fixNewLines",/\r?\n|\r/g);let Id=Or;function mg(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(n),i.setEnd(r.endContainer,r.endOffset),t=i.toString().length}return t}const Oce=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function Oj(n){return Oce.test(n)}function kce(n){return n.replace(/\t/g,Ku)}function Cce(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const r of e)if(r.trim().length>0){const i=r.length-r.trimStart().length;t=Math.min(t,i)}return e.map(r=>r.slice(t)).join(`
`)}function Pce(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function Tce(n){return Pce(Cce(kce(n)))}function Ece(n,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i},{toasts:s,msg:o}){n.registerExternalAssetHandler("file",async({file:a})=>{const l=a.name;let c=a;const u=r.includes(c.type),d=i.includes(c.type);!u&&!d&&s.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),Ye(u||d,`File type not allowed: ${c.type}`),c.size>t&&s.addToast({title:o("assets.files.size-too-big"),severity:"error"}),Ye(c.size<=t,`File size too big: ${(c.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),c.type==="video/quicktime"&&(c=new File([c],c.name,{type:"video/mp4"}));let h=u?await ao.getImageSize(c):await ao.getVideoSize(c);const p=await ao.isAnimated(c)||d,g=Kte(await c.arrayBuffer());if(isFinite(e)){const y=vce(h,{w:e,h:e});h!==y&&ao.isStaticImageType(c.type)&&(h=y)}const S={id:bc.createId(g),type:u?"image":"video",typeName:"asset",props:{name:l,src:"",w:h.w,h:h.h,fileSize:c.size,mimeType:c.type,isAnimated:p}};return S.props.src=await n.uploadAsset(S,c),bc.create(S)}),n.registerExternalAssetHandler("url",async({url:a})=>{var c,u,d,h,p;let l;try{const m=await(await Oo(a,{method:"GET",mode:"no-cors"})).text(),S=new DOMParser().parseFromString(m,"text/html");l={image:((c=S.head.querySelector('meta[property="og:image"]'))==null?void 0:c.getAttribute("content"))??"",favicon:((u=S.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:u.getAttribute("href"))??((d=S.head.querySelector('link[rel="icon"]'))==null?void 0:d.getAttribute("href"))??"",title:((h=S.head.querySelector('meta[property="og:title"]'))==null?void 0:h.getAttribute("content"))??a,description:((p=S.head.querySelector('meta[property="og:description"]'))==null?void 0:p.getAttribute("content"))??""},l.image.startsWith("http")||(l.image=new URL(l.image,a).href),l.favicon.startsWith("http")||(l.favicon=new URL(l.favicon,a).href)}catch(g){console.error(g),s.addToast({title:o("assets.url.failed"),severity:"error"}),l={image:"",favicon:"",title:"",description:""}}return{id:bc.createId(Xb(a)),typeName:"asset",type:"bookmark",props:{src:a,description:l.description,image:l.image,favicon:l.favicon,title:l.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:a,text:l})=>{const c=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=new DOMParser().parseFromString(l,"image/svg+xml").querySelector("svg");if(!u)throw new Error("No <svg/> element present");let d=parseFloat(u.getAttribute("width")||"0"),h=parseFloat(u.getAttribute("height")||"0");if(!(d&&h)){document.body.appendChild(u);const g=u.getBoundingClientRect();document.body.removeChild(u),d=g.width,h=g.height}const p=await n.getAssetForExternalContent({type:"file",file:new File([l],"asset.svg",{type:"image/svg+xml"})});if(!p)throw Error("Could not create an asset");GP(n,[p],c)}),n.registerExternalContentHandler("embed",({point:a,url:l,embed:c})=>{const u=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),{width:d,height:h}=c,p=mt(),g={id:p,type:"embed",x:u.x-(d||450)/2,y:u.y-(h||450)/2,props:{w:d,h,url:l}};n.createShapes([g]).select(p)}),n.registerExternalContentHandler("files",async({point:a,files:l})=>{const c=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=new b(c.x,c.y),d=[];await Promise.all(l.map(async(h,p)=>{if(h.size>t)return s.addToast({title:o("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(h.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),null;if(!h.type)throw new Error("No mime type");if(!r.concat(i).includes(h.type))return s.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${h.name} not loaded - Extension not allowed.`),null;try{const g=await n.getAssetForExternalContent({type:"file",file:h});if(!g)throw Error("Could not create an asset");d[p]=g}catch(g){return s.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(g),null}})),GP(n,He(d),u)}),n.registerExternalContentHandler("text",async({point:a,text:l})=>{const c=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=n.getShapeUtil("text").getDefaultProps(),d=Tce(l),h=n.getOnlySelectedShape();if(h&&"text"in h.props){n.updateShapes([{id:h.id,type:h.type,props:{text:d}}]);return}let p,g,m,S="middle";const y=d.split(`
`).length>1,x=Oj(d);y&&(S=y?x?"end":"start":"middle");const w=n.textMeasure.measureText(d,{...Yn,fontFamily:wo[u.font],fontSize:Ed[u.size],maxWidth:null}),O=Math.min(y?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(w.w>O){const T=n.textMeasure.measureText(d,{...Yn,fontFamily:wo[u.font],fontSize:Ed[u.size],maxWidth:O});p=T.w,g=T.h,m=!1,S=x?"end":"start"}else p=w.w,g=w.h,m=!0;c.y-g/2<n.getViewportPageBounds().minY+40&&(c.y=n.getViewportPageBounds().minY+40+g/2),n.createShapes([{id:mt(),type:"text",x:c.x-p/2,y:c.y-g/2,props:{text:d,textAlign:S,autoSize:m,w:p}}])}),n.registerExternalContentHandler("url",async({point:a,url:l})=>{const c=cl(l);if(c)return n.putExternalContent({type:"embed",url:c.url,point:a,embed:c.definition});const u=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),d=bc.createId(Xb(l)),h=Ice(n,l,u);let p=n.getAsset(d),g=!1;if(!p){g=!0;try{const m=await n.getAssetForExternalContent({type:"url",url:l});if(!m)throw Error("Could not create an asset");p=m}catch{s.addToast({title:o("assets.url.failed"),severity:"error"});return}}n.run(()=>{g&&n.createAssets([p]),n.updateShapes([{id:h.id,type:h.type,props:{assetId:p.id}}])})})}async function GP(n,e,t){if(!e.length)return[];const r=b.From(t),i=[];for(let s=0;s<e.length;s++){const o=e[s];switch(o.type){case"bookmark":{i.push({id:mt(),type:"bookmark",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,url:o.props.src}}),r.x+=300;break}case"image":{i.push({id:mt(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":i.push({id:mt(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}}return n.run(()=>{const s=e.filter(o=>!n.getAsset(o.id));s.length&&n.createAssets(s),n.createShapes(i).select(...i.map(o=>o.id)),kj(n,t)}),i.map(s=>s.id)}function kj(n,e){const t=n.getViewportPageBounds();let r=n.getSelectionPageBounds();if(r){const i=r.center.sub(e);n.updateShapes(n.getSelectedShapes().map(s=>{const o=n.getShapeParentTransform(s).decompose().rotation,a=b.Rot(i,-o);return{id:s.id,type:s.type,x:s.x-a.x,y:s.y-a.y}}))}r=n.getSelectionPageBounds(),r&&!t.contains(r)&&n.zoomToSelection()}function Ice(n,e,t){const r={id:mt(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return n.run(()=>{n.createShapes([r]).select(r.id),kj(n,t)}),n.getShape(r.id)}var Ow;let Mce=(Ow=class extends Oe{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")});v(this,"onKeyUp",t=>{var r;if(t.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(r=this.editor.root.getCurrent())==null||r.transition("editing_shape",{...t,target:"shape",shape:i}))}})}},v(Ow,"id","idle"),Ow);var kw;let Ace=(kw=class extends Oe{constructor(){super(...arguments);v(this,"shape");v(this,"markId","");v(this,"onEnter",()=>{this.didTimeout=!1;const t=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:r=>!r.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:r,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});t?this.editor.setHintingShapes([t.id]):this.createArrowShape(),this.startPreciseTimeout()});v(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()});v(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,onInteractionEnd:"arrow"})}});v(this,"onPointerUp",()=>{this.cancel()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()});v(this,"preciseTimeout",-1);v(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var u;const{originPagePoint:t}=this.editor.inputs,r=mt();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShape({id:r,type:"arrow",x:t.x,y:t.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(r);if(!i)throw Error("expected shape");const s=this.editor.getShapeHandles(i);if(!s)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),a=this.shape,l=s.find(d=>d.id==="start"),c=(u=o.onHandleDrag)==null?void 0:u.call(o,i,{handle:{...l,x:0,y:0},isPrecise:!0,initial:a});c&&this.editor.updateShapes([c]),this.shape=this.editor.getShape(r),this.editor.select(r)}updateArrowShapeEndHandle(){var i,s;const t=this.shape;if(!t)throw Error("expected shape");const r=this.editor.getShapeHandles(t);if(!r)throw Error("expected handles for arrow");{const o=this.editor.getShapeUtil("arrow"),a=this.shape,l=r.find(u=>u.id==="start"),c=(i=o.onHandleDrag)==null?void 0:i.call(o,t,{handle:{...l,x:0,y:0},isPrecise:this.didTimeout,initial:a});c&&this.editor.updateShapes([c])}{const o=this.editor.getShapeUtil("arrow"),a=this.shape,l=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),c=r.find(d=>d.id==="end"),u=(s=o.onHandleDrag)==null?void 0:s.call(o,this.editor.getShape(t),{handle:{...c,x:l.x,y:l.y},isPrecise:!1,initial:a});u&&this.editor.updateShapes([u])}this.shape=this.editor.getShape(t.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},v(kw,"id","pointing"),kw);class Lm extends Oe{constructor(){super(...arguments);v(this,"shapeType","arrow")}}v(Lm,"id","arrow"),v(Lm,"initial","idle"),v(Lm,"children",()=>[Mce,Ace]);class rO extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"initialShape");v(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");v(this,"util",this.editor.getShapeUtil(this.shapeType));v(this,"isPen",!1);v(this,"isPenOrStylus",!1);v(this,"segmentMode","free");v(this,"didJustShiftClickToExtendPreviousShapeLine",!1);v(this,"pagePointWhereCurrentSegmentChanged",{});v(this,"pagePointWhereNextSegmentChanged",null);v(this,"lastRecordedPoint",{});v(this,"mergeNextPoint",!1);v(this,"currentLineLength",0);v(this,"canDraw",!1);v(this,"markId",null);v(this,"onEnter",t=>{this.markId=null,this.info=t,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});v(this,"onPointerMove",()=>{const{inputs:t}=this.editor;if(this.isPen&&!t.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&t.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(this.isPenOrStylus?b.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())});v(this,"onKeyDown",t=>{if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()});v(this,"onKeyUp",t=>{if(t.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()});v(this,"onExit",()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,r,i){if(!this.canClose())return!1;const s=Dn[r],o=t[0].points[0],a=t[t.length-1],l=a.points[a.points.length-1];return o!==l&&this.currentLineLength>s*4*i&&b.DistMin(o,l,s*2*i)}startShape(){const{inputs:{originPagePoint:t,isPen:r}}=this.editor;this.markId="draw start "+wt(),this.editor.mark(this.markId);const{z:i=.5}=this.info.point;this.isPen=r,this.isPenOrStylus=r||i>0&&i<.5||i>.5&&i<1;const s=this.isPenOrStylus?i*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const l=Hn(a.props.segments);if(!l)throw Error("Expected a previous segment!");const c=Hn(l.points);if(!c)throw Error("Expected a previous point!");const{x:u,y:d}=this.editor.getPointInShapeSpace(a,t).toFixed(),h={type:this.segmentMode,points:[{x:c.x,y:c.y,z:+s.toFixed(2)},{x:u,y:d,z:+s.toFixed(2)}]},p=ke.applyToPoint(this.editor.getShapePageTransform(a.id),c);this.pagePointWhereCurrentSegmentChanged=p,this.pagePointWhereNextSegmentChanged=null;const g=[...a.props.segments,h];this.currentLineLength<Dn[a.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const m={id:a.id,type:this.shapeType,props:{segments:g}};this.canClose()&&(m.props.isClosed=this.getIsClosed(g,a.props.size,a.props.scale)),this.editor.updateShapes([m]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const o=mt();this.editor.createShapes([{id:o,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+s.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateDrawingShape(){const{initialShape:t}=this,{inputs:r}=this.editor;if(!t)return;const{id:i,props:{size:s,scale:o}}=t,a=this.editor.getShape(i);if(!a)return;const{segments:l}=a.props,{x:c,y:u,z:d}=this.editor.getPointInShapeSpace(a,r.currentPagePoint).toFixed(),h=this.isPenOrStylus?+(r.currentPagePoint.z*1.25).toFixed(2):.5,p={x:c,y:u,z:h};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(b.Dist2(g,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const S=Hn(l);if(!S)throw Error("Expected a previous segment!");const y=Hn(S.points);if(!y)throw Error("Expected a previous last point!");let x;const w=this.editor.getPointInShapeSpace(a,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(S.type==="straight"){this.currentLineLength+=b.Dist(y,w),x={type:"straight",points:[{...y},w]};const T=this.editor.getShapePageTransform(a);this.pagePointWhereCurrentSegmentChanged=ke.applyToPoint(T,y)}else x={type:"straight",points:[w,p]};const O={id:i,type:this.shapeType,props:{segments:[...l,x]}};this.canClose()&&(O.props.isClosed=this.getIsClosed(l,s,o)),this.editor.updateShapes([O])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(b.Dist2(g,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const S=l.slice(),y=S[S.length-1],x=Hn(y.points);if(!x)throw Error("No previous point!");const w={type:"free",points:[...b.PointsBetween(x,p,6).map(E=>({x:na(E.x),y:na(E.y),z:na(E.z)}))]},O=[...S,w];this.currentLineLength<Dn[a.props.size]*4&&(this.currentLineLength=this.getLineLength(O));const T={id:i,type:this.shapeType,props:{segments:O}};this.canClose()&&(T.props.isClosed=this.getIsClosed(O,s,o)),this.editor.updateShapes([T])}break}case"straight":{const g=l.slice(),m=g[g.length-1],{pagePointWhereCurrentSegmentChanged:S}=this,{ctrlKey:y,currentPagePoint:x}=this.editor.inputs;if(!S)throw Error("We should have a point where the segment changed");let w,O=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(O=!y,this.didJustShiftClickToExtendPreviousShapeLine=!1):O=!y;let T=this.editor.getPointInShapeSpace(a,x).toFixed().toJson(),E=!1,C;if((this.editor.user.getIsSnapMode()?!y:y)&&g.length>2){let D,N=8/this.editor.getZoomLevel();for(let F=0,j=l.length-2;F<j;F++){const L=l[F];if(!L)break;if(L.type==="free")continue;const U=L.points[0],Y=Hn(L.points);if(!(U&&Y))continue;const V=b.NearestPointOnLineSegment(U,Y,T);if(b.DistMin(V,T,N)){D=V.toFixed().toJson(),N=b.Dist(V,T),C=L;break}}D&&(E=!0,T=D)}if(E&&C){const D=this.editor.getShapePageTransform(a),N=C.points[0],F=Hn(C.points);if(!F)throw Error("Expected a last point!");const j=ke.applyToPoint(D,N),L=ke.applyToPoint(D,F),U=ke.applyToPoint(D,T);this.editor.snaps.setIndicators([{id:wt(),type:"points",points:[j,U,L]}])}else{if(this.editor.snaps.clearIndicators(),O){const D=b.Angle(S,x),F=dy(D,24)-D;w=b.RotWith(x,S,F)}else w=x;T=this.editor.getPointInShapeSpace(a,w).toFixed().toJson()}this.currentLineLength+=b.Dist(m.points[0],T),g[g.length-1]={...m,type:"straight",points:[m.points[0],T]};const A={id:i,type:this.shapeType,props:{segments:g}};this.canClose()&&(A.props.isClosed=this.getIsClosed(l,s,o)),this.editor.updateShapes([A]);break}case"free":{const g=l.slice(),m=g[g.length-1],S=[...m.points];if(S.length&&this.mergeNextPoint){const{z:x}=S[S.length-1];S[S.length-1]={x:p.x,y:p.y,z:x?Math.max(x,p.z):p.z}}else this.currentLineLength+=b.Dist(S[S.length-1],p),S.push(p);g[g.length-1]={...m,points:S},this.currentLineLength<Dn[a.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const y={id:i,type:this.shapeType,props:{segments:g}};if(this.canClose()&&(y.props.isClosed=this.getIsClosed(g,s,o)),this.editor.updateShapes([y]),S.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const x=mt(),w=this.editor.getShape(i).props;this.editor.createShapes([{id:x,type:this.shapeType,x:na(r.currentPagePoint.x),y:na(r.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:w.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(d*1.25).toFixed():.5}]}]}}]),this.initialShape=It(this.editor.getShape(x)),this.mergeNextPoint=!1,this.lastRecordedPoint=r.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let r=0;for(const i of t)for(let s=0;s<i.points.length-1;s++){const o=i.points[s],a=i.points[s+1];r+=b.Dist2(a,o)}return Math.sqrt(r)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}v(rO,"id","drawing");var Cw;let Cj=(Cw=class extends Oe{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("drawing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(Cw,"id","idle"),Cw);class Jh extends Oe{constructor(){super(...arguments);v(this,"shapeType","draw");v(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}v(Jh,"id","draw"),v(Jh,"initial","idle"),v(Jh,"isLockable",!1),v(Jh,"children",()=>[Cj,rO]);class m4 extends cd{constructor(){super(...arguments);v(this,"shapeType","frame");v(this,"onCreate",t=>{if(!t)return;const r=this.editor.getShapePageBounds(t),i=[],s=this.editor.getShapeAncestors(t).map(o=>o.id);this.editor.getSortedChildIdsForParent(t.parentId).map(o=>{const a=this.editor.getShape(o);if(!a||a.id===t.id||a.isLocked)return;const l=this.editor.getShapePageBounds(a);l&&r.contains(l)&&_ce(a,s,t)&&i.push(a.id)}),this.editor.reparentShapes(i,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")})}}v(m4,"id","frame"),v(m4,"initial","idle");function _ce(n,e,t){return e.includes(n.id)?!1:n.parentId===t.parentId}var Pw;let Rce=(Pw=class extends Oe{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onKeyUp",t=>{var r;if(t.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(r=this.editor.root.getCurrent())==null||r.transition("editing_shape",{...t,target:"shape",shape:i}))}});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(Pw,"id","idle"),Pw);var Tw;let Dce=(Tw=class extends Oe{constructor(){super(...arguments);v(this,"markId","");v(this,"onPointerUp",()=>{this.complete()});v(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){const{originPagePoint:r}=this.editor.inputs,i=mt();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:"geo",x:r.x,y:r.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(ks),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(i).setCurrentTool("select.resizing",{...t,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:t}=this.editor.inputs,r=mt();this.markId=`creating:${r}`,this.editor.mark(this.markId);const i=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,s=this.editor.getStyleForNextShape(ks),o=s==="star"?{w:200,h:190}:s==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:r,type:"geo",x:t.x,y:t.y,props:{geo:this.editor.getStyleForNextShape(ks),scale:i,...o}}]);const a=this.editor.getShape(r);if(!a)return;const{w:l,h:c}=a.props,u=new b(l/2,c/2).mul(i),d=this.editor.getShapeParentTransform(a);d&&u.rot(-d.rotation()),this.editor.select(r),this.editor.updateShape({id:a.id,type:"geo",x:a.x-u.x,y:a.y-u.y,props:{geo:this.editor.getStyleForNextShape(ks),w:l*i,h:c*i}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},v(Tw,"id","pointing"),Tw);class zm extends Oe{constructor(){super(...arguments);v(this,"shapeType","geo")}}v(zm,"id","geo"),v(zm,"initial","idle"),v(zm,"children",()=>[Rce,Dce]);class ef extends Oe{constructor(){super(...arguments);v(this,"shapeType","highlight");v(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}v(ef,"id","highlight"),v(ef,"initial","idle"),v(ef,"children",()=>[Cj,rO]),v(ef,"isLockable",!1);var Ew;let jce=(Ew=class extends Oe{constructor(){super(...arguments);v(this,"shapeId","");v(this,"onEnter",t=>{this.shapeId=t.shapeId,this.editor.setCursor({type:"cross",rotation:0})});v(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(Ew,"id","idle"),Ew);const XP=2;var Iw;let Lce=(Iw=class extends Oe{constructor(){super(...arguments);v(this,"shape",{});v(this,"markId");v(this,"onEnter",t=>{const{inputs:r}=this.editor,{currentPagePoint:i}=r;this.markId=void 0;const s=t.shapeId&&this.editor.getShape(t.shapeId);if(s&&r.shiftKey){this.markId=`creating:${s.id}`,this.editor.mark(this.markId),this.shape=s;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const a=o.filter(p=>p.type==="vertex").sort(fr),l=a[a.length-1],c=a[a.length-2],u=ke.applyToPoint(this.editor.getShapeParentTransform(this.shape),new b(this.shape.x,this.shape.y)),d=b.Sub(i,u).addXY(.1,.1),h=It(this.shape.props.points);if(b.DistMin(l,c,XP)||b.DistMin(d,l,XP))h[l.id]={id:l.id,index:l.index,x:d.x,y:d.y};else{const p=bs(l.index);h[p]={id:p,index:p,x:d.x,y:d.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:h}}])}else{const o=mt();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:"line",x:i.x,y:i.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(o),this.shape=this.editor.getShape(o)}});v(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const t=this.editor.getShapeHandles(this.shape);if(!t)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const r=Hn(t);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...r,x:r.x-.1,y:r.y-.1},onInteractionEnd:"line"})}});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},v(Iw,"id","pointing"),Iw);class Nm extends Oe{constructor(){super(...arguments);v(this,"shapeType","line")}}v(Nm,"id","line"),v(Nm,"initial","idle"),v(Nm,"children",()=>[jce,Lce]);var Mw;let zce=(Mw=class extends Oe{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(Mw,"id","idle"),Mw);function Pt(n,e){var i;const t=new Set;for(const s of e){const o=n.getShape(s);if(!o)continue;n.getShapeUtil(o).onDragShapesOut&&t.add(o);const a=n.getShape(o.parentId);a&&n.getShapeUtil(a).onDragShapesOut&&t.add(a)}const r=new Map;for(const s of t){const o=Pj(n,s);o.length&&r.set(s,o)}for(const[s,o]of r){const a=n.getShapeUtil(s),l=He(o.map(c=>n.getShape(c)));(i=a.onDragShapesOut)==null||i.call(a,s,l)}}function Pj(n,e){const t=n.getSortedChildIdsForParent(e.id);if(t.length===0)return[];const r=n.getShapePageBounds(e);if(!r)return[];let i,s,o;const a=[];for(const l of t){const c=n.getShapePageBounds(l);if(!c)continue;if(!r.includes(c)){a.push(l);continue}i??(i=n.getShapeGeometry(e)),s??(s=n.getShapePageTransform(e)),o??(o=s.applyToPoints(i.vertices));const u=n.getShapePageTransform(l).clone().invert().applyToPoints(o),{vertices:d,isClosed:h}=n.getShapeGeometry(l);if(!d.some(p=>Pi(p,u))){if(h){if(YD(u,d))continue}else if(_oe(u,d))continue;a.push(l)}}return a}function vy(n,e,t=!1){n.select(e),n.setEditingShape(e),n.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),t&&n.emit("select-all-text",{shapeId:e.id}),Tj(n)}const Nce=16;function Tj(n){const e=n.getSelectionPageBounds(),t=n.getViewportPageBounds();if(e&&!t.contains(e)){const r=e.clone().expandBy(Nce/n.getZoomLevel()).expand(t),i=t.clone().translate({x:(r.center.x-t.center.x)*2,y:(r.center.y-t.center.y)*2});n.zoomToBounds(i,{animation:{duration:n.options.animationMediumMs},inset:0})}}const $ce=0,xt=200,Qv=new b(xt/2,xt/2),Ej=10,Fce=n=>[[["a1"],new b(xt*.5,xt*-.5-n.options.adjacentShapeMargin)],[["a2"],new b(xt*1.5+n.options.adjacentShapeMargin,xt*.5)],[["a3"],new b(xt*.5,xt*1.5+n.options.adjacentShapeMargin)],[["a4"],new b(xt*-.5-n.options.adjacentShapeMargin,xt*.5)]];function Bce(n,e){if(e===1)return Fce(n);const t=xt*e,r=n.options.adjacentShapeMargin*e;return[[["a1"],new b(t*.5,t*-.5-r)],[["a2"],new b(t*1.5+r,t*.5)],[["a3"],new b(t*.5,t*1.5+r)],[["a4"],new b(t*-.5-r,t*.5)]]}function Ij(n,e,t,r,i,s){return Object.fromEntries(Bce(n,s).map(([o,a],l)=>{const c=a.clone();return l===0&&i?c.y-=i:l===2&&r&&(c.y+=r),[o,c.rot(t).add(e)]}))}function Mj(n,e,t,r){const i=new Set(n.getSelectedShapeIds()),s=(xt+n.options.adjacentShapeMargin+r)**2,o=new Map,a=[];for(const u of n.getCurrentPageShapes()){if(!n.isShapeOfType(u,"note")||t!==u.props.scale||i.has(u.id))continue;const d=n.getShapePageTransform(u.id);e===d.rotation()&&(o.set(u,n.getShapePageBounds(u).center),a.push(...Object.values(Ij(n,d.point(),e,u.props.growY,r,t))))}const l=a.length;let c;for(const[u,d]of o)for(let h=0;h<l;h++)c=a[h],c&&(b.Dist2(d,c)>s||n.isPointInShape(u,c)&&(a[h]=void 0));return He(a)}function Aj(n,e,t,r,i=!1){let s;const o=n.getCurrentPageShapesSorted(),a=(xt+n.options.adjacentShapeMargin**2)**e.props.scale;for(let l=o.length-1;l>=0;l--){const c=o[l];if(c.type==="note"&&c.id!==e.id){const u=n.getShapePageBounds(c);if(u&&b.Dist2(u.center,t)<a&&n.isPointInShape(c,t)){s=c;break}}}if(n.complete(),!s||i){n.mark("creating note shape");const l=mt();n.createShape({id:l,type:"note",x:t.x,y:t.y,rotation:r,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const c=n.getShape(l);if(!c)return;const u=n.getPointInParentSpace(c,b.Sub(t,b.Rot(Qv.clone().mul(c.props.scale),r)));n.updateShape({id:l,type:"note",x:u.x,y:u.y}),s=n.getShape(l)}return Tj(n),s}var Aw;let Uce=(Aw=class extends Oe{constructor(){super(...arguments);v(this,"dragged",!1);v(this,"info",{});v(this,"wasFocusedOnEnter",!1);v(this,"markId","");v(this,"shape",{});v(this,"onEnter",()=>{const{editor:t}=this;if(this.wasFocusedOnEnter=!t.getIsMenuOpen(),this.wasFocusedOnEnter){const r=mt();this.markId=`creating:${r}`,t.mark(this.markId);const i=this.editor.inputs.originPagePoint.clone(),s=KP(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&i.sub(s),this.shape=YP(this.editor,r,i)}});v(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){const r=mt(),i=this.editor.inputs.originPagePoint.clone(),s=KP(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&i.sub(s),this.shape=YP(this.editor,r,i)}this.editor.setCurrentTool("select.translating",{...t,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}});v(this,"onPointerUp",()=>{this.complete()});v(this,"onInterrupt",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},v(Aw,"id","pointing"),Aw);function KP(n,e,t){let r=Ej/n.getZoomLevel(),i;for(const s of Mj(n,0,t,0)){const o=b.Sub(e,s),a=o.len();a<r&&(r=a,i=o)}return i}function YP(n,e,t){n.createShape({id:e,type:"note",x:t.x,y:t.y,props:{scale:n.user.getIsDynamicResizeMode()?1/n.getZoomLevel():1}}).select(e);const r=n.getShape(e),i=n.getShapeGeometry(r).bounds;return n.updateShapes([{id:e,type:"note",x:r.x-i.width/2,y:r.y-i.height/2}]),n.getShape(e)}class $m extends Oe{constructor(){super(...arguments);v(this,"shapeType","note")}}v($m,"id","note"),v($m,"initial","idle"),v($m,"children",()=>[zce,Uce]);function Hce(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let t;const r=n.getOutermostSelectableShape(e);return r===e||r.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(r.id)?t=e:t=r,n.setHoveredShape(t.id)}const aa=Q_(Hce,32);var _w;let Qce=(_w=class extends Oe{constructor(){super(...arguments);v(this,"onPointerMove",t=>{switch(t.target){case"shape":case"canvas":aa(this.editor)}});v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onExit",()=>{aa.cancel()});v(this,"onKeyDown",t=>{var r;if(t.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(r=this.editor.root.getCurrent())==null||r.transition("editing_shape",{...t,target:"shape",shape:i}))}});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(_w,"id","idle"),_w);var Rw;let qce=(Rw=class extends Oe{constructor(){super(...arguments);v(this,"shape");v(this,"markId","");v(this,"onExit",()=>{this.editor.setHintingShapes([])});v(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:r}}=this.editor,i=mt();this.markId=`creating:${i}`,this.editor.mark(this.markId);const s=this.createTextShape(i,r,!1);if(!s){this.cancel();return}this.shape=this.editor.getShape(s),this.editor.select(i),this.editor.setCurrentTool("select.resizing",{...t,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:18,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(s.id),this.editor.setCurrentTool("select.editing_shape")}})}});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.cancel()});v(this,"onCancel",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}complete(){var s;this.editor.mark("creating text shape");const t=mt(),{currentPagePoint:r}=this.editor.inputs;this.createTextShape(t,r,!0)&&(this.editor.select(t),this.editor.setEditingShape(t),this.editor.setCurrentTool("select"),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape"))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(t,r,i){this.editor.createShape({id:t,type:"text",x:r.x,y:r.y,props:{text:"",autoSize:i,w:20,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const s=this.editor.getShape(t);if(!s){this.cancel();return}const o=this.editor.getShapePageBounds(s),a=new b;if(i)switch(s.props.textAlign){case"start":{a.x=0;break}case"middle":{a.x=-o.width/2;break}case"end":{a.x=-o.width;break}}else a.x=0;if(a.y=-o.height/2,Qr(s.parentId)){const l=this.editor.getShapeParentTransform(s);a.rot(-l.rotation())}return this.editor.updateShape({...s,x:s.x+a.x,y:s.y+a.y}),s}},v(Rw,"id","pointing"),Rw);class tf extends Oe{constructor(){super(...arguments);v(this,"shapeType","text")}}v(tf,"id","text"),v(tf,"initial","idle"),v(tf,"children",()=>[Qce,qce]),v(tf,"isLockable",!1);const Wce=[tf,Jh,zm,$m,Nm,m4,Lm,ef];function ds(){return Ra({isDarkMode:r0()})}function qv(n){return{key:`${ko.id}:${n}`,getElement:async()=>{const e=Vce(n);if(!e)return null;const t=e.$$_url,r=e.$$_fontface;if(!t||!r)return null;const i=await(await Oo(t)).blob(),s=await Ic.blobToDataUrl(i),o=r.replace(t,s);return f.jsx("style",{children:o})}}}function Vce(n){const e=PR[n];for(const t of document.fonts)if(e.includes(t.family))return t;return null}function iO(n){return{key:`${ko.id}:${n}`,getElement:async()=>n!=="pattern"?null:f.jsx(Gce,{})}}function Gce(){const n=ds(),e=8/12;return f.jsxs(f.Fragment,{children:[f.jsxs("mask",{id:"hash_pattern_mask",children:[f.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),f.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[f.jsx("line",{x1:e*1,y1:e*3,x2:e*3,y2:e*1}),f.jsx("line",{x1:e*5,y1:e*7,x2:e*7,y2:e*5}),f.jsx("line",{x1:e*9,y1:e*11,x2:e*11,y2:e*9})]})]}),f.jsx("pattern",{id:Sy(1,n.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:f.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:n.solid,mask:"url(#hash_pattern_mask)"})})]})}function sO(){return{key:`${ko.id}:pattern`,component:Zce}}const nf=8,ZP=(n,e,t)=>new Promise((r,i)=>{const s=nf*e*n,o=document.createElement("canvas");o.width=s,o.height=s;const a=o.getContext("2d");if(!a)return;a.fillStyle=t?sy.darkMode.solid:sy.lightMode.solid,a.fillRect(0,0,s,s),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*n;const l=8/12,c=u=>u*e*n;a.beginPath(),a.moveTo(c(l*1),c(l*3)),a.lineTo(c(l*3),c(l*1)),a.moveTo(c(l*5),c(l*7)),a.lineTo(c(l*7),c(l*5)),a.moveTo(c(l*9),c(l*11)),a.lineTo(c(l*11),c(l*9)),a.stroke(),o.toBlob(u=>{!u||un.throwToBlob.get()?i():r(u)})}),JP=(n,e)=>{const t=document.createElement("canvas");t.width=n[0],t.height=n[1];const r=t.getContext("2d");return r?(e(r),t.toDataURL()):""};let u2=null;function Xce(){return u2||(u2={white:JP([1,1],n=>{n.fillStyle="#f8f9fa",n.fillRect(0,0,1,1)}),black:JP([1,1],n=>{n.fillStyle="#212529",n.fillRect(0,0,1,1)})}),u2}function _j(n){return Math.ceil(Math.log2(Math.max(1,n)))}function Sy(n,e){const t=_j(n);return`tldraw_hash_pattern_${e}_${t}`}function Rj(n){const e=[],r=_j(n);for(let i=0;i<=r;i++)e.push(Math.pow(2,i));return e}function Kce(n){const e=Xce();return Rj(n).flatMap(t=>[{zoom:t,url:e.white,theme:"light"},{zoom:t,url:e.black,theme:"dark"}])}function Yce(){const n=G(),e=ee("devicePixelRatio",()=>n.getInstanceState().devicePixelRatio,[n]),t=ee("maxZoom",()=>Math.ceil(Hn(n.getCameraOptions().zoomSteps)),[n]),[r,i]=k.useState(!1),[s,o]=k.useState(()=>Kce(t));return k.useEffect(()=>{const l=Promise.all(Rj(t).flatMap(u=>[ZP(e,u,!1).then(d=>({zoom:u,theme:"light",url:URL.createObjectURL(d)})),ZP(e,u,!0).then(d=>({zoom:u,theme:"dark",url:URL.createObjectURL(d)}))]));let c=!1;return l.then(u=>{c||(o(u),i(!0))}),()=>{c=!0,i(!1),l.then(u=>{for(const{url:d}of u)URL.revokeObjectURL(d)})}},[e,t]),{defs:f.jsx(f.Fragment,{children:s.map(l=>{const c=Sy(l.zoom,l.theme);return f.jsx("pattern",{id:c,width:nf,height:nf,patternUnits:"userSpaceOnUse",children:f.jsx("image",{href:l.url,width:nf,height:nf})},c)})}),isReady:r}}function Zce(){const n=G(),e=k.useRef(null),{defs:t,isReady:r}=Yce();return k.useEffect(()=>{if(r&&n.environment.isSafari){const i=Dj(e.current);i&&n.timers.requestAnimationFrame(()=>{i.style.display="none",n.timers.requestAnimationFrame(()=>{i.style.display=""})})}},[n,r]),f.jsx("g",{ref:e,"data-testid":r?"ready-pattern-fill-defs":void 0,children:t})}function Dj(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?Dj(n.parentElement):null}const or=Qe.memo(function({theme:e,d:t,color:r,fill:i,scale:s}){switch(i){case"none":return null;case"solid":return f.jsx("path",{fill:e[r].semi,d:t});case"semi":return f.jsx("path",{fill:e.solid,d:t});case"fill":return f.jsx("path",{fill:e[r].fill,d:t});case"pattern":return f.jsx(Jce,{theme:e,color:r,fill:i,d:t,scale:s})}});function Jce({d:n,color:e,theme:t}){const r=G(),i=nj(),s=ee("zoomLevel",()=>r.getZoomLevel(),[r]),o=r.getZoomLevel()<=.18;return f.jsxs(f.Fragment,{children:[f.jsx("path",{fill:t[e].pattern,d:n}),f.jsx("path",{fill:i?`url(#${Sy(1,t.id)})`:o?t[e].semi:`url(#${Sy(s,t.id)})`,d:n})]})}function eue(n){return n.replace(/\s/g,"")}function y4(n,e,t){const{padding:r=0}=t;if(e.length===0)return null;const i=ye.From(e[0].box);for(const{box:c}of e)i.union(c);const s=r+(t.offsetX??0),o=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?r:t.verticalTextAlign==="end"?t.height-r-i.height:(Math.ceil(t.height)-i.height)/2);let a=null;const l=[];for(const{text:c,box:u}of e)a!==null&&u.y>a&&l.push(f.jsx("tspan",{alignmentBaseline:"mathematical",x:s,y:u.y+o,children:`
`},l.length)),l.push(f.jsx("tspan",{alignmentBaseline:"mathematical",x:u.x+s,y:u.y+o,unicodeBidi:"plaintext",children:eue(c)},l.length)),a=u.y;return f.jsx("text",{fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,children:l})}function tue(n,e,t,r){if((n==="start-legacy"||n==="end-legacy")&&t.length!==0){const i=ye.From(t[0].box);for(const{box:s}of t)i.union(s);if(n==="start-legacy")return(r-2*e-i.width)/2;if(n==="end-legacy")return-(r-2*e-i.width)/2}}function nue(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}function Wv({fontSize:n,font:e,align:t,verticalAlign:r,text:i,labelColor:s,bounds:o,padding:a=16,stroke:l=!0}){const c=G(),u=ds(),d={fontSize:n,fontFamily:PR[e],textAlign:t,verticalTextAlign:r,width:Math.ceil(o.width),height:Math.ceil(o.height),padding:a,lineHeight:Yn.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:s,stroke:void 0,strokeWidth:void 0},h=c.textMeasure.measureTextSpans(i,d),p=tue(t,a,h,o.width);p&&(d.offsetX=p),d.offsetX+=o.x,d.offsetY+=o.y;const g=y4(c,h,d);let m=null;return l&&(d.fill=u.background,d.stroke=u.background,d.strokeWidth=2,m=y4(c,h,d)),f.jsxs(f.Fragment,{children:[m,g]})}const rue=k.forwardRef(function({isEditing:e,text:t,handleFocus:r,handleChange:i,handleKeyDown:s,handleBlur:o,handleInputPointerDown:a,handleDoubleClick:l},c){return f.jsx("textarea",{ref:c,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:r,onChange:i,onKeyDown:s,onBlur:o,onTouchEnd:Tn,onContextMenu:e?Tn:void 0,onPointerDown:a,onDoubleClick:l,onDragStart:tt})});function iue(n,e,t){const r=G(),i=k.useRef(null),s=ee("isEditing",()=>r.getEditingShapeId()===n,[r]),o=ee("isEditingAnything",()=>!!r.getEditingShapeId(),[r]);k.useEffect(()=>{function u({shapeId:d}){var h;d===n&&((h=i.current)==null||h.select())}return r.on("select-all-text",u),()=>{r.off("select-all-text",u)}},[r,n,s]),k.useEffect(()=>{var u,d,h,p;s&&(document.activeElement!==i.current&&((u=i.current)==null||u.focus()),r.getInstanceState().isCoarsePointer&&((d=i.current)==null||d.select()),r.environment.isSafari&&((h=i.current)==null||h.blur(),(p=i.current)==null||p.focus()))},[r,s]);const a=k.useCallback(u=>{if(r.getEditingShapeId()===n)switch(u.key){case"Enter":{(u.ctrlKey||u.metaKey)&&r.complete();break}}},[r,n]),l=k.useCallback(u=>{if(r.getEditingShapeId()!==n)return;let d=Id.normalizeText(u.currentTarget.value);const h=d.replace(/\t/g,Ku);if(h!==d){const p=u.currentTarget.selectionStart;u.currentTarget.value=h,u.currentTarget.selectionStart=p+(h.length-d.length),u.currentTarget.selectionEnd=p+(h.length-d.length),d=h}r.updateShape({id:n,type:e,props:{text:d}})},[r,n,e]),c=k.useCallback(u=>{r.dispatch({...Zr(u),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(n)}),Tn(u)},[r,n]);return{rInput:i,handleFocus:op,handleBlur:op,handleKeyDown:a,handleChange:l,handleInputPointerDown:c,handleDoubleClick:Tn,isEmpty:t.trim().length===0,isEditing:s,isEditingAnything:o}}const Vv=Qe.memo(function({id:e,type:t,text:r,labelColor:i,font:s,fontSize:o,lineHeight:a,align:l,verticalAlign:c,wrap:u,isSelected:d,padding:h=0,onKeyDown:p,classNamePrefix:g,style:m,textWidth:S,textHeight:y}){const{rInput:x,isEmpty:w,isEditing:O,isEditingAnything:T,...E}=iue(e,t,r),[C,M]=k.useState(r);k.useEffect(()=>{O||M(r)},[O,r]);const A=Id.normalizeTextForDom(r),D=A.length>0,N=nue(l);if(!O&&!D)return null;const F=g||"tl-text";return f.jsx("div",{className:`${F}-label tl-text-wrapper`,"data-font":s,"data-align":l,"data-hastext":!w,"data-isediting":O,"data-iseditinganything":T,"data-textwrap":!!u,"data-isselected":d,style:{justifyContent:l==="middle"||N?"center":l,alignItems:c==="middle"?"center":c,padding:h,...m},children:f.jsxs("div",{className:`${F}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:Math.floor(o*a)+"px",minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(S||0),color:i,width:S?Math.ceil(S):void 0,height:y?Math.ceil(y):void 0},children:[f.jsx("div",{className:`${F} tl-text tl-text-content`,dir:"auto",children:A.split(`
`).map((j,L)=>f.jsx("div",{dir:"auto",children:j},L))}),(T||d)&&f.jsx(rue,{ref:x,text:r,isEditing:O,...E,handleKeyDown:p??E.handleKeyDown},C)]})})});function eo(n,e,t={}){const{closed:r=!1,snap:i=1,start:s="outset",end:o="outset",lengthRatio:a=2,style:l="dashed"}=t;let c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":{d=1,c=Math.min(e*a,n/4);break}case"dotted":{d=100,c=e/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(s==="outset"?(n+=c/2,p+=c/2):s==="skip"&&(n-=c,p-=c),o==="outset"?n+=c/2:o==="skip"&&(n-=c)),u=Math.floor(n/c/(2*d)),u-=u%i,u<3&&l==="dashed"?n/e<4?(c=n,u=1,h=0):(c=n*(1/3),h=n*(1/3)):(c=n/u/(2*d),r?(p=c/2,h=(n-u*c)/u):h=(n-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}const eT=new WeakMap;function oO(n,e){const t=eT.get(e);if(t)return t;const r=co(n,e);let i=0,s=0;const o=r.isStraight?new oa({start:b.From(r.start.point),end:b.From(r.end.point)}):new Wu({center:b.Cast(r.handleArc.center),start:b.Cast(r.start.point),end:b.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});if(e.props.text.trim()){const l=o.bounds,c=v4(e),{w:u,h:d}=n.textMeasure.measureText(e.props.text,{...Yn,fontFamily:wo[e.props.font],fontSize:c,maxWidth:null});if(i=u,s=d,l.width>l.height){i=Math.max(Math.min(u,64),Math.min(l.width-64,u));const{w:h,h:p}=n.textMeasure.measureText(e.props.text,{...Yn,fontFamily:wo[e.props.font],fontSize:c,maxWidth:i});i=h,s=p}if(i>16*c){i=16*c;const{w:h,h:p}=n.textMeasure.measureText(e.props.text,{...Yn,fontFamily:wo[e.props.font],fontSize:c,maxWidth:i});i=h,s=p}}const a=new b(i,s).addScalar(tce*2*e.props.scale);return eT.set(e,a),a}function jj(n){const e=Dn[n.props.size];return(ece+(e-Dn.s)*2+(e===Dn.xl?20:0))*n.props.scale}function sue(n,e,t){const r=oO(n,e),i=jj(e),s=b.Nudge(t.start.point,t.end.point,i),o=b.Nudge(t.end.point,t.start.point,i),a=Q6(s,o,ye.FromCenter(t.middle,r).corners);if(!a||a.length!==2)return{start:.5,end:.5};let[l,c]=a;b.Dist2(l,s)>b.Dist2(c,s)&&([c,l]=a);const u=s.add(b.Sub(t.middle,l)),d=o.add(b.Sub(t.middle,c)),h=b.Dist(t.start.point,u)/t.length,p=b.Dist(t.start.point,d)/t.length;return{start:h,end:p}}function oue(n,e,t){const r=oO(n,e),i=jj(e),s=Math.sign(e.props.bend),o=i/t.handleArc.radius*s,a=b.Angle(t.bodyArc.center,t.start.point)-o,l=b.Angle(t.bodyArc.center,t.end.point)+o,c=Hc(t.bodyArc.center,t.bodyArc.radius,a),u=Hc(t.bodyArc.center,t.bodyArc.radius,l),d=[],h=tT(t.bodyArc.center,t.bodyArc.radius,a,l,s,ye.FromCenter(c,r).corners);d.push(new an({points:ye.FromCenter(c,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const p=tT(t.bodyArc.center,t.bodyArc.radius,a,l,s,ye.FromCenter(u,r).corners);d.push(new an({points:ye.FromCenter(u,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const C of[...h??[],...p??[],c,u])d.push(new eO({x:C.x-3,y:C.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const g=(h&&nT(t.start.point,h))??t.middle,m=(p&&nT(t.end.point,p))??t.middle,S=b.Angle(t.bodyArc.center,t.start.point),y=b.Angle(t.bodyArc.center,t.end.point),x=b.Angle(t.bodyArc.center,g),w=b.Angle(t.bodyArc.center,m);if(nl(S,x,s)>nl(S,w,s))return{start:.5,end:.5,dbg:d};const O=nl(S,y,s),T=nl(S,x,s)/O,E=nl(S,w,s)/O;return{start:T,end:E,dbg:d}}function Fm(n,e){let t;const r=[],i=co(n,e),s=!!i.bindings.start,o=!!i.bindings.end,a=i.start.arrowhead!=="none",l=i.end.arrowhead!=="none";if(i.isStraight){const u=sue(n,e,i);let d=An(e.props.labelPosition,a||s?u.start:0,l||o?u.end:1);d=d>=.48&&d<=.52?.5:d,t=b.Lrp(i.start.point,i.end.point,d)}else{const u=oue(n,e,i);u.dbg&&r.push(...u.dbg);let d=An(e.props.labelPosition,a||s?u.start:0,l||o?u.end:1);d=d>=.48&&d<=.52?.5:d;const h=aue(b.Angle(i.bodyArc.center,i.start.point),b.Angle(i.bodyArc.center,i.end.point),Math.sign(e.props.bend),d);t=Hc(i.bodyArc.center,i.bodyArc.radius,h)}const c=oO(n,e);return{box:ye.FromCenter(t,c),debugGeom:r}}function tT(n,e,t,r,i,s){const o=l4(n,e,s),a=nl(t,r,i);return o==null?void 0:o.filter(l=>{const c=nl(t,b.Angle(n,l),i);return c>=0&&c<=a})}function nT(n,e){let t=null,r=-1/0;for(const i of e){const s=b.Dist2(n,i);s>r&&(t=i,r=s)}return t}function aue(n,e,t,r){const i=nl(n,e,t);return n+i*r*t*-1}function v4(n){return Jle[n.props.size]*n.props.scale}function lue(n,e,t){const r=e==="end"?n.end.point:n.start.point,i=e==="end"?n.start.point:n.end.point,s=n.isStraight?b.Dist(i,r):Math.abs(n.bodyArc.length),o=Math.max(Math.min(s/5,t*3),t);let a;if(n.isStraight)a=b.Nudge(r,i,o);else{const l=Moe(r,o,n.handleArc.center,n.handleArc.radius);a=e==="end"?n.handleArc.sweepFlag?l[0]:l[1]:n.handleArc.sweepFlag?l[1]:l[0]}return b.IsNaN(a)&&(a=n.start.point),{point:r,int:a}}function cue({point:n,int:e}){const t=b.RotWith(e,n,at/6),r=b.RotWith(e,n,-at/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y}`}function uue({point:n,int:e}){const t=b.RotWith(e,n,at/6),r=b.RotWith(e,n,-at/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function due({point:n,int:e}){const t=b.Sub(e,n).div(2),r=b.Add(n,b.Rot(t,Mt)),i=b.Sub(n,b.Rot(t,Mt));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function hue({point:n,int:e}){const t=b.Lrp(n,e,.45),r=b.Dist(t,n);return`M ${t.x-r},${t.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function fue({point:n,int:e}){const t=b.Lrp(n,e,.75),r=b.RotWith(t,n,at/4),i=b.RotWith(t,n,-at/4),s=b.Lrp(r,i,.5);return s.add(b.Sub(s,n)),`M ${s.x} ${s.y} L ${r.x} ${r.y} ${n.x} ${n.y} L ${i.x} ${i.y} Z`}function pue({int:n,point:e}){const t=b.Lrp(e,n,.85),r=b.Sub(t,e).div(2),i=b.Add(e,b.Rot(r,Mt)),s=b.Sub(e,b.Rot(r,Mt)),o=b.Add(t,b.Rot(r,Mt)),a=b.Sub(t,b.Rot(r,Mt));return`M ${i.x} ${i.y} L ${o.x} ${o.y} L ${a.x} ${a.y} L ${s.x} ${s.y} Z`}function gue({int:n,point:e}){const t=b.Sub(n,e).div(2),r=b.Add(e,b.Rot(t,Mt)),i=b.Sub(e,b.Rot(t,Mt));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function xy(n,e,t){const r=e==="end"?n.end.arrowhead:n.start.arrowhead;if(r==="none")return;const i=lue(n,e,t);if(i){switch(r){case"bar":return gue(i);case"square":return pue(i);case"diamond":return fue(i);case"dot":return hue(i);case"inverted":return due(i);case"arrow":return cue(i);case"triangle":return uue(i)}return""}}function mue(n){const{start:e,end:t,handleArc:{radius:r,largeArcFlag:i,sweepFlag:s}}=n;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${i} ${s} ${t.handle.x},${t.handle.y}`}function Lj(n){const{start:e,end:t,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:s}}=n;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${i} ${s} ${t.point.x},${t.point.y}`}function zj(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function yue(n){return zj(n.start.handle,n.end.handle)}function Nj(n){return zj(n.start.point,n.end.point)}let vue=0;class Bm extends Ti{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"canSnap",()=>!1);v(this,"hideResizeHandles",()=>!0);v(this,"hideRotateHandle",()=>!0);v(this,"hideSelectionBoundsBg",()=>!0);v(this,"hideSelectionBoundsFg",()=>!0);v(this,"canBeLaidOut",t=>{const r=Xr(this.editor,t);return!r.start&&!r.end});v(this,"onHandleDrag",(t,{handle:r,isPrecise:i})=>{const s=r.id,o=Xr(this.editor,t);if(s==="middle"){const{start:E,end:C}=Vu(this.editor,t,o),M=b.Sub(C,E),A=b.Per(M),D=b.Med(C,E),N=b.Sub(D,A),F=b.Add(D,A),j=b.NearestPointOnLineSegment(N,F,r,!1);let L=b.Dist(j,D);return b.Clockwise(j,C,D)&&(L*=-1),{id:t.id,type:t.type,props:{bend:L}}}const a={id:t.id,type:"arrow",props:{}},l=o[s],u=o[s==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return Dm(this.editor,t,s),a.props[s]={x:r.x,y:r.y},a;const d=this.editor.getShapePageTransform(t.id).applyToPoint(r),h=this.editor.getShapeAtPoint(d,{hitInside:!0,hitFrameInside:!0,margin:0,filter:E=>!E.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:E,binding:"arrow"})});if(!h)return Dm(this.editor,t,s),a.props[s]={x:r.x,y:r.y},a;const p=this.editor.getShapeGeometry(h),g=ye.ZeroFix(p.bounds),S=this.editor.getShapePageTransform(a.id).applyToPoint(r),y=this.editor.getPointInShapeSpace(h,S);let x=i;x||(!l||l&&h.id!==l.toId)&&(x=this.editor.inputs.pointerVelocity.len()<.5),i||(p.isClosed||(x=!0),u&&h.id===u.toId&&u.props.isPrecise&&(x=!0));const w={x:(y.x-g.minX)/g.width,y:(y.y-g.minY)/g.height};x&&b.Dist(y,g.center)<Math.max(4,Math.min(Math.min(g.width,g.height)*.15,16))/this.editor.getZoomLevel()&&(w.x=.5,w.y=.5);const O={terminal:s,normalizedAnchor:w,isPrecise:x,isExact:this.editor.inputs.altKey};Ah(this.editor,t,h.id,O),this.editor.setHintingShapes([h.id]);const T=Xr(this.editor,t);return T.start&&T.end&&T.start.toId===T.end.toId&&b.Equals(T.start.props.normalizedAnchor,T.end.props.normalizedAnchor)&&Ah(this.editor,t,T.end.toId,{...T.end.props,normalizedAnchor:{x:T.end.props.normalizedAnchor.x+.05,y:T.end.props.normalizedAnchor.y}}),a});v(this,"onTranslateStart",t=>{const r=Xr(this.editor,t),i=Vu(this.editor,t,r),s=this.editor.getShapePageTransform(t.id),o=this.editor.getSelectedShapeIds();if(!(r.start&&(o.includes(r.start.toId)||this.editor.isAncestorSelected(r.start.toId))||r.end&&(o.includes(r.end.toId)||this.editor.isAncestorSelected(r.end.toId)))){iT.set(t,{pagePosition:s.applyToPoint(t),terminalBindings:Vp(i,(a,l)=>{const c=r[a];return c?{binding:c,shapePosition:l,pagePosition:s.applyToPoint(l)}:null})}),r.start&&(yy({editor:this.editor,arrow:t,terminal:"start",useHandle:!0}),t=this.editor.getShape(t.id)),r.end&&yy({editor:this.editor,arrow:t,terminal:"end",useHandle:!0});for(const a of["start","end"]){const l=r[a];l&&this.editor.updateBinding({...l,props:{...l.props,isPrecise:!0}})}}});v(this,"onTranslate",(t,r)=>{const i=iT.get(t);if(!i)return;const s=this.editor.getShapePageTransform(r.id),o=b.Sub(s.applyToPoint(r),i.pagePosition);for(const a of Object.values(i.terminalBindings)){if(!a)continue;const l=b.Add(a.pagePosition,b.Mul(o,.5)),c=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:u=>!u.isLocked&&this.editor.canBindShapes({fromShape:r,toShape:u,binding:"arrow"})});if((c==null?void 0:c.id)===a.binding.toId){const u=ye.ZeroFix(this.editor.getShapeGeometry(c).bounds),d=this.editor.getPointInShapeSpace(c,l),h={x:(d.x-u.minX)/u.width,y:(d.y-u.minY)/u.height};Ah(this.editor,r,c.id,{...a.binding.props,normalizedAnchor:h,isPrecise:!0})}else Dm(this.editor,r,a.binding.props.terminal)}});v(this,"_resizeInitialBindings",new wa);v(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:s}=r,o=this._resizeInitialBindings.get(t,()=>Xr(this.editor,t)),a=Vu(this.editor,t,o),{start:l,end:c}=It(t.props);let{bend:u}=t.props;o.start||(l.x=a.start.x*i,l.y=a.start.y*s),o.end||(c.x=a.end.x*i,c.y=a.end.y*s);const d=Math.abs(i),h=Math.abs(s),p=o!=null&&o.start?b.From(o.start.props.normalizedAnchor):null,g=o!=null&&o.end?b.From(o.end.props.normalizedAnchor):null;return i<0&&s>=0?(u!==0&&(u*=-1,u*=Math.max(d,h)),p&&(p.x=1-p.x),g&&(g.x=1-g.x)):i>=0&&s<0?(u!==0&&(u*=-1,u*=Math.max(d,h)),p&&(p.y=1-p.y),g&&(g.y=1-g.y)):i>=0&&s>=0?u!==0&&(u*=Math.max(d,h)):i<0&&s<0&&(u!==0&&(u*=Math.max(d,h)),p&&(p.x=1-p.x,p.y=1-p.y),g&&(g.x=1-g.x,g.y=1-g.y)),o.start&&p&&Ah(this.editor,t,o.start.toId,{...o.start.props,normalizedAnchor:p.toJson()}),o.end&&g&&Ah(this.editor,t,o.end.toId,{...o.end.props,normalizedAnchor:g.toJson()}),{props:{start:l,end:c,bend:u}}});v(this,"onDoubleClickHandle",(t,r)=>{switch(r.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}});v(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:s}}=t;s.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])})}canBind({toShapeType:t}){return t!=="arrow"}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(t){const r=co(this.editor,t),i=[],s=r.isStraight?new oa({start:b.From(r.start.point),end:b.From(r.end.point)}):new Wu({center:b.Cast(r.handleArc.center),start:b.Cast(r.start.point),end:b.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let o;if(t.props.text.trim()){const a=Fm(this.editor,t);i.push(...a.debugGeom),o=new As({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new Ms({children:[...o?[s,o]:[s],...i]})}getHandles(t){const r=co(this.editor,t);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y}].filter(Boolean)}component(t){const r=ds(),i=this.editor.getOnlySelectedShape(),s=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,o=co(this.editor,t);if(!(o!=null&&o.isValid))return null;const a=Fm(this.editor,t),l=t.id===this.editor.getOnlySelectedShapeId(),u=this.editor.getEditingShapeId()===t.id||t.props.text;return f.jsxs(f.Fragment,{children:[f.jsx(Il,{id:t.id,style:{minWidth:50,minHeight:50},children:f.jsx(rT,{shape:t,shouldDisplayHandles:s&&(i==null?void 0:i.id)===t.id})}),u&&f.jsx(Vv,{id:t.id,classNamePrefix:"tl-arrow",type:"arrow",font:t.props.font,fontSize:v4(t),lineHeight:Yn.lineHeight,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:r[t.props.labelColor].solid,textWidth:a.box.w,isSelected:l,padding:0,style:{transform:`translate(${a.box.center.x}px, ${a.box.center.y}px)`}})]})}indicator(t){const r=Uv(t.id),i=co(this.editor,t);if(!i)return null;const{start:s,end:o}=Vu(this.editor,t,i==null?void 0:i.bindings),a=this.editor.getShapeGeometry(t),l=a.bounds,c=t.props.text.trim()?a.children[1]:null;if(b.Equals(s,o))return null;const u=Dn[t.props.size]*t.props.scale,d=i.start.arrowhead&&xy(i,"start",u),h=i.end.arrowhead&&xy(i,"end",u),p=i.isStraight?Nj(i):Lj(i),g=d&&i.start.arrowhead!=="arrow"||h&&i.end.arrowhead!=="arrow"||!!c,m=(t.id+"_clip").replace(":","_");return r&&c?f.jsx("rect",{x:q(c.x),y:q(c.y),width:c.w,height:c.h,rx:3.5*t.props.scale,ry:3.5*t.props.scale}):f.jsxs("g",{children:[g&&f.jsx("defs",{children:f.jsxs("mask",{id:m,children:[f.jsx("rect",{x:l.minX-100,y:l.minY-100,width:l.w+200,height:l.h+200,fill:"white"}),c&&f.jsx("rect",{x:q(c.x),y:q(c.y),width:c.w,height:c.h,fill:"black",rx:3.5*t.props.scale,ry:3.5*t.props.scale}),d&&f.jsx("path",{d,fill:i.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&f.jsx("path",{d:h,fill:i.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),f.jsxs("g",{...g?{mask:`url(#${m})`}:void 0,children:[g&&f.jsx("rect",{x:l.minX-100,y:l.minY-100,width:l.width+200,height:l.height+200,opacity:0}),f.jsx("path",{d:p})]}),d&&f.jsx("path",{d}),h&&f.jsx("path",{d:h}),c&&f.jsx("rect",{x:q(c.x),y:q(c.y),width:c.w,height:c.h,rx:3.5,ry:3.5})]})}toSvg(t,r){r.addExportDef(iO(t.props.fill)),t.props.text&&r.addExportDef(qv(t.props.font));const i=Ra(r),s=1/t.props.scale;return f.jsxs("g",{transform:`scale(${s})`,children:[f.jsx(rT,{shape:t,shouldDisplayHandles:!1}),f.jsx(Wv,{fontSize:v4(t),font:t.props.font,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:i[t.props.labelColor].solid,bounds:Fm(this.editor,t).box,padding:4*t.props.scale})]})}getCanvasSvgDefs(){return[sO(),{key:"arrow:dot",component:xue},{key:"arrow:cross",component:wue}]}getInterpolatedProps(t,r,i){return{...r.props,start:{x:Wr(t.props.start.x,r.props.start.x,i),y:Wr(t.props.start.y,r.props.start.y,i)},end:{x:Wr(t.props.end.x,r.props.end.x,i),y:Wr(t.props.end.y,r.props.end.y,i)},bend:Wr(t.props.bend,r.props.bend,i),labelPosition:Wr(t.props.labelPosition,r.props.labelPosition,i)}}}v(Bm,"type","arrow"),v(Bm,"props",ER),v(Bm,"migrations",IR);function Sue(n,e){const t=co(n,e);return t.isStraight?b.Dist(t.start.handle,t.end.handle):Math.abs(t.handleArc.length)}const rT=zn(function({shape:e,shouldDisplayHandles:t}){const r=G(),i=ds(),s=co(r,e),o=ye.ZeroFix(r.getShapeGeometry(e).bounds),a=Xr(r,e),l=Qe.useMemo(()=>r.environment.isSafari?vue+=1:0,[e]);if(!(s!=null&&s.isValid))return null;const c=Dn[e.props.size]*e.props.scale,u=s.start.arrowhead&&xy(s,"start",c),d=s.end.arrowhead&&xy(s,"end",c),h=s.isStraight?Nj(s):Lj(s);let p=null;if(t){const O=2/r.getZoomLevel(),{strokeDasharray:T,strokeDashoffset:E}=eo(Sue(r,e),O,{end:"skip",start:"skip",lengthRatio:2.5});p=a.start||a.end?f.jsx("path",{className:"tl-arrow-hint",d:s.isStraight?yue(s):mue(s),strokeDasharray:T,strokeDashoffset:E,strokeWidth:O,markerStart:a.start?a.start.props.isExact?"":a.start.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:a.end?a.end.props.isExact?"":a.end.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:g,strokeDashoffset:m}=eo(s.isStraight?s.length:Math.abs(s.bodyArc.length),c,{style:e.props.dash}),S=Fm(r,e),y=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),x=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow"),w=(e.id+"_clip_"+l).replace(":","_");return f.jsxs(f.Fragment,{children:[f.jsx("defs",{children:f.jsxs("mask",{id:w,children:[f.jsx("rect",{x:q(-100+o.minX),y:q(-100+o.minY),width:q(o.width+200),height:q(o.height+200),fill:"white"}),e.props.text.trim()&&f.jsx("rect",{x:S.box.x,y:S.box.y,width:S.box.w,height:S.box.h,fill:"black",rx:4,ry:4}),u&&y&&f.jsx("path",{d:u,fill:s.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),d&&x&&f.jsx("path",{d,fill:s.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),f.jsxs("g",{fill:"none",stroke:i[e.props.color].solid,strokeWidth:c,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[p,f.jsxs("g",{mask:`url(#${w})`,children:[f.jsx("rect",{x:q(o.minX-100),y:q(o.minY-100),width:q(o.width+200),height:q(o.height+200),opacity:0}),f.jsx("path",{d:h,strokeDasharray:g,strokeDashoffset:m})]}),u&&y&&e.props.fill!=="none"&&f.jsx(or,{theme:i,d:u,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),d&&x&&e.props.fill!=="none"&&f.jsx(or,{theme:i,d,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),u&&f.jsx("path",{d:u}),d&&f.jsx("path",{d})]})]})}),iT=new WeakMap;function xue(){return f.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:f.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function wue(){return f.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[f.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),f.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const sT="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Md({url:n,zoomLevel:e}){return f.jsx("a",{className:Te("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:Tn,onPointerUp:Tn,title:n,draggable:!1,children:f.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${sT}") center 100% / 100% no-repeat`,WebkitMask:`url("${sT}") center 100% / 100% no-repeat`}})})}const oT="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",bue=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function aO(n){return bue.map(t=>{const{offsetX:r,offsetY:i,blur:s,spread:o,color:a}=t,l=new b(r,i),{x:c,y:u}=l.rot(-n);return`${c}px ${u}px ${s}px ${o}px ${a}`}).join(", ")}const Oue=300,$j=320,kue=46,Cue=101;class Um extends th{constructor(){super(...arguments);v(this,"canResize",()=>!1);v(this,"hideSelectionBoundsFg",()=>!0);v(this,"onBeforeCreate",t=>aT(this.editor,t));v(this,"onBeforeUpdate",(t,r)=>{if(t.props.url!==r.props.url)if(Mi.isValid(r.props.url))Tue(this.editor,r);else return{...r,props:{...r.props,url:t.props.url}};if(t.props.assetId!==r.props.assetId)return aT(this.editor,r)})}getDefaultProps(){return{url:"",w:Oue,h:$j,assetId:null}}component(t){const r=t.props.assetId?this.editor.getAsset(t.props.assetId):null,i=this.editor.getShapePageTransform(t).rotation(),s=Pue(t);return f.jsx(Oa,{children:f.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:aO(i),maxHeight:t.props.h},children:[(!r||r.props.image)&&f.jsxs("div",{className:"tl-bookmark__image_container",children:[r?f.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:r==null?void 0:r.props.image,alt:(r==null?void 0:r.props.title)||""}):f.jsx("div",{className:"tl-bookmark__placeholder"}),(r==null?void 0:r.props.image)&&f.jsx(Md,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]}),f.jsxs("div",{className:"tl-bookmark__copy_container",children:[r!=null&&r.props.title?f.jsx("h2",{className:"tl-bookmark__heading",children:r.props.title}):null,r!=null&&r.props.description&&(r!=null&&r.props.image)?f.jsx("p",{className:"tl-bookmark__description",children:r.props.description}):null,f.jsxs("a",{className:"tl-bookmark__link",href:t.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Tn,onPointerUp:Tn,onClick:Tn,children:[r!=null&&r.props.favicon?f.jsx("img",{className:"tl-bookmark__favicon",src:r==null?void 0:r.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",alt:`favicon of ${s}`}):f.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${oT}") center 100% / 100% no-repeat`,WebkitMask:`url("${oT}") center 100% / 100% no-repeat`}}),f.jsx("span",{children:s})]})]})]})})}indicator(t){return f.jsx("rect",{width:q(t.props.w),height:q(t.props.h),rx:"6",ry:"6"})}}v(Um,"type","bookmark"),v(Um,"props",jR),v(Um,"migrations",LR);function aT(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):null;let r=$j;return t&&(t.props.image||(t.props.title?r=Cue:r=kue)),{...e,props:{...e.props,h:r}}}const Pue=n=>{try{return new URL(n.props.url).hostname.replace(/^www\./,"")}catch{return n.props.url}};function Tue(n,e){const{url:t}=e.props,r=bc.createId(Xb(t));n.getAsset(r)?e.props.assetId!==r&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),Eue(n,e))}const Eue=Y_(async(n,e)=>{if(n.isDisposed)return;const{url:t}=e.props,r=await n.getAssetForExternalContent({type:"url",url:t});r&&n.run(()=>{n.createAssets([r]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function Qc(n,e=!1){const t=n.length;if(t<2)return"";let r=n[0].point,i=n[1].point;if(t===2)return`M${st(r)}L${st(i)}`;let s="";for(let o=2,a=t-1;o<a;o++)r=n[o].point,i=n[o+1].point,s+=Vr(r,i);return e?`M${Vr(n[0].point,n[1].point)}Q${st(n[1].point)}${Vr(n[1].point,n[2].point)}T${s}${Vr(n[t-1].point,n[0].point)}${Vr(n[0].point,n[1].point)}Z`:`M${st(n[0].point)}Q${st(n[1].point)}${Vr(n[1].point,n[2].point)}${n.length>3?"T":""}${s}L${st(n[t-1].point)}`}function Iue(n,e={}){const{start:t={},end:r={}}=e,{cap:i=!0}=t,{cap:s=!0}=r;Ye(!t.taper&&!r.taper,"cap taper not supported here"),Ye(!t.easing&&!r.easing,"cap easing not supported here"),Ye(i&&s,"cap must be true");const o=Po(n,e);Hv(o,e);const a=Mue(o);let l="";for(const c of a)l+=_ue(c,e);return l}function Mue(n){if(n.length<=2)return[n];const e=[];let t=[n[0]],r=b.Sub(n[1].point,n[0].point).uni(),i,s,o,a,l;for(let c=1,u=n.length;c<u-1;c++){if(o=n[c-1],a=n[c],l=n[c+1],i=b.Sub(l.point,a.point).uni(),s=b.Dpr(r,i),r=i,s<-.8){const d={...a,point:a.input};t.push(d),e.push(d2(t)),t=[d];continue}if(t.push(a),!(s>.7)&&(b.Dist2(o.point,a.point)+b.Dist2(a.point,l.point))/((o.radius+a.radius+l.radius)/3)**2<1.5){t.push(a),e.push(d2(t)),t=[a];continue}}return t.push(n[n.length-1]),e.push(d2(t)),e}function d2(n){const e=n[0];let t;for(;n.length>2&&(t=n[1],b.Dist2(e.point,t.point)<((e.radius+t.radius)/2*.5)**2);)n.splice(1,1);const r=n[n.length-1];let i;for(;n.length>2&&(i=n[n.length-2],b.Dist2(r.point,i.point)<((r.radius+i.radius)/2*.5)**2);)n.splice(n.length-2,1);return n.length>1&&(n[0]={...n[0],vector:b.Sub(n[0].point,n[1].point).uni()},n[n.length-1]={...n[n.length-1],vector:b.Sub(n[n.length-2].point,n[n.length-1].point).uni()}),n}function Aue(n,e,t){return"M "+n+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function _ue(n,e={}){if(n.length===0)return"";if(n.length===1)return Aue(n[0].point.x,n[0].point.y,n[0].radius);const{left:t,right:r}=yj(n,e);r.reverse();let i=`M${st(t[0])}T`;for(let s=1;s<t.length;s++)i+=Vr(t[s-1],t[s]);{const s=n[n.length-1],o=s.radius,a=s.vector.clone().per().neg(),l=b.Add(s.point,b.Mul(a,o)),c=b.Add(s.point,b.Mul(a,-o));i+=`${st(l)}A${q(o)},${q(o)} 0 0 1 ${st(c)}T`}for(let s=1;s<r.length;s++)i+=Vr(r[s-1],r[s]);{const s=n[0],o=s.radius,a=s.vector.clone().per(),l=b.Add(s.point,b.Mul(a,o)),c=b.Add(s.point,b.Mul(a,-o));i+=`${st(l)}A${q(o)},${q(o)} 0 0 1 ${st(c)}Z`}return i}const Rue=n=>n*.65+Zre(n*at/2)*.35,Due=n=>({size:n,thinning:.5,streamline:Pd(n,[9,16],[.64,.74],!0),smoothing:.62,easing:Rn.easeOutSine,simulatePressure:!0}),jue=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Rue}),lT=n=>({size:n,thinning:0,streamline:Pd(n,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:Rn.linear}),Lue=n=>({size:n,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Rn.linear});function lO({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Rn.easeOutSine,last:e}}function S4(n,e,t,r){const i=n.isComplete||t;return r?n.isPen?{...Lue(e),last:i}:{...lT(e),last:i}:n.dash==="draw"?n.isPen?{...jue(e),last:i}:{...Due(e),last:i}:{...lT(e),last:i}}function Ad(n){const e=[];for(const t of n)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(b.Cast));else{const r=Math.max(4,Math.floor(b.Dist(t.points[0],t.points[1])/16));e.push(...b.PointsBetween(t.points[0],t.points[1],r))}return e}function zue(n,e){return{draw:"none",solid:"none",dotted:`0.1 ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class Hm extends Ti{constructor(){super(...arguments);v(this,"hideResizeHandles",t=>h2(t));v(this,"hideRotateHandle",t=>h2(t));v(this,"hideSelectionBoundsFg",t=>h2(t));v(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:s}=r,o=[];for(const a of t.props.segments)o.push({...a,points:a.points.map(({x:l,y:c,z:u})=>({x:na(i*l),y:na(s*c),z:u}))});return{props:{segments:o}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(t){const r=Ad(t.props.segments),i=(Dn[t.props.size]+1)*t.props.scale;if(t.props.segments.length===1){const o=ye.FromPoints(r);if(o.width<i*2&&o.height<i*2)return new eO({x:-i,y:-i,radius:i,isFilled:!0})}const s=Po(r,S4(t.props,i,t.props.isPen,!0)).map(o=>o.point);return t.props.isClosed?new an({points:s,isFilled:t.props.fill!=="none"}):new eh({points:s})}component(t){return f.jsx(Il,{id:t.id,children:f.jsx(cT,{shape:t,zoomLevel:this.editor.getZoomLevel()})})}indicator(t){var d;const r=Ad(t.props.segments);let i=(Dn[t.props.size]+1)*t.props.scale;const s=this.editor.getZoomLevel();!(s<.5&&s<1.5/i)&&!t.props.isPen&&t.props.dash==="draw"&&r.length===1&&(i+=Ls(t.id)()*(i/6));const a=t.props.isComplete||((d=Hn(t.props.segments))==null?void 0:d.type)==="straight",l=S4(t.props,i,a,!0),c=Po(r,l),u=c.length>1?Qc(c,t.props.isClosed):Fj(r[0],i);return f.jsx("path",{d:u})}toSvg(t,r){r.addExportDef(iO(t.props.fill));const i=1/t.props.scale;return f.jsx("g",{transform:`scale(${i})`,children:f.jsx(cT,{shape:t,zoomLevel:1})})}getCanvasSvgDefs(){return[sO()]}expandSelectionOutlinePx(t){const r=t.props.dash==="draw"?1.6:1;return Dn[t.props.size]*r/2*t.props.scale}}v(Hm,"type","draw"),v(Hm,"props",NR),v(Hm,"migrations",$R);function Fj(n,e){const t=(e+1)*.5;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function h2(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function cT({shape:n,zoomLevel:e}){var d;const t=ds(),r=Ad(n.props.segments),i=n.props.isComplete||((d=Hn(n.props.segments))==null?void 0:d.type)==="straight";let s=(Dn[n.props.size]+1)*n.props.scale;const o=e<.5&&e<1.5/s;!o&&!n.props.isPen&&n.props.dash==="draw"&&r.length===1&&(s+=Ls(n.id)()*(s/6));const a=S4(n.props,s,i,o);if(!o&&n.props.dash==="draw")return f.jsxs(f.Fragment,{children:[n.props.isClosed&&n.props.fill&&r.length>1?f.jsx(or,{d:Qc(Po(r,a),n.props.isClosed),theme:t,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",scale:n.props.scale}):null,f.jsx("path",{d:Iue(r,a),strokeLinecap:"round",fill:t[n.props.color].solid})]});const l=Po(r,a),c=l.length<2,u=c?Fj(r[0],0):Qc(l,n.props.isClosed);return f.jsxs(f.Fragment,{children:[f.jsx(or,{d:u,theme:t,color:n.props.color,fill:c||n.props.isClosed?n.props.fill:"none",scale:n.props.scale}),f.jsx("path",{d:u,strokeLinecap:"round",fill:c?t[n.props.color].solid:"none",stroke:t[n.props.color].solid,strokeWidth:s,strokeDasharray:c?"none":zue(n,s),strokeDashoffset:"0"})]})}function Nue(n,e,t={}){const{newPoint:r,handle:i,scaleX:s,scaleY:o}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=t;let d=n.props.w*s,h=n.props.h*o;const p=new b(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=d-a;break}case"top":case"bottom":{p.x=(d-a)/2;break}default:p.x=0}d=a}}else if(p.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-d;break}default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:g,y:m}=p.rot(n.rotation).add(r);return{x:g,y:m,props:{w:Math.min(l,d),h:Math.min(u,h)}}}const $ue=n=>Object.entries(n).filter(([e,t])=>t).map(([e])=>e).join(" ");class Qm extends th{constructor(){super(...arguments);v(this,"hideSelectionBoundsFg",t=>!this.canResize(t));v(this,"canEdit",()=>!0);v(this,"canResize",t=>{var r,i;return!!((i=(r=cl(t.props.url))==null?void 0:r.definition)!=null&&i.doesResize)});v(this,"canEditInReadOnly",()=>!0);v(this,"isAspectRatioLocked",t=>{const r=cl(t.props.url);return(r==null?void 0:r.definition.isAspectRatioLocked)??!1});v(this,"onResize",(t,r)=>{const i=this.isAspectRatioLocked(t),s=cl(t.props.url);let o=(s==null?void 0:s.definition.minWidth)??200,a=(s==null?void 0:s.definition.minHeight)??200;if(i){const l=t.props.w/t.props.h;l>1?o*=l:a/=l}return Nue(t,r,{minWidth:o,minHeight:a})})}getDefaultProps(){return{w:300,h:300,url:""}}component(t){const{w:r,h:i,url:s}=t.props,o=Uv(t.id),a=k.useMemo(()=>bj(s),[s]),l=ee("is hovering",()=>{const{editingShapeId:p,hoveredShapeId:g}=this.editor.getCurrentPageState();if(p&&g!==p){const m=this.editor.getShape(p);if(m&&this.editor.isShapeOfType(m,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(t).rotation(),u=o||l;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(a==null?void 0:a.definition.type)==="tldraw")return null;if((a==null?void 0:a.definition.type)==="github_gist"){const p=a.url.split("/").pop();if(!p)throw Error("No gist id!");return f.jsx(Oa,{className:"tl-embed-container",id:t.id,children:f.jsx(Fue,{id:p,width:q(r),height:q(i),isInteractive:u,pageRotation:c})})}const h=$ue({...Rre,...(a==null?void 0:a.definition.overridePermissions)??{}});return f.jsx(Oa,{className:"tl-embed-container",id:t.id,children:a!=null&&a.definition?f.jsx("iframe",{className:"tl-embed",sandbox:h,src:a.embedUrl,width:q(r),height:q(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:aO(c),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(t){const r=k.useMemo(()=>cl(t.props.url),[t.props.url]);return f.jsx("rect",{width:q(t.props.w),height:q(t.props.h),rx:(r==null?void 0:r.definition.overrideOutlineRadius)??8,ry:(r==null?void 0:r.definition.overrideOutlineRadius)??8})}}v(Qm,"type","embed"),v(Qm,"props",FR),v(Qm,"migrations",BR);function Fue({id:n,file:e,isInteractive:t,width:r,height:i,style:s,pageRotation:o}){return f.jsx("iframe",{className:"tl-embed",draggable:!1,width:q(r),height:q(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...s,pointerEvents:t?"all":"none",zIndex:t?"":"-1",boxShadow:aO(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const Bue=k.forwardRef(({id:n,name:e,isEditing:t},r)=>{const i=G(),s=k.useCallback(l=>{l.key==="Enter"&&!l.nativeEvent.isComposing&&(Tn(l),l.currentTarget.blur(),i.setEditingShape(null))},[i]),o=k.useCallback(l=>{const c=i.getShape(n);if(!c)return;const u=c.props.name,d=l.currentTarget.value.trim();u!==d&&i.updateShapes([{id:n,type:"frame",props:{name:d}}])},[n,i]),a=k.useCallback(l=>{const c=i.getShape(n);if(!c)return;const u=c.props.name,d=l.currentTarget.value;u!==d&&i.updateShapes([{id:n,type:"frame",props:{name:d}}])},[n,i]);return f.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[f.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:s,onBlur:o,onChange:a}),Bj(e,"Frame")+""]})}),Uue=function({id:e,name:t,width:r,height:i}){const s=G(),o=ee("shape rotation",()=>kl(s.getShapePageTransform(e).rotation()),[s,e]),a=Uv(e),l=k.useRef(null),c=k.useCallback(g=>{const m=Zr(g);g.preventDefault(),s.getEditingShapeId()!==e&&s.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:s.getShape(e),...m})},[s,e]);k.useEffect(()=>{const g=l.current;g&&a&&(g.focus(),g.select())},[l,a]);const d=((o+Math.PI/4)*(2/Math.PI)+4)%4,h=["top","left","bottom","right"][Math.floor(d)];let p;switch(h){case"top":p="";break;case"right":p=`translate(${q(r)}px, 0px) rotate(90deg)`;break;case"bottom":p=`translate(${q(r)}px, ${q(i)}px) rotate(180deg)`;break;case"left":p=`translate(0px, ${q(i)}px) rotate(270deg)`;break}return f.jsx("div",{className:"tl-frame-heading",style:{overflow:a?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(h==="top"||h==="bottom"?r:i)}px + var(--space-5))`,bottom:"100%",transform:`${p} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:c,children:f.jsx("div",{className:"tl-frame-heading-hit-area",children:f.jsx(Bue,{ref:l,id:e,name:t,isEditing:a})})})};function Bj(n,e){return n.match(/^\s*$/)?e:n}class qm extends th{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"canReceiveNewChildrenOfType",(t,r)=>!t.isLocked);v(this,"canDropShapes",(t,r)=>!t.isLocked);v(this,"onDragShapesOver",(t,r)=>{r.every(i=>i.parentId===t.id)||this.editor.reparentShapes(r,t.id)});v(this,"onDragShapesOut",(t,r)=>{const i=this.editor.getShape(t.parentId);i&&this.editor.isShapeOfType(i,"group")?this.editor.reparentShapes(r,i.id):this.editor.reparentShapes(r,this.editor.getCurrentPageId())});v(this,"onResize",(t,r)=>i0(t,r))}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(t){return new As({width:t.props.w,height:t.props.h,isFilled:!1})}component(t){const r=this.editor.getShapeGeometry(t).bounds,i=ds(),s=ee("is creating this shape",()=>{const o=this.editor.getStateDescendant("select.resizing");if(!o||!o.getIsActive())return!1;const a=o==null?void 0:o.info;return a?a.isCreating&&this.editor.getOnlySelectedShapeId()===t.id:!1},[t.id]);return f.jsxs(f.Fragment,{children:[f.jsx(Il,{children:f.jsx("rect",{className:Te("tl-frame__body",{"tl-frame__creating":s}),width:r.width,height:r.height,fill:i.solid,stroke:i.text})}),s?null:f.jsx(Uue,{id:t.id,name:t.props.name,width:r.width,height:r.height})]})}toSvg(t,r){const i=Ra({isDarkMode:r.isDarkMode}),a=((kl(this.editor.getShapePageTransform(t.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,l=Math.floor(a);let c;switch(l){case 0:c="";break;case 3:c=`translate(${q(t.props.w)}, 0) rotate(90)`;break;case 2:c=`translate(${q(t.props.w)}, ${q(t.props.h)}) rotate(180)`;break;case 1:c=`translate(0, ${q(t.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}const u={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:t.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},d=this.editor.textMeasure.measureTextSpans(Bj(t.props.name,"Frame")+"",u),h=d[0],p=Hn(d),g=p.box.w+p.box.x-h.box.x,m=y4(this.editor,d,{offsetY:-u.height-2,...u});return f.jsxs(f.Fragment,{children:[f.jsx("rect",{width:t.props.w,height:t.props.h,fill:i.solid,stroke:i.black.solid,strokeWidth:1,rx:1,ry:1}),f.jsxs("g",{transform:c,children:[f.jsx("rect",{x:-8,y:-u.height-4,width:g+16,height:u.height,fill:i.background,rx:4,ry:4}),m]})]})}indicator(t){const r=this.editor.getShapeGeometry(t).bounds;return f.jsx("rect",{width:q(r.width),height:q(r.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}v(qm,"type","frame"),v(qm,"props",UR),v(qm,"migrations",HR);function uT(n,e){return n>e?(at*(e/2)+(n-e))*2:(at*(n/2)+(e-n))*2}function Uj(n,e){return cO(n,e).map((t,r)=>t.getSvgPathData(r===0)).join(" ")+" Z"}function Hue(n,e,t,r){const i=n/4,s=e/4,o=Ls(r),a=t*.75,l=x=>x.addXY(o()*a,o()*a),c=new b(n/2,e),u=new b(0,s*1.2),d=new b(n/2,s*.9),h=new b(n,s*1.2),p=l(new b(n/2,e)),g=l(new b(0,s*1.2)),m=l(new b(n/2,s*.9)),S=l(new b(n,s*1.2));return[new lr({start:c,cp1:new b(i*1.5,s*3),cp2:new b(0,s*2.5),end:u}),new lr({start:u,cp1:new b(0,-s*.32),cp2:new b(i*1.85,-s*.32),end:d}),new lr({start:d,cp1:new b(i*2.15,-s*.32),cp2:new b(n,-s*.32),end:h}),new lr({start:h,cp1:new b(n,s*2.5),cp2:new b(i*2.5,s*3),end:p}),new lr({start:p,cp1:new b(i*1.5,s*3),cp2:new b(0,s*2.5),end:g}),new lr({start:g,cp1:new b(0,-s*.32),cp2:new b(i*1.85,-s*.32),end:m}),new lr({start:m,cp1:new b(i*2.15,-s*.32),cp2:new b(n,-s*.32),end:S}),new lr({start:S,cp1:new b(n,s*2.5),cp2:new b(i*2.5,s*3),end:c})].map((x,w)=>x.getSvgPathData(w===0)).join(" ")+" Z"}function cO(n,e){const t=n/4,r=e/4;return[new lr({start:new b(n/2,e),cp1:new b(t*1.5,r*3),cp2:new b(0,r*2.5),end:new b(0,r*1.2)}),new lr({start:new b(0,r*1.2),cp1:new b(0,-r*.32),cp2:new b(t*1.85,-r*.32),end:new b(n/2,r*.9)}),new lr({start:new b(n/2,r*.9),cp1:new b(t*2.15,-r*.32),cp2:new b(n,-r*.32),end:new b(n,r*1.2)}),new lr({start:new b(n,r*1.2),cp1:new b(n,r*2.5),cp2:new b(t*2.5,r*3),end:new b(n/2,e)})]}function Que(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function que(n,e,t,r){const i=Ls(n),s=e/2,o=t/2,a=cD(s,o),l=[],c=pt*i(),u=pt+Mt/2+Math.abs(i())*Mt,d=Math.max(16,a/10);for(let h=0;h<d;h++){const p=h/(d-1),g=c+p*u,m=Math.cos(g),S=Math.sin(g);l.push(new b(s*m+e*.5+.05*i(),o*S+t/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?Rn.easeInOutSine(p):Rn.easeInExpo(p)))/2)))}return Po(l,Que(r))}function Wue(n,e,t,r){return Qc(que(n,e,t,r))}function x4(n){let e="M";const t=n.length;let r,i,s;for(let o=0,a=t;o<a;o+=3)r=n[o],i=n[o+1],s=n[o+2],e+=`${st(r)}L${st(i)}Q${st(s)}`;return e+=`${st(n[0])}`,e}function w4(n,e,t,r,i){const s=[],o=Ls(n);let a=e[0],l;const c=e.length;for(let u=0,d=c*i;u<d;u++){l=b.AddXY(e[(u+1)%c],o()*t,o()*t);const h=b.Sub(l,a),p=b.Len(h),g=b.Div(h,p).mul(Math.min(p/4,r));s.push(b.Add(a,g),b.Add(l,g.neg()),l),a=l}return s}function Vue(n,e,t){const r=Math.min(n,e)/2,i=Math.max(n,e)-r*2,o=(Math.PI*(r*2)+2*i)/t,a=n>e?[{type:"straight",start:new b(r,0),delta:new b(1,0)},{type:"arc",center:new b(n-r,r),startAngle:-at/2},{type:"straight",start:new b(n-r,e),delta:new b(-1,0)},{type:"arc",center:new b(r,r),startAngle:at/2}]:[{type:"straight",start:new b(n,r),delta:new b(0,1)},{type:"arc",center:new b(r,e-r),startAngle:0},{type:"straight",start:new b(0,e-r),delta:new b(0,-1)},{type:"arc",center:new b(r,r),startAngle:at}];let l=0;const c=[];for(let u=0;u<t;u++){const d=a[0];d.type==="straight"?c.push(b.Add(d.start,b.Mul(d.delta,l))):c.push(Hc(d.center,r,d.startAngle+l/r)),l+=o;let h=d.type==="straight"?i:at*r;for(;l>h;)l-=h,a.push(a.shift()),h=a[0].type==="straight"?i:at*r}return c}const Gue={s:50,m:70,l:100,xl:130},Xue=.2;function Gv(n,e,t,r){const i=Ls(t),s=uT(n,e),o=Math.max(Math.ceil(s/Gue[r]),6,Math.ceil(s/Math.min(n,e))),a=s/o*Xue,l=Math.max(n-a*2,1),c=Math.max(e-a*2,1),d=uT(l,c)/o,h=(n-l)/2,p=(e-c)/2,g=Vue(l,c,o).map(w=>w.addXY(h,p)),m=n<20?0:a*.3,S=e<20?0:a*.3,y=g.slice(0);for(let w=0;w<Math.floor(o/2);w++)y[w]=b.AddXY(y[w],i()*m,i()*S),y[o-w-1]=b.AddXY(y[o-w-1],i()*m,i()*S);const x=[];for(let w=0;w<y.length;w++){const O=w===y.length-1?0:w+1,T=y[w],E=y[O],C=g[w],M=g[O],A=b.Dist(C,M),D=d-A,F=b.Dist(T,E)/A,j=(Math.max(h,p)+D)*F,L=b.Lrp(C,M,.5).add(b.Sub(M,C).uni().per().mul(j));L.x<0?L.x=0:L.x>n&&(L.x=n),L.y<0?L.y=0:L.y>e&&(L.y=e);const U=j6(T,E,L),Y=b.Dist(U||b.Average([T,E]),T);x.push({leftPoint:T,rightPoint:E,arcPoint:L,center:U,radius:Y})}return x}function Kue(n,e,t,r){const i=[],s=Gv(n,e,t,r);for(const{center:o,radius:a,leftPoint:l,rightPoint:c}of s)i.push(...nie(l,c,o,a,10));return i}function b4(n,e,t,r){const i=Gv(n,e,t,r);let s=`M${i[0].leftPoint.toFixed()}`;for(const{leftPoint:o,rightPoint:a,radius:l,center:c}of i){if(c===null){s+=` L${a.toFixed()}`;continue}const u=b.Clockwise(o,a,c)?"0":"1";s+=` A${q(l)},${q(l)} 0 ${u},1 ${a.toFixed()}`}return s+=" Z",s}const Yue={s:.5,m:.7,l:.9,xl:1.6};function Zue(n,e,t,r){const i=Ls(t),s=Yue[r],o=Gv(n,e,t,r),c=o.reduce((p,g)=>p+b.Dist2(g.leftPoint,g.rightPoint),0)/o.length>(s*15)**2?p=>p.addXY(i()*s*2,i()*s*2):p=>p;let u=`M${o[0].leftPoint.toFixed()}`,d=c(o[0].leftPoint),h=`M${d.toFixed()}`;for(const{leftPoint:p,center:g,rightPoint:m,radius:S,arcPoint:y}of o){if(g===null){u+=` L${m.toFixed()}`;const C=c(m);h+=` L${C.toFixed()}`,d=C;continue}const x=b.Clockwise(p,m,g)?"0":"1";u+=` A${q(S)},${q(S)} 0 ${x},1 ${m.toFixed()}`;const w=c(m),O=c(y),T=j6(d,w,O);if(!Number.isFinite(T.x)||!Number.isFinite(T.y)){h+=` L${w.toFixed()}`,d=w;continue}const E=Math.abs(b.Dist(T,d));h+=` A${q(E)},${q(E)} 0 ${x},1 ${w.toFixed()}`,d=w}return u+h+" Z"}function O4(n,e){switch(n.geo){case"x-box":return Jue(n.w,n.h,e,n.dash);case"check-box":return ede(n.w,n.h);default:return}}function Jue(n,e,t,r){const i=r==="draw"?.62:0;if(r==="dashed")return[[new b(0,0),new b(n/2,e/2)],[new b(n,e),new b(n/2,e/2)],[new b(0,e),new b(n/2,e/2)],[new b(n,0),new b(n/2,e/2)]];const s=a=>Math.max(0,Math.min(n,a)),o=a=>Math.max(0,Math.min(e,a));return[[new b(s(t*i),o(t*i)),new b(s(n-t*i),o(e-t*i))],[new b(s(t*i),o(e-t*i)),new b(s(n-t*i),o(t*i))]]}function ede(n,e){const t=Math.min(n,e)*.82,r=(n-t)/2,i=(e-t)/2,s=a=>Math.max(0,Math.min(n,a)),o=a=>Math.max(0,Math.min(e,a));return[[new b(s(r+t*.25),o(i+t*.52)),new b(s(r+t*.45),o(i+t*.82))],[new b(s(r+t*.45),o(i+t*.82)),new b(s(r+t*.82),o(i+t*.22))]]}function dT({shape:n,shouldScale:e}){const t=e?n.props.scale:1,r=G(),i=ds(),{id:s,props:o}=n,{w:a,color:l,fill:c,dash:u,growY:d,size:h}=o,p=Dn[h]*t,g=o.h+d;switch(o.geo){case"cloud":if(u==="solid"){const m=b4(a,g,s,h);return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:m,color:l,fill:c,scale:t}),f.jsx("path",{d:m,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}else if(u==="draw"){const m=Zue(a,g,s,h);return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:m,color:l,fill:c,scale:t}),f.jsx("path",{d:m,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}else{const m=b4(a,g,s,h),S=Gv(a,g,s,h);return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:m,color:l,fill:c,scale:t}),f.jsx("g",{strokeWidth:p,stroke:i[l].solid,fill:"none",pointerEvents:"all",children:S.map(({leftPoint:y,rightPoint:x,center:w,radius:O},T)=>{const E=w?O*kl(kl(b.Angle(w,x))-kl(b.Angle(w,y))):b.Dist(y,x),{strokeDasharray:C,strokeDashoffset:M}=eo(E,p,{style:u,start:"outset",end:"outset"});return f.jsx("path",{d:w?`M${y.x},${y.y}A${O},${O},0,0,1,${x.x},${x.y}`:`M${y.x},${y.y}L${x.x},${x.y}`,strokeDasharray:C,strokeDashoffset:M},T)})})]})}case"ellipse":{const m=e?r.getShapeGeometry(n):r.getShapeUtil(n).getGeometry(n),S=m.getSvgPathData(!0);if(u==="dashed"||u==="dotted"){const y=m.length,{strokeDasharray:x,strokeDashoffset:w}=eo(y<64?y*2:y,p,{style:u,snap:4,closed:!0});return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:S,color:l,fill:c,scale:t}),f.jsx("path",{d:S,strokeWidth:p,fill:"none",stroke:i[l].solid,strokeDasharray:x,strokeDashoffset:w})]})}else{const x=(e?r.getShapeGeometry(n):r.getShapeUtil(n).getGeometry(n)).getSvgPathData(!0);return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:x,color:l,fill:c,scale:t}),f.jsx("path",{d:x,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}}case"oval":{const m=e?r.getShapeGeometry(n):r.getShapeUtil(n).getGeometry(n),S=m.getSvgPathData(!0);if(u==="dashed"||u==="dotted"){const y=m.getLength(),{strokeDasharray:x,strokeDashoffset:w}=eo(y<64?y*2:y,p,{style:u,snap:4,start:"outset",end:"outset",closed:!0});return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:S,color:l,fill:c,scale:t}),f.jsx("path",{d:S,strokeWidth:p,fill:"none",stroke:i[l].solid,strokeDasharray:x,strokeDashoffset:w})]})}else return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:S,color:l,fill:c,scale:t}),f.jsx("path",{d:S,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}case"heart":if(u==="dashed"||u==="dotted"||u==="solid"){const m=Uj(a,g),S=cO(a,g);return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:m,color:l,fill:c,scale:t}),S.map((y,x)=>{const{strokeDasharray:w,strokeDashoffset:O}=eo(y.length,p,{style:u,snap:1,start:"outset",end:"outset",closed:!0});return f.jsx("path",{d:y.getSvgPathData(),strokeWidth:p,fill:"none",stroke:i[l].solid,strokeDasharray:w,strokeDashoffset:O,pointerEvents:"all"},`curve_${x}`)})]})}else{const m=Hue(a,g,p,n.id);return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:m,color:l,fill:c,scale:t}),f.jsx("path",{d:m,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}default:{const m=e?r.getShapeGeometry(n):r.getShapeUtil(n).getGeometry(n),S=m instanceof Ms?m.children[0].vertices:m.vertices,y=O4(n.props,p);if(u==="solid"){let x="M"+S[0]+"L"+S.slice(1)+"Z";if(y)for(const[w,O]of y)x+=`M${w.x},${w.y}L${O.x},${O.y}`;return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:x,color:l,fill:c,scale:t}),f.jsx("path",{d:x,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}else if(u==="dashed"||u==="dotted"){const x="M"+S[0]+"L"+S.slice(1)+"Z";return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:x,color:l,fill:c,scale:t}),f.jsxs("g",{strokeWidth:p,stroke:i[l].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(S.length)).map((w,O)=>{const T=b.ToFixed(S[O]),E=b.ToFixed(S[(O+1)%S.length]),C=b.Dist(T,E),{strokeDasharray:M,strokeDashoffset:A}=eo(C,p,{style:u,start:"outset",end:"outset"});return f.jsx("line",{x1:T.x,y1:T.y,x2:E.x,y2:E.y,strokeDasharray:M,strokeDashoffset:A},O)}),y&&y.map(([w,O],T)=>{const E=b.Dist(w,O),{strokeDasharray:C,strokeDashoffset:M}=eo(E,p,{style:u,start:"skip",end:"skip",snap:u==="dotted"?4:void 0});return f.jsx("path",{d:`M${w.x},${w.y}L${O.x},${O.y}`,stroke:i[l].solid,strokeWidth:p,fill:"none",strokeDasharray:C,strokeDashoffset:M},`line_fg_${T}`)})]})]})}else if(u==="draw"){let x=x4(w4(s,S,p/3,p*2,2));if(y)for(const[O,T]of y)x+=`M${O.toFixed()}L${T.toFixed()}`;const w=x4(w4(s,S,0,p*2,1));return f.jsxs(f.Fragment,{children:[f.jsx(or,{theme:i,d:w,color:l,fill:c,scale:t}),f.jsx("path",{d:x,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}}}}const hT=17*3;class Wm extends th{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:s}}=t;s.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])});v(this,"onResize",(t,{handle:r,newPoint:i,scaleX:s,scaleY:o,initialShape:a})=>{const l=a.props.w/a.props.scale,c=a.props.h/a.props.scale,u=a.props.growY/a.props.scale;let d=l*s,h=(c+u)*o,p=0,g=0;const m=hT;if(t.props.text.trim()){let T=Math.max(Math.abs(d),m),E=Math.max(Math.abs(h),m);T<m&&E===m&&(T=m),T===m&&E<m&&(E=m);const C=yg(this.editor,{...t,props:{...t.props,w:T*t.props.scale,h:E*t.props.scale}}),M=Math.max(Math.abs(d),C.w)*Math.sign(d),A=Math.max(Math.abs(h),C.h)*Math.sign(h);p=Math.abs(M)-Math.abs(d),g=Math.abs(A)-Math.abs(h),d=M,h=A}const S=d*t.props.scale,y=h*t.props.scale,x=new b(0,0);s<0&&(x.x+=S),(r==="left"||r==="top_left"||r==="bottom_left")&&(x.x+=s<0?p:-p),o<0&&(x.y+=y),(r==="top"||r==="top_left"||r==="top_right")&&(x.y+=o<0?g:-g);const{x:w,y:O}=x.rot(t.rotation).add(i);return{x:w,y:O,props:{w:Math.max(Math.abs(S),1),h:Math.max(Math.abs(y),1),growY:0}}});v(this,"onBeforeCreate",t=>{if(!t.props.text)return t.props.growY?{...t,props:{...t.props,growY:0}}:void 0;const r=t.props.h/t.props.scale,i=yg(this.editor,t).h;let s=null;if(i>r?s=i-r:t.props.growY&&(s=0),s!==null)return{...t,props:{...t.props,growY:s*t.props.scale}}});v(this,"onBeforeUpdate",(t,r)=>{const i=t.props.text,s=r.props.text;if(i===s&&t.props.font===r.props.font&&t.props.size===r.props.size)return;if(i&&!s)return{...r,props:{...r.props,growY:0}};const o=t.props.w/t.props.scale,a=t.props.h/t.props.scale,l=t.props.growY/t.props.scale,c=yg(this.editor,r);if(!i&&s&&s.length===1){let d=Math.max(o,c.w),h=Math.max(a,c.h);const p=hT;return o<p&&a<p&&(d=Math.max(d,p),h=Math.max(h,p),d=Math.max(d,h),h=Math.max(d,h)),{...r,props:{...r.props,w:d*r.props.scale,h:h*r.props.scale,growY:0}}}let u=null;if(c.h>a?u=c.h-a:l&&(u=0),u!==null){const d=r.props.w/r.props.scale;return{...r,props:{...r.props,growY:u*r.props.scale,w:Math.max(d,c.w)*r.props.scale}}}if(c.w>o)return{...r,props:{...r.props,w:c.w*r.props.scale}}});v(this,"onDoubleClick",t=>{if(this.editor.inputs.altKey)switch(t.props.geo){case"rectangle":return{...t,props:{geo:"check-box"}};case"check-box":return{...t,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(t){const r=Math.max(1,t.props.w),i=Math.max(1,t.props.h+t.props.growY),s=r/2,o=i/2,a=t.props.fill!=="none";let l;switch(t.props.geo){case"cloud":{l=new an({points:Kue(r,i,t.id,t.props.size),isFilled:a});break}case"triangle":{l=new an({points:[new b(s,0),new b(r,i),new b(0,i)],isFilled:a});break}case"diamond":{l=new an({points:[new b(s,0),new b(r,o),new b(s,i),new b(0,o)],isFilled:a});break}case"pentagon":{l=new an({points:qx(r,i,5),isFilled:a});break}case"hexagon":{l=new an({points:qx(r,i,6),isFilled:a});break}case"octagon":{l=new an({points:qx(r,i,8),isFilled:a});break}case"ellipse":{l=new _le({width:r,height:i,isFilled:a});break}case"oval":{l=new Rle({width:r,height:i,isFilled:a});break}case"star":{const w=pt/5/2,O=Math.floor(5/4)*2,T=5*2-O,E=0,C=Math.floor(5/2)*2,M=Math.cos(-Mt+O*w)*r/2,A=Math.cos(-Mt+T*w)*r/2,D=Math.sin(-Mt+E*w)*i/2,N=Math.sin(-Mt+C*w)*i/2,F=r-Math.abs(M-A),j=i-Math.abs(N-D),L=r/2+A-(r/2-M),U=i/2+D-(i/2-N),Y=1,V=(r-L)/2,W=(i-U)/2,J=(r+F)/2,ne=(i+j)/2,le=J*Y/2,ue=ne*Y/2;l=new an({points:Array.from(Array(5*2)).map((Pe,je)=>{const he=-Mt+je*w;return new b(V+(je%2?le:J)*Math.cos(he),W+(je%2?ue:ne)*Math.sin(he))}),isFilled:a});break}case"rhombus":{const x=Math.min(r*.38,i*.38);l=new an({points:[new b(x,0),new b(r,0),new b(r-x,i),new b(0,i)],isFilled:a});break}case"rhombus-2":{const x=Math.min(r*.38,i*.38);l=new an({points:[new b(0,0),new b(r-x,0),new b(r,i),new b(x,i)],isFilled:a});break}case"trapezoid":{const x=Math.min(r*.38,i*.38);l=new an({points:[new b(x,0),new b(r-x,0),new b(r,i),new b(0,i)],isFilled:a});break}case"arrow-right":{const x=Math.min(r,i)*.38,w=i*.16;l=new an({points:[new b(0,w),new b(r-x,w),new b(r-x,0),new b(r,i/2),new b(r-x,i),new b(r-x,i-w),new b(0,i-w)],isFilled:a});break}case"arrow-left":{const x=Math.min(r,i)*.38,w=i*.16;l=new an({points:[new b(x,0),new b(x,w),new b(r,w),new b(r,i-w),new b(x,i-w),new b(x,i),new b(0,i/2)],isFilled:a});break}case"arrow-up":{const x=r*.16,w=Math.min(r,i)*.38;l=new an({points:[new b(r/2,0),new b(r,w),new b(r-x,w),new b(r-x,i),new b(x,i),new b(x,w),new b(0,w)],isFilled:a});break}case"arrow-down":{const x=r*.16,w=Math.min(r,i)*.38;l=new an({points:[new b(x,0),new b(r-x,0),new b(r-x,i-w),new b(r,i-w),new b(r/2,i),new b(0,i-w),new b(x,i-w)],isFilled:a});break}case"check-box":case"x-box":case"rectangle":{l=new As({width:r,height:i,isFilled:a});break}case"heart":{const w=cO(r,i).reduce((O,T)=>(O.push(...T.vertices),O),[]);l=new an({points:w,isFilled:a});break}default:Vn(t.props.geo)}const c=yg(this.editor,t),u=r/t.props.scale,d=i/t.props.scale,h=Math.min(100,u/2),p=Math.min(ha[t.props.size]*Yn.lineHeight+Bi*2,d/2),g=Math.min(u,Math.max(c.w,Math.min(h,Math.max(1,u-8)))),m=Math.min(d,Math.max(c.h,Math.min(p,Math.max(1,d-8)))),S=O4(t.props,Dn[t.props.size]*t.props.scale),y=S?S.map(x=>new eh({points:x})):[];return new Ms({children:[l,new As({x:t.props.align==="start"?0:t.props.align==="end"?(u-g)*t.props.scale:(u-g)/2*t.props.scale,y:t.props.verticalAlign==="start"?0:t.props.verticalAlign==="end"?(d-m)*t.props.scale:(d-m)/2*t.props.scale,width:g*t.props.scale,height:m*t.props.scale,isFilled:!0,isLabel:!0}),...y]})}getHandleSnapGeometry(t){const r=this.getGeometry(t),i=r.children[0];switch(t.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:i,points:[...i.getVertices(),r.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:i,points:[r.bounds.center]};default:Vn(t.props.geo)}}component(t){const{id:r,type:i,props:s}=t,{fill:o,font:a,align:l,verticalAlign:c,size:u,text:d}=s,h=t.id===this.editor.getOnlySelectedShapeId(),p=ds(),m=this.editor.getEditingShapeId()!==null||t.props.text;return f.jsxs(f.Fragment,{children:[f.jsx(Il,{id:r,children:f.jsx(dT,{shape:t,shouldScale:!0})}),m&&f.jsx(Oa,{style:{overflow:"hidden",width:t.props.w,height:t.props.h+s.growY},children:f.jsx(Vv,{id:r,type:i,font:a,fontSize:ha[u]*t.props.scale,lineHeight:Yn.lineHeight,padding:Bi*t.props.scale,fill:o,align:l,verticalAlign:c,text:d,isSelected:h,labelColor:p[s.labelColor].solid,wrap:!0})}),t.props.url&&f.jsx(Md,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(t){const{id:r,props:i}=t,{w:s,size:o}=i,a=i.h+i.growY,l=Dn[o],c=this.editor.getShapeGeometry(t);switch(i.geo){case"ellipse":return i.dash==="draw"?f.jsx("path",{d:Wue(r,s,a,l)}):f.jsx("path",{d:c.getSvgPathData(!0)});case"heart":return f.jsx("path",{d:Uj(s,a)});case"oval":return f.jsx("path",{d:c.getSvgPathData(!0)});case"cloud":return f.jsx("path",{d:b4(s,a,r,o)});default:{const u=this.editor.getShapeGeometry(t),d=u instanceof Ms?u.children[0].vertices:u.vertices;let h;if(i.dash==="draw"){const g=w4(r,d,0,l*2*t.props.scale,1);h=x4(g)}else h="M"+d[0]+"L"+d.slice(1)+"Z";const p=O4(t.props,l);if(p)for(const[g,m]of p)h+=`M${g.x},${g.y}L${m.x},${m.y}`;return f.jsx("path",{d:h})}}}toSvg(t,r){const i={...t,props:{...t.props,w:t.props.w/t.props.scale,h:t.props.h/t.props.scale}},s=i.props;r.addExportDef(iO(s.fill));let o;if(s.text){r.addExportDef(qv(s.font));const a=Ra(r),l=new ye(0,0,s.w,s.h+s.growY);o=f.jsx(Wv,{fontSize:ha[s.size],font:s.font,align:s.align,verticalAlign:s.verticalAlign,text:s.text,labelColor:a[s.labelColor].solid,bounds:l,padding:16})}return f.jsxs(f.Fragment,{children:[f.jsx(dT,{shouldScale:!1,shape:i}),o]})}getCanvasSvgDefs(){return[sO()]}}v(Wm,"type","geo"),v(Wm,"props",QR),v(Wm,"migrations",qR);function yg(n,e){const{text:t,font:r,size:i,w:s}=e.props;if(!t)return{w:0,h:0};const o=n.textMeasure.measureText("w",{...Yn,fontFamily:wo[r],fontSize:ha[i],maxWidth:100}),a={s:2,m:3.5,l:5,xl:10},l=n.textMeasure.measureText(t,{...Yn,fontFamily:wo[r],fontSize:ha[i],minWidth:o.w,maxWidth:Math.max(0,Math.ceil(o.w+a[i]),Math.ceil(s/e.props.scale-Bi*2))});return{w:l.w+Bi*2,h:l.h+Bi*2}}function tde(){const[n,e]=k.useState(!1);return k.useEffect(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),i=matchMedia("(color-gamut: p3)");e(r&&i.matches);const s=()=>e(r&&i.matches);return i.addEventListener("change",s),()=>i.removeEventListener("change",s)},[]),ee(un.forceSrgb)||!n?"srgb":"p3"}const fT=.35,pT=.82;class Vm extends Ti{constructor(){super(...arguments);v(this,"hideResizeHandles",t=>vg(t));v(this,"hideRotateHandle",t=>vg(t));v(this,"hideSelectionBoundsFg",t=>vg(t));v(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:s}=r,o=[];for(const a of t.props.segments)o.push({...a,points:a.points.map(({x:l,y:c,z:u})=>({x:i*l,y:s*c,z:u}))});return{props:{segments:o}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(t){const r=mc(t);if(vg(t))return new eO({x:-r/2,y:-r/2,radius:r/2,isFilled:!0});const{strokePoints:i,sw:s}=gT(t,r,!0),o=lO({strokeWidth:s,showAsComplete:!0});return Hv(i,o),new an({points:tO(i,o),isFilled:!0})}component(t){const r=f2(this.editor,t),i=mc(t);return f.jsx(Il,{id:t.id,children:f.jsx(Sg,{shape:t,forceSolid:r,strokeWidth:i,opacity:fT})})}backgroundComponent(t){const r=f2(this.editor,t),i=mc(t);return f.jsx(Il,{id:t.id,children:f.jsx(Sg,{shape:t,forceSolid:r,strokeWidth:i,opacity:pT})})}indicator(t){const r=f2(this.editor,t),i=mc(t),{strokePoints:s,sw:o}=gT(t,i,r),a=Ad(t.props.segments);let l;return s.length<2?l=rde(a[0],o):l=Qc(s,!1),f.jsx("path",{d:l})}toSvg(t){const r=mc(t),i=r<1.5,s=1/t.props.scale;return f.jsx("g",{transform:`scale(${s})`,children:f.jsx(Sg,{forceSolid:i,strokeWidth:r,shape:t,opacity:fT})})}toBackgroundSvg(t){const r=mc(t),i=r<1.5,s=1/t.props.scale;return f.jsx("g",{transform:`scale(${s})`,children:f.jsx(Sg,{forceSolid:i,strokeWidth:r,shape:t,opacity:pT})})}}v(Vm,"type","highlight"),v(Vm,"props",GR),v(Vm,"migrations",XR);function nde(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function rde(n,e){const t=e/2;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function gT(n,e,t){var l;const r=Ad(n.props.segments),i=n.props.isComplete||((l=Hn(n.props.segments))==null?void 0:l.type)==="straight";let s=e;!t&&!n.props.isPen&&r.length===1&&(s+=Ls(n.id)()*(e/6));const o=lO({strokeWidth:s,showAsComplete:i});return{strokePoints:Po(r,o),sw:s}}function mc(n){return Ed[n.props.size]*1.12*n.props.scale}function vg(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function Sg({strokeWidth:n,forceSolid:e,shape:t,opacity:r}){var h;const i=ds(),s=Ad(t.props.segments);let o=n;!e&&!t.props.isPen&&s.length===1&&(o+=Ls(t.id)()*(o/6));const a=lO({strokeWidth:o,showAsComplete:t.props.isComplete||((h=Hn(t.props.segments))==null?void 0:h.type)==="straight"}),l=Po(s,a),c=l.length>1?Qc(l,!1):nde(t.props.segments[0].points[0]),u=tde(),d=i[t.props.color].highlight[u];return f.jsx("path",{d:c,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:d,strokeWidth:o,opacity:r})}function f2(n,e){return ee("forceSolid",()=>{const t=mc(e),r=n.getZoomLevel();return t/r<1.5},[n])}function Hj(){return f.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[f.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),f.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),f.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function Qj(n,e,t){const r=G(),[i,s]=k.useState(null),o=e?r.getAsset(e):null,l=r.getCulledShapes().has(n),c=k.useRef(!1);k.useEffect(()=>{i&&(c.current=!0)},[i]);const u=o&&"w"in o.props?t/o.props.w:1,d=ee("zoom level",()=>r.getZoomLevel()*u,[r,u]);return k.useEffect(()=>{if(l)return;let h=!1;const p=r.timers.setTimeout(async()=>{const g=await r.resolveAssetUrl(e,{screenScale:d});h||s(g)},c.current?500:0);return()=>{clearTimeout(p),h=!0}},[e,o==null?void 0:o.props.src,l,d,r]),{asset:o,url:i}}function qj(){const[n,e]=k.useState(!1);return k.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(t.matches)};return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),n}async function ide(n){const t=await(await Oo(n)).blob();return Ic.blobToDataUrl(t)}class Gm extends th{constructor(){super(...arguments);v(this,"isAspectRatioLocked",()=>!0);v(this,"canCrop",()=>!0);v(this,"onResize",(t,r)=>{let i=i0(t,r);const{flipX:s,flipY:o}=r.initialShape.props;return i={...i,props:{...i.props,flipX:r.scaleX<0!==s,flipY:r.scaleY<0!==o}},i});v(this,"onDoubleClick",t=>{const r=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;!r||!(r.props.src&&this.isAnimated(t))||this.editor.updateShapes([{type:"image",id:t.id,props:{playing:!t.props.playing}}])});v(this,"onDoubleClickEdge",t=>{const r=t.props;if(!r||this.editor.getCroppingShapeId()!==t.id)return;const i=It(r.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},s=1/(i.bottomRight.x-i.topLeft.x)*t.props.w,o=1/(i.bottomRight.y-i.topLeft.y)*t.props.h,a=new b(i.topLeft.x*s,i.topLeft.y*o).rot(t.rotation),l={id:t.id,type:t.type,x:t.x-a.x,y:t.y-a.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:s,h:o}};this.editor.updateShapes([l])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}isAnimated(t){const r=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;return r?"mimeType"in r.props&&ao.isAnimatedImageType(r==null?void 0:r.props.mimeType)||"isAnimated"in r.props&&r.props.isAnimated:!1}component(t){var m;const r=this.editor.getCroppingShapeId()===t.id,i=qj(),[s,o]=k.useState(""),[a,l]=k.useState(""),c=t.id===this.editor.getOnlySelectedShapeId(),{asset:u,url:d}=Qj(t.id,t.props.assetId,t.props.w);if(k.useEffect(()=>{if(d){let S=!1;const y=Cd();return y.onload=()=>{S||l(d)},y.src=d,()=>{S=!0}}},[d,t]),k.useEffect(()=>{if(d&&this.isAnimated(t)){let S=!1;const y=Cd();return y.onload=()=>{if(S)return;const x=document.createElement("canvas");x.width=y.width,x.height=y.height;const w=x.getContext("2d");w&&(w.drawImage(y,0,0),o(x.toDataURL()),l(d))},y.crossOrigin="anonymous",y.src=d,()=>{S=!0}}},[i,d,t]),(u==null?void 0:u.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const h=c&&r&&this.editor.isIn("select.crop"),p=i&&(((m=u==null?void 0:u.props.mimeType)==null?void 0:m.includes("video"))||this.isAnimated(t)),g=mT(t);return u!=null&&u.props.src?a?f.jsxs(f.Fragment,{children:[h&&f.jsx("div",{style:g,children:f.jsx("img",{className:"tl-image",crossOrigin:this.isAnimated(t)?"anonymous":void 0,src:!t.props.playing||p?s:a,referrerPolicy:"strict-origin-when-cross-origin",style:{opacity:.1},draggable:!1})}),f.jsxs(Oa,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h},children:[f.jsxs("div",{className:"tl-image-container",style:g,children:[f.jsx("img",{className:Te("tl-image",{"tl-flip-x":t.props.flipX&&!t.props.flipY,"tl-flip-y":t.props.flipY&&!t.props.flipX,"tl-flip-xy":t.props.flipY&&t.props.flipX}),crossOrigin:this.isAnimated(t)?"anonymous":void 0,src:!t.props.playing||p?s:a,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1}),this.isAnimated(t)&&!t.props.playing&&f.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),t.props.url&&f.jsx(Md,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})]}):null:f.jsxs(Oa,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h,color:"var(--color-text-3)",backgroundColor:u?"transparent":"var(--color-low)",border:u?"none":"1px solid var(--color-low-border)"},children:[f.jsx("div",{className:"tl-image-container",style:g,children:u?null:f.jsx(Hj,{})}),"url"in t.props&&t.props.url&&f.jsx(Md,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(t){return this.editor.getCroppingShapeId()===t.id?null:f.jsx("rect",{width:q(t.props.w),height:q(t.props.h)})}async toSvg(t){if(!t.props.assetId||!this.editor.getAsset(t.props.assetId))return null;let i=await this.editor.resolveAssetUrl(t.props.assetId,{shouldResolveToOriginal:!0});if(!i)return null;(i.startsWith("blob:")||i.startsWith("http")||i.startsWith("/")||i.startsWith("./"))&&(i=await ide(i)||"");const s=mT(t),o=t.props.crop;if(s.transform&&o){const{transform:a,width:l,height:c}=s,u=(o.bottomRight.x-o.topLeft.x)*l,d=(o.bottomRight.y-o.topLeft.y)*c,h=[new b(0,0),new b(u,0),new b(u,d),new b(0,d)],p=`cropClipPath_${t.id.replace(":","_")}`;return f.jsxs(f.Fragment,{children:[f.jsx("defs",{children:f.jsx("clipPath",{id:p,children:f.jsx("polygon",{points:h.map(g=>`${g.x},${g.y}`).join(" ")})})}),f.jsx("g",{clipPath:`url(#${p})`,children:f.jsx("image",{href:i,width:l,height:c,style:{transform:a}})})]})}else return f.jsx("image",{href:i,width:t.props.w,height:t.props.h})}}v(Gm,"type","image"),v(Gm,"props",KR),v(Gm,"migrations",YR);function mT(n){const e=n.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:n.props.w,height:n.props.h};const r=1/(e.bottomRight.x-e.topLeft.x)*n.props.w,i=1/(e.bottomRight.y-e.topLeft.y)*n.props.h,s=-t.x*r,o=-t.y*i;return{transform:`translate(${s}px, ${o}px)`,width:r,height:i}}function Wj(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function Vj(n,e,t){const r=e.vertices,i=Wj(t);return Po(r,i)}function sde(n,e,t){const r=Wj(t);return tO(Hv(Vj(n,e,t),r),r)}function ode(n,e,t){const r=sde(n,e,t);return N6(r)}function ade(n,e,t){if(n.props.dash==="draw"){const r=Vj(n,e,t);return Qc(r)}return e.getSvgPathData()}function Gj(n,e,t){let r=`M ${st(e[0])}L`,i=`M ${st(e[0])}L`;const s=t/3,o=t*2,a=Ls(n);let l=e[0],c,u=e[0],d;const h=e.length;for(let p=0,g=h-1;p<g;p++){c=e[p+1],d=b.AddXY(e[p+1],a()*s,a()*s);const m=b.Sub(c,l),S=b.Len(m),y=b.Div(m,S).mul(Math.min(S/4,o)),x=b.Add(l,y),w=b.Add(c,y.neg()),O=b.Sub(d,u),T=b.Len(O),E=b.Div(O,T).mul(Math.min(T/4,o)),C=b.Add(u,E),M=b.Add(d,E.neg());p===g-1?(r+=`${st(x)}L ${st(c)}`,i+=`${st(C)}L ${st(d)}`):(r+=`${st(x)}L ${st(w)}Q ${st(c)}`,i+=`${st(C)}L ${st(M)}Q ${st(d)}`,l=c,u=d)}return[r,r+i]}const lde=new wa;class Xm extends Ti{constructor(){super(...arguments);v(this,"hideResizeHandles",()=>!0);v(this,"hideRotateHandle",()=>!0);v(this,"hideSelectionBoundsFg",()=>!0);v(this,"hideSelectionBoundsBg",()=>!0);v(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:s}=r;return{props:{points:Vp(t.props.points,(o,{id:a,index:l,x:c,y:u})=>({id:a,index:l,x:c*i,y:u*s}))}}});v(this,"onHandleDrag",(t,{handle:r})=>{if(r.type==="vertex")return{...t,props:{...t.props,points:{...t.props.points,[r.id]:{id:r.id,index:r.index,x:r.x,y:r.y}}}}})}getDefaultProps(){const[t,r]=lp(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[t]:{id:t,index:t,x:0,y:0},[r]:{id:r,index:r,x:.1,y:.1}},scale:1}}getGeometry(t){return sf(t)}getHandles(t){return lde.get(t.props,()=>{const r=sf(t),i=rf(t),s=i.map(o=>({...o,id:o.index,type:"vertex",canSnap:!0}));for(let o=0;o<i.length-1;o++){const a=ap(i[o].index,i[o+1].index),c=r.segments[o].midPoint();s.push({id:a,type:"create",index:a,x:c.x,y:c.y,canSnap:!0})}return s.sort(fr)})}component(t){return f.jsx(Il,{id:t.id,children:f.jsx(yT,{shape:t})})}indicator(t){const r=Dn[t.props.size]*t.props.scale,i=sf(t),{dash:s}=t.props;let o;if(t.props.spline==="line"){const a=i.points;if(s==="solid"||s==="dotted"||s==="dashed")o="M"+a[0]+"L"+a.slice(1);else{const[l]=Gj(t.id,a,r);o=l}}else o=ade(t,i,r);return f.jsx("path",{d:o})}toSvg(t){return f.jsx(yT,{shouldScale:!0,shape:t})}getHandleSnapGeometry(t){const r=rf(t);return{points:r,getSelfSnapPoints:i=>{const s=this.getHandles(t).filter(o=>o.type==="vertex").findIndex(o=>o.id===i.id);return r.filter((o,a)=>Math.abs(a-s)>1).map(b.From)},getSelfSnapOutline:i=>{const s=this.getHandles(t).filter(a=>a.type==="vertex").findIndex(a=>a.id===i.id),o=sf(t).segments.filter((a,l)=>l!==s-1&&l!==s);return o.length?new Ms({children:o}):null}}}getInterpolatedProps(t,r,i){const s=rf(t),o=rf(r),a=[],l=[];let c=aR;if(s.length>o.length)for(let u=0;u<s.length;u++)a[u]={...s[u]},o[u]===void 0?l[u]={...o[o.length-1],id:c}:l[u]={...o[u],id:c},c=bs(c);else if(o.length>s.length)for(let u=0;u<o.length;u++)l[u]={...o[u]},s[u]===void 0?a[u]={...s[s.length-1],id:c}:a[u]={...s[u],id:c},c=bs(c);else for(let u=0;u<o.length;u++)a[u]=s[u],l[u]=o[u];return{...r.props,points:Object.fromEntries(a.map((u,d)=>{const h=l[d];return[u.id,{...u,x:Wr(u.x,h.x,i),y:Wr(u.y,h.y,i)}]}))}}}v(Xm,"type","line"),v(Xm,"props",ZR),v(Xm,"migrations",JR);function rf(n){return Object.values(n.props.points).sort(fr)}function sf(n){const e=rf(n).map(b.From);switch(n.props.spline){case"cubic":return new Ale({points:e});case"line":return new eh({points:e})}}function yT({shape:n,shouldScale:e=!1}){const t=ds(),r=sf(n),{dash:i,color:s,size:o}=n.props,a=1/n.props.scale,l=e?a:1,c=Dn[o]*n.props.scale;if(n.props.spline==="line"){if(i==="solid"){const u=r.points,d="M"+u[0]+"L"+u.slice(1);return f.jsx("path",{d,stroke:t[s].solid,strokeWidth:c,fill:"none",transform:`scale(${l})`})}if(i==="dashed"||i==="dotted")return f.jsx("g",{stroke:t[s].solid,strokeWidth:c,transform:`scale(${l})`,children:r.segments.map((u,d)=>{const{strokeDasharray:h,strokeDashoffset:p}=eo(u.length,c,{style:i,start:d>0?"outset":"none",end:d<r.segments.length-1?"outset":"none"});return f.jsx("path",{strokeDasharray:h,strokeDashoffset:p,d:u.getSvgPathData(!0),fill:"none"},d)})});if(i==="draw"){const u=r.points,[d,h]=Gj(n.id,u,c);return f.jsx("path",{d:h,stroke:t[s].solid,strokeWidth:c,fill:"none",transform:`scale(${l})`})}}if(n.props.spline==="cubic"){const u=r.getSvgPathData();if(i==="solid")return f.jsx("path",{strokeWidth:c,stroke:t[s].solid,fill:"none",d:u,transform:`scale(${l})`});if(i==="dashed"||i==="dotted")return f.jsx("g",{stroke:t[s].solid,strokeWidth:c,transform:`scale(${l})`,children:r.segments.map((d,h)=>{const{strokeDasharray:p,strokeDashoffset:g}=eo(d.length,c,{style:i,start:h>0?"outset":"none",end:h<r.segments.length-1?"outset":"none"});return f.jsx("path",{strokeDasharray:p,strokeDashoffset:g,d:d.getSvgPathData(),fill:"none"},h)})});if(i==="draw")return f.jsx("path",{d:ode(n,r,c),strokeWidth:1,stroke:t[s].solid,fill:t[s].solid,transform:`scale(${l})`})}}const Xj=k.createContext(null);function cde({assetUrls:n,children:e}){return k.useEffect(()=>{for(const t of Object.values(n.icons)){const r=Cd();r.src=t,r.decode()}for(const t of Object.values(n.embedIcons)){const r=Cd();r.src=t,r.decode()}},[n]),f.jsx(Xj.Provider,{value:n,children:e})}function uO(){const n=k.useContext(Xj);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const k4={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project","share-menu.copied":"Copied link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},ude=new Set(["ar","fa","he","ur","ku"]),xu={locale:"en",label:"English",messages:k4,dir:"ltr"};async function dde(n,e){if(!(await Oo(e.translations.en)).ok)return console.warn("No main translations found."),xu;if(n==="en")return xu;const r=hp.find(a=>a.locale===n);if(!r)return console.warn(`No translation found for locale ${n}`),xu;const s=await(await Oo(e.translations[r.locale])).json();if(!s)return console.warn(`No messages found for locale ${n}`),xu;const o=[];for(const a in xu.messages)s[a]||o.push(a);return o.length>0,{locale:n,label:r.label,dir:ude.has(r.locale)?"rtl":"ltr",messages:{...xu.messages,...s}}}const Kj=k.createContext(null);function Yj(){const n=k.useContext(Kj);if(!n)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return n}const hde=zn(function({overrides:e,children:t}){const i=G().user.getLocale(),s=uO(),[o,a]=k.useState(()=>e&&e.en?{locale:"en",label:"English",dir:"ltr",messages:{...k4,...e.en}}:{locale:"en",label:"English",dir:"ltr",messages:k4});return k.useEffect(()=>{let l=!1;async function c(){const u=await dde(i,s);u&&!l&&(e&&e[i]?a({...u,messages:{...u.messages,...e[i]}}):a(u))}return c(),()=>{l=!0}},[s,i,e]),f.jsx(Kj.Provider,{value:o,children:t})});function Xe(){const n=Yj();return k.useCallback(function(t){return n.messages[t]??t},[n])}class Km extends Ti{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"hideResizeHandles",()=>!0);v(this,"hideSelectionBoundsFg",()=>!1);v(this,"onBeforeCreate",t=>vT(this.editor,t));v(this,"onBeforeUpdate",(t,r)=>{if(!(t.props.text===r.props.text&&t.props.font===r.props.font&&t.props.size===r.props.size))return vT(this.editor,r)});v(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:s}}=t;s.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(t){const{labelHeight:r,labelWidth:i}=Zj(this.editor,t),{scale:s}=t.props,o=r*s,a=i*s,l=xt*s,c=xg(t);return new Ms({children:[new As({width:l,height:c,isFilled:!0}),new As({x:t.props.align==="start"?0:t.props.align==="end"?l-a:(l-a)/2,y:t.props.verticalAlign==="start"?0:t.props.verticalAlign==="end"?c-o:(c-o)/2,width:a,height:o,isFilled:!0,isLabel:!0})]})}getHandles(t){const{scale:r}=t.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const s=this.editor.getZoomLevel();if(s*r<.25)return[];const o=xg(t),a=xt*r,l=$ce/s*r;return s*r<.5?[{id:"bottom",index:"a3",type:"clone",x:a/2,y:o+l}]:[{id:"top",index:"a1",type:"clone",x:a/2,y:-l},{id:"right",index:"a2",type:"clone",x:a+l,y:o/2},{id:"bottom",index:"a3",type:"clone",x:a/2,y:o+l},{id:"left",index:"a4",type:"clone",x:-l,y:o/2}]}component(t){const{id:r,type:i,props:{scale:s,color:o,font:a,size:l,align:c,text:u,verticalAlign:d,fontSizeAdjustment:h}}=t,p=gde(r),g=ds(),m=xt*s,S=xg(t),y=ee("shape rotation",()=>{var O;return((O=this.editor.getShapePageTransform(r))==null?void 0:O.rotation())??0},[this.editor]),x=ee("zoom",()=>this.editor.getZoomLevel()<.35/s,[s,this.editor]),w=t.id===this.editor.getOnlySelectedShapeId();return f.jsxs(f.Fragment,{children:[f.jsx("div",{id:r,className:"tl-note__container",style:{width:m,height:S,backgroundColor:g[o].note.fill,borderBottom:x?`${3*s}px solid rgb(15, 23, 31, .2)`:"none",boxShadow:x?"none":mde(t.id,y,s)},children:f.jsx(Vv,{id:r,type:i,font:a,fontSize:(h||ha[l])*s,lineHeight:Yn.lineHeight,align:c,verticalAlign:d,text:u,isNote:!0,isSelected:w,labelColor:g[o].note.text,wrap:!0,padding:16*s,onKeyDown:p})}),"url"in t.props&&t.props.url&&f.jsx(Md,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(t){const{scale:r}=t.props;return f.jsx("rect",{rx:r,width:q(xt*r),height:q(xg(t))})}toSvg(t,r){t.props.text&&r.addExportDef(qv(t.props.font));const i=Ra({isDarkMode:r.isDarkMode}),s=yde(t);return f.jsxs(f.Fragment,{children:[f.jsx("rect",{x:5,y:5,rx:1,width:xt-10,height:s.h,fill:"rgba(0,0,0,.1)"}),f.jsx("rect",{rx:1,width:xt,height:s.h,fill:i[t.props.color].note.fill}),f.jsx(Wv,{fontSize:t.props.fontSizeAdjustment||ha[t.props.size],font:t.props.font,align:t.props.align,verticalAlign:t.props.verticalAlign,text:t.props.text,labelColor:i[t.props.color].note.text,bounds:s,stroke:!1})]})}}v(Km,"type","note"),v(Km,"props",eD),v(Km,"migrations",tD);function vT(n,e){const{labelHeight:t,fontSizeAdjustment:r}=Zj(n,e),i=Math.max(0,t-xt);if(i!==e.props.growY||r!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:i,fontSizeAdjustment:r}}}function fde(n,e){const{text:t}=e.props;if(!t)return{labelHeight:ha[e.props.size]*Yn.lineHeight+Bi*2,labelWidth:100,fontSizeAdjustment:0};const r=ha[e.props.size];let i=0,s=0,o=xt,a=xt;const l=1;do{i=Math.min(r,r-s);const c=n.textMeasure.measureText(t,{...Yn,fontFamily:wo[e.props.font],fontSize:i,maxWidth:xt-Bi*2-l,disableOverflowWrapBreaking:!0});if(o=c.h+Bi*2,a=c.w+Bi*2,i<=14){const u=n.textMeasure.measureText(t,{...Yn,fontFamily:wo[e.props.font],fontSize:i,maxWidth:xt-Bi*2-l});o=u.h+Bi*2,a=u.w+Bi*2;break}if(c.scrollWidth.toFixed(0)===c.w.toFixed(0))break}while(s++<50);return{labelHeight:o,labelWidth:a,fontSizeAdjustment:i}}const pde=new wa;function Zj(n,e){return pde.get(e,()=>fde(n,e))}function gde(n){const e=G(),t=Yj();return k.useCallback(r=>{const i=e.getShape(n);if(!i)return;const s=r.key==="Tab",o=(r.metaKey||r.ctrlKey)&&r.key==="Enter";if(s||o){r.preventDefault();const a=e.getShapePageTransform(n),l=a.rotation(),c=!!(t.dir==="rtl"||Oj(i.props.text)),u=(xt+e.options.adjacentShapeMargin+(o&&!r.shiftKey?i.props.growY:0))*i.props.scale,d=new b(s?r.shiftKey!=c?-1:1:0,o?r.shiftKey?-1:1:0).mul(u).add(Qv.clone().mul(i.props.scale)).rot(l).add(a.point()),h=Aj(e,i,d,l);h&&(e.mark("editing adjacent shape"),vy(e,h,!0))}},[n,e,t.dir])}function xg(n){return(xt+n.props.growY)*n.props.scale}function mde(n,e,t){const r=Ls(n),i=Math.abs(r())+.5,s=Math.cos(e),o=5*t,a=4*t,l=6*t,c=7*t;return`0px ${o-i}px ${o}px -${o}px rgba(15, 23, 31, .6),
	0px ${(a+i*c)*Math.max(0,s)}px ${l+i*c}px -${a+i*l}px rgba(15, 23, 31, ${(.3+i*.1).toFixed(2)}), 
	0px ${48*t}px ${10*t}px -${10*t}px inset rgba(15, 23, 44, ${((.022+r()*.005)*((1+s)/2)).toFixed(2)})`}function yde(n){return new ye(0,0,xt,xt+n.props.growY)}function vde(n,{initialBounds:e,scaleX:t,scaleY:r,newPoint:i}){const s=Math.max(.01,Math.min(Math.abs(t),Math.abs(r))),o=new b(0,0);t<0&&(o.x=-(e.width*s)),r<0&&(o.y=-(e.height*s));const{x:a,y:l}=b.Add(i,o.rot(n.rotation));return{x:a,y:l,props:{scale:s*n.props.scale}}}const Sde=new wa;class Ym extends Ti{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"isAspectRatioLocked",()=>!0);v(this,"onResize",(t,r)=>{const{newPoint:i,initialBounds:s,initialShape:o,scaleX:a,handle:l}=r;if(r.mode==="scale_shape"||l!=="right"&&l!=="left")return{id:t.id,type:t.type,...vde(t,r)};{const c=Math.max(1,Math.abs(s.width*a)),{x:u,y:d}=a<0?b.Sub(i,b.FromAngle(t.rotation).mul(c)):i;return{id:t.id,type:t.type,x:u,y:d,props:{w:c/o.props.scale,autoSize:!1}}}});v(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:s}}=t,o=t.props.text.trimEnd();o.length===0?this.editor.deleteShapes([t.id]):o!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])});v(this,"onBeforeUpdate",(t,r)=>{if(!r.props.autoSize)return;const i=t.props.size!==r.props.size||t.props.textAlign!==r.props.textAlign||t.props.font!==r.props.font||t.props.scale!==1&&r.props.scale===1,s=t.props.text!==r.props.text;if(!i&&!s)return;const o=this.getMinDimensions(t),a=ST(this.editor,r.props),l=o.width*t.props.scale,c=o.height*t.props.scale,u=a.width*r.props.scale,d=a.height*r.props.scale;let h;switch(r.props.textAlign){case"middle":{h=new b((u-l)/2,s?0:(d-c)/2);break}case"end":{h=new b(u-l,s?0:(d-c)/2);break}default:{if(s)break;h=new b(0,(d-c)/2);break}}if(h){h.rot(r.rotation);const{x:p,y:g}=r;return{...r,x:p-h.x,y:g-h.y,props:{...r.props,w:u}}}else return{...r,props:{...r.props,w:u}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(t){return Sde.get(t.props,r=>ST(this.editor,r))}getGeometry(t){const{scale:r}=t.props,{width:i,height:s}=this.getMinDimensions(t);return new As({width:i*r,height:s*r,isFilled:!0,isLabel:!0})}component(t){const{id:r,props:{font:i,size:s,text:o,color:a,scale:l,textAlign:c}}=t,{width:u,height:d}=this.getMinDimensions(t),h=t.id===this.editor.getOnlySelectedShapeId(),p=ds(),g=xde(r);return f.jsx(Vv,{id:r,classNamePrefix:"tl-text-shape",type:"text",font:i,fontSize:Ed[s],lineHeight:Yn.lineHeight,align:c,verticalAlign:"middle",text:o,labelColor:p[a].solid,isSelected:h,textWidth:u,textHeight:d,style:{transform:`scale(${l})`,transformOrigin:"top left"},wrap:!0,onKeyDown:g})}indicator(t){const r=this.editor.getShapeGeometry(t).bounds,i=G();return t.props.autoSize&&i.getEditingShapeId()===t.id?null:f.jsx("rect",{width:q(r.width),height:q(r.height)})}toSvg(t,r){t.props.text&&r.addExportDef(qv(t.props.font));const i=this.editor.getShapeGeometry(t).bounds,s=i.width/(t.props.scale??1),o=i.height/(t.props.scale??1),a=Ra(r);return f.jsx(Wv,{fontSize:Ed[t.props.size],font:t.props.font,align:t.props.textAlign,verticalAlign:"middle",text:t.props.text,labelColor:a[t.props.color].solid,bounds:new ye(0,0,s,o),padding:0})}}v(Ym,"type","text"),v(Ym,"props",nD),v(Ym,"migrations",rD);function ST(n,e){const{font:t,text:r,autoSize:i,size:s,w:o}=e,a=i?16:Math.max(16,o),l=Ed[s],c=i?null:Math.floor(Math.max(a,o)),u=n.textMeasure.measureText(r,{...Yn,fontFamily:wo[t],fontSize:l,maxWidth:c});return i&&(u.w+=1),{width:Math.max(a,u.w),height:Math.max(l,u.h)}}function xde(n){const e=G();return k.useCallback(t=>{if(e.getEditingShapeId()===n)switch(t.key){case"Enter":{(t.ctrlKey||t.metaKey)&&e.complete();break}case"Tab":{tt(t),t.shiftKey?Id.unindent(t.currentTarget):Id.indent(t.currentTarget);break}}},[e,n])}class Zm extends th{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(t){const{editor:r}=this,i=r.getShapeGeometry(t).bounds.w*r.getZoomLevel()>=110,{asset:s,url:o}=Qj(t.id,t.props.assetId,t.props.w),{time:a,playing:l}=t.props,c=Uv(t.id),u=qj(),d=k.useRef(null),h=k.useCallback(x=>{const w=x.currentTarget;w&&r.updateShapes([{type:"video",id:t.id,props:{playing:!0,time:w.currentTime}}])},[t.id,r]),p=k.useCallback(x=>{const w=x.currentTarget;w&&r.updateShapes([{type:"video",id:t.id,props:{playing:!1,time:w.currentTime}}])},[t.id,r]),g=k.useCallback(x=>{const w=x.currentTarget;w&&c&&r.updateShapes([{type:"video",id:t.id,props:{time:w.currentTime}}])},[c,t.id,r]),[m,S]=k.useState(!1),y=k.useCallback(x=>{const w=x.currentTarget;w&&(a!==w.currentTime&&(w.currentTime=a),l||w.pause(),S(!0))},[l,a]);return k.useEffect(()=>{const x=d.current;x&&(m&&!c&&a!==x.currentTime&&(x.currentTime=a),c&&document.activeElement!==x&&x.focus())},[c,m,a]),k.useEffect(()=>{if(u){const x=d.current;if(!x)return;x.pause(),x.currentTime=0}},[d,u]),f.jsxs(f.Fragment,{children:[f.jsx(Oa,{id:t.id,style:{color:"var(--color-text-3)",backgroundColor:s?"transparent":"var(--color-low)",border:s?"none":"1px solid var(--color-low-border)"},children:f.jsx("div",{className:"tl-counter-scaled",children:f.jsx("div",{className:"tl-video-container",children:s!=null&&s.props.src?o?f.jsx("video",{ref:d,style:c?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${t.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:c&&i,onPlay:h,onPause:p,onTimeUpdate:g,onLoadedData:y,hidden:!m,children:f.jsx("source",{src:o})}):null:f.jsx(Hj,{})})})}),"url"in t.props&&t.props.url&&f.jsx(Md,{url:t.props.url,zoomLevel:r.getZoomLevel()})]})}indicator(t){return f.jsx("rect",{width:q(t.props.w),height:q(t.props.h)})}toSvg(t){return f.jsx("image",{href:wde(t.id),width:t.props.w,height:t.props.h})}}v(Zm,"type","video"),v(Zm,"props",iD),v(Zm,"migrations",sD);function wde(n){const e=n.split(":")[1],t=document.querySelector(`.tl-video-shape-${e}`);if(t){const r=document.createElement("canvas");return r.width=t.videoWidth,r.height=t.videoHeight,r.getContext("2d").drawImage(t,0,0),r.toDataURL("image/png")}else throw new Error("Video with not found when attempting serialization.")}const dO=[Ym,Um,Hm,Wm,Km,Xm,qm,Bm,Vm,Qm,Gm,Zm];function bde(n){return n.sideEffects.register({instance_page_state:{afterChange:(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const r=n.isIn("select.crop");!e.croppingShapeId&&t.croppingShapeId?r||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&r&&n.setCurrentTool("select.idle")}e.editingShapeId!==t.editingShapeId&&(!e.editingShapeId&&t.editingShapeId?n.isIn("select.editing_shape")||n.setCurrentTool("select.editing_shape"):e.editingShapeId&&!t.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle"))}}})}class Jj extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"scribbleId","id");v(this,"markId","");v(this,"excludedShapeIds",new Set);v(this,"onEnter",t=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=t;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>{if(this.editor.isShapeOrAncestorLocked(s))return!0;if(this.editor.isShapeOfType(s,"group")||this.editor.isShapeOfType(s,"frame")){const o=this.editor.getPointInShapeSpace(s,r);return this.editor.getShapeGeometry(s).bounds.containsPoint(o)}return!1}).map(s=>s.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()});v(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)});v(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});v(this,"onPointerMove",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()})}update(){const{editor:t,excludedShapeIds:r}=this,i=t.getErasingShapeIds(),s=t.getZoomLevel(),o=t.getCurrentPageShapes(),{inputs:{currentPagePoint:a,previousPagePoint:l}}=t;this.pushPointToScribble();const c=new Set(i),u=this.editor.options.hitTestMargin/s;for(const d of o){if(t.isShapeOfType(d,"group"))continue;const h=t.getShapeMask(d.id);if(h&&!Pi(a,h))continue;const p=t.getShapeGeometry(d),g=t.getShapePageTransform(d);if(!p||!g)continue;const m=g.clone().invert(),S=m.applyToPoint(l),y=m.applyToPoint(a),{bounds:x}=p;x.minX-u>Math.max(S.x,y.x)||x.minY-u>Math.max(S.y,y.y)||x.maxX+u<Math.min(S.x,y.x)||x.maxY+u<Math.min(S.y,y.y)||p.hitTestLineSegment(S,y,u)&&c.add(t.getOutermostSelectableShape(d).id)}this.editor.setErasingShapes([...c].filter(d=>!r.has(d)))}complete(){const{editor:t}=this;t.deleteShapes(t.getCurrentPageState().erasingShapeIds),t.setErasingShapes([]),this.parent.transition("idle")}cancel(){const{editor:t}=this;t.setErasingShapes([]),t.bailToMark(this.markId),this.parent.transition("idle",this.info)}}v(Jj,"id","erasing");var Dw;let Ode=(Dw=class extends Oe{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(Dw,"id","idle"),Dw);var jw;let kde=(jw=class extends Oe{constructor(){super(...arguments);v(this,"onEnter",()=>{const t=this.editor.getZoomLevel(),r=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:i}}=this.editor,s=new Set,o=s.size;for(let a=r.length,l=a-1;l>=0;l--){const c=r[l];if(!(this.editor.isShapeOrAncestorLocked(c)||this.editor.isShapeOfType(c,"group"))&&this.editor.isPointInShape(c,i,{hitInside:!1,margin:this.editor.options.hitTestMargin/t})){const u=this.editor.getOutermostSelectableShape(c);if(this.editor.isShapeOfType(u,"frame")&&s.size>o)break;s.add(u.id)}}this.editor.setErasingShapes([...s])});v(this,"onLongPress",t=>{this.startErasing(t)});v(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.startErasing(t)});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.cancel()})}startErasing(t){this.parent.transition("erasing",t)}complete(){const t=this.editor.getErasingShapeIds();t.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(t)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},v(jw,"id","pointing"),jw);class of extends Oe{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}v(of,"id","eraser"),v(of,"initial","idle"),v(of,"isLockable",!1),v(of,"children",()=>[Ode,kde,Jj]);class eL extends Oe{constructor(){super(...arguments);v(this,"initialCamera",new b);v(this,"onEnter",()=>{this.initialCamera=b.From(this.editor.getCamera()),this.update()});v(this,"onPointerMove",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.parent.transition("idle")});v(this,"onComplete",()=>{this.complete()})}update(){const{initialCamera:t,editor:r}=this,{currentScreenPoint:i,originScreenPoint:s}=r.inputs,o=b.Sub(i,s).div(r.getZoomLevel());o.len2()!==0&&r.setCamera(t.clone().add(o))}complete(){const{editor:t}=this,{pointerVelocity:r}=t.inputs,i=Math.min(r.len(),2);i>.1&&this.editor.slideCamera({speed:i,direction:r}),this.parent.transition("idle")}}v(eL,"id","dragging");var Lw;let Cde=(Lw=class extends Oe{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.setCursor({type:"grab",rotation:0})});v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(Lw,"id","idle"),Lw);var zw;let Pde=(zw=class extends Oe{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})});v(this,"onLongPress",()=>{this.startDragging()});v(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startDragging()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.complete()})}startDragging(){this.parent.transition("dragging")}complete(){this.parent.transition("idle")}},v(zw,"id","pointing"),zw);class af extends Oe{constructor(){super(...arguments);v(this,"onDoubleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomIn(r,{animation:{duration:220,easing:Rn.easeOutQuint}})}});v(this,"onTripleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomOut(r,{animation:{duration:320,easing:Rn.easeOutQuint}})}});v(this,"onQuadrupleClick",t=>{if(t.phase==="settle"){const r=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:i}}=this.editor;r===1?this.editor.zoomToFit({animation:{duration:400,easing:Rn.easeOutQuint}}):this.editor.resetZoom(i,{animation:{duration:320,easing:Rn.easeOutQuint}})}})}}v(af,"id","hand"),v(af,"initial","idle"),v(af,"isLockable",!1),v(af,"children",()=>[Cde,Pde,eL]);var Nw;let Tde=(Nw=class extends Oe{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("lasering",t)})}},v(Nw,"id","idle"),Nw);class tL extends Oe{constructor(){super(...arguments);v(this,"scribbleId","id");v(this,"onEnter",()=>{const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()});v(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});v(this,"onPointerMove",()=>{this.pushPointToScribble()});v(this,"onPointerUp",()=>{this.complete()});v(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}v(tL,"id","lasering");class lf extends Oe{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}v(lf,"id","laser"),v(lf,"initial","idle"),v(lf,"children",()=>[Tde,tL]),v(lf,"isLockable",!1);class nL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"initialSelectedShapeIds",[]);v(this,"excludedShapeIds",new Set);v(this,"isWrapMode",!1);v(this,"initialStartShape",null);v(this,"onEnter",t=>{const{altKey:r,currentPagePoint:i}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),r){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>this.editor.isShapeOfType(s,"group")||this.editor.isShapeOrAncestorLocked(s)).map(s=>s.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.hitTestShapes()});v(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});v(this,"onTick",({elapsed:t})=>{const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)});v(this,"onPointerMove",()=>{this.hitTestShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",t=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",t)});v(this,"onKeyDown",t=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()});v(this,"onKeyUp",()=>{this.hitTestShapes()});v(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:t,excludedShapeIds:r,isWrapMode:i}=this,{inputs:{originPagePoint:s,currentPagePoint:o,shiftKey:a,ctrlKey:l}}=t,c=new Set(a?this.initialSelectedShapeIds:[]),u=i?!l:l,d=ye.FromPoints([s,o]),{corners:h}=d;let p,g,m,S,y,x;const w=t.getCurrentPageShapes(),O=t.getCurrentPageId();e:for(let C=0,M=w.length;C<M;C++){if(m=w[C],r.has(m.id)||c.has(m.id)||(S=t.getShapePageBounds(m),!S))continue e;if(d.contains(S)){this.handleHit(m,o,O,c,h);continue e}if(u||t.isShapeOfType(m,"frame"))continue e;if(d.collides(S)){if(y=t.getShapePageTransform(m),!y)continue e;x=y.clone().invert().applyToPoints(h);const A=t.getShapeGeometry(m);t:for(let D=0;D<4;D++)if(p=x[D],g=x[(D+1)%4],A.hitTestLineSegment(p,g,0)){this.handleHit(m,o,O,c,h);break t}}}t.getInstanceState().isCoarsePointer;const T=t.getInstanceState().brush;(!T||!d.equals(T))&&t.updateInstanceState({brush:{...d.toJson()}});const E=t.getSelectedShapeIds();(E.length!==c.size||E.some(C=>!c.has(C)))&&t.setSelectedShapes(Array.from(c))}handleHit(t,r,i,s,o){if(t.parentId===i){s.add(t.id);return}const a=this.editor.getOutermostSelectableShape(t),l=this.editor.getShapeMask(a.id);l&&!YD(l,o)&&!Pi(r,l)||s.add(a.id)}}v(nL,"id","brushing");const _d={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class rL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",t=>{this.info=t,this.updateCursor()});v(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startResizing()});v(this,"onLongPress",()=>{this.startResizing()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const t=this.editor.getSelectedShapes(),r=_d[this.info.handle];this.editor.setCursor({type:r,rotation:t.length===1?this.editor.getSelectionRotation():0})}startResizing(){this.editor.getInstanceState().isReadonly||this.parent.transition("resizing",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}v(rL,"id","pointing_resize_handle");const $i=8;class hO extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"markId","");v(this,"snapshot",{});v(this,"onEnter",t=>{this.info=t,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()});v(this,"onPointerMove",()=>{this.updateShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const r=_d[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()})}updateShapes(){const{shape:t,cursorHandleOffset:r}=this.snapshot;if(!t||!this.editor.getShapeUtil("image"))return;const s=t.props,o=this.editor.inputs.currentPagePoint.clone().sub(r),a=this.editor.inputs.originPagePoint.clone().sub(r),l=o.clone().sub(a).rot(-t.rotation),c=s.crop??this.getDefaultCrop(),u=It(c),d=new b(t.x,t.y),h=new b(0,0),p=1/(c.bottomRight.x-c.topLeft.x)*s.w,g=1/(c.bottomRight.y-c.topLeft.y)*s.h;let m=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(g<$i)break;m=!0,u.topLeft.y=u.topLeft.y+l.y/g,g*(u.bottomRight.y-u.topLeft.y)<$i?(u.topLeft.y=u.bottomRight.y-$i/g,h.y=(u.topLeft.y-c.topLeft.y)*g):u.topLeft.y<=0?(u.topLeft.y=0,h.y=(u.topLeft.y-c.topLeft.y)*g):h.y=l.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(g<$i)break;m=!0,u.bottomRight.y=Math.min(1,u.bottomRight.y+l.y/g),g*(u.bottomRight.y-u.topLeft.y)<$i&&(u.bottomRight.y=u.topLeft.y+$i/g);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(p<$i)break;m=!0,u.topLeft.x=u.topLeft.x+l.x/p,p*(u.bottomRight.x-u.topLeft.x)<$i?(u.topLeft.x=u.bottomRight.x-$i/p,h.x=(u.topLeft.x-c.topLeft.x)*p):u.topLeft.x<=0?(u.topLeft.x=0,h.x=(u.topLeft.x-c.topLeft.x)*p):h.x=l.x;break}case"right":case"top_right":case"bottom_right":{if(p<$i)break;m=!0,u.bottomRight.x=Math.min(1,u.bottomRight.x+l.x/p),p*(u.bottomRight.x-u.topLeft.x)<$i&&(u.bottomRight.x=u.topLeft.x+$i/p);break}}if(!m)return;d.add(h.rot(t.rotation));const S={id:t.id,type:t.type,x:d.x,y:d.y,props:{crop:u,w:(u.bottomRight.x-u.topLeft.x)*p,h:(u.bottomRight.y-u.topLeft.y)*g}};this.editor.updateShapes([S]),this.updateCursor()}complete(){this.updateShapes(),Pt(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getOnlySelectedShape(),s=this.editor.getSelectionRotatedPageBounds(),o=b.RotWith(s.getHandlePoint(this.info.handle),s.point,t),a=b.Sub(r,o);return{shape:i,cursorHandleOffset:a}}}v(hO,"id","cropping");function iL(n,e=!1){const t=n.getZoomLevel(),{inputs:{currentPagePoint:r}}=n;return n.getShapeAtPoint(r,{hitInside:!1,hitLabels:e,margin:n.options.hitTestMargin/t,renderingOnly:!0})??n.getSelectedShapeAtPoint(r)}function sL(n,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const i=n.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;i==="x"?t.x=0:i==="y"&&(t.y=0),t.rot(-e.rotation);const s=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,o=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,l=r.bottomRight.x-r.topLeft.x,c=It(r);return c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-t.x/s)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-t.y/o)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a,{id:e.id,type:e.type,props:{crop:c}}}var $w;let Ede=($w=class extends Oe{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.setCursor({type:"default",rotation:0});const t=this.editor.getOnlySelectedShape();t&&this.editor.setCroppingShape(t.id)});v(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0})});v(this,"onCancel",()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})});v(this,"onPointerDown",t=>{var r;if(!this.editor.getIsMenuOpen()){if(t.ctrlKey){this.cancel(),this.editor.root.handleEvent(t);return}switch(t.target){case"canvas":{const i=iL(this.editor);if(i&&!this.editor.isShapeOfType(i,"group")){this.onPointerDown({...t,shape:i,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(t);break}case"shape":{if(t.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",t);return}else(r=this.editor.getShapeUtil(t.shape))!=null&&r.canCrop(t.shape)?(this.editor.setCroppingShape(t.shape.id),this.editor.setSelectedShapes([t.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",t)):(this.cancel(),this.editor.root.handleEvent(t));break}case"selection":{switch(t.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...t,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...t,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}});v(this,"onDoubleClick",t=>{var o;if(this.editor.inputs.shiftKey||t.phase!=="up")return;const r=this.editor.getCroppingShapeId();if(!r)return;const i=this.editor.getShape(r);if(!i)return;const s=this.editor.getShapeUtil(i);if(s){if(t.target==="selection"){(o=s.onDoubleClickEdge)==null||o.call(s,i);return}this.cancel(),this.editor.root.handleEvent(t)}});v(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});v(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});v(this,"onKeyUp",t=>{switch(t.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(t=!1){const{editor:{inputs:{keys:r}}}=this,i=r.has("ShiftLeft"),s=new b(0,0);if(r.has("ArrowLeft")&&(s.x+=1),r.has("ArrowRight")&&(s.x-=1),r.has("ArrowUp")&&(s.y+=1),r.has("ArrowDown")&&(s.y-=1),s.equals(new b(0,0)))return;i&&s.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const a=sL(this.editor,o,s);a&&(t||this.editor.mark("translate crop"),this.editor.updateShapes([a]))}},v($w,"id","idle"),$w);class oL extends Oe{constructor(){super(...arguments);v(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});v(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",t)});v(this,"onPointerUp",t=>{this.editor.setCurrentTool("select.crop.idle",t)})}}v(oL,"id","pointing_crop");class fO extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];if(!r)return;const i=_d[this.info.handle];this.editor.setCursor({type:i,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(r.id)});v(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)});v(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startCropping()});v(this,"onLongPress",()=>{this.startCropping()});v(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}startCropping(){this.editor.getInstanceState().isReadonly||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}v(fO,"id","pointing_crop_handle");class aL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"markId","translating crop");v(this,"snapshot",{});v(this,"onEnter",t=>{this.info=t,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()});v(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0})});v(this,"onPointerMove",()=>{this.updateShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onKeyDown",t=>{switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}});v(this,"onKeyUp",t=>{switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:r,currentPagePoint:i}=this.editor.inputs,s=i.clone().sub(r),o=sL(this.editor,t,s);o&&this.editor.updateShapes([o])}}v(aL,"id","translating_crop");class Jm extends Oe{constructor(){super(...arguments);v(this,"markId","");v(this,"onEnter",()=>{this.didCancel=!1,this.markId="crop",this.editor.mark(this.markId)});v(this,"didCancel",!1);v(this,"onExit",()=>{this.didCancel?this.editor.bailToMark(this.markId):this.editor.squashToMark(this.markId)});v(this,"onCancel",()=>{this.didCancel=!0})}}v(Jm,"id","crop"),v(Jm,"initial","idle"),v(Jm,"children",()=>[Ede,aL,oL,fO,hO]);class lL extends Oe{constructor(){super(...arguments);v(this,"shapeId","");v(this,"initialHandle",{});v(this,"initialAdjacentHandle",null);v(this,"initialPagePoint",{});v(this,"markId","");v(this,"initialPageTransform");v(this,"initialPageRotation");v(this,"info",{});v(this,"isPrecise",!1);v(this,"isPreciseId",null);v(this,"pointingId",null);v(this,"onEnter",t=>{const{shape:r,isCreating:i,handle:s}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=r.id,this.markId=i?`creating:${r.id}`:"dragging handle",i||this.editor.mark(this.markId),this.initialHandle=It(s),this.editor.isShapeOfType(r,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...r,props:{points:{...r.props.points,[s.index]:{id:s.index,index:s.index,x:s.x,y:s.y}}}});const c=this.editor.getShapeHandles(r).find(u=>u.index===s.index);this.initialHandle=It(c)}this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:i?"cross":"grabbing",rotation:0});const o=this.editor.getShapeHandles(r).sort(fr),a=o.findIndex(l=>l.id===t.handle.id);this.initialAdjacentHandle=null;for(let l=a+1;l<o.length;l++){const c=o[l];if(c.type==="vertex"&&c.id!=="middle"&&c.id!==t.handle.id){this.initialAdjacentHandle=c;break}}if(!this.initialAdjacentHandle)for(let l=o.length-1;l>=0;l--){const c=o[l];if(c.type==="vertex"&&c.id!=="middle"&&c.id!==t.handle.id){this.initialAdjacentHandle=c;break}}if(this.editor.isShapeOfType(r,"arrow")){const l=Xr(this.editor,r)[t.handle.id];this.isPrecise=!1,l?(this.editor.setHintingShapes([l.toId]),this.isPrecise=l.props.isPrecise,this.isPrecise?this.isPreciseId=l.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)});v(this,"exactTimeout",-1);v(this,"onPointerMove",()=>{this.update()});v(this,"onKeyDown",()=>{this.update()});v(this,"onKeyUp",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.update(),this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clearIndicators(),Pt(this.editor,[this.shapeId]);const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var C;const{editor:t,shapeId:r,initialPagePoint:i}=this,{initialHandle:s,initialPageRotation:o,initialAdjacentHandle:a}=this,l=this.editor.getHintingShapeIds(),c=this.editor.user.getIsSnapMode(),{snaps:u,inputs:{currentPagePoint:d,shiftKey:h,ctrlKey:p,altKey:g,pointerVelocity:m}}=t,S=this.info.shape,y=t.getShape(r);if(!y)return;const x=t.getShapeUtil(y);let w=d.clone().sub(i).rot(-o).add(s);if(h&&a&&s.id!=="middle"){const M=b.Angle(a,w),D=dy(M,24)-M;w=b.RotWith(w,a,D)}t.snaps.clearIndicators();let O={...s,x:w.x,y:w.y};if(s.canSnap&&(c?!p:p)){if(!t.getShapePageTransform(y.id))throw Error("Expected a page transform");const A=u.handles.snapHandle({currentShapeId:r,handle:O});A&&(A.nudge.rot(-t.getShapeParentTransform(y).rotation()),w.add(A.nudge),O={...s,x:w.x,y:w.y})}const T=(C=x.onHandleDrag)==null?void 0:C.call(x,y,{handle:O,isPrecise:this.isPrecise||g,initial:S}),E={id:y.id,type:y.type,...T};if(s.type==="vertex"&&this.editor.isShapeOfType(y,"arrow")){const M=Xr(t,y)[s.id];M?l[0]!==M.toId&&(t.setHintingShapes([M.toId]),this.pointingId=M.toId,this.isPrecise=m.len()<.5||g,this.isPreciseId=this.isPrecise?M.toId:null,this.resetExactTimeout()):l.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}T&&t.updateShapes([E])}}v(lL,"id","dragging_handle");function cL(n){return n.isLabel?[n]:n instanceof Ms?n.children.filter(e=>e.isLabel):[]}class uL extends Oe{constructor(){super(...arguments);v(this,"hitShapeForPointerUp",null);v(this,"onEnter",()=>{const t=this.editor.getEditingShape();if(!t)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,aa(this.editor),this.editor.select(t)});v(this,"onExit",()=>{var s;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null),aa.cancel();const r=this.editor.getShape(t),i=this.editor.getShapeUtil(r);(s=i.onEditEnd)==null||s.call(i,r)});v(this,"onPointerMove",t=>{if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",t),this.hitShapeForPointerUp=null;return}switch(t.target){case"shape":case"canvas":{aa(this.editor);return}}});v(this,"onPointerDown",t=>{switch(this.hitShapeForPointerUp=null,t.target){case"shape":{const{shape:r}=t,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");const s=this.editor.getShapeUtil(r).getGeometry(r),o=cL(s),a=o.length===1?o[0]:void 0,l=this.editor.isShapeOfType(i,"text")&&i.props.text.trim()==="";if(a&&!l){const c=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(a.bounds.containsPoint(c,0)&&a.hitTestPoint(c)){if(r.id===i.id)return;this.hitShapeForPointerUp=r,this.editor.mark("editing on pointer up"),this.editor.select(r.id);return}}else{if(r.id===i.id)this.editor.isShapeOfType(r,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",t));else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)});v(this,"onPointerUp",t=>{const r=this.hitShapeForPointerUp;if(!r)return;this.hitShapeForPointerUp=null;const i=this.editor.getShapeUtil(r);if(!r.isLocked){if(this.editor.getInstanceState().isReadonly&&!i.canEditInReadOnly(r)){this.parent.transition("pointing_shape",t);return}this.editor.select(r.id),this.editor.setEditingShape(r.id),aa(this.editor)}});v(this,"onComplete",t=>{this.parent.transition("idle",t)});v(this,"onCancel",t=>{this.parent.transition("idle",t)})}}v(uL,"id","editing_shape");function xT(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function wy(n){const e=n.getSelectedShapeIds(),{shiftKey:t,altKey:r,currentPagePoint:i}=n.inputs,s=n.getShapeAtPoint(i,{hitInside:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:o=>!o.isLocked});if(s){const o=n.getOutermostSelectableShape(s);if(t&&!r)n.cancelDoubleClick(),e.includes(o.id)?(n.mark("deselecting shape"),n.deselect(o)):(n.mark("shift selecting shape"),n.setSelectedShapes([...e,o.id]));else{let a;o===s||o.id===n.getFocusedGroupId()||e.includes(o.id)?a=s:a=o,a&&!e.includes(a.id)&&(n.mark("selecting shape"),n.select(a.id))}}else{if(t)return;{e.length>0&&(n.mark("selecting none"),n.selectNone());const o=n.getFocusedGroupId();if(Qr(o)){const a=n.getShape(o);n.isPointInShape(a,i,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}const Ide=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var Fw;let Mde=(Fw=class extends Oe{constructor(){super(...arguments);v(this,"onEnter",()=>{this.parent.setCurrentToolIdMask(void 0),aa(this.editor),this.editor.setCursor({type:"default",rotation:0})});v(this,"onExit",()=>{aa.cancel()});v(this,"onPointerMove",()=>{aa(this.editor)});v(this,"onPointerDown",t=>{if(this.editor.getIsMenuOpen())return;const r=t.ctrlKey&&xT(this.editor);if(t.ctrlKey&&!r){if(t.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(t.shape)){this.parent.transition("pointing_shape",t);return}this.parent.transition("brushing",t);return}switch(t.target){case"canvas":{const i=iL(this.editor);if(i&&!i.isLocked){this.onPointerDown({...t,shape:i,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((s.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&wT(this.editor,a)){this.onPointerDown({...t,target:"selection"});return}this.parent.transition("pointing_canvas",t);break}case"shape":{const{shape:i}=t;if(this.isOverArrowLabelTest(i)){this.parent.transition("pointing_arrow_label",t);break}if(this.editor.isShapeOrAncestorLocked(i)){this.parent.transition("pointing_canvas",t);break}this.parent.transition("pointing_shape",t);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",t):this.parent.transition("pointing_handle",t);break}case"selection":{switch(t.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",t);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{r?this.parent.transition("crop.pointing_crop_handle",t):this.parent.transition("pointing_resize_handle",t);break}default:{const i=this.editor.getHoveredShape();if(i&&!this.editor.getSelectedShapeIds().includes(i.id)&&!i.isLocked){this.onPointerDown({...t,shape:i,target:"shape"});return}this.parent.transition("pointing_selection",t)}}break}}});v(this,"onDoubleClick",t=>{var r,i,s,o;if(!(this.editor.inputs.shiftKey||t.phase!=="up"))switch(t.target){case"canvas":{const a=this.editor.getHoveredShape(),l=a&&!this.editor.isShapeOfType(a,"group")?a:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(l){if(this.editor.isShapeOfType(l,"group")){wy(this.editor);return}else{const u=this.editor.getShape(l.parentId);if(u&&this.editor.isShapeOfType(u,"group")&&!(c&&u.id===c)){wy(this.editor);return}}this.onDoubleClick({...t,shape:l,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(t);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const a=this.editor.getOnlySelectedShape();if(a){const l=this.editor.getShapeUtil(a);if(!this.canInteractWithShapeInReadOnly(a))return;if(t.handle==="right"||t.handle==="left"||t.handle==="top"||t.handle==="bottom"){const c=(r=l.onDoubleClickEdge)==null?void 0:r.call(l,a);if(c){this.editor.mark("double click edge"),this.editor.updateShapes([c]),Pt(this.editor,[a.id]);return}}if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.parent.transition("crop",t);return}this.shouldStartEditingShape(a)&&this.startEditingShape(a,t,!0)}break}case"shape":{const{shape:a}=t,l=this.editor.getShapeUtil(a);if(a.type!=="video"&&a.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(l.onDoubleClick){const c=(i=l.onDoubleClick)==null?void 0:i.call(l,a);if(c){this.editor.updateShapes([c]);return}else if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.editor.mark("select and crop"),this.editor.select((s=t.shape)==null?void 0:s.id),this.parent.transition("crop",t);return}}this.shouldStartEditingShape(a)?this.startEditingShape(a,t,!0):this.handleDoubleClickOnCanvas(t);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:a,handle:l}=t,c=this.editor.getShapeUtil(a),u=(o=c.onDoubleClickHandle)==null?void 0:o.call(c,a,l);u?this.editor.updateShapes([u]):this.shouldStartEditingShape(a)&&this.startEditingShape(a,t,!0)}}});v(this,"onRightClick",t=>{switch(t.target){case"canvas":{const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!1,renderingOnly:!0});if(i){this.onRightClick({...t,shape:i,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((s.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&wT(this.editor,a)){this.onRightClick({...t,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:r}=this.editor.getCurrentPageState(),{shape:i}=t,s=this.editor.getOutermostSelectableShape(i,o=>!r.includes(o.id));!r.includes(s.id)&&!this.editor.findShapeAncestor(s,o=>r.includes(o.id))&&(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([s.id]));break}}});v(this,"onCancel",()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())});v(this,"onKeyDown",t=>{switch(t.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(un.editOnType.get()&&!Ide.includes(t.key)&&!t.altKey&&!t.ctrlKey){const r=this.editor.getOnlySelectedShape();if(r&&this.editor.isShapeOfType(r,"note")&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...t,target:"shape",shape:r},!0);return}}});v(this,"onKeyRepeat",t=>{switch(t.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});v(this,"onKeyUp",t=>{switch(t.code){case"Enter":{const r=this.editor.getSelectedShapes();if(r.every(s=>this.editor.isShapeOfType(s,"group"))){this.editor.setSelectedShapes(r.flatMap(s=>this.editor.getSortedChildIdsForParent(s.id)));return}const i=this.editor.getOnlySelectedShape();if(i&&this.shouldStartEditingShape(i)){this.startEditingShape(i,{...t,target:"shape",shape:i},!0);return}xT(this.editor)&&this.parent.transition("crop",t);break}}});v(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(t=this.editor.getOnlySelectedShape()){return!t||this.editor.isShapeOrAncestorLocked(t)&&t.type!=="embed"||!this.canInteractWithShapeInReadOnly(t)?!1:this.editor.getShapeUtil(t).canEdit(t)}startEditingShape(t,r,i){this.editor.isShapeOrAncestorLocked(t)&&t.type!=="embed"||(this.editor.mark("editing shape"),vy(this.editor,t,i),this.parent.transition("editing_shape",r))}isOverArrowLabelTest(t){if(!t)return!1;const r=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(t,"arrow")){const i=this.editor.getShapeGeometry(t).children[1];if(i&&Pi(r,i.vertices))return!0}return!1}handleDoubleClickOnCanvas(t){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const r=mt(),{x:i,y:s}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:r,type:"text",x:i,y:s,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(r);if(!o)return;const a=this.editor.getShapeUtil(o);this.editor.getInstanceState().isReadonly&&!a.canEditInReadOnly(o)||(this.editor.setEditingShape(r),this.editor.select(r),this.parent.transition("editing_shape",t))}nudgeSelectedShapes(t=!1){const{editor:{inputs:{keys:r}}}=this,i=r.has("ShiftLeft"),s=new b(0,0);if(r.has("ArrowLeft")&&(s.x-=1),r.has("ArrowRight")&&(s.x+=1),r.has("ArrowUp")&&(s.y-=1),r.has("ArrowDown")&&(s.y+=1),s.equals(new b(0,0)))return;t||this.editor.mark("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),a=this.editor.getInstanceState().isGridMode?i?o*Rde:o:i?Ade:_de,l=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(l,s.mul(a)),Pt(this.editor,l)}canInteractWithShapeInReadOnly(t){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(t).canEditInReadOnly(t))}},v(Fw,"id","idle"),Fw);const Ade=10,_de=1,Rde=5;function wT(n,e){const t=n.getSelectionRotatedPageBounds();if(!t)return!1;const r=n.getSelectionRotation();return r?Pi(e,t.corners.map(i=>b.RotWith(i,t.point,r))):t.containsPoint(e)}class dL extends Oe{constructor(){super(...arguments);v(this,"shapeId","");v(this,"markId","");v(this,"wasAlreadySelected",!1);v(this,"didDrag",!1);v(this,"info",{});v(this,"onEnter",t=>{const{shape:r}=t;this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.shapeId=r.id,this.didDrag=!1,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===r.id,this.updateCursor();const s=this.editor.getShapeGeometry(r).children[1];if(!s)throw Error(`Expected to find an arrow label geometry for shape: ${r.id}`);const{currentPagePoint:o}=this.editor.inputs,a=this.editor.getPointInShapeSpace(r,o);this._labelDragOffset=b.Sub(s.center,a),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})});v(this,"_labelDragOffset",new b(0,0));v(this,"onPointerMove",()=>{const{isDragging:t}=this.editor.inputs;if(!t)return;const r=this.editor.getShape(this.shapeId);if(!r)return;const i=co(this.editor,r),s=this.editor.getShapeGeometry(r),o=s.children[0],a=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint),l=o.nearestPoint(b.Add(a,this._labelDragOffset));let c;if(i.isStraight){const u=b.Dist(i.start.point,i.end.point);c=1-b.Dist(i.end.point,l)/u}else{const{_center:u,measure:d,angleEnd:h,angleStart:p}=s.children[0];c=i4(d,p,h,u.angle(l))}isNaN(c)&&(c=.5),this.didDrag=!0,this.editor.updateShape({id:r.id,type:r.type,props:{labelPosition:c}})});v(this,"onPointerUp",()=>{const t=this.editor.getShape(this.shapeId);t&&(this.didDrag||!this.wasAlreadySelected?this.complete():(this.editor.setEditingShape(t.id),this.editor.setCurrentTool("select.editing_shape")))});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}v(dL,"id","pointing_arrow_label");class hL extends Oe{constructor(){super(...arguments);v(this,"onEnter",()=>{const{inputs:t}=this.editor;t.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});v(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",t)});v(this,"onPointerUp",()=>{wy(this.editor),this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.parent.transition("idle")})}complete(){this.parent.transition("idle")}}v(hL,"id","pointing_canvas");class fL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",t=>{this.info=t;const{shape:r}=t;if(this.editor.isShapeOfType(r,"arrow")){const i=Xr(this.editor,r)[t.handle.id];i&&this.editor.setHintingShapes([i.toId])}this.editor.setCursor({type:"grabbing",rotation:0})});v(this,"onExit",()=>{this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})});v(this,"onPointerUp",()=>{const{shape:t,handle:r}=this.info;if(this.editor.isShapeOfType(t,"note")){const{editor:i}=this,s=bT(i,t,r,!1);if(s){vy(i,s,!0);return}}this.parent.transition("idle",this.info)});v(this,"onPointerMove",()=>{const{editor:t}=this;t.inputs.isDragging&&this.startDraggingHandle()});v(this,"onLongPress",()=>{this.startDraggingHandle()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}startDraggingHandle(){const{editor:t}=this;if(t.getInstanceState().isReadonly)return;const{shape:r,handle:i}=this.info;if(t.isShapeOfType(r,"note")){const s=bT(t,r,i,!0);if(s){const o=t.getPointInParentSpace(s,t.inputs.originPagePoint).sub(b.Rot(Qv.clone().mul(r.props.scale),s.rotation));t.updateShape({...s,x:o.x,y:o.y}),t.setHoveredShape(s.id).select(s.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:t.getShape(s),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{vy(t,s,!0)}});return}}this.parent.transition("dragging_handle",this.info)}cancel(){this.parent.transition("idle")}}v(fL,"id","pointing_handle");function bT(n,e,t,r){const i=n.getShapePageTransform(e.id),s=i.point(),o=i.rotation(),l=Ij(n,s,o,e.props.growY,0,e.props.scale)[t.index];if(l)return Aj(n,e,l,o,r)}class pL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",t=>{this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})});v(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startRotating()});v(this,"onLongPress",()=>{this.startRotating()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.setCursor({type:_d[this.info.handle],rotation:this.editor.getSelectionRotation()})}startRotating(){this.editor.getInstanceState().isReadonly||this.parent.transition("rotating",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}v(pL,"id","pointing_rotate_handle");class gL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",t=>{this.info=t});v(this,"onPointerUp",t=>{wy(this.editor),this.parent.transition("idle",t)});v(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.startTranslating(t)});v(this,"onLongPress",t=>{this.startTranslating(t)});v(this,"onDoubleClick",t=>{var s,o;const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(o=(s=this.parent).onDoubleClick)==null||o.call(s,{...t,target:"shape",shape:this.editor.getShape(i)});return}});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}startTranslating(t){this.editor.getInstanceState().isReadonly||this.parent.transition("translating",t)}cancel(){this.parent.transition("idle")}}v(gL,"id","pointing_selection");class mL extends Oe{constructor(){super(...arguments);v(this,"hitShape",{});v(this,"hitShapeForPointerUp",{});v(this,"isDoubleClick",!1);v(this,"didSelectOnEnter",!1);v(this,"onEnter",t=>{const r=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),s=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:o,shiftKey:a,altKey:l}}=this.editor;this.hitShape=t.shape,this.isDoubleClick=!1;const c=this.editor.getOutermostSelectableShape(t.shape),u=this.editor.findShapeAncestor(c,d=>r.includes(d.id));if(this.editor.getShapeUtil(t.shape).onClick||c.id===s||r.includes(c.id)||u||r.length>1&&(i!=null&&i.containsPoint(o))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=c;return}this.didSelectOnEnter=!0,a&&!l?(this.editor.cancelDoubleClick(),r.includes(c.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...r,c.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([c.id]))});v(this,"onPointerUp",t=>{var u;const r=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),s=this.editor.getZoomLevel(),{inputs:{currentPagePoint:o,shiftKey:a}}=this.editor,l=this.editor.getShapeAtPoint(o,{margin:this.editor.options.hitTestMargin/s,hitInside:!0,renderingOnly:!0})??this.hitShape,c=l?this.editor.getOutermostSelectableShape(l):this.hitShapeForPointerUp;if(c){const d=this.editor.getShapeUtil(c);if(d.onClick){const h=(u=d.onClick)==null?void 0:u.call(d,c);if(h){this.editor.mark("shape on click"),this.editor.updateShapes([h]),this.parent.transition("idle",t);return}}if(c.id===i){r.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const d=this.editor.getOutermostSelectableShape(l,h=>!r.includes(h.id));if(r.includes(d.id))if(a)this.editor.mark("deselecting on pointer up"),this.editor.deselect(c);else if(r.includes(c.id)){if(r.length===1){const h=this.editor.getShapeUtil(c).getGeometry(c),p=cL(h),g=p.length===1?p[0]:void 0;if(g){const m=this.editor.getPointInShapeSpace(c,o);if(g.bounds.containsPoint(m,0)&&g.hitTestPoint(m)){this.editor.run(()=>{this.editor.mark("editing on pointer up"),this.editor.select(c.id);const S=this.editor.getShapeUtil(c);this.editor.getInstanceState().isReadonly&&!S.canEditInReadOnly(c)||(this.editor.setEditingShape(c.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:c.id}))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(c.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(c);else if(a){const h=this.editor.getShapeAncestors(d);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(p=>!h.find(g=>g.id===p)),d.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([d.id])}this.parent.transition("idle",t)});v(this,"onDoubleClick",()=>{this.isDoubleClick=!0});v(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.startTranslating(t)});v(this,"onLongPress",t=>{this.startTranslating(t)});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}startTranslating(t){this.editor.getInstanceState().isReadonly||(this.editor.focus(),this.parent.transition("translating",t))}cancel(){this.parent.transition("idle")}}v(mL,"id","pointing_shape");class yL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"markId","");v(this,"didHoldCommand",!1);v(this,"creationCursorOffset",{x:0,y:0});v(this,"snapshot",{});v(this,"onEnter",t=>{const{isCreating:r=!1,creationCursorOffset:i={x:0,y:0}}=t;this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),r?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.setCursor({type:"cross",rotation:0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()});v(this,"onTick",({elapsed:t})=>{const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)});v(this,"onPointerMove",()=>{this.updateShapes()});v(this,"onKeyDown",()=>{this.updateShapes()});v(this,"onKeyUp",()=>{this.updateShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()});v(this,"_createSnapshot",()=>{const t=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,s=this.editor.getSelectionRotatedPageBounds(),o=b.RotWith(s.getHandlePoint(this.info.handle),s.point,r),a=b.Sub(i,o),l=new Map,c=[];t.forEach(d=>{const h=this.editor.getShape(d);if(h){if(h.type==="frame"&&c.push({id:d,children:He(this.editor.getSortedChildIdsForParent(h).map(p=>this.editor.getShape(p)))}),l.set(h.id,this._createShapeSnapshot(h)),this.editor.isShapeOfType(h,"frame")&&t.length===1)return;this.editor.visitDescendants(h.id,p=>{const g=this.editor.getShape(p);if(g&&(l.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")))return!1})}});const u=![...l.values()].some(d=>!dD(d.pageRotation,r)||d.isAspectRatioLocked);return{shapeSnapshots:l,selectionBounds:s,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:t,canShapesDeform:u,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}});v(this,"_createShapeSnapshot",t=>{const r=this.editor.getShapePageTransform(t),i=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:r,pageRotation:ke.Decompose(r).rotation,isAspectRatioLocked:i.isAspectRatioLocked(t)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,r;if(Pt(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(t=this.info).onCreate)==null||r.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var a;const s=this.editor.getShapeUtil(i),o=(a=s.onResizeStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var l;const s=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),a=(l=o.onResizeEnd)==null?void 0:l.call(o,i,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:t,shiftKey:r}=this.editor.inputs,{frames:i,shapeSnapshots:s,selectionBounds:o,cursorHandleOffset:a,selectedShapeIds:l,selectionRotation:c,canShapesDeform:u}=this.snapshot;let d=r||!u;if(s.size===1){const M=[...s.values()][0];this.editor.isShapeOfType(M.shape,"text")&&(d=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:h}=this.editor.inputs,p=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),g=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!h){const{gridSize:M}=this.editor.getDocumentSettings();p.snapToGrid(M)}const m=this.info.handle,S=OT(m,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!h:h)&&c%Mt===0){const{nudge:M}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:b.Sub(p,g),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:OT(m,c),isAspectRatioLocked:d,isResizingFromCenter:t});p.add(M)}const x=b.RotWith(t?o.center:o.getHandlePoint(S),o.point,c),w=b.Sub(p,x).rot(-c),O=b.Sub(g,x).rot(-c),T=b.DivV(w,O);Number.isFinite(T.x)||(T.x=1),Number.isFinite(T.y)||(T.y=1);const E=m==="top"||m==="bottom",C=m==="left"||m==="right";d?C?T.y=Math.abs(T.x):E?T.x=Math.abs(T.y):Math.abs(T.x)>Math.abs(T.y)?T.y=Math.abs(T.x)*(T.y<0?-1:1):T.x=Math.abs(T.y)*(T.x<0?-1:1):(E&&(T.x=1),C&&(T.y=1)),this.info.isCreating||this.updateCursor({dragHandle:m,isFlippedX:T.x<0,isFlippedY:T.y<0,rotation:c});for(const M of s.keys()){const A=s.get(M);this.editor.resizeShape(M,T,{initialShape:A.shape,initialBounds:A.bounds,initialPageTransform:A.pageTransform,dragHandle:m,mode:l.length===1&&M===l[0]?"resize_bounds":"scale_shape",scaleOrigin:x,isAspectRatioLocked:d,scaleAxisRotation:c,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:M,children:A}of i){if(!A.length)continue;const D=s.get(M).shape,N=this.editor.getShape(M);if(!(D&&N))continue;const F=N.x-D.x,j=N.y-D.y,L=new b(F,j).rot(-D.rotation);if(L.x!==0||L.y!==0)for(const U of A)this.editor.updateShape({id:U.id,type:U.type,x:U.x-L.x,y:U.y-L.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:M}of i)if(M.length)for(const A of M)this.editor.updateShape({id:A.id,type:A.type,x:A.x,y:A.y})}}updateCursor({dragHandle:t,isFlippedX:r,isFlippedY:i,rotation:s}){const o={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{o.type="nwse-resize",r!==i&&(o.type="nesw-resize");break}case"top_right":case"bottom_left":{o.type="nesw-resize",r!==i&&(o.type="nwse-resize");break}}o.rotation=s,this.editor.setCursor(o)}}v(yL,"id","resizing");const p2=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function OT(n,e){e=e%pt;const t=Math.round(e/(at/4)),r=p2.indexOf(n);return p2[(r+t)%p2.length]}const kT=Math.PI/180;class vL extends Oe{constructor(){super(...arguments);v(this,"snapshot",{});v(this,"info",{});v(this,"markId","");v(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const r=ej({editor:this.editor});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r;const i=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Mm({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:_d[this.info.handle],rotation:i+this.snapshot.initialSelectionRotation})});v(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}});v(this,"onPointerMove",()=>{this.update()});v(this,"onKeyDown",()=>{this.update()});v(this,"onKeyUp",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"update",()=>{const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Mm({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:_d[this.info.handle],rotation:t+this.snapshot.initialSelectionRotation})});v(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});v(this,"complete",()=>{Mm({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),Pt(this.editor,this.snapshot.shapeSnapshots.map(t=>t.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}_getRotationFromPointerPosition({snapToNearestDegree:t}){const r=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:s,currentPagePoint:o}}=this.editor,{initialCursorAngle:a,initialSelectionRotation:l}=this.snapshot;if(!i)return l;const u=i.center.clone().rotWith(i.point,r).angle(o)-a;let d=l+u;if(s)d=dy(d,24);else if(t&&(d=Math.round(d/kT)*kT,this.editor.getInstanceState().isCoarsePointer)){const h=dy(d,4),p=Tm(d,h);Math.abs(p)<Jre(5)&&(d=h)}return d-l}}v(vL,"id","rotating");class SL extends Oe{constructor(){super(...arguments);v(this,"hits",new Set);v(this,"size",0);v(this,"scribbleId","id");v(this,"initialSelectedShapeIds",new Set);v(this,"newlySelectedShapeIds",new Set);v(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})});v(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});v(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});v(this,"onPointerUp",()=>{this.complete()});v(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});v(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)})}updateScribbleSelection(t){const{editor:r}=this,i=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:s,originPagePoint:o,previousPagePoint:a,currentPagePoint:l}}=this.editor,{newlySelectedShapeIds:c,initialSelectedShapeIds:u}=this;t&&this.pushPointToScribble();const d=i;let h,p,g,m;const S=0;for(let w=0,O=d.length;w<O;w++){if(h=d[w],r.isShapeOfType(h,"group")||c.has(h.id)||r.isShapeOrAncestorLocked(h)||(p=r.getShapeGeometry(h),r.isShapeOfType(h,"frame")&&p.bounds.containsPoint(r.getPointInShapeSpace(h,o))))continue;const T=r.getShapePageTransform(h);if(!p||!T)continue;const E=T.clone().invert();g=E.applyToPoint(a),m=E.applyToPoint(l);const{bounds:C}=p;if(!(C.minX-S>Math.max(g.x,m.x)||C.minY-S>Math.max(g.y,m.y)||C.maxX+S<Math.min(g.x,m.x)||C.maxY+S<Math.min(g.y,m.y))&&p.hitTestLineSegment(g,m,S)){const M=this.editor.getOutermostSelectableShape(h),A=this.editor.getShapeMask(M.id);if(A&&Q6(a,l,A)!==null&&!Pi(l,A))continue;c.add(M.id)}}const y=r.getSelectedShapeIds(),x=new Set(s?[...c,...u]:[...c]);(y.length!==x.size||y.some(w=>!x.has(w)))&&this.editor.setSelectedShapes(Array.from(x))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}v(SL,"id","scribble_brushing");const Dde=20,jde=100;class Lde{constructor(e){v(this,"prevDroppingShapeId",null);v(this,"droppingNodeTimer",null);v(this,"first",!0);v(this,"dispose",()=>{this.clear()});this.editor=e,e.disposables.add(this.dispose)}updateDroppingNode(e,t){var r;this.first&&(this.editor.setHintingShapes(e.map(i=>this.editor.findShapeAncestor(i,s=>s.type!=="group")).filter(i=>i)),this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,Dde,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,jde,t))}setDragTimer(e,t,r){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,r){var l,c,u,d,h;t=He(t.map(p=>this.editor.getShape(p.id)));const i=((l=this.editor.getDroppingOverShape(e,t))==null?void 0:l.id)??null;if(i===this.prevDroppingShapeId){this.hintParents(t);return}const{prevDroppingShapeId:s}=this,o=s&&this.editor.getShape(s),a=i&&this.editor.getShape(i);o&&((u=(c=this.editor.getShapeUtil(o)).onDragShapesOut)==null||u.call(c,o,t)),a&&((h=(d=this.editor.getShapeUtil(a)).onDragShapesOver)==null||h.call(d,a,t)),this.hintParents(t),r==null||r(),this.prevDroppingShapeId=i}hintParents(e){const t=new Map;for(const i of e){const s=this.editor.findShapeAncestor(i,o=>o.type!=="group");s&&(t.has(s.id)||t.set(s.id,[]),t.get(s.id).push(i.id))}const r=[];for(const[i,s]of t){const o=this.editor.getShape(i);o&&Pj(this.editor,o).length<s.length&&r.push(o.id)}this.editor.setHintingShapes(r)}dropShapes(e){var r,i;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const s=this.editor.getShape(t);if(!s)return;(i=(r=this.editor.getShapeUtil(s)).onDropShapesOver)==null||i.call(r,s,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class xL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"selectionSnapshot",{});v(this,"snapshot",{});v(this,"markId","");v(this,"isCloning",!1);v(this,"isCreating",!1);v(this,"onCreate",()=>{});v(this,"dragAndDropManager",new Lde(this.editor));v(this,"onEnter",t=>{var s;const{isCreating:r=!1,onCreate:i=()=>{}}=t;if(!((s=this.editor.getSelectedShapeIds())!=null&&s.length)){this.parent.transition("idle");return}if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.isCreating=r,this.onCreate=i,r?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=t,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=CT(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()});v(this,"onTick",({elapsed:t})=>{const{editor:r}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),r.edgeScrollManager.updateEdgeScrolling(t)});v(this,"onPointerMove",()=>{this.updateShapes()});v(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});v(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"updateParentTransforms",()=>{const{editor:t,snapshot:{shapeSnapshots:r}}=this;r.forEach(i=>{const s=t.getShape(i.shape.id);if(!s)return null;const o=Br(s.parentId)?null:ke.Inverse(t.getShapePageTransform(s.parentId));i.parentTransform=o})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=CT(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var t;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),Pt(this.editor,this.snapshot.movingShapes.map(r=>r.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(t=this.onCreate)==null||t.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var a;const s=this.editor.getShapeUtil(i),o=(a=s.onTranslateStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:t}=this.snapshot;if(this.isCloning&&t.length>0){const i=b.Average(t.map(o=>this.editor.getShapePageTransform(o.id).point())),s=b.Sub(i,this.selectionSnapshot.averagePagePoint);b.IsNaN(s)||this.editor.updateInstanceState({duplicateProps:{shapeIds:t.map(o=>o.id),offset:{x:s.x,y:s.y}}})}const r=[];t.forEach(i=>{var l;const s=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),a=(l=o.onTranslateEnd)==null?void 0:l.call(o,i,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{snapshot:t}=this;this.dragAndDropManager.updateDroppingNode(t.movingShapes,this.updateParentTransforms),zde({editor:this.editor,snapshot:t});const{movingShapes:r}=t,i=[];r.forEach(s=>{var c;const o=this.editor.getShape(s.id),a=this.editor.getShapeUtil(s),l=(c=a.onTranslate)==null?void 0:c.call(a,s,o);l&&i.push(l)}),i.length>0&&this.editor.updateShapes(i)}}v(xL,"id","translating");function CT(n){var d;const e=[],t=[],r=n.getSelectedShapeIds(),i=He(r.map(h=>{const p=n.getShape(h);if(!p)return null;e.push(p);const g=n.getShapePageTransform(h),m=g.point(),S=g.rotation();t.push(m);const y=ba.isId(p.parentId)?null:ke.Inverse(n.getShapePageTransform(p.parentId));return{shape:p,pagePoint:m,pageRotation:S,parentTransform:y}})),s=n.getOnlySelectedShape();let o=[];if(s)o=n.snaps.shapeBounds.getSnapPoints(s.id);else{const h=n.getSelectionPageBounds();h&&(o=h.cornersAndCenter.map((p,g)=>({id:"selection:"+g,x:p.x,y:p.y})))}let a,l;const{originPagePoint:c}=n.inputs,u=i.filter(h=>n.isShapeOfType(h.shape,"note")&&n.isPointInShape(h.shape,c));if(u.length!==0)if(u.length===1)l=u[0];else{const h=n.getCurrentPageShapesSorted();l=(d=u.map(p=>({snapshot:p,index:h.findIndex(g=>g.id===p.shape.id)})).sort((p,g)=>g.index-p.index)[0])==null?void 0:d.snapshot}return l&&(a=Mj(n,l.pageRotation,l.shape.props.scale,l.shape.props.growY??0)),{averagePagePoint:b.Average(t),movingShapes:e,shapeSnapshots:i,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:o,noteAdjacentPositions:a,noteSnapshot:l}}function zde({editor:n,snapshot:e}){const{inputs:t}=n,{noteSnapshot:r,noteAdjacentPositions:i,initialPageBounds:s,initialSnapPoints:o,shapeSnapshots:a,averagePagePoint:l}=e,c=n.getInstanceState().isGridMode,u=n.getDocumentSettings().gridSize,d=b.Sub(t.currentPagePoint,t.originPagePoint),h=n.inputs.shiftKey?Math.abs(d.x)<Math.abs(d.y)?"x":"y":null;if(h==="x"?d.x=0:h==="y"&&(d.y=0),n.snaps.clearIndicators(),(n.user.getIsSnapMode()?!t.ctrlKey:t.ctrlKey)&&n.inputs.pointerVelocity.len()<.5){const{nudge:S}=n.snaps.shapeBounds.snapTranslateShapes({dragDelta:d,initialSelectionPageBounds:s,lockedAxis:h,initialSelectionSnapPoints:o});d.add(S)}else if(r&&i){const{scale:S}=r.shape.props,y=r.pagePoint.clone().add(d).add(Qv.clone().mul(S).rot(r.pageRotation));let x=Ej/n.getZoomLevel(),w=new b(0,0);for(const O of i){const T=b.Sub(y,O),E=T.len();E<x&&(x=E,w=T)}d.sub(w)}const g=b.Add(l,d);c&&!t.ctrlKey&&g.snapToGrid(u);const m=b.Sub(g,l);n.updateShapes(He(a.map(({shape:S,pagePoint:y,parentTransform:x})=>{const w=b.Add(y,m),O=x?ke.applyToPoint(x,w):w;return{id:S.id,type:S.type,x:O.x,y:O.y}})))}class cf extends Oe{constructor(){super(...arguments);v(this,"reactor");v(this,"cleanUpDuplicateProps",()=>{const t=this.editor.getSelectedShapeIds(),r=this.editor.getInstanceState();if(!r.duplicateProps)return;const i=new Set(r.duplicateProps.shapeIds);t.length===i.size&&t.every(s=>i.has(s))||this.editor.updateInstanceState({duplicateProps:null})});v(this,"onEnter",()=>{this.reactor=Xl("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(t){typeof process<"u",console.error(t)}})});v(this,"onExit",()=>{var t;(t=this.reactor)==null||t.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)})}}v(cf,"id","select"),v(cf,"initial","idle"),v(cf,"isLockable",!1),v(cf,"children",()=>[Jm,hO,Mde,hL,mL,xL,nL,SL,fO,gL,rL,uL,yL,vL,pL,dL,fL,lL]);class wL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",t=>{this.info=t});v(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}v(wL,"id","idle");class bL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",t=>{this.info=t});v(this,"onPointerUp",()=>{this.complete()});v(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});v(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{animation:{duration:220}}):this.editor.zoomIn(t,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}v(bL,"id","pointing");class OL extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"zoomBrush",new ye);v(this,"onEnter",t=>{this.info=t,this.update()});v(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});v(this,"onPointerMove",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:t,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(ye.FromPoints([t,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,r=8/this.editor.getZoomLevel();if(t.width<r&&t.height<r){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{animation:{duration:220}}):this.editor.zoomIn(i,{animation:{duration:220}})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,{targetZoom:i,animation:{duration:220}})}this.parent.transition("idle",this.info)}}v(OL,"id","zoom_brushing");class uf extends Oe{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)});v(this,"onKeyDown",()=>{this.updateCursor()});v(this,"onKeyUp",t=>{this.updateCursor(),t.code==="KeyZ"&&this.complete()});v(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}v(uf,"id","zoom"),v(uf,"initial","idle"),v(uf,"children",()=>[wL,OL,bL]),v(uf,"isLockable",!1);const Nde=[of,af,lf,uf,cf];function be(n,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(n==null||n(i),t===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function $de(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function Xv(...n){return e=>n.forEach(t=>$de(t,e))}function _t(...n){return k.useCallback(Xv(...n),n)}function Fde(n,e){const t=k.createContext(e);function r(s){const{children:o,...a}=s,l=k.useMemo(()=>a,Object.values(a));return f.jsx(t.Provider,{value:l,children:o})}function i(s){const o=k.useContext(t);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${n}\``)}return r.displayName=n+"Provider",[r,i]}function Ro(n,e=[]){let t=[];function r(s,o){const a=k.createContext(o),l=t.length;t=[...t,o];function c(d){const{scope:h,children:p,...g}=d,m=(h==null?void 0:h[n][l])||a,S=k.useMemo(()=>g,Object.values(g));return f.jsx(m.Provider,{value:S,children:p})}function u(d,h){const p=(h==null?void 0:h[n][l])||a,g=k.useContext(p);if(g)return g;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return c.displayName=s+"Provider",[c,u]}const i=()=>{const s=t.map(o=>k.createContext(o));return function(a){const l=(a==null?void 0:a[n])||s;return k.useMemo(()=>({[`__scope${n}`]:{...a,[n]:l}}),[a,l])}};return i.scopeName=n,[r,Bde(i,...e)]}function Bde(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return k.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}var Ml=globalThis!=null&&globalThis.document?k.useLayoutEffect:()=>{},Ude=fq.useId||(()=>{}),Hde=0;function fa(n){const[e,t]=k.useState(Ude());return Ml(()=>{n||t(r=>r??String(Hde++))},[n]),n||(e?`radix-${e}`:"")}function Jn(n){const e=k.useRef(n);return k.useEffect(()=>{e.current=n}),k.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}function Yl({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,i]=Qde({defaultProp:e,onChange:t}),s=n!==void 0,o=s?n:r,a=Jn(t),l=k.useCallback(c=>{if(s){const d=typeof c=="function"?c(n):c;d!==n&&a(d)}else i(c)},[s,n,i,a]);return[o,l]}function Qde({defaultProp:n,onChange:e}){const t=k.useState(n),[r]=t,i=k.useRef(r),s=Jn(e);return k.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),t}var qc=k.forwardRef((n,e)=>{const{children:t,...r}=n,i=k.Children.toArray(t),s=i.find(Wde);if(s){const o=s.props.children,a=i.map(l=>l===s?k.Children.count(o)>1?k.Children.only(null):k.isValidElement(o)?o.props.children:null:l);return f.jsx(C4,{...r,ref:e,children:k.isValidElement(o)?k.cloneElement(o,void 0,a):null})}return f.jsx(C4,{...r,ref:e,children:t})});qc.displayName="Slot";var C4=k.forwardRef((n,e)=>{const{children:t,...r}=n;if(k.isValidElement(t)){const i=Gde(t);return k.cloneElement(t,{...Vde(r,t.props),ref:e?Xv(e,i):i})}return k.Children.count(t)>1?k.Children.only(null):null});C4.displayName="SlotClone";var qde=({children:n})=>f.jsx(f.Fragment,{children:n});function Wde(n){return k.isValidElement(n)&&n.type===qde}function Vde(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{s(...a),i(...a)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function Gde(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Xde=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],it=Xde.reduce((n,e)=>{const t=k.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?qc:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(a,{...o,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function pO(n,e){n&&su.flushSync(()=>n.dispatchEvent(e))}function Kde(n,e=globalThis==null?void 0:globalThis.document){const t=Jn(n);k.useEffect(()=>{const r=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var Yde="DismissableLayer",P4="dismissableLayer.update",Zde="dismissableLayer.pointerDownOutside",Jde="dismissableLayer.focusOutside",PT,kL=k.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),s0=k.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...l}=n,c=k.useContext(kL),[u,d]=k.useState(null),h=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,p]=k.useState({}),g=_t(e,C=>d(C)),m=Array.from(c.layers),[S]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),y=m.indexOf(S),x=u?m.indexOf(u):-1,w=c.layersWithOutsidePointerEventsDisabled.size>0,O=x>=y,T=the(C=>{const M=C.target,A=[...c.branches].some(D=>D.contains(M));!O||A||(i==null||i(C),o==null||o(C),C.defaultPrevented||a==null||a())},h),E=nhe(C=>{const M=C.target;[...c.branches].some(D=>D.contains(M))||(s==null||s(C),o==null||o(C),C.defaultPrevented||a==null||a())},h);return Kde(C=>{x===c.layers.size-1&&(r==null||r(C),!C.defaultPrevented&&a&&(C.preventDefault(),a()))},h),k.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(PT=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),TT(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=PT)}},[u,h,t,c]),k.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),TT())},[u,c]),k.useEffect(()=>{const C=()=>p({});return document.addEventListener(P4,C),()=>document.removeEventListener(P4,C)},[]),f.jsx(it.div,{...l,ref:g,style:{pointerEvents:w?O?"auto":"none":void 0,...n.style},onFocusCapture:be(n.onFocusCapture,E.onFocusCapture),onBlurCapture:be(n.onBlurCapture,E.onBlurCapture),onPointerDownCapture:be(n.onPointerDownCapture,T.onPointerDownCapture)})});s0.displayName=Yde;var ehe="DismissableLayerBranch",CL=k.forwardRef((n,e)=>{const t=k.useContext(kL),r=k.useRef(null),i=_t(e,r);return k.useEffect(()=>{const s=r.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),f.jsx(it.div,{...n,ref:i})});CL.displayName=ehe;function the(n,e=globalThis==null?void 0:globalThis.document){const t=Jn(n),r=k.useRef(!1),i=k.useRef(()=>{});return k.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){PL(Zde,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function nhe(n,e=globalThis==null?void 0:globalThis.document){const t=Jn(n),r=k.useRef(!1);return k.useEffect(()=>{const i=s=>{s.target&&!r.current&&PL(Jde,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function TT(){const n=new CustomEvent(P4);document.dispatchEvent(n)}function PL(n,e,t,{discrete:r}){const i=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?pO(i,s):i.dispatchEvent(s)}var rhe=s0,ihe=CL,g2="focusScope.autoFocusOnMount",m2="focusScope.autoFocusOnUnmount",ET={bubbles:!1,cancelable:!0},she="FocusScope",Kv=k.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=n,[a,l]=k.useState(null),c=Jn(i),u=Jn(s),d=k.useRef(null),h=_t(e,m=>l(m)),p=k.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;k.useEffect(()=>{if(r){let m=function(w){if(p.paused||!a)return;const O=w.target;a.contains(O)?d.current=O:Xa(d.current,{select:!0})},S=function(w){if(p.paused||!a)return;const O=w.relatedTarget;O!==null&&(a.contains(O)||Xa(d.current,{select:!0}))},y=function(w){if(document.activeElement===document.body)for(const T of w)T.removedNodes.length>0&&Xa(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",S);const x=new MutationObserver(y);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",S),x.disconnect()}}},[r,a,p.paused]),k.useEffect(()=>{if(a){MT.add(p);const m=document.activeElement;if(!a.contains(m)){const y=new CustomEvent(g2,ET);a.addEventListener(g2,c),a.dispatchEvent(y),y.defaultPrevented||(ohe(dhe(TL(a)),{select:!0}),document.activeElement===m&&Xa(a))}return()=>{a.removeEventListener(g2,c),setTimeout(()=>{const y=new CustomEvent(m2,ET);a.addEventListener(m2,u),a.dispatchEvent(y),y.defaultPrevented||Xa(m??document.body,{select:!0}),a.removeEventListener(m2,u),MT.remove(p)},0)}}},[a,c,u,p]);const g=k.useCallback(m=>{if(!t&&!r||p.paused)return;const S=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,y=document.activeElement;if(S&&y){const x=m.currentTarget,[w,O]=ahe(x);w&&O?!m.shiftKey&&y===O?(m.preventDefault(),t&&Xa(w,{select:!0})):m.shiftKey&&y===w&&(m.preventDefault(),t&&Xa(O,{select:!0})):y===x&&m.preventDefault()}},[t,r,p.paused]);return f.jsx(it.div,{tabIndex:-1,...o,ref:h,onKeyDown:g})});Kv.displayName=she;function ohe(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(Xa(r,{select:e}),document.activeElement!==t)return}function ahe(n){const e=TL(n),t=IT(e,n),r=IT(e.reverse(),n);return[t,r]}function TL(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function IT(n,e){for(const t of n)if(!lhe(t,{upTo:e}))return t}function lhe(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function che(n){return n instanceof HTMLInputElement&&"select"in n}function Xa(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&che(n)&&e&&n.select()}}var MT=uhe();function uhe(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=AT(n,e),n.unshift(e)},remove(e){var t;n=AT(n,e),(t=n[0])==null||t.resume()}}}function AT(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function dhe(n){return n.filter(e=>e.tagName!=="A")}var hhe="Portal",o0=k.forwardRef((n,e)=>{var a;const{container:t,...r}=n,[i,s]=k.useState(!1);Ml(()=>s(!0),[]);const o=t||i&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?kV.createPortal(f.jsx(it.div,{...r,ref:e}),o):null});o0.displayName=hhe;function fhe(n,e){return k.useReducer((t,r)=>e[t][r]??t,n)}var Ns=n=>{const{present:e,children:t}=n,r=phe(e),i=typeof t=="function"?t({present:r.isPresent}):k.Children.only(t),s=_t(r.ref,ghe(i));return typeof t=="function"||r.isPresent?k.cloneElement(i,{ref:s}):null};Ns.displayName="Presence";function phe(n){const[e,t]=k.useState(),r=k.useRef({}),i=k.useRef(n),s=k.useRef("none"),o=n?"mounted":"unmounted",[a,l]=fhe(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return k.useEffect(()=>{const c=wg(r.current);s.current=a==="mounted"?c:"none"},[a]),Ml(()=>{const c=r.current,u=i.current;if(u!==n){const h=s.current,p=wg(c);n?l("MOUNT"):p==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&h!==p?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,l]),Ml(()=>{if(e){const c=d=>{const p=wg(r.current).includes(d.animationName);d.target===e&&p&&su.flushSync(()=>l("ANIMATION_END"))},u=d=>{d.target===e&&(s.current=wg(r.current))};return e.addEventListener("animationstart",u),e.addEventListener("animationcancel",c),e.addEventListener("animationend",c),()=>{e.removeEventListener("animationstart",u),e.removeEventListener("animationcancel",c),e.removeEventListener("animationend",c)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:k.useCallback(c=>{c&&(r.current=getComputedStyle(c)),t(c)},[])}}function wg(n){return(n==null?void 0:n.animationName)||"none"}function ghe(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var y2=0;function gO(){k.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??_T()),document.body.insertAdjacentElement("beforeend",n[1]??_T()),y2++,()=>{y2===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),y2--}},[])}function _T(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",n}var io=function(){return io=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},io.apply(this,arguments)};function EL(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function mhe(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var e1="right-scroll-bar-position",t1="width-before-scroll-bar",yhe="with-scroll-bars-hidden",vhe="--removed-body-scroll-bar-size";function v2(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function She(n,e){var t=k.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var i=t.value;i!==r&&(t.value=r,t.callback(r,i))}}}})[0];return t.callback=e,t.facade}var xhe=typeof window<"u"?k.useLayoutEffect:k.useEffect,RT=new WeakMap;function whe(n,e){var t=She(null,function(r){return n.forEach(function(i){return v2(i,r)})});return xhe(function(){var r=RT.get(t);if(r){var i=new Set(r),s=new Set(n),o=t.current;i.forEach(function(a){s.has(a)||v2(a,null)}),s.forEach(function(a){i.has(a)||v2(a,o)})}RT.set(t,n)},[n]),t}function bhe(n){return n}function Ohe(n,e){e===void 0&&(e=bhe);var t=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var o=e(s,r);return t.push(o),function(){t=t.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(r=!0;t.length;){var o=t;t=[],o.forEach(s)}t={push:function(a){return s(a)},filter:function(){return t}}},assignMedium:function(s){r=!0;var o=[];if(t.length){var a=t;t=[],a.forEach(s),o=t}var l=function(){var u=o;o=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){o.push(u),c()},filter:function(u){return o=o.filter(u),t}}}};return i}function khe(n){n===void 0&&(n={});var e=Ohe(null);return e.options=io({async:!0,ssr:!1},n),e}var IL=function(n){var e=n.sideCar,t=EL(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return k.createElement(r,io({},t))};IL.isSideCarExport=!0;function Che(n,e){return n.useMedium(e),IL}var ML=khe(),S2=function(){},Yv=k.forwardRef(function(n,e){var t=k.useRef(null),r=k.useState({onScrollCapture:S2,onWheelCapture:S2,onTouchMoveCapture:S2}),i=r[0],s=r[1],o=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,u=n.enabled,d=n.shards,h=n.sideCar,p=n.noIsolation,g=n.inert,m=n.allowPinchZoom,S=n.as,y=S===void 0?"div":S,x=n.gapMode,w=EL(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),O=h,T=whe([t,e]),E=io(io({},w),i);return k.createElement(k.Fragment,null,u&&k.createElement(O,{sideCar:ML,removeScrollBar:c,shards:d,noIsolation:p,inert:g,setCallbacks:s,allowPinchZoom:!!m,lockRef:t,gapMode:x}),o?k.cloneElement(k.Children.only(a),io(io({},E),{ref:T})):k.createElement(y,io({},E,{className:l,ref:T}),a))});Yv.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Yv.classNames={fullWidth:t1,zeroRight:e1};var Phe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function The(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=Phe();return e&&n.setAttribute("nonce",e),n}function Ehe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function Ihe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var Mhe=function(){var n=0,e=null;return{add:function(t){n==0&&(e=The())&&(Ehe(e,t),Ihe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Ahe=function(){var n=Mhe();return function(e,t){k.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},AL=function(){var n=Ahe(),e=function(t){var r=t.styles,i=t.dynamic;return n(r,i),null};return e},_he={left:0,top:0,right:0,gap:0},x2=function(n){return parseInt(n||"",10)||0},Rhe=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[x2(t),x2(r),x2(i)]},Dhe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return _he;var e=Rhe(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},jhe=AL(),dd="data-scroll-locked",Lhe=function(n,e,t,r){var i=n.left,s=n.top,o=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(yhe,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(dd,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(e1,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(t1,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(e1," .").concat(e1,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(t1," .").concat(t1,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(dd,`] {
    `).concat(vhe,": ").concat(a,`px;
  }
`)},DT=function(){var n=parseInt(document.body.getAttribute(dd)||"0",10);return isFinite(n)?n:0},zhe=function(){k.useEffect(function(){return document.body.setAttribute(dd,(DT()+1).toString()),function(){var n=DT()-1;n<=0?document.body.removeAttribute(dd):document.body.setAttribute(dd,n.toString())}},[])},Nhe=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,i=r===void 0?"margin":r;zhe();var s=k.useMemo(function(){return Dhe(i)},[i]);return k.createElement(jhe,{styles:Lhe(s,!e,i,t?"":"!important")})},T4=!1;if(typeof window<"u")try{var bg=Object.defineProperty({},"passive",{get:function(){return T4=!0,!0}});window.addEventListener("test",bg,bg),window.removeEventListener("test",bg,bg)}catch{T4=!1}var wu=T4?{passive:!1}:!1,$he=function(n){return n.tagName==="TEXTAREA"},_L=function(n,e){var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!$he(n)&&t[e]==="visible")},Fhe=function(n){return _L(n,"overflowY")},Bhe=function(n){return _L(n,"overflowX")},jT=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=RL(n,r);if(i){var s=DL(n,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},Uhe=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},Hhe=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},RL=function(n,e){return n==="v"?Fhe(e):Bhe(e)},DL=function(n,e){return n==="v"?Uhe(e):Hhe(e)},Qhe=function(n,e){return n==="h"&&e==="rtl"?-1:1},qhe=function(n,e,t,r,i){var s=Qhe(n,window.getComputedStyle(e).direction),o=s*r,a=t.target,l=e.contains(a),c=!1,u=o>0,d=0,h=0;do{var p=DL(n,a),g=p[0],m=p[1],S=p[2],y=m-S-s*g;(g||y)&&RL(n,a)&&(d+=y,h+=g),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&(Math.abs(d)<1||!i)||!u&&(Math.abs(h)<1||!i))&&(c=!0),c},Og=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},LT=function(n){return[n.deltaX,n.deltaY]},zT=function(n){return n&&"current"in n?n.current:n},Whe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},Vhe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},Ghe=0,bu=[];function Xhe(n){var e=k.useRef([]),t=k.useRef([0,0]),r=k.useRef(),i=k.useState(Ghe++)[0],s=k.useState(AL)[0],o=k.useRef(n);k.useEffect(function(){o.current=n},[n]),k.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var m=mhe([n.lockRef.current],(n.shards||[]).map(zT),!0).filter(Boolean);return m.forEach(function(S){return S.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),m.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var a=k.useCallback(function(m,S){if("touches"in m&&m.touches.length===2)return!o.current.allowPinchZoom;var y=Og(m),x=t.current,w="deltaX"in m?m.deltaX:x[0]-y[0],O="deltaY"in m?m.deltaY:x[1]-y[1],T,E=m.target,C=Math.abs(w)>Math.abs(O)?"h":"v";if("touches"in m&&C==="h"&&E.type==="range")return!1;var M=jT(C,E);if(!M)return!0;if(M?T=C:(T=C==="v"?"h":"v",M=jT(C,E)),!M)return!1;if(!r.current&&"changedTouches"in m&&(w||O)&&(r.current=T),!T)return!0;var A=r.current||T;return qhe(A,S,m,A==="h"?w:O,!0)},[]),l=k.useCallback(function(m){var S=m;if(!(!bu.length||bu[bu.length-1]!==s)){var y="deltaY"in S?LT(S):Og(S),x=e.current.filter(function(T){return T.name===S.type&&(T.target===S.target||S.target===T.shadowParent)&&Whe(T.delta,y)})[0];if(x&&x.should){S.cancelable&&S.preventDefault();return}if(!x){var w=(o.current.shards||[]).map(zT).filter(Boolean).filter(function(T){return T.contains(S.target)}),O=w.length>0?a(S,w[0]):!o.current.noIsolation;O&&S.cancelable&&S.preventDefault()}}},[]),c=k.useCallback(function(m,S,y,x){var w={name:m,delta:S,target:y,should:x,shadowParent:Khe(y)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(O){return O!==w})},1)},[]),u=k.useCallback(function(m){t.current=Og(m),r.current=void 0},[]),d=k.useCallback(function(m){c(m.type,LT(m),m.target,a(m,n.lockRef.current))},[]),h=k.useCallback(function(m){c(m.type,Og(m),m.target,a(m,n.lockRef.current))},[]);k.useEffect(function(){return bu.push(s),n.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,wu),document.addEventListener("touchmove",l,wu),document.addEventListener("touchstart",u,wu),function(){bu=bu.filter(function(m){return m!==s}),document.removeEventListener("wheel",l,wu),document.removeEventListener("touchmove",l,wu),document.removeEventListener("touchstart",u,wu)}},[]);var p=n.removeScrollBar,g=n.inert;return k.createElement(k.Fragment,null,g?k.createElement(s,{styles:Vhe(i)}):null,p?k.createElement(Nhe,{gapMode:n.gapMode}):null)}function Khe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const Yhe=Che(ML,Xhe);var Zv=k.forwardRef(function(n,e){return k.createElement(Yv,io({},n,{ref:e,sideCar:Yhe}))});Zv.classNames=Yv.classNames;var Zhe=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Ou=new WeakMap,kg=new WeakMap,Cg={},w2=0,jL=function(n){return n&&(n.host||jL(n.parentNode))},Jhe=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=jL(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},efe=function(n,e,t,r){var i=Jhe(e,Array.isArray(n)?n:[n]);Cg[t]||(Cg[t]=new WeakMap);var s=Cg[t],o=[],a=new Set,l=new Set(i),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};i.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var p=h.getAttribute(r),g=p!==null&&p!=="false",m=(Ou.get(h)||0)+1,S=(s.get(h)||0)+1;Ou.set(h,m),s.set(h,S),o.push(h),m===1&&g&&kg.set(h,!0),S===1&&h.setAttribute(t,"true"),g||h.setAttribute(r,"true")}catch(y){console.error("aria-hidden: cannot operate on ",h,y)}})};return u(e),a.clear(),w2++,function(){o.forEach(function(d){var h=Ou.get(d)-1,p=s.get(d)-1;Ou.set(d,h),s.set(d,p),h||(kg.has(d)||d.removeAttribute(r),kg.delete(d)),p||d.removeAttribute(t)}),w2--,w2||(Ou=new WeakMap,Ou=new WeakMap,kg=new WeakMap,Cg={})}},mO=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),i=Zhe(n);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),efe(r,i,t,"aria-hidden")):function(){return null}},yO="Dialog",[LL,VOe]=Ro(yO),[tfe,$s]=LL(yO),zL=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=n,a=k.useRef(null),l=k.useRef(null),[c=!1,u]=Yl({prop:r,defaultProp:i,onChange:s});return f.jsx(tfe,{scope:e,triggerRef:a,contentRef:l,contentId:fa(),titleId:fa(),descriptionId:fa(),open:c,onOpenChange:u,onOpenToggle:k.useCallback(()=>u(d=>!d),[u]),modal:o,children:t})};zL.displayName=yO;var NL="DialogTrigger",nfe=k.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=$s(NL,t),s=_t(e,i.triggerRef);return f.jsx(it.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":xO(i.open),...r,ref:s,onClick:be(n.onClick,i.onOpenToggle)})});nfe.displayName=NL;var vO="DialogPortal",[rfe,$L]=LL(vO,{forceMount:void 0}),FL=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:i}=n,s=$s(vO,e);return f.jsx(rfe,{scope:e,forceMount:t,children:k.Children.map(r,o=>f.jsx(Ns,{present:t||s.open,children:f.jsx(o0,{asChild:!0,container:i,children:o})}))})};FL.displayName=vO;var by="DialogOverlay",BL=k.forwardRef((n,e)=>{const t=$L(by,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,s=$s(by,n.__scopeDialog);return s.modal?f.jsx(Ns,{present:r||s.open,children:f.jsx(ife,{...i,ref:e})}):null});BL.displayName=by;var ife=k.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=$s(by,t);return f.jsx(Zv,{as:qc,allowPinchZoom:!0,shards:[i.contentRef],children:f.jsx(it.div,{"data-state":xO(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),Wc="DialogContent",UL=k.forwardRef((n,e)=>{const t=$L(Wc,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,s=$s(Wc,n.__scopeDialog);return f.jsx(Ns,{present:r||s.open,children:s.modal?f.jsx(sfe,{...i,ref:e}):f.jsx(ofe,{...i,ref:e})})});UL.displayName=Wc;var sfe=k.forwardRef((n,e)=>{const t=$s(Wc,n.__scopeDialog),r=k.useRef(null),i=_t(e,t.contentRef,r);return k.useEffect(()=>{const s=r.current;if(s)return mO(s)},[]),f.jsx(HL,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:be(n.onCloseAutoFocus,s=>{var o;s.preventDefault(),(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:be(n.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:be(n.onFocusOutside,s=>s.preventDefault())})}),ofe=k.forwardRef((n,e)=>{const t=$s(Wc,n.__scopeDialog),r=k.useRef(!1),i=k.useRef(!1);return f.jsx(HL,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=n.onCloseAutoFocus)==null||o.call(n,s),s.defaultPrevented||(r.current||(a=t.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var l,c;(l=n.onInteractOutside)==null||l.call(n,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((c=t.triggerRef.current)==null?void 0:c.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),HL=k.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=n,a=$s(Wc,t),l=k.useRef(null),c=_t(e,l);return gO(),f.jsxs(f.Fragment,{children:[f.jsx(Kv,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:f.jsx(s0,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":xO(a.open),...o,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),f.jsxs(f.Fragment,{children:[f.jsx(lfe,{titleId:a.titleId}),f.jsx(ufe,{contentRef:l,descriptionId:a.descriptionId})]})]})}),SO="DialogTitle",QL=k.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=$s(SO,t);return f.jsx(it.h2,{id:i.titleId,...r,ref:e})});QL.displayName=SO;var qL="DialogDescription",afe=k.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=$s(qL,t);return f.jsx(it.p,{id:i.descriptionId,...r,ref:e})});afe.displayName=qL;var WL="DialogClose",VL=k.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=$s(WL,t);return f.jsx(it.button,{type:"button",...r,ref:e,onClick:be(n.onClick,()=>i.onOpenChange(!1))})});VL.displayName=WL;function xO(n){return n?"open":"closed"}var GL="DialogTitleWarning",[GOe,XL]=Fde(GL,{contentName:Wc,titleName:SO,docsSlug:"dialog"}),lfe=({titleId:n})=>{const e=XL(GL),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return k.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},cfe="DialogDescriptionWarning",ufe=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${XL(cfe).contentName}}.`;return k.useEffect(()=>{var s;const i=(s=n.current)==null?void 0:s.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},dfe=zL,hfe=FL,ffe=BL,pfe=UL;const KL=()=>{},YL=k.createContext(null);function gfe({onEvent:n,children:e}){return f.jsx(YL.Provider,{value:n??KL,children:e})}function tr(){return k.useContext(YL)??KL}const ZL=k.createContext(null);function mfe({children:n}){const e=G(),t=tr(),[r,i]=k.useState([]),s=k.useCallback(c=>{const u=c.id??wt();return i(d=>[...d.filter(h=>h.id!==c.id),{...c,id:u}]),t("open-menu",{source:"dialog",id:u}),e.addOpenMenu(u),u},[e,t]),o=k.useCallback((c,u)=>(i(d=>d.map(h=>h.id===c?{...h,...u}:h)),t("open-menu",{source:"dialog",id:c}),e.addOpenMenu(c),c),[e,t]),a=k.useCallback(c=>(i(u=>u.filter(d=>{var h;return d.id===c?((h=d.onClose)==null||h.call(d),!1):!0})),t("close-menu",{source:"dialog",id:c}),e.deleteOpenMenu(c),c),[e,t]),l=k.useCallback(()=>{i(c=>(c.forEach(u=>{var d;(d=u.onClose)==null||d.call(u),t("close-menu",{source:"dialog",id:u.id}),e.deleteOpenMenu(u.id)}),[]))},[e,t]);return f.jsx(ZL.Provider,{value:{dialogs:r,addDialog:s,removeDialog:a,clearDialogs:l,updateDialog:o},children:n})}function cu(){const n=k.useContext(ZL);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}const yfe=({id:n,component:e,onClose:t})=>{const{removeDialog:r}=cu(),i=Nn(),s=k.useCallback(o=>{if(!o){if(t)try{t()}catch(a){console.warn(a)}r(n)}},[n,t,r]);return f.jsx(dfe,{onOpenChange:s,defaultOpen:!0,children:f.jsx(hfe,{container:i,children:f.jsx(ffe,{dir:"ltr",className:"tlui-dialog__overlay",onClick:o=>{o.target===o.currentTarget&&s(!1)},children:f.jsx(pfe,{dir:"ltr",className:"tlui-dialog__content",children:f.jsx(e,{onClose:()=>s(!1)})})})})})};function vfe(){const{dialogs:n}=cu();return n.map(e=>f.jsx(yfe,{...e},e.id))}const Sfe=Qe.memo(vfe);function xfe(){const n=G(),e=ee("follow",()=>n.getInstanceState().followingUserId,[n]);return e?f.jsx(wfe,{userId:e}):null}function wfe({userId:n}){const e=zv(n);return e?f.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}function Jv(n){const e=n+"CollectionProvider",[t,r]=Ro(e),[i,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=p=>{const{scope:g,children:m}=p,S=Qe.useRef(null),y=Qe.useRef(new Map).current;return f.jsx(i,{scope:g,itemMap:y,collectionRef:S,children:m})};o.displayName=e;const a=n+"CollectionSlot",l=Qe.forwardRef((p,g)=>{const{scope:m,children:S}=p,y=s(a,m),x=_t(g,y.collectionRef);return f.jsx(qc,{ref:x,children:S})});l.displayName=a;const c=n+"CollectionItemSlot",u="data-radix-collection-item",d=Qe.forwardRef((p,g)=>{const{scope:m,children:S,...y}=p,x=Qe.useRef(null),w=_t(g,x),O=s(c,m);return Qe.useEffect(()=>(O.itemMap.set(x,{ref:x,...y}),()=>void O.itemMap.delete(x))),f.jsx(qc,{[u]:"",ref:w,children:S})});d.displayName=c;function h(p){const g=s(n+"CollectionConsumer",p);return Qe.useCallback(()=>{const S=g.collectionRef.current;if(!S)return[];const y=Array.from(S.querySelectorAll(`[${u}]`));return Array.from(g.itemMap.values()).sort((O,T)=>y.indexOf(O.ref.current)-y.indexOf(T.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:o,Slot:l,ItemSlot:d},h,r]}var bfe="VisuallyHidden",wO=k.forwardRef((n,e)=>f.jsx(it.span,{...n,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}));wO.displayName=bfe;var bO="ToastProvider",[OO,Ofe,kfe]=Jv("Toast"),[JL,XOe]=Ro("Toast",[kfe]),[Cfe,eS]=JL(bO),ez=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:s=50,children:o}=n,[a,l]=k.useState(null),[c,u]=k.useState(0),d=k.useRef(!1),h=k.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${bO}\`. Expected non-empty \`string\`.`),f.jsx(OO.Provider,{scope:e,children:f.jsx(Cfe,{scope:e,label:t,duration:r,swipeDirection:i,swipeThreshold:s,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:k.useCallback(()=>u(p=>p+1),[]),onToastRemove:k.useCallback(()=>u(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h,children:o})})};ez.displayName=bO;var tz="ToastViewport",Pfe=["F8"],E4="toast.viewportPause",I4="toast.viewportResume",nz=k.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=Pfe,label:i="Notifications ({hotkey})",...s}=n,o=eS(tz,t),a=Ofe(t),l=k.useRef(null),c=k.useRef(null),u=k.useRef(null),d=k.useRef(null),h=_t(e,d,o.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=o.toastCount>0;k.useEffect(()=>{const S=y=>{var w;r.every(O=>y[O]||y.code===O)&&((w=d.current)==null||w.focus())};return document.addEventListener("keydown",S),()=>document.removeEventListener("keydown",S)},[r]),k.useEffect(()=>{const S=l.current,y=d.current;if(g&&S&&y){const x=()=>{if(!o.isClosePausedRef.current){const E=new CustomEvent(E4);y.dispatchEvent(E),o.isClosePausedRef.current=!0}},w=()=>{if(o.isClosePausedRef.current){const E=new CustomEvent(I4);y.dispatchEvent(E),o.isClosePausedRef.current=!1}},O=E=>{!S.contains(E.relatedTarget)&&w()},T=()=>{S.contains(document.activeElement)||w()};return S.addEventListener("focusin",x),S.addEventListener("focusout",O),S.addEventListener("pointermove",x),S.addEventListener("pointerleave",T),window.addEventListener("blur",x),window.addEventListener("focus",w),()=>{S.removeEventListener("focusin",x),S.removeEventListener("focusout",O),S.removeEventListener("pointermove",x),S.removeEventListener("pointerleave",T),window.removeEventListener("blur",x),window.removeEventListener("focus",w)}}},[g,o.isClosePausedRef]);const m=k.useCallback(({tabbingDirection:S})=>{const x=a().map(w=>{const O=w.ref.current,T=[O,...$fe(O)];return S==="forwards"?T:T.reverse()});return(S==="forwards"?x.reverse():x).flat()},[a]);return k.useEffect(()=>{const S=d.current;if(S){const y=x=>{var T,E,C;const w=x.altKey||x.ctrlKey||x.metaKey;if(x.key==="Tab"&&!w){const M=document.activeElement,A=x.shiftKey;if(x.target===S&&A){(T=c.current)==null||T.focus();return}const F=m({tabbingDirection:A?"backwards":"forwards"}),j=F.findIndex(L=>L===M);b2(F.slice(j+1))?x.preventDefault():A?(E=c.current)==null||E.focus():(C=u.current)==null||C.focus()}};return S.addEventListener("keydown",y),()=>S.removeEventListener("keydown",y)}},[a,m]),f.jsxs(ihe,{ref:l,role:"region","aria-label":i.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:g?void 0:"none"},children:[g&&f.jsx(M4,{ref:c,onFocusFromOutsideViewport:()=>{const S=m({tabbingDirection:"forwards"});b2(S)}}),f.jsx(OO.Slot,{scope:t,children:f.jsx(it.ol,{tabIndex:-1,...s,ref:h})}),g&&f.jsx(M4,{ref:u,onFocusFromOutsideViewport:()=>{const S=m({tabbingDirection:"backwards"});b2(S)}})]})});nz.displayName=tz;var rz="ToastFocusProxy",M4=k.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...i}=n,s=eS(rz,t);return f.jsx(wO,{"aria-hidden":!0,tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=s.viewport)!=null&&c.contains(a))&&r()}})});M4.displayName=rz;var tS="Toast",Tfe="toast.swipeStart",Efe="toast.swipeMove",Ife="toast.swipeCancel",Mfe="toast.swipeEnd",iz=k.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:i,onOpenChange:s,...o}=n,[a=!0,l]=Yl({prop:r,defaultProp:i,onChange:s});return f.jsx(Ns,{present:t||a,children:f.jsx(Rfe,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:Jn(n.onPause),onResume:Jn(n.onResume),onSwipeStart:be(n.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:be(n.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:be(n.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:be(n.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});iz.displayName=tS;var[Afe,_fe]=JL(tS,{onClose(){}}),Rfe=k.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:i,open:s,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:p,...g}=n,m=eS(tS,t),[S,y]=k.useState(null),x=_t(e,L=>y(L)),w=k.useRef(null),O=k.useRef(null),T=i||m.duration,E=k.useRef(0),C=k.useRef(T),M=k.useRef(0),{onToastAdd:A,onToastRemove:D}=m,N=Jn(()=>{var U;(S==null?void 0:S.contains(document.activeElement))&&((U=m.viewport)==null||U.focus()),o()}),F=k.useCallback(L=>{!L||L===1/0||(window.clearTimeout(M.current),E.current=new Date().getTime(),M.current=window.setTimeout(N,L))},[N]);k.useEffect(()=>{const L=m.viewport;if(L){const U=()=>{F(C.current),c==null||c()},Y=()=>{const V=new Date().getTime()-E.current;C.current=C.current-V,window.clearTimeout(M.current),l==null||l()};return L.addEventListener(E4,Y),L.addEventListener(I4,U),()=>{L.removeEventListener(E4,Y),L.removeEventListener(I4,U)}}},[m.viewport,T,l,c,F]),k.useEffect(()=>{s&&!m.isClosePausedRef.current&&F(T)},[s,T,m.isClosePausedRef,F]),k.useEffect(()=>(A(),()=>D()),[A,D]);const j=k.useMemo(()=>S?dz(S):null,[S]);return m.viewport?f.jsxs(f.Fragment,{children:[j&&f.jsx(Dfe,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:j}),f.jsx(Afe,{scope:t,onClose:N,children:su.createPortal(f.jsx(OO.ItemSlot,{scope:t,children:f.jsx(rhe,{asChild:!0,onEscapeKeyDown:be(a,()=>{m.isFocusedToastEscapeKeyDownRef.current||N(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:f.jsx(it.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":m.swipeDirection,...g,ref:x,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:be(n.onKeyDown,L=>{L.key==="Escape"&&(a==null||a(L.nativeEvent),L.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,N()))}),onPointerDown:be(n.onPointerDown,L=>{L.button===0&&(w.current={x:L.clientX,y:L.clientY})}),onPointerMove:be(n.onPointerMove,L=>{if(!w.current)return;const U=L.clientX-w.current.x,Y=L.clientY-w.current.y,V=!!O.current,W=["left","right"].includes(m.swipeDirection),J=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,ne=W?J(0,U):0,le=W?0:J(0,Y),ue=L.pointerType==="touch"?10:2,Pe={x:ne,y:le},je={originalEvent:L,delta:Pe};V?(O.current=Pe,Pg(Efe,d,je,{discrete:!1})):NT(Pe,m.swipeDirection,ue)?(O.current=Pe,Pg(Tfe,u,je,{discrete:!1}),L.target.setPointerCapture(L.pointerId)):(Math.abs(U)>ue||Math.abs(Y)>ue)&&(w.current=null)}),onPointerUp:be(n.onPointerUp,L=>{const U=O.current,Y=L.target;if(Y.hasPointerCapture(L.pointerId)&&Y.releasePointerCapture(L.pointerId),O.current=null,w.current=null,U){const V=L.currentTarget,W={originalEvent:L,delta:U};NT(U,m.swipeDirection,m.swipeThreshold)?Pg(Mfe,p,W,{discrete:!0}):Pg(Ife,h,W,{discrete:!0}),V.addEventListener("click",J=>J.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),Dfe=n=>{const{__scopeToast:e,children:t,...r}=n,i=eS(tS,e),[s,o]=k.useState(!1),[a,l]=k.useState(!1);return zfe(()=>o(!0)),k.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:f.jsx(o0,{asChild:!0,children:f.jsx(wO,{...r,children:s&&f.jsxs(f.Fragment,{children:[i.label," ",t]})})})},jfe="ToastTitle",sz=k.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return f.jsx(it.div,{...r,ref:e})});sz.displayName=jfe;var Lfe="ToastDescription",oz=k.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return f.jsx(it.div,{...r,ref:e})});oz.displayName=Lfe;var az="ToastAction",lz=k.forwardRef((n,e)=>{const{altText:t,...r}=n;return t.trim()?f.jsx(uz,{altText:t,asChild:!0,children:f.jsx(kO,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${az}\`. Expected non-empty \`string\`.`),null)});lz.displayName=az;var cz="ToastClose",kO=k.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,i=_fe(cz,t);return f.jsx(uz,{asChild:!0,children:f.jsx(it.button,{type:"button",...r,ref:e,onClick:be(n.onClick,i.onClose)})})});kO.displayName=cz;var uz=k.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...i}=n;return f.jsx(it.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:e})});function dz(n){const e=[];return Array.from(n.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),Nfe(r)){const i=r.ariaHidden||r.hidden||r.style.display==="none",s=r.dataset.radixToastAnnounceExclude==="";if(!i)if(s){const o=r.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...dz(r))}}),e}function Pg(n,e,t,{discrete:r}){const i=t.originalEvent.currentTarget,s=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?pO(i,s):i.dispatchEvent(s)}var NT=(n,e,t=0)=>{const r=Math.abs(n.x),i=Math.abs(n.y),s=r>i;return e==="left"||e==="right"?s&&r>t:!s&&i>t};function zfe(n=()=>{}){const e=Jn(n);Ml(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function Nfe(n){return n.nodeType===n.ELEMENT_NODE}function $fe(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function b2(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var Ffe=iz,Bfe=sz,Ufe=oz,Hfe=lz,$T=kO;const hz=k.createContext(null);function Qfe({children:n}){const[e,t]=k.useState([]),r=k.useCallback(o=>{const a=o.id??wt();return t(l=>[...l.filter(c=>c.id!==o.id),{...o,id:a}]),a},[]),i=k.useCallback(o=>(t(a=>a.filter(l=>l.id!==o)),o),[]),s=k.useCallback(()=>{t(()=>[])},[]);return f.jsx(ez,{children:f.jsx(hz.Provider,{value:{toasts:e,addToast:r,removeToast:i,clearToasts:s},children:n})})}function Fs(){const n=k.useContext(hz);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}const Ee=k.forwardRef(function({children:e,disabled:t,type:r,...i},s){return f.jsx("button",{ref:s,type:"button",draggable:!1,disabled:t,...i,className:Te("tlui-button",`tlui-button__${r}`,i.className),children:e})});function dn({children:n}){return f.jsx("span",{className:"tlui-button__label",children:n})}const To=k.memo(function({small:e,invertIcon:t,icon:r,color:i,className:s,...o}){const a=uO(),l=a.icons[r]??a.icons["question-mark-circle"],c=k.useRef(null);return k.useLayoutEffect(()=>{l||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),c!=null&&c.current&&(c.current.style.webkitMask=`url(${l}) center 100% / 100% no-repeat`)},[c,l,r]),r==="none"?f.jsx("div",{className:Te("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},s)}):f.jsx("div",{...o,ref:c,className:Te("tlui-icon",{"tlui-icon__small":e},s),style:{color:i,mask:`url(${l}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})}),qfe={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function Wfe({toast:n}){const{removeToast:e}=Fs(),t=Xe(),r=o=>{o||e(n.id)},i=n.actions&&n.actions.length>0,s=n.icon||n.severity&&qfe[n.severity];return f.jsxs(Ffe,{onOpenChange:r,className:"tlui-toast__container",duration:n.keepOpen?1/0:5e3,"data-severity":n.severity,children:[s&&f.jsx("div",{className:"tlui-toast__icon",children:f.jsx(To,{icon:s})}),f.jsxs("div",{className:"tlui-toast__main",children:[f.jsxs("div",{className:"tlui-toast__content",children:[n.title&&f.jsx(Bfe,{className:"tlui-toast__title",children:n.title}),n.description&&f.jsx(Ufe,{className:"tlui-toast__description",children:n.description})]}),n.actions&&f.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((o,a)=>f.jsx(Hfe,{altText:o.label,asChild:!0,onClick:o.onClick,children:f.jsx(Ee,{type:o.type,children:f.jsx(dn,{children:o.label})})},a)),f.jsx($T,{asChild:!0,children:f.jsx(Ee,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:f.jsx(dn,{children:n.closeLabel??t("toast.close")})})})]})]}),!i&&f.jsx($T,{asChild:!0,children:f.jsx(Ee,{type:"normal",className:"tlui-toast__close",children:f.jsx(dn,{children:n.closeLabel??t("toast.close")})})})]})}function Vfe(){const{toasts:n}=Fs();return n.map(e=>f.jsx(Wfe,{toast:e},e.id))}const Gfe=k.memo(Vfe);function Xfe(){const n=G(),{toasts:e}=Fs(),[t,r]=k.useState(!1);return k.useEffect(()=>{let i=-1;return e.length?r(!0):i=n.timers.setTimeout(()=>{r(!1)},1e3),()=>{clearTimeout(i)}},[e.length,r,n]),t?f.jsx(nz,{className:"tlui-toast__viewport"}):null}function We({icon:n,small:e,invertIcon:t}){return f.jsx(To,{className:"tlui-button__icon",icon:n,small:e,invertIcon:t})}const O2=[0,390,428,468,580,640,840,1023];var sn=(n=>(n[n.ZERO=0]="ZERO",n[n.MOBILE_XXS=1]="MOBILE_XXS",n[n.MOBILE_XS=2]="MOBILE_XS",n[n.MOBILE_SM=3]="MOBILE_SM",n[n.MOBILE=4]="MOBILE",n[n.TABLET_SM=5]="TABLET_SM",n[n.TABLET=6]="TABLET",n[n.DESKTOP=7]="DESKTOP",n))(sn||{});let A4={fonts:{draw:`${al()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${al()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${al()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${al()}/fonts/IBMPlexMono-Medium.woff2`}};function fz(n){return k.useMemo(()=>n?{fonts:{...A4.fonts,...n==null?void 0:n.fonts}}:A4,[n])}const Kfe=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let Rh={...A4,icons:Object.fromEntries(Kfe.map(n=>[n,`${al()}/icons/icon/${n}.svg`])),translations:Object.fromEntries(hp.map(n=>[n.locale,`${al()}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(Gp.map(n=>[n.type,`${al()}/embed-icons/${n.type}.png`]))};function Yfe(n){return n?{fonts:Object.assign({...Rh.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...Rh.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...Rh.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...Rh.translations},{...n==null?void 0:n.translations})}:Rh}function nS({className:n,children:e}){return f.jsx("div",{className:Te("tlui-dialog__header",n),children:e})}function rS({className:n,children:e}){return f.jsx(QL,{dir:"ltr",className:Te("tlui-dialog__header__title",n),children:e})}function iS(){return f.jsx("div",{className:"tlui-dialog__header__close",children:f.jsx(VL,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:f.jsx(Ee,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:f.jsx(We,{small:!0,icon:"cross-2"})})})})}function mp({className:n,children:e,style:t}){return f.jsx("div",{className:Te("tlui-dialog__body",n),style:t,children:e})}function CO({className:n,children:e}){return f.jsx("div",{className:Te("tlui-dialog__footer",n),children:e})}const sS=k.forwardRef(function({className:e,label:t,icon:r,iconLeft:i,autoSelect:s=!1,autoFocus:o=!1,defaultValue:a,placeholder:l,onComplete:c,onValueChange:u,onCancel:d,onFocus:h,onBlur:p,shouldManuallyMaintainScrollPositionWhenFocused:g=!1,children:m,value:S},y){const x=G(),w=k.useRef(null);k.useImperativeHandle(y,()=>w.current);const O=Xe(),T=k.useRef(a??""),E=k.useRef(a??""),[C,M]=k.useState(!1),A=k.useCallback(j=>{M(!0);const L=j.currentTarget;E.current=L.value,x.timers.requestAnimationFrame(()=>{s&&L.select()}),h==null||h()},[s,h,x.timers]),D=k.useCallback(j=>{const L=j.currentTarget.value;E.current=L,u==null||u(L)},[u]),N=k.useCallback(j=>{switch(j.key){case"Enter":{j.currentTarget.blur(),Tn(j),c==null||c(j.currentTarget.value);break}case"Escape":{j.currentTarget.value=T.current,j.currentTarget.blur(),Tn(j),d==null||d(j.currentTarget.value);break}}},[c,d]),F=k.useCallback(j=>{M(!1);const L=j.currentTarget.value;p==null||p(L)},[p]);return k.useEffect(()=>{if(!x.environment.isIos)return;const j=window.visualViewport;if(C&&g&&j){const L=()=>{var U;(U=w.current)==null||U.scrollIntoView({block:"center"})};return j.addEventListener("resize",L),j.addEventListener("scroll",L),x.timers.requestAnimationFrame(()=>{var U;(U=w.current)==null||U.scrollIntoView({block:"center"})}),()=>{j.removeEventListener("resize",L),j.removeEventListener("scroll",L)}}},[x,C,g]),f.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[m,t&&f.jsx("label",{children:O(t)}),i&&f.jsx(To,{icon:i,className:"tlui-icon-left",small:!0}),f.jsx("input",{ref:w,className:Te("tlui-input",e),type:"text",defaultValue:a,onKeyUp:N,onChange:D,onFocus:A,onBlur:F,autoFocus:o,placeholder:l,value:S}),r&&f.jsx(To,{icon:r,small:!!t})]})}),pz=zn(function({onClose:e}){const t=G(),r=Xe(),i=uO(),[s,o]=k.useState(null),[a,l]=k.useState(""),[c,u]=k.useState(null),[d,h]=k.useState(!1),p=k.useRef(-1);return f.jsxs(f.Fragment,{children:[f.jsxs(nS,{children:[f.jsx(rS,{children:s?`${r("embed-dialog.title")}  ${s.title}`:r("embed-dialog.title")}),f.jsx(iS,{})]}),s?f.jsxs(f.Fragment,{children:[f.jsxs(mp,{className:"tlui-embed-dialog__enter",children:[f.jsx(sS,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autoFocus:!0,onValueChange:g=>{l(g);const m=cl(g);u(m&&m.definition.type===s.type?m:null),h(!1),clearTimeout(p.current),p.current=t.timers.setTimeout(()=>h(!m),320)}}),a===""?f.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[f.jsx("span",{children:r("embed-dialog.instruction")})," ",s.instructionLink&&f.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",f.jsx(To,{icon:"external-link",small:!0})]})]}):f.jsx("div",{className:"tlui-embed-dialog__warning",children:d?r("embed-dialog.invalid-url"):""})]}),f.jsxs(CO,{className:"tlui-dialog__footer__actions",children:[f.jsx(Ee,{type:"normal",onClick:()=>{o(null),u(null),l("")},children:f.jsx(dn,{children:r("embed-dialog.back")})}),f.jsx("div",{className:"tlui-embed__spacer"}),f.jsx(Ee,{type:"normal",onClick:e,children:f.jsx(dn,{children:r("embed-dialog.cancel")})}),f.jsx(Ee,{type:"primary",disabled:!c,onClick:()=>{c&&(t.putExternalContent({type:"embed",url:a,point:t.getViewportPageBounds().center,embed:c.definition}),e())},children:f.jsx(dn,{children:r("embed-dialog.create")})})]})]}):f.jsx(f.Fragment,{children:f.jsx(mp,{className:"tlui-embed-dialog__list",children:Gp.map(g=>f.jsxs(Ee,{type:"menu",onClick:()=>o(g),children:[f.jsx(dn,{children:g.title}),f.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${i.embedIcons[g.type]})`}})]},g.type))})})]})});function gz(){const n=G(),e=k.useRef();return k.useEffect(()=>{const t=window.document.createElement("input");t.type="file",t.accept=ine,t.multiple=!0,e.current=t;async function r(i){const s=i.target.files;!s||s.length===0||(n.mark("insert media"),await n.putExternalContent({type:"files",files:Array.from(s),point:n.getViewportPageBounds().center,ignoreParent:!1}),t.value="")}return t.addEventListener("change",r),()=>{e.current=void 0,t.removeEventListener("change",r)}},[n]),k.useCallback(()=>{var t;(t=e.current)==null||t.click()},[e])}const mz=k.createContext(null);function Zfe({overrides:n,children:e}){const t=G(),r=tr(),{addDialog:i}=cu(),s=gz(),o=k.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(c){t.setCurrentTool("select"),r("select-tool",{source:c,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(c){t.setCurrentTool("hand"),r("select-tool",{source:c,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(c){t.setCurrentTool("eraser"),r("select-tool",{source:c,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(c){t.setCurrentTool("draw"),r("select-tool",{source:c,id:"draw"})}},...[...ks.values].map(c=>({id:c,label:`tool.${c}`,meta:{geo:c},kbd:c==="rectangle"?"r":c==="ellipse"?"o":void 0,icon:"geo-"+c,onSelect(u){t.run(()=>{t.setStyleForNextShapes(ks,c),t.setCurrentTool("geo"),r("select-tool",{source:u,id:`geo-${c}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(c){t.setCurrentTool("arrow"),r("select-tool",{source:c,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(c){t.setCurrentTool("line"),r("select-tool",{source:c,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(c){t.setCurrentTool("frame"),r("select-tool",{source:c,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(c){t.setCurrentTool("text"),r("select-tool",{source:c,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(c){s(),r("select-tool",{source:c,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(c){t.setCurrentTool("note"),r("select-tool",{source:c,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(c){t.setCurrentTool("laser"),r("select-tool",{source:c,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(c){i({component:pz}),r("select-tool",{source:c,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(c){t.setCurrentTool("highlight"),r("select-tool",{source:c,id:"highlight"})}}];a.push();const l=Object.fromEntries(a.map(c=>[c.id,c]));return n?n(t,l,{insertMedia:s}):l},[n,t,r,s,i]);return f.jsx(mz.Provider,{value:o,children:e})}function Rd(){const n=k.useContext(mz);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}const yz=Qe.createContext(null);function Jfe({forceMobile:n=!1,children:e}){const t=G(),r=ee("breakpoint",()=>{const{width:i}=t.getViewportScreenBounds(),s=n?sn.MOBILE_SM:O2.length-1;for(let o=0;o<s;o++)if(i>O2[o]&&i<=O2[o+1])return o;return s},[t]);return f.jsx(yz.Provider,{value:r,children:e})}function Lr(){const n=k.useContext(yz);if(n===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return n}function epe(){const{addToast:n,removeToast:e,clearToasts:t}=Fs(),{addDialog:r,clearDialogs:i,removeDialog:s,updateDialog:o}=cu(),l=Lr()<sn.TABLET_SM,c=Xe();return k.useMemo(()=>({addToast:n,removeToast:e,clearToasts:t,addDialog:r,clearDialogs:i,removeDialog:s,updateDialog:o,msg:c,isMobile:l}),[r,n,i,t,c,s,e,o,l])}function tpe(n,e){const t={};for(const r of n)if(r.translations)for(const[i,s]of Kn(r.translations)){let o=t[i];o||(o=t[i]={}),Object.assign(o,s)}return{actions:(r,i)=>{for(const s of n)s.actions&&(i=s.actions(r,i,e));return i},tools:(r,i,s)=>{for(const o of n)o.tools&&(i=o.tools(r,i,{...e,...s}));return i},translations:t}}function vz(n){return k.useMemo(()=>n,n)}function npe(n){const e=vz(n==null?[]:Array.isArray(n)?n:[n]);return k.useMemo(()=>{const t={};for(const r of e)if(r.translations)for(const[i,s]of Kn(r.translations)){let o=t[i];o||(o=t[i]={}),Object.assign(o,s)}return t},[e])}function rpe(n){const e=epe(),t=vz(n==null?[]:Array.isArray(n)?n:[n]);return k.useMemo(()=>tpe(t,e),[t,e])}function ipe(n,e){const t=He(e.map(i=>n.getShape(i)).filter(i=>i&&n.isShapeOfType(i,"frame")));if(!t.length)return;const r=[];n.run(()=>{t.map(i=>{const s=n.getSortedChildIdsForParent(i.id);s.length&&(n.reparentShapes(s,i.parentId,i.index),r.push(...s))}),n.setSelectedShapes(r),n.deleteShapes(e)})}const spe=50;function ope(n,e,t={}){const r=n.getShape(e);if(!r)return;const i=n.getSortedChildIdsForParent(r.id),s=He(i.map(p=>n.getShape(p)));if(!s.length)return;const o=ye.FromPoints(s.flatMap(p=>{const g=n.getShapeGeometry(p.id);return n.getShapeLocalTransform(p).applyToPoints(g.vertices)})),{padding:a=spe}=t,l=o.w+2*a,c=o.h+2*a,u=a-o.minX,d=a-o.minY;if(u===0&&d===0&&r.props.w===l&&r.props.h===c)return;const h=new b(u,d).rot(r.rotation);n.run(()=>{const p=i.map(g=>{const m=n.getShape(g);return{id:m.id,type:m.type,x:m.x+u,y:m.y+d}});p.push({id:r.id,type:r.type,x:r.x-h.x,y:r.y-h.y,props:{w:l,h:c}}),n.updateShapes(p)})}function FT(n){return Mi.isValid(n)?{isValid:!0,hasProtocol:!0}:Mi.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const ape=zn(function({onClose:e}){const r=G().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?f.jsx(lpe,{onClose:e,selectedShape:r}):null}),lpe=zn(function({onClose:e,selectedShape:t}){const r=G(),i=Xe(),s=k.useRef(null);k.useEffect(()=>{r.timers.requestAnimationFrame(()=>{var g;return(g=s.current)==null?void 0:g.focus()})},[r]);const o=k.useRef(t.props.url),[a,l]=k.useState(()=>{const g=FT(t.props.url),m=g.isValid===!0?g.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:m,safe:m,valid:!0}}),c=k.useCallback(g=>{const m=g.replace(/https?:\/\/(https?:\/\/)/,(x,w)=>w),S=FT(m),y=S.isValid===!0?S.hasProtocol?m:"https://"+m:"https://";l({actual:m,safe:y,valid:S.isValid})},[]),u=k.useCallback(()=>{const g=r.getOnlySelectedShape();g&&(r.updateShapes([{id:g.id,type:g.type,props:{url:""}}]),e())},[r,e]),d=k.useCallback(()=>{const g=r.getOnlySelectedShape();g&&(g&&"url"in g.props&&g.props.url!==a.safe&&r.updateShapes([{id:g.id,type:g.type,props:{url:a.safe}}]),e())},[r,e,a]),h=k.useCallback(()=>{e()},[e]);if(!t)return e(),null;const p=o.current&&!a.valid;return f.jsxs(f.Fragment,{children:[f.jsxs(nS,{children:[f.jsx(rS,{children:i("edit-link-dialog.title")}),f.jsx(iS,{})]}),f.jsx(mp,{children:f.jsxs("div",{className:"tlui-edit-link-dialog",children:[f.jsx(sS,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:a.actual,onValueChange:c,onComplete:d,onCancel:h}),f.jsx("div",{children:a.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),f.jsxs(CO,{className:"tlui-dialog__footer__actions",children:[f.jsx(Ee,{type:"normal",onClick:h,onTouchEnd:h,children:f.jsx(dn,{children:i("edit-link-dialog.cancel")})}),p?f.jsx(Ee,{type:"danger",onTouchEnd:u,onClick:u,children:f.jsx(dn,{children:i("edit-link-dialog.clear")})}):f.jsx(Ee,{type:"primary",disabled:!a.valid,onTouchEnd:d,onClick:d,children:f.jsx(dn,{children:i("edit-link-dialog.save")})})]})]})});var PO={exports:{}};PO.exports;(function(n){var e=function(){var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(l,c){if(!s[l]){s[l]={};for(var u=0;u<l.length;u++)s[l][l.charAt(u)]=u}return s[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(u){return r.charAt(u)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return o(r,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return t(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),u=new Uint8Array(c.length*2),d=0,h=c.length;d<h;d++){var p=c.charCodeAt(d);u[d*2]=p>>>8,u[d*2+1]=p%256}return u},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),u=0,d=c.length;u<d;u++)c[u]=l[u*2]*256+l[u*2+1];var h=[];return c.forEach(function(p){h.push(t(p))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return o(i,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return t(c)})},_compress:function(l,c,u){if(l==null)return"";var d,h,p={},g={},m="",S="",y="",x=2,w=3,O=2,T=[],E=0,C=0,M;for(M=0;M<l.length;M+=1)if(m=l.charAt(M),Object.prototype.hasOwnProperty.call(p,m)||(p[m]=w++,g[m]=!0),S=y+m,Object.prototype.hasOwnProperty.call(p,S))y=S;else{if(Object.prototype.hasOwnProperty.call(g,y)){if(y.charCodeAt(0)<256){for(d=0;d<O;d++)E=E<<1,C==c-1?(C=0,T.push(u(E)),E=0):C++;for(h=y.charCodeAt(0),d=0;d<8;d++)E=E<<1|h&1,C==c-1?(C=0,T.push(u(E)),E=0):C++,h=h>>1}else{for(h=1,d=0;d<O;d++)E=E<<1|h,C==c-1?(C=0,T.push(u(E)),E=0):C++,h=0;for(h=y.charCodeAt(0),d=0;d<16;d++)E=E<<1|h&1,C==c-1?(C=0,T.push(u(E)),E=0):C++,h=h>>1}x--,x==0&&(x=Math.pow(2,O),O++),delete g[y]}else for(h=p[y],d=0;d<O;d++)E=E<<1|h&1,C==c-1?(C=0,T.push(u(E)),E=0):C++,h=h>>1;x--,x==0&&(x=Math.pow(2,O),O++),p[S]=w++,y=String(m)}if(y!==""){if(Object.prototype.hasOwnProperty.call(g,y)){if(y.charCodeAt(0)<256){for(d=0;d<O;d++)E=E<<1,C==c-1?(C=0,T.push(u(E)),E=0):C++;for(h=y.charCodeAt(0),d=0;d<8;d++)E=E<<1|h&1,C==c-1?(C=0,T.push(u(E)),E=0):C++,h=h>>1}else{for(h=1,d=0;d<O;d++)E=E<<1|h,C==c-1?(C=0,T.push(u(E)),E=0):C++,h=0;for(h=y.charCodeAt(0),d=0;d<16;d++)E=E<<1|h&1,C==c-1?(C=0,T.push(u(E)),E=0):C++,h=h>>1}x--,x==0&&(x=Math.pow(2,O),O++),delete g[y]}else for(h=p[y],d=0;d<O;d++)E=E<<1|h&1,C==c-1?(C=0,T.push(u(E)),E=0):C++,h=h>>1;x--,x==0&&(x=Math.pow(2,O),O++)}for(h=2,d=0;d<O;d++)E=E<<1|h&1,C==c-1?(C=0,T.push(u(E)),E=0):C++,h=h>>1;for(;;)if(E=E<<1,C==c-1){T.push(u(E));break}else C++;return T.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,u){var d=[],h=4,p=4,g=3,m="",S=[],y,x,w,O,T,E,C,M={val:u(0),position:c,index:1};for(y=0;y<3;y+=1)d[y]=y;for(w=0,T=Math.pow(2,2),E=1;E!=T;)O=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(O>0?1:0)*E,E<<=1;switch(w){case 0:for(w=0,T=Math.pow(2,8),E=1;E!=T;)O=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(O>0?1:0)*E,E<<=1;C=t(w);break;case 1:for(w=0,T=Math.pow(2,16),E=1;E!=T;)O=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(O>0?1:0)*E,E<<=1;C=t(w);break;case 2:return""}for(d[3]=C,x=C,S.push(C);;){if(M.index>l)return"";for(w=0,T=Math.pow(2,g),E=1;E!=T;)O=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(O>0?1:0)*E,E<<=1;switch(C=w){case 0:for(w=0,T=Math.pow(2,8),E=1;E!=T;)O=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(O>0?1:0)*E,E<<=1;d[p++]=t(w),C=p-1,h--;break;case 1:for(w=0,T=Math.pow(2,16),E=1;E!=T;)O=M.val&M.position,M.position>>=1,M.position==0&&(M.position=c,M.val=u(M.index++)),w|=(O>0?1:0)*E,E<<=1;d[p++]=t(w),C=p-1,h--;break;case 2:return S.join("")}if(h==0&&(h=Math.pow(2,g),g++),d[C])m=d[C];else if(C===p)m=x+x.charAt(0);else return null;S.push(m),d[p++]=x+m.charAt(0),h--,x=m,h==0&&(h=Math.pow(2,g),g++)}}};return a}();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(PO);var cpe=PO.exports;const Sz=Ul(cpe);async function upe(n,e,t){var y,x,w;const{elements:r,files:i}=e,s={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},o=new Map,a=new Map,l=n.getCurrentPageId(),c=new Map,u=[],d=new Set;r.forEach(O=>{if(c.set(O.id,mt()),O.boundElements!==null)for(const T of O.boundElements)T.type==="text"&&d.add(T.id)});let h=aR;for(const O of r){if(d.has(O.id))continue;const T=c.get(O.id),E={id:T,typeName:"shape",parentId:l,index:h,x:O.x,y:O.y,rotation:0,isLocked:O.locked,opacity:dpe(O.opacity),meta:{}};switch(O.angle!==0&&a.set(T,O.angle),O.groupIds&&O.groupIds.length>0?o.has(O.groupIds[0])?(y=o.get(O.groupIds[0]))==null||y.push(T):o.set(O.groupIds[0],[T]):u.push(T),O.type){case"rectangle":case"ellipse":case"diamond":{let C="",M="middle";if(O.boundElements!==null){for(const D of O.boundElements)if(D.type==="text"){const N=r.find(F=>F.id===D.id);N&&(C=N.text,M=ype[N.textAlign])}}const A=O.backgroundColor==="transparent"?O.strokeColor:O.backgroundColor;s.shapes.push({...E,type:"geo",props:{geo:O.type,url:O.link??"",w:O.width,h:O.height,size:Tg[O.strokeWidth]??"draw",color:Dh[A]??"black",text:C,align:M,dash:Eg(O),fill:xpe(O)}});break}case"freedraw":{s.shapes.push({...E,type:"draw",props:{dash:Eg(O),size:Tg[O.strokeWidth],color:Dh[O.strokeColor]??"black",segments:[{type:"free",points:O.points.map(([C,M,A=.5])=>({x:C,y:M,z:A}))}]}});break}case"line":{if(O.points.slice().length<2)break;const M=lp(O.points.length);s.shapes.push({...E,type:"line",props:{dash:Eg(O),size:Tg[O.strokeWidth],color:Dh[O.strokeColor]??"black",spline:O.roundness?"cubic":"line",points:{...Object.fromEntries(O.points.map(([A,D],N)=>{const F=M[N];return[F,{id:F,index:F,x:A,y:D}]}))}}});break}case"arrow":{let C="";if(O.boundElements!==null){for(const F of O.boundElements)if(F.type==="text"){const j=r.find(L=>L.id===F.id);j&&(C=j.text)}}const M=O.points[0],A=O.points[O.points.length-1],D=c.get((x=O.startBinding)==null?void 0:x.elementId),N=c.get((w=O.endBinding)==null?void 0:w.elementId);s.shapes.push({...E,type:"arrow",props:{text:C,bend:Spe(O,M,A),dash:Eg(O),size:Tg[O.strokeWidth]??"m",color:Dh[O.strokeColor]??"black",start:{x:M[0],y:M[1]},end:{x:A[0],y:A[1]},arrowheadEnd:BT[O.endArrowhead]??"none",arrowheadStart:BT[O.startArrowhead]??"none"}}),D&&s.bindings.push({id:Mc(),typeName:"binding",type:"arrow",fromId:T,toId:D,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),N&&s.bindings.push({id:Mc(),typeName:"binding",type:"arrow",fromId:T,toId:N,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:C,scale:M}=fpe(O.fontSize);s.shapes.push({...E,type:"text",props:{size:C,scale:M,font:ppe[O.fontFamily]??"draw",color:Dh[O.strokeColor]??"black",text:O.text,textAlign:vpe[O.textAlign]}});break}case"image":{const C=i[O.fileId];if(!C)break;const M=bc.createId();s.assets.push({id:M,typeName:"asset",type:"image",props:{w:O.width,h:O.height,fileSize:C.size,name:O.id??"Untitled",isAnimated:!1,mimeType:C.mimeType,src:C.dataURL},meta:{}}),s.shapes.push({...E,type:"image",props:{w:O.width,h:O.height,assetId:M}})}}h=bs(h)}const p=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(s,{point:p,select:!1,preserveIds:!0});for(const O of o.values())if(O.length>1){n.groupShapes(O);const T=n.getShape(O[0]);T!=null&&T.parentId&&Qr(T.parentId)&&u.push(T.parentId)}for(const[O,T]of a)n.select(O),n.rotateShapesBy([O],T);const g=He(u.map(O=>n.getShape(O))),m=ye.Common(g.map(O=>n.getShapePageBounds(O))),S=n.getViewportPageBounds().center;n.updateShapes(g.map(O=>{const T={x:(O.x??0)-(m.x+m.w/2),y:(O.y??0)-(m.y+m.h/2)};return{id:O.id,type:O.type,x:S.x+T.x,y:S.y+T.y}})),n.setSelectedShapes(u)}const dpe=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},Tg={1:"s",2:"m",3:"l",4:"xl"},hpe={16:"s",20:"m",28:"l",36:"xl"};function fpe(n){const e=hpe[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const ppe={1:"draw",2:"sans",3:"mono"},Dh={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},gpe={solid:"draw",dashed:"dashed",dotted:"dotted"},mpe={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},ype={left:"start",center:"middle",right:"end"},vpe={left:"start",center:"middle",right:"end"},BT={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function Spe(n,e,t){let r=0;if(n.points.length>2){const i=new b(e[0],e[1]),s=new b(t[0],t[1]),o=new b(n.points[1][0],n.points[1][1]),a=b.Sub(s,i),l=b.Per(a),c=b.Med(s,i),u=b.Sub(c,l),d=b.Add(c,l),h=b.NearestPointOnLineSegment(u,d,o,!1);r=b.Dist(h,c),b.Clockwise(h,s,c)&&(r*=-1)}return r}const Eg=n=>{let e=gpe[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},xpe=n=>n.backgroundColor==="transparent"?"none":mpe[n.fillStyle]??"solid";async function wpe(n,e,t,r){const s=(await Promise.all(e.map(async o=>await(await Oo(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));n.mark("paste"),await n.putExternalContent({type:"files",files:s,point:t,ignoreParent:!1,sources:r}),e.forEach(o=>URL.revokeObjectURL(o))}function bpe(n,e,t){const r=n.getSelectionPageBounds();n.mark("paste"),n.putContentOntoCurrentPage(e,{point:t,select:!0});const i=n.getSelectionPageBounds();r&&i&&(r!=null&&r.collides(i))&&(n.updateInstanceState({isChangingStyle:!0}),n.timers.setTimeout(()=>{n.updateInstanceState({isChangingStyle:!1})},150))}async function _4(n,e,t,r){return n.mark("paste"),await n.putExternalContent({type:"url",point:t,url:e,sources:r})}function Ope(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const kpe=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},Cpe=n=>{const e=n.split(/[\n\s]/);for(const t of e)try{const r=new URL(t);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return PD(e)},Ppe=n=>/^<svg/.test(n),Tpe=["input","select","textarea"];function k2(n){const{activeElement:e}=document;return n.getIsMenuOpen()||e&&(e.getAttribute("contenteditable")||Tpe.indexOf(e.tagName.toLowerCase())>-1)}const Epe=n=>n.types.find(e=>e.match(/^image\//)),C2=(n,e,t,r)=>{const i=Cpe(e);if(i)for(const s of i)_4(n,s,t);else kpe(e)?_4(n,e,t):Ppe(e)?(n.mark("paste"),n.putExternalContent({type:"svg-text",text:e,point:t,sources:r})):(n.mark("paste"),n.putExternalContent({type:"text",text:e,point:t,sources:r}))},Ipe=async(n,e,t)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{r.push({type:"file",source:new Promise(s=>s(i.getAsFile()))});break}case"string":{i.type==="text/html"?r.push({type:"html",source:new Promise(s=>i.getAsString(s))}):i.type==="text/plain"?r.push({type:"text",source:new Promise(s=>i.getAsString(s))}):r.push({type:i.type,source:new Promise(s=>i.getAsString(s))});break}}wz(n,r,t)},xz=async(n,e,t)=>{const r=[];for(const i of e){if(Epe(i))for(const s of i.types)s.match(/^image\//)&&r.push({type:"blob",source:i.getType(s)});i.types.includes("text/html")&&r.push({type:"html",source:(async()=>{const s=await i.getType("text/html");return await Ic.blobToText(s)})()}),i.types.includes("text/uri-list")&&r.push({type:"url",source:(async()=>{const s=await i.getType("text/uri-list");return await Ic.blobToText(s)})()}),i.types.includes("text/plain")&&r.push({type:"text",source:(async()=>{const s=await i.getType("text/plain");return await Ic.blobToText(s)})()})}return await wz(n,r,t)};async function wz(n,e,t){const r=e.filter(s=>(s.type==="file"||s.type==="blob")&&s.source!==null);if(r.length){const o=(await Promise.all(r.map(a=>a.source))).filter(Boolean).map(a=>URL.createObjectURL(a));return await wpe(n,o,t)}const i=await Promise.all(e.filter(s=>s.type!=="file").map(s=>new Promise(o=>{const a=s;if(a.type==="file"){o({type:"error",data:null,reason:"unexpected file"});return}a.source.then(l=>{var u;const c=(u=l.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:u[1];if(c)try{const d=Sz.decompressFromBase64(c);if(d===null){o({type:"error",data:d,reason:"found tldraw data comment but could not parse base64"});return}else{const h=JSON.parse(d);if(h.type!=="application/tldraw"&&o({type:"error",data:h,reason:`found tldraw data comment but JSON was of a different type: ${h.type}`}),typeof h.data=="string"){o({type:"error",data:h,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}o({type:"tldraw",data:h.data});return}}catch{o({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){o({type:"text",data:l,subtype:"html"});return}if(a.type==="url"){o({type:"text",data:l,subtype:"url"});return}try{const d=JSON.parse(l);if(d.type==="excalidraw/clipboard"){o({type:"excalidraw",data:d});return}else{o({type:"text",data:l,subtype:"json"});return}}catch{o({type:"text",data:l,subtype:"text"});return}}o({type:"error",data:l,reason:"unhandled case"})})})));for(const s of i)if(s.type==="tldraw"){bpe(n,s.data,t);return}for(const s of i)if(s.type==="excalidraw"){upe(n,s.data,t);return}for(const s of i)if(s.type==="text"&&s.subtype==="html"){const a=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(c=>c.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const c=a.firstElementChild.getAttribute("href");C2(n,c,t,i);return}if(!i.some(c=>c.type==="text"&&c.subtype!=="html")&&s.data.trim()){C2(n,Ope(s.data),t,i);return}}for(const s of i)if(s.type==="text"&&s.subtype==="url"){_4(n,s.data,t,i);return}for(const s of i)if(s.type==="text"&&s.subtype==="text"&&s.data.trim()){C2(n,s.data,t,i);return}}const Oy=async n=>{var r;const e=await n.resolveAssetsInContent(n.getContentFromCurrentPage(n.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=Sz.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const i=e.shapes.map(s=>n.isShapeOfType(s,"text")||n.isShapeOfType(s,"geo")||n.isShapeOfType(s,"arrow")?s.props.text:n.isShapeOfType(s,"bookmark")||n.isShapeOfType(s,"embed")?s.props.url:null).filter(pne);if((r=navigator.clipboard)!=null&&r.write){const s=new Blob([`<div data-tldraw>${t}</div>`],{type:"text/html"});let o=i.join(" ");o===""&&(o=" "),navigator.clipboard.write([new ClipboardItem({"text/html":s,"text/plain":new Blob([o],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${t}</div>`)}};function Mpe(){const n=G(),e=tr(),t=k.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await Oy(n),e("copy",{source:o}))},[n,e]),r=k.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await Oy(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:o}))},[n,e]),i=k.useCallback(async function(o,a,l){n.getEditingShapeId()===null&&(Array.isArray(o)&&o[0]instanceof ClipboardItem?(xz(n,o,l),e("paste",{source:"menu"})):navigator.clipboard.read().then(c=>{i(c,a,l)}))},[n,e]);return{copy:t,cut:r,paste:i}}function Ape(){const n=G(),e=tr(),t=ee("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);k.useEffect(()=>{if(!t)return;const r=async l=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||k2(n)||(tt(l),await Oy(n),e("copy",{source:"kbd"}))};async function i(l){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||k2(n)||(tt(l),await Oy(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let s=!1;const o=l=>{l.button===1&&(s=!0,n.timers.requestAnimationFrame(()=>{s=!1}))},a=l=>{if(s){Tn(l);return}if(n.getEditingShapeId()!==null||k2(n))return;let c,u=!1;n.inputs.shiftKey&&(u=!0),n.user.getIsPasteAtCursorMode()&&(u=!u),u&&(c=n.inputs.currentPagePoint),l.clipboardData&&!n.inputs.shiftKey?Ipe(n,l.clipboardData,c):navigator.clipboard.read().then(d=>{Array.isArray(d)&&d[0]instanceof ClipboardItem&&xz(n,d,c)}),tt(l),e("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",o),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",o)}},[n,e,t])}async function bz(n,e,t){const{type:r,quality:i,scale:s,width:o,height:a}=t;let[l,c]=await yce(o*s,a*s);l=Math.floor(l),c=Math.floor(c);const u=l/o,d=URL.createObjectURL(new Blob([e],{type:"image/svg+xml"})),h=await new Promise(g=>{const m=Cd();m.crossOrigin="anonymous",m.onload=async()=>{n.environment.isSafari&&await new Promise(x=>n.timers.setTimeout(x,250));const S=document.createElement("canvas"),y=S.getContext("2d");S.width=l,S.height=c,y.imageSmoothingEnabled=!0,y.imageSmoothingQuality="high",y.drawImage(m,0,0,l,c),URL.revokeObjectURL(d),g(S)},m.onerror=()=>{g(null)},m.src=d});if(!h)return null;const p=await new Promise(g=>h.toBlob(m=>{(!m||un.throwToBlob.get())&&g(null),g(m)},"image/"+r,i));if(!p)return null;if(r==="png"){const g=new DataView(await p.arrayBuffer());return ro.setPhysChunk(g,u,{type:"image/"+r})}else return p}async function Oz(n,e,t){const r=await n.getSvgString(e!=null&&e.length?e:[...n.getCurrentPageShapeIds()],{scale:1,background:n.getInstanceState().exportBackground,...t});if(!r)throw new Error("Could not construct SVG.");return r}async function R4(n,e,t,r={}){var i;switch(t){case"svg":return(i=await Oz(n,e,r))==null?void 0:i.svg;case"json":{const s=await n.resolveAssetsInContent(n.getContentFromCurrentPage(e));return JSON.stringify(s)}default:Vn(t)}}async function kz({editor:n,ids:e,format:t,opts:r={}}){switch(t){case"svg":return new Blob([await R4(n,e,"svg",r)],{type:"text/plain"});case"json":return new Blob([await R4(n,e,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const i=await Oz(n,e,r);if(!i)throw new Error("Could not construct image.");const s=await bz(n,i.svg,{type:t,quality:1,scale:2,width:i.width,height:i.height});if(!s)throw new Error("Could not construct image.");return s}default:Vn(t)}}const _pe={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function Rpe(n,e,t,r={}){return{blobPromise:kz({editor:n,ids:e,format:t,opts:r}),mimeType:_pe[t]}}function Dpe(n,e,t="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:i,mimeType:s}=Rpe(n,e,t,r);return window.navigator.clipboard.write([new ClipboardItem({[s]:i})]).catch(o=>(console.error(o),i.then(a=>window.navigator.clipboard.write([new ClipboardItem({[s]:a})]))))}switch(t){case"json":case"svg":return jpe(async()=>R4(n,e,t,r));case"jpeg":case"png":throw new Error("Copy not supported");default:Vn(t)}}async function jpe(n){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await n()))}function Lpe(){const n=G(),{addToast:e}=Fs(),t=Xe();return k.useCallback((r,i="svg")=>{Dpe(n,r,i).catch(()=>{e({id:"copy-fail",severity:"warning",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[n,e,t])}async function zpe(n,e,t="png",r,i={}){if(!r&&(r=`shapes at ${UT()}`,e.length===1)){const a=n.getShape(e[0]);n.isShapeOfType(a,"frame")?r=a.props.name??"frame":r=`${a.id.replace(/:/,"_")} at ${UT()}`}r+=`.${t}`;const s=await kz({editor:n,ids:e,format:t,opts:i}),o=new File([s],r,{type:s.type});Npe(o)}function UT(){const n=new Date,e=String(n.getFullYear()).slice(2),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0"),o=String(n.getSeconds()).padStart(2,"0");return`${e}-${t}-${r} ${i}.${s}.${o}`}function Npe(n){const e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download=n.name,e.click(),URL.revokeObjectURL(t)}function $pe(){const n=G(),{addToast:e}=Fs(),t=Xe();return k.useCallback((r,i="png",s)=>{zpe(n,r,i,s,{scale:1,background:n.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc"),severity:"error"})})},[n,e,t])}async function Fpe(n,e,t){const r=He(e.map(a=>{const l=n.getShape(a);if(!(!l||n.getShapeUtil(l.type).toSvg===void 0))return l}));if(r.length===0)return;if(r.length===1){const a=r[0];if(!a||n.isShapeOfType(a,"image"))return}const i=[];if(t!==void 0){const a=r.map(l=>({shape:l,bounds:n.getShapeMaskedPageBounds(l).clone().expandBy(t)}));for(let l=0;l<a.length;l++){const c=a[l];if(l===0){i[0]={shapes:[c.shape],bounds:c.bounds};continue}let u=!1;for(const d of i)if(d.bounds.includes(c.bounds)){d.shapes.push(c.shape),d.bounds.expand(c.bounds),u=!0;break}u||i.push({shapes:[c.shape],bounds:c.bounds})}}else{const a=ye.Common(r.map(l=>n.getShapeMaskedPageBounds(l)));i.push({shapes:r,bounds:a})}const s=n.options.flattenImageBoundsPadding;for(const a of i){t!==void 0&&a.bounds.expandBy(-t);const l=await n.getSvgString(a.shapes,{padding:s});if(!(l!=null&&l.svg))continue;const c=new Blob([l.svg],{type:"image/svg+xml"}),u=await n.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});u&&(a.asset=u)}const o=[];return Es(()=>{for(const a of i){const{asset:l,bounds:c,shapes:u}=a;if(!l)continue;const d=n.findCommonAncestor(u)??n.getCurrentPageId();if(!d)continue;let h="a1";for(const y of u)if(y.parentId===d){y.index>h&&(h=y.index);break}let p,g,m;if(Qr(d)){const y=n.getShape(d);if(!y)continue;const x=n.getPointInShapeSpace(y,{x:c.x,y:c.y});m=n.getShapePageTransform(d).rotation(),x.sub(new b(s,s).rot(-m)),p=x.x,g=x.y}else p=c.x-s,g=c.y-s,m=0;n.deleteShapes(u),n.createAssets([{...l,id:l.id}]);const S=mt();n.createShape({id:S,type:"image",index:h,parentId:d,x:p,y:g,rotation:-m,props:{assetId:l.id,w:c.w+s*2,h:c.h+s*2}}),o.push(S)}}),o}function oS(){return G().store.props.collaboration!==void 0}function Bpe(){const n=G();return ee("sync status",()=>{var e;return(e=n.store.props.collaboration)!=null&&e.status?n.store.props.collaboration.status.get():null},[n])}function Upe(){const n=G(),e=k.useRef(null),t=k.useRef(null);return k.useCallback(async function(){const i=document.createElement("div"),s=document.createElement("style"),o=(y,x)=>{y&&(y.innerHTML=""),x&&document.head.contains(x)&&document.head.removeChild(x),y&&document.body.contains(y)&&document.body.removeChild(y)};o(e.current,t.current),e.current=i,t.current=s;const a=`tl-print-surface-${wt()}`;i.className=a,s.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const l=()=>{document.head.appendChild(s),document.body.appendChild(i)},c=()=>{n.once("tick",()=>{o(i,s)})};window.addEventListener("beforeprint",l),window.addEventListener("afterprint",c);function u(y,x,w){try{i.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${y.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${w}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${x?"":"hide"}">
          ${x??""}
        </div>
      </div>`}catch(O){console.error(O)}}function d(){n.environment.isChromeForIos?(l(),window.print()):n.environment.isSafari?(l(),document.execCommand("print",!1)):window.print()}const h=n.getSelectedShapeIds(),p=n.getCurrentPageId(),g=n.getPages(),S={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const y=await n.getSvgString(h,S);if(y){const x=g.find(w=>w.id===p);u(`tldraw  ${x==null?void 0:x.name}`,null,y.svg),d()}}else{const y=n.getCurrentPage(),x=await n.getSvgString(n.getSortedChildIdsForParent(y.id),S);x&&(u(`tldraw  ${y.name}`,null,x.svg),d())}window.removeEventListener("beforeprint",l),window.removeEventListener("afterprint",c)},[n])}const Cz=k.createContext(null);function Hpe(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function ku(n,e){if(n.getSelectedShapes().length===0)return n.getDocumentSettings().name||e}function Qpe({overrides:n,children:e}){const t=G(),r=oS(),{addDialog:i,clearDialogs:s}=cu(),{clearToasts:o,addToast:a}=Fs(),l=Xe(),c=gz(),u=Upe(),{cut:d,copy:h,paste:p}=Mpe(),g=Lpe(),m=$pe(),S=l("document.default-name"),y=tr(),x=k.useMemo(()=>{function w(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function O(){return t.isIn("select")&&t.getSelectedShapeIds().length>0}const T=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(C){O()&&(w()||(y("edit-link",{source:C}),t.mark("edit-link"),i({component:ape})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(C){y("insert-embed",{source:C}),i({component:pz})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(C){y("insert-media",{source:C}),c()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(C){y("undo",{source:C}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(C){y("redo",{source:C}),t.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(C){let M=t.getSelectedShapeIds();M.length===0&&(M=Array.from(t.getCurrentPageShapeIds().values())),M.length!==0&&(y("export-as",{format:"svg",source:C}),m(M,"svg",ku(t,S)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(C){let M=t.getSelectedShapeIds();M.length===0&&(M=Array.from(t.getCurrentPageShapeIds().values())),M.length!==0&&(y("export-as",{format:"png",source:C}),m(M,"png",ku(t,S)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(C){let M=t.getSelectedShapeIds();M.length===0&&(M=Array.from(t.getCurrentPageShapeIds().values())),M.length!==0&&(y("export-as",{format:"json",source:C}),m(M,"json",ku(t,S)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(C){let M=t.getSelectedShapeIds();M.length===0&&(M=Array.from(t.getCurrentPageShapeIds().values())),M.length!==0&&(y("export-all-as",{format:"svg",source:C}),m(Array.from(t.getCurrentPageShapeIds()),"svg",ku(t,S)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(C){const M=Array.from(t.getCurrentPageShapeIds().values());M.length!==0&&(y("export-all-as",{format:"png",source:C}),m(M,"png",ku(t,S)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(C){const M=Array.from(t.getCurrentPageShapeIds().values());M.length!==0&&(y("export-all-as",{format:"json",source:C}),m(M,"json",ku(t,S)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(C){let M=t.getSelectedShapeIds();M.length===0&&(M=Array.from(t.getCurrentPageShapeIds().values())),M.length!==0&&(y("copy-as",{format:"svg",source:C}),g(M,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(C){let M=t.getSelectedShapeIds();M.length===0&&(M=Array.from(t.getCurrentPageShapeIds().values())),M.length!==0&&(y("copy-as",{format:"png",source:C}),g(M,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(C){let M=t.getSelectedShapeIds();M.length===0&&(M=Array.from(t.getCurrentPageShapeIds().values())),M.length!==0&&(y("copy-as",{format:"json",source:C}),g(M,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(C){if(!O()||w())return;y("toggle-auto-size",{source:C}),t.mark("toggling auto size");const M=t.getSelectedShapes().filter(A=>t.isShapeOfType(A,"text")&&A.props.autoSize===!1);t.updateShapes(M.map(A=>({id:A.id,type:A.type,props:{...A.props,w:8,autoSize:!0}}))),Pt(t,M.map(A=>A.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(C){y("open-embed-link",{source:C});const M=t.getSelectedShapeIds(),A="No embed shapes selected";if(M.length!==1){console.error(A);return}const D=t.getShape(M[0]);if(!D||!t.isShapeOfType(D,"embed")){console.error(A);return}jle(D.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(C){var M,A;if(((M=t.root.getCurrent())==null?void 0:M.id)!=="zoom"&&(y("zoom-tool",{source:C}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const D=t.root.getCurrent();D&&((A=D.getCurrent())==null?void 0:A.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:D.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(C){O()&&(w()||t.run(()=>{y("convert-to-bookmark",{source:C});const M=t.getSelectedShapes(),A=[],D=[];for(const N of M){if(!N||!t.isShapeOfType(N,"embed")||!N.props.url)continue;const F=new b(N.x,N.y);F.rot(-N.rotation),F.add(new b(N.props.w/2-300/2,N.props.h/2-320/2)),F.rot(N.rotation);const j={id:mt(),type:"bookmark",rotation:N.rotation,x:F.x,y:F.y,opacity:1,props:{url:N.props.url}};A.push(j),D.push(N.id)}t.mark("convert shapes to bookmark"),t.deleteShapes(D),t.createShapes(A)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(C){O()&&(w()||(y("convert-to-embed",{source:C}),t.run(()=>{const M=t.getSelectedShapeIds(),A=He(M.map(F=>t.getShape(F))),D=[],N=[];for(const F of A){if(!t.isShapeOfType(F,"bookmark"))continue;const{url:j}=F.props,L=cl(F.props.url);if(!L||!L.definition)continue;const{width:U,height:Y}=L.definition,V=new b(F.x,F.y);V.rot(-F.rotation),V.add(new b(F.props.w/2-U/2,F.props.h/2-Y/2)),V.rot(F.rotation);const W={id:mt(),type:"embed",x:V.x,y:V.y,rotation:F.rotation,props:{url:j,w:U,h:Y}};D.push(W),N.push(F.id)}t.mark("convert shapes to embed"),t.deleteShapes(N),t.createShapes(D)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(C){if(!O()||w())return;y("duplicate-shapes",{source:C});const M=t.getInstanceState();let A,D;if(M.duplicateProps)A=M.duplicateProps.shapeIds,D=M.duplicateProps.offset;else{A=t.getSelectedShapeIds();const N=ye.Common(He(A.map(F=>t.getShapePageBounds(F))));D=t.getCameraOptions().isLocked?{x:t.options.adjacentShapeMargin,y:t.options.adjacentShapeMargin}:{x:N.width+t.options.adjacentShapeMargin,y:0}}t.mark("duplicate shapes"),t.duplicateShapes(A,D),M.duplicateProps&&t.updateInstanceState({duplicateProps:{...M.duplicateProps,shapeIds:t.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(C){O()&&(w()||(y("ungroup-shapes",{source:C}),t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(C){if(!O()||w())return;y("group-shapes",{source:C});const M=t.getOnlySelectedShape();M&&t.isShapeOfType(M,"group")?(t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.mark("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(C){if(!O())return;y("remove-frame",{source:C});const M=t.getSelectedShapes();M.length>0&&M.every(A=>t.isShapeOfType(A,"frame"))&&(t.mark("remove-frame"),ipe(t,M.map(A=>A.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(C){if(!O())return;y("fit-frame-to-content",{source:C});const M=t.getOnlySelectedShape();M&&t.isShapeOfType(M,"frame")&&(t.mark("fit-frame-to-content"),ope(t,M.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(C){if(!O()||w())return;y("align-shapes",{operation:"left",source:C}),t.mark("align left");const M=t.getSelectedShapeIds();t.alignShapes(M,"left"),Pt(t,M)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(C){if(!O()||w())return;y("align-shapes",{operation:"center-horizontal",source:C}),t.mark("align center horizontal");const M=t.getSelectedShapeIds();t.alignShapes(M,"center-horizontal"),Pt(t,M)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(C){if(!O()||w())return;y("align-shapes",{operation:"right",source:C}),t.mark("align right");const M=t.getSelectedShapeIds();t.alignShapes(M,"right"),Pt(t,M)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(C){if(!O()||w())return;y("align-shapes",{operation:"center-vertical",source:C}),t.mark("align center vertical");const M=t.getSelectedShapeIds();t.alignShapes(M,"center-vertical"),Pt(t,M)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(C){if(!O()||w())return;y("align-shapes",{operation:"top",source:C}),t.mark("align top");const M=t.getSelectedShapeIds();t.alignShapes(M,"top"),Pt(t,M)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(C){if(!O()||w())return;y("align-shapes",{operation:"bottom",source:C}),t.mark("align bottom");const M=t.getSelectedShapeIds();t.alignShapes(M,"bottom"),Pt(t,M)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(C){if(!O()||w())return;y("distribute-shapes",{operation:"horizontal",source:C}),t.mark("distribute horizontal");const M=t.getSelectedShapeIds();t.distributeShapes(M,"horizontal"),Pt(t,M)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(C){if(!O()||w())return;y("distribute-shapes",{operation:"vertical",source:C}),t.mark("distribute vertical");const M=t.getSelectedShapeIds();t.distributeShapes(M,"vertical"),Pt(t,M)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(C){if(!O()||w())return;y("stretch-shapes",{operation:"horizontal",source:C}),t.mark("stretch horizontal");const M=t.getSelectedShapeIds();t.stretchShapes(M,"horizontal"),Pt(t,M)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(C){if(!O()||w())return;y("stretch-shapes",{operation:"vertical",source:C}),t.mark("stretch vertical");const M=t.getSelectedShapeIds();t.stretchShapes(M,"vertical"),Pt(t,M)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(C){if(!O()||w())return;y("flip-shapes",{operation:"horizontal",source:C}),t.mark("flip horizontal");const M=t.getSelectedShapeIds();t.flipShapes(M,"horizontal"),Pt(t,M)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(C){if(!O()||w())return;y("flip-shapes",{operation:"vertical",source:C}),t.mark("flip vertical");const M=t.getSelectedShapeIds();t.flipShapes(M,"vertical"),Pt(t,M)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(C){if(!O()||w())return;y("pack-shapes",{source:C}),t.mark("pack");const M=t.getSelectedShapeIds();t.packShapes(M,t.options.adjacentShapeMargin),Pt(t,M)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(C){if(!O()||w())return;y("stack-shapes",{operation:"vertical",source:C}),t.mark("stack-vertical");const M=t.getSelectedShapeIds();t.stackShapes(M,"vertical",16),Pt(t,M)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(C){if(!O()||w())return;y("stack-shapes",{operation:"horizontal",source:C}),t.mark("stack-horizontal");const M=t.getSelectedShapeIds();t.stackShapes(M,"horizontal",16),Pt(t,M)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(C){O()&&(w()||(y("reorder-shapes",{operation:"toFront",source:C}),t.mark("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(C){O()&&(w()||(y("reorder-shapes",{operation:"forward",source:C}),t.mark("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(C){O()&&(w()||(y("reorder-shapes",{operation:"backward",source:C}),t.mark("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(C){O()&&(w()||(y("reorder-shapes",{operation:"toBack",source:C}),t.mark("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(C){O()&&(w()||(t.mark("cut"),d(C)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(C){O()&&(w()||h(C))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(C){var M;(M=navigator.clipboard)==null||M.read().then(A=>{p(A,C,C==="context-menu"?t.inputs.currentPagePoint:void 0)}).catch(()=>{a({title:l("action.paste-error-title"),description:l("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(C){t.run(()=>{w()||(y("select-all-shapes",{source:C}),t.mark("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(C){O()&&(w()||(y("select-none-shapes",{source:C}),t.mark("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",onSelect(C){O()&&(w()||(y("delete-shapes",{source:C}),t.mark("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(C){if(!O()||w())return;y("rotate-cw",{source:C}),t.mark("rotate-cw");const M=t.getSelectionRotation()%(Mt/2),A=Ol(M,0)||Ol(M,Mt/2),D=t.getSelectedShapeIds();t.rotateShapesBy(D,Mt/2-(A?0:M)),Pt(t,D)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(C){if(!O()||w())return;y("rotate-ccw",{source:C}),t.mark("rotate-ccw");const M=t.getSelectionRotation()%(Mt/2),A=Ol(M,0),D=t.getSelectedShapeIds();t.rotateShapesBy(D,A?-(Mt/2):-M),Pt(t,D)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(C){y("zoom-in",{source:C}),t.zoomIn(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(C){y("zoom-out",{source:C}),t.zoomOut(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(C){y("reset-zoom",{source:C}),t.resetZoom(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(C){y("zoom-to-fit",{source:C}),t.zoomToFit({animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(C){O()&&(w()||(y("zoom-to-selection",{source:C}),t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(C){y("toggle-snap-mode",{source:C}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(C){const M=t.user.getIsDarkMode()?"light":"dark";y("color-scheme",{source:C,value:M}),t.user.updateUserPreferences({colorScheme:M})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(C){y("toggle-wrap-mode",{source:C}),t.user.updateUserPreferences({isWrapMode:!t.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(C){y("toggle-dynamic-size-mode",{source:C}),t.user.updateUserPreferences({isDynamicSizeMode:!t.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(C){y("toggle-paste-at-cursor",{source:C}),t.user.updateUserPreferences({isPasteAtCursorMode:!t.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(C){y("toggle-reduce-motion",{source:C}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(C){y("toggle-edge-scrolling",{source:C}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(C){y("toggle-transparent",{source:C}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(C){y("toggle-tool-lock",{source:C}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(C){y("unlock-all",{source:C});const M=[];for(const A of t.getCurrentPageShapes())A.isLocked&&M.push({id:A.id,type:A.type,isLocked:!1});M.length>0&&t.updateShapes(M)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(C){t.timers.requestAnimationFrame(()=>{t.run(()=>{y("toggle-focus-mode",{source:C}),s(),o(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(C){y("toggle-grid-mode",{source:C}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(C){y("toggle-debug-mode",{source:C}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(C){y("print",{source:C}),u()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(C){y("exit-pen-mode",{source:C}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(C){y("stop-following",{source:C}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(C){y("zoom-to-content",{source:C});const M=t.getSelectionPageBounds()??t.getCurrentPageBounds();M&&t.zoomToBounds(M,{targetZoom:Math.min(1,t.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(C){t.mark("locking"),y("toggle-lock",{source:C}),t.toggleLock(t.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(C){const M=ba.createId(),A=t.getSelectedShapeIds();t.run(()=>{t.mark("move_shapes_to_page"),t.createPage({name:l("page-menu.new-page-initial-name"),id:M}),t.moveShapesToPage(A,M)}),y("move-to-new-page",{source:C})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(C){const M=Ai;t.run(()=>{t.mark("change-color"),t.isIn("select")&&t.setStyleForSelectedShapes(M,"white"),t.setStyleForNextShapes(M,"white")}),y("set-style",{source:C,id:M.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(C){const M=Uc;t.run(()=>{t.mark("change-fill"),t.isIn("select")&&t.setStyleForSelectedShapes(M,"fill"),t.setStyleForNextShapes(M,"fill")}),y("set-style",{source:C,id:M.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async C=>{const M=t.getSelectedShapeIds();if(M.length===0)return;t.mark("flattening to image"),y("flatten-to-image",{source:C});const A=await Fpe(t,M,t.options.flattenImageBoundsExpand);A!=null&&A.length&&t.setSelectedShapes(A)}}];r&&T.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(C){y("open-cursor-chat",{source:C}),!t.getInstanceState().isCoarsePointer&&t.timers.requestAnimationFrame(()=>{t.updateInstanceState({isChatting:!0})})}});const E=Hpe(T);return n?n(t,E,void 0):E},[t,y,n,i,a,c,m,g,d,h,p,s,o,u,l,S,r]);return f.jsx(Cz.Provider,{value:x,children:e})}function Ce(){const n=k.useContext(Cz);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function yp(n,e){return n?typeof n=="string"?n:e?n[e]??n.default:void 0:void 0}const qpe=["top","right","bottom","left"],uo=Math.min,Si=Math.max,ky=Math.round,Ig=Math.floor,Al=n=>({x:n,y:n}),Wpe={left:"right",right:"left",bottom:"top",top:"bottom"},Vpe={start:"end",end:"start"};function D4(n,e,t){return Si(n,uo(e,t))}function ka(n,e){return typeof n=="function"?n(e):n}function Ca(n){return n.split("-")[0]}function nh(n){return n.split("-")[1]}function TO(n){return n==="x"?"y":"x"}function EO(n){return n==="y"?"height":"width"}function _l(n){return["top","bottom"].includes(Ca(n))?"y":"x"}function IO(n){return TO(_l(n))}function Gpe(n,e,t){t===void 0&&(t=!1);const r=nh(n),i=IO(n),s=EO(i);let o=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=Cy(o)),[o,Cy(o)]}function Xpe(n){const e=Cy(n);return[j4(n),e,j4(e)]}function j4(n){return n.replace(/start|end/g,e=>Vpe[e])}function Kpe(n,e,t){const r=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(n){case"top":case"bottom":return t?e?i:r:e?r:i;case"left":case"right":return e?s:o;default:return[]}}function Ype(n,e,t,r){const i=nh(n);let s=Kpe(Ca(n),t==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(j4)))),s}function Cy(n){return n.replace(/left|right|bottom|top/g,e=>Wpe[e])}function Zpe(n){return{top:0,right:0,bottom:0,left:0,...n}}function Pz(n){return typeof n!="number"?Zpe(n):{top:n,right:n,bottom:n,left:n}}function Py(n){const{x:e,y:t,width:r,height:i}=n;return{width:r,height:i,top:t,left:e,right:e+r,bottom:t+i,x:e,y:t}}function HT(n,e,t){let{reference:r,floating:i}=n;const s=_l(e),o=IO(e),a=EO(o),l=Ca(e),c=s==="y",u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,h=r[a]/2-i[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-i.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-i.width,y:d};break;default:p={x:r.x,y:r.y}}switch(nh(e)){case"start":p[o]-=h*(t&&c?-1:1);break;case"end":p[o]+=h*(t&&c?-1:1);break}return p}const Jpe=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=t,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:n,floating:e,strategy:i}),{x:u,y:d}=HT(c,r,l),h=r,p={},g=0;for(let m=0;m<a.length;m++){const{name:S,fn:y}=a[m],{x,y:w,data:O,reset:T}=await y({x:u,y:d,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:o,elements:{reference:n,floating:e}});u=x??u,d=w??d,p={...p,[S]:{...p[S],...O}},T&&g<=50&&(g++,typeof T=="object"&&(T.placement&&(h=T.placement),T.rects&&(c=T.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:i}):T.rects),{x:u,y:d}=HT(c,h,l)),m=-1)}return{x:u,y:d,placement:h,strategy:i,middlewareData:p}};async function vp(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=ka(e,n),g=Pz(p),S=a[h?d==="floating"?"reference":"floating":d],y=Py(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(S)))==null||t?S:S.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),x=d==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,w=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),O=await(s.isElement==null?void 0:s.isElement(w))?await(s.getScale==null?void 0:s.getScale(w))||{x:1,y:1}:{x:1,y:1},T=Py(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:x,offsetParent:w,strategy:l}):x);return{top:(y.top-T.top+g.top)/O.y,bottom:(T.bottom-y.bottom+g.bottom)/O.y,left:(y.left-T.left+g.left)/O.x,right:(T.right-y.right+g.right)/O.x}}const e0e=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=ka(n,e)||{};if(c==null)return{};const d=Pz(u),h={x:t,y:r},p=IO(i),g=EO(p),m=await o.getDimensions(c),S=p==="y",y=S?"top":"left",x=S?"bottom":"right",w=S?"clientHeight":"clientWidth",O=s.reference[g]+s.reference[p]-h[p]-s.floating[g],T=h[p]-s.reference[p],E=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let C=E?E[w]:0;(!C||!await(o.isElement==null?void 0:o.isElement(E)))&&(C=a.floating[w]||s.floating[g]);const M=O/2-T/2,A=C/2-m[g]/2-1,D=uo(d[y],A),N=uo(d[x],A),F=D,j=C-m[g]-N,L=C/2-m[g]/2+M,U=D4(F,L,j),Y=!l.arrow&&nh(i)!=null&&L!==U&&s.reference[g]/2-(L<F?D:N)-m[g]/2<0,V=Y?L<F?L-F:L-j:0;return{[p]:h[p]+V,data:{[p]:U,centerOffset:L-U-V,...Y&&{alignmentOffset:V}},reset:Y}}}),t0e=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0,...S}=ka(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const y=Ca(i),x=_l(a),w=Ca(a)===a,O=await(l.isRTL==null?void 0:l.isRTL(c.floating)),T=h||(w||!m?[Cy(a)]:Xpe(a)),E=g!=="none";!h&&E&&T.push(...Ype(a,m,g,O));const C=[a,...T],M=await vp(e,S),A=[];let D=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&A.push(M[y]),d){const L=Gpe(i,o,O);A.push(M[L[0]],M[L[1]])}if(D=[...D,{placement:i,overflows:A}],!A.every(L=>L<=0)){var N,F;const L=(((N=s.flip)==null?void 0:N.index)||0)+1,U=C[L];if(U)return{data:{index:L,overflows:D},reset:{placement:U}};let Y=(F=D.filter(V=>V.overflows[0]<=0).sort((V,W)=>V.overflows[1]-W.overflows[1])[0])==null?void 0:F.placement;if(!Y)switch(p){case"bestFit":{var j;const V=(j=D.filter(W=>{if(E){const J=_l(W.placement);return J===x||J==="y"}return!0}).map(W=>[W.placement,W.overflows.filter(J=>J>0).reduce((J,ne)=>J+ne,0)]).sort((W,J)=>W[1]-J[1])[0])==null?void 0:j[0];V&&(Y=V);break}case"initialPlacement":Y=a;break}if(i!==Y)return{reset:{placement:Y}}}return{}}}};function QT(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function qT(n){return qpe.some(e=>n[e]>=0)}const n0e=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...i}=ka(n,e);switch(r){case"referenceHidden":{const s=await vp(e,{...i,elementContext:"reference"}),o=QT(s,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:qT(o)}}}case"escaped":{const s=await vp(e,{...i,altBoundary:!0}),o=QT(s,t.floating);return{data:{escapedOffsets:o,escaped:qT(o)}}}default:return{}}}}};async function r0e(n,e){const{placement:t,platform:r,elements:i}=n,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=Ca(t),a=nh(t),l=_l(t)==="y",c=["left","top"].includes(o)?-1:1,u=s&&l?-1:1,d=ka(e,n);let{mainAxis:h,crossAxis:p,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const i0e=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:i,y:s,placement:o,middlewareData:a}=e,l=await r0e(e,n);return o===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},s0e=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:S=>{let{x:y,y:x}=S;return{x:y,y:x}}},...l}=ka(n,e),c={x:t,y:r},u=await vp(e,l),d=_l(Ca(i)),h=TO(d);let p=c[h],g=c[d];if(s){const S=h==="y"?"top":"left",y=h==="y"?"bottom":"right",x=p+u[S],w=p-u[y];p=D4(x,p,w)}if(o){const S=d==="y"?"top":"left",y=d==="y"?"bottom":"right",x=g+u[S],w=g-u[y];g=D4(x,g,w)}const m=a.fn({...e,[h]:p,[d]:g});return{...m,data:{x:m.x-t,y:m.y-r}}}}},o0e=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=ka(n,e),u={x:t,y:r},d=_l(i),h=TO(d);let p=u[h],g=u[d];const m=ka(a,e),S=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const w=h==="y"?"height":"width",O=s.reference[h]-s.floating[w]+S.mainAxis,T=s.reference[h]+s.reference[w]-S.mainAxis;p<O?p=O:p>T&&(p=T)}if(c){var y,x;const w=h==="y"?"width":"height",O=["top","left"].includes(Ca(i)),T=s.reference[d]-s.floating[w]+(O&&((y=o.offset)==null?void 0:y[d])||0)+(O?0:S.crossAxis),E=s.reference[d]+s.reference[w]+(O?0:((x=o.offset)==null?void 0:x[d])||0)-(O?S.crossAxis:0);g<T?g=T:g>E&&(g=E)}return{[h]:p,[d]:g}}}},a0e=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){const{placement:t,rects:r,platform:i,elements:s}=e,{apply:o=()=>{},...a}=ka(n,e),l=await vp(e,a),c=Ca(t),u=nh(t),d=_l(t)==="y",{width:h,height:p}=r.floating;let g,m;c==="top"||c==="bottom"?(g=c,m=u===(await(i.isRTL==null?void 0:i.isRTL(s.floating))?"start":"end")?"left":"right"):(m=c,g=u==="end"?"top":"bottom");const S=p-l.top-l.bottom,y=h-l.left-l.right,x=uo(p-l[g],S),w=uo(h-l[m],y),O=!e.middlewareData.shift;let T=x,E=w;if(d?E=u||O?uo(w,y):y:T=u||O?uo(x,S):S,O&&!u){const M=Si(l.left,0),A=Si(l.right,0),D=Si(l.top,0),N=Si(l.bottom,0);d?E=h-2*(M!==0||A!==0?M+A:Si(l.left,l.right)):T=p-2*(D!==0||N!==0?D+N:Si(l.top,l.bottom))}await o({...e,availableWidth:E,availableHeight:T});const C=await i.getDimensions(s.floating);return h!==C.width||p!==C.height?{reset:{rects:!0}}:{}}}};function rh(n){return Tz(n)?(n.nodeName||"").toLowerCase():"#document"}function Ei(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function ja(n){var e;return(e=(Tz(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function Tz(n){return n instanceof Node||n instanceof Ei(n).Node}function _s(n){return n instanceof Element||n instanceof Ei(n).Element}function Eo(n){return n instanceof HTMLElement||n instanceof Ei(n).HTMLElement}function WT(n){return typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Ei(n).ShadowRoot}function a0(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=Rs(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(i)}function l0e(n){return["table","td","th"].includes(rh(n))}function aS(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function MO(n){const e=AO(),t=_s(n)?Rs(n):n;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function c0e(n){let e=Rl(n);for(;Eo(e)&&!Dd(e);){if(MO(e))return e;if(aS(e))return null;e=Rl(e)}return null}function AO(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Dd(n){return["html","body","#document"].includes(rh(n))}function Rs(n){return Ei(n).getComputedStyle(n)}function lS(n){return _s(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Rl(n){if(rh(n)==="html")return n;const e=n.assignedSlot||n.parentNode||WT(n)&&n.host||ja(n);return WT(e)?e.host:e}function Ez(n){const e=Rl(n);return Dd(e)?n.ownerDocument?n.ownerDocument.body:n.body:Eo(e)&&a0(e)?e:Ez(e)}function Sp(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=Ez(n),s=i===((r=n.ownerDocument)==null?void 0:r.body),o=Ei(i);if(s){const a=L4(o);return e.concat(o,o.visualViewport||[],a0(i)?i:[],a&&t?Sp(a):[])}return e.concat(i,Sp(i,[],t))}function L4(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function Iz(n){const e=Rs(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Eo(n),s=i?n.offsetWidth:t,o=i?n.offsetHeight:r,a=ky(t)!==s||ky(r)!==o;return a&&(t=s,r=o),{width:t,height:r,$:a}}function _O(n){return _s(n)?n:n.contextElement}function hd(n){const e=_O(n);if(!Eo(e))return Al(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:s}=Iz(e);let o=(s?ky(t.width):t.width)/r,a=(s?ky(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const u0e=Al(0);function Mz(n){const e=Ei(n);return!AO()||!e.visualViewport?u0e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function d0e(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Ei(n)?!1:e}function Vc(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),s=_O(n);let o=Al(1);e&&(r?_s(r)&&(o=hd(r)):o=hd(n));const a=d0e(s,t,r)?Mz(s):Al(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,d=i.height/o.y;if(s){const h=Ei(s),p=r&&_s(r)?Ei(r):r;let g=h,m=L4(g);for(;m&&r&&p!==g;){const S=hd(m),y=m.getBoundingClientRect(),x=Rs(m),w=y.left+(m.clientLeft+parseFloat(x.paddingLeft))*S.x,O=y.top+(m.clientTop+parseFloat(x.paddingTop))*S.y;l*=S.x,c*=S.y,u*=S.x,d*=S.y,l+=w,c+=O,g=Ei(m),m=L4(g)}}return Py({width:u,height:d,x:l,y:c})}function h0e(n){let{elements:e,rect:t,offsetParent:r,strategy:i}=n;const s=i==="fixed",o=ja(r),a=e?aS(e.floating):!1;if(r===o||a&&s)return t;let l={scrollLeft:0,scrollTop:0},c=Al(1);const u=Al(0),d=Eo(r);if((d||!d&&!s)&&((rh(r)!=="body"||a0(o))&&(l=lS(r)),Eo(r))){const h=Vc(r);c=hd(r),u.x=h.x+r.clientLeft,u.y=h.y+r.clientTop}return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x,y:t.y*c.y-l.scrollTop*c.y+u.y}}function f0e(n){return Array.from(n.getClientRects())}function Az(n){return Vc(ja(n)).left+lS(n).scrollLeft}function p0e(n){const e=ja(n),t=lS(n),r=n.ownerDocument.body,i=Si(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Si(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-t.scrollLeft+Az(n);const a=-t.scrollTop;return Rs(r).direction==="rtl"&&(o+=Si(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}function g0e(n,e){const t=Ei(n),r=ja(n),i=t.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const c=AO();(!c||c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a,y:l}}function m0e(n,e){const t=Vc(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,s=Eo(n)?hd(n):Al(1),o=n.clientWidth*s.x,a=n.clientHeight*s.y,l=i*s.x,c=r*s.y;return{width:o,height:a,x:l,y:c}}function VT(n,e,t){let r;if(e==="viewport")r=g0e(n,t);else if(e==="document")r=p0e(ja(n));else if(_s(e))r=m0e(e,t);else{const i=Mz(n);r={...e,x:e.x-i.x,y:e.y-i.y}}return Py(r)}function _z(n,e){const t=Rl(n);return t===e||!_s(t)||Dd(t)?!1:Rs(t).position==="fixed"||_z(t,e)}function y0e(n,e){const t=e.get(n);if(t)return t;let r=Sp(n,[],!1).filter(a=>_s(a)&&rh(a)!=="body"),i=null;const s=Rs(n).position==="fixed";let o=s?Rl(n):n;for(;_s(o)&&!Dd(o);){const a=Rs(o),l=MO(o);!l&&a.position==="fixed"&&(i=null),(s?!l&&!i:!l&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||a0(o)&&!l&&_z(n,o))?r=r.filter(u=>u!==o):i=a,o=Rl(o)}return e.set(n,r),r}function v0e(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const o=[...t==="clippingAncestors"?aS(e)?[]:y0e(e,this._c):[].concat(t),r],a=o[0],l=o.reduce((c,u)=>{const d=VT(e,u,i);return c.top=Si(d.top,c.top),c.right=uo(d.right,c.right),c.bottom=uo(d.bottom,c.bottom),c.left=Si(d.left,c.left),c},VT(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function S0e(n){const{width:e,height:t}=Iz(n);return{width:e,height:t}}function x0e(n,e,t){const r=Eo(e),i=ja(e),s=t==="fixed",o=Vc(n,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Al(0);if(r||!r&&!s)if((rh(e)!=="body"||a0(i))&&(a=lS(e)),r){const d=Vc(e,!0,s,e);l.x=d.x+e.clientLeft,l.y=d.y+e.clientTop}else i&&(l.x=Az(i));const c=o.left+a.scrollLeft-l.x,u=o.top+a.scrollTop-l.y;return{x:c,y:u,width:o.width,height:o.height}}function P2(n){return Rs(n).position==="static"}function GT(n,e){return!Eo(n)||Rs(n).position==="fixed"?null:e?e(n):n.offsetParent}function Rz(n,e){const t=Ei(n);if(aS(n))return t;if(!Eo(n)){let i=Rl(n);for(;i&&!Dd(i);){if(_s(i)&&!P2(i))return i;i=Rl(i)}return t}let r=GT(n,e);for(;r&&l0e(r)&&P2(r);)r=GT(r,e);return r&&Dd(r)&&P2(r)&&!MO(r)?t:r||c0e(n)||t}const w0e=async function(n){const e=this.getOffsetParent||Rz,t=this.getDimensions,r=await t(n.floating);return{reference:x0e(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function b0e(n){return Rs(n).direction==="rtl"}const O0e={convertOffsetParentRelativeRectToViewportRelativeRect:h0e,getDocumentElement:ja,getClippingRect:v0e,getOffsetParent:Rz,getElementRects:w0e,getClientRects:f0e,getDimensions:S0e,getScale:hd,isElement:_s,isRTL:b0e};function k0e(n,e){let t=null,r;const i=ja(n);function s(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const{left:c,top:u,width:d,height:h}=n.getBoundingClientRect();if(a||e(),!d||!h)return;const p=Ig(u),g=Ig(i.clientWidth-(c+d)),m=Ig(i.clientHeight-(u+h)),S=Ig(c),x={rootMargin:-p+"px "+-g+"px "+-m+"px "+-S+"px",threshold:Si(0,uo(1,l))||1};let w=!0;function O(T){const E=T[0].intersectionRatio;if(E!==l){if(!w)return o();E?o(!1,E):r=setTimeout(()=>{o(!1,1e-7)},1e3)}w=!1}try{t=new IntersectionObserver(O,{...x,root:i.ownerDocument})}catch{t=new IntersectionObserver(O,x)}t.observe(n)}return o(!0),s}function C0e(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=_O(n),u=i||s?[...c?Sp(c):[],...Sp(e)]:[];u.forEach(y=>{i&&y.addEventListener("scroll",t,{passive:!0}),s&&y.addEventListener("resize",t)});const d=c&&a?k0e(c,t):null;let h=-1,p=null;o&&(p=new ResizeObserver(y=>{let[x]=y;x&&x.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var w;(w=p)==null||w.observe(e)})),t()}),c&&!l&&p.observe(c),p.observe(e));let g,m=l?Vc(n):null;l&&S();function S(){const y=Vc(n);m&&(y.x!==m.x||y.y!==m.y||y.width!==m.width||y.height!==m.height)&&t(),m=y,g=requestAnimationFrame(S)}return t(),()=>{var y;u.forEach(x=>{i&&x.removeEventListener("scroll",t),s&&x.removeEventListener("resize",t)}),d==null||d(),(y=p)==null||y.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const P0e=i0e,T0e=s0e,E0e=t0e,I0e=a0e,M0e=n0e,XT=e0e,A0e=o0e,_0e=(n,e,t)=>{const r=new Map,i={platform:O0e,...t},s={...i.platform,_c:r};return Jpe(n,e,{...i,platform:s})};var n1=typeof document<"u"?k.useLayoutEffect:k.useEffect;function Ty(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!Ty(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const s=i[r];if(!(s==="_owner"&&n.$$typeof)&&!Ty(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function Dz(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function KT(n,e){const t=Dz(n);return Math.round(e*t)/t}function YT(n){const e=k.useRef(n);return n1(()=>{e.current=n}),e}function R0e(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[u,d]=k.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=k.useState(r);Ty(h,r)||p(r);const[g,m]=k.useState(null),[S,y]=k.useState(null),x=k.useCallback(V=>{V!==E.current&&(E.current=V,m(V))},[]),w=k.useCallback(V=>{V!==C.current&&(C.current=V,y(V))},[]),O=s||g,T=o||S,E=k.useRef(null),C=k.useRef(null),M=k.useRef(u),A=l!=null,D=YT(l),N=YT(i),F=k.useCallback(()=>{if(!E.current||!C.current)return;const V={placement:e,strategy:t,middleware:h};N.current&&(V.platform=N.current),_0e(E.current,C.current,V).then(W=>{const J={...W,isPositioned:!0};j.current&&!Ty(M.current,J)&&(M.current=J,su.flushSync(()=>{d(J)}))})},[h,e,t,N]);n1(()=>{c===!1&&M.current.isPositioned&&(M.current.isPositioned=!1,d(V=>({...V,isPositioned:!1})))},[c]);const j=k.useRef(!1);n1(()=>(j.current=!0,()=>{j.current=!1}),[]),n1(()=>{if(O&&(E.current=O),T&&(C.current=T),O&&T){if(D.current)return D.current(O,T,F);F()}},[O,T,F,D,A]);const L=k.useMemo(()=>({reference:E,floating:C,setReference:x,setFloating:w}),[x,w]),U=k.useMemo(()=>({reference:O,floating:T}),[O,T]),Y=k.useMemo(()=>{const V={position:t,left:0,top:0};if(!U.floating)return V;const W=KT(U.floating,u.x),J=KT(U.floating,u.y);return a?{...V,transform:"translate("+W+"px, "+J+"px)",...Dz(U.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:W,top:J}},[t,a,U.floating,u.x,u.y]);return k.useMemo(()=>({...u,update:F,refs:L,elements:U,floatingStyles:Y}),[u,F,L,U,Y])}const D0e=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:i}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?XT({element:r.current,padding:i}).fn(t):{}:r?XT({element:r,padding:i}).fn(t):{}}}},j0e=(n,e)=>({...P0e(n),options:[n,e]}),L0e=(n,e)=>({...T0e(n),options:[n,e]}),z0e=(n,e)=>({...A0e(n),options:[n,e]}),N0e=(n,e)=>({...E0e(n),options:[n,e]}),$0e=(n,e)=>({...I0e(n),options:[n,e]}),F0e=(n,e)=>({...M0e(n),options:[n,e]}),B0e=(n,e)=>({...D0e(n),options:[n,e]});var U0e="Arrow",jz=k.forwardRef((n,e)=>{const{children:t,width:r=10,height:i=5,...s}=n;return f.jsx(it.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});jz.displayName=U0e;var H0e=jz;function Lz(n){const[e,t]=k.useState(void 0);return Ml(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=n.offsetWidth,a=n.offsetHeight;t({width:o,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var RO="Popper",[zz,cS]=Ro(RO),[Q0e,Nz]=zz(RO),$z=n=>{const{__scopePopper:e,children:t}=n,[r,i]=k.useState(null);return f.jsx(Q0e,{scope:e,anchor:r,onAnchorChange:i,children:t})};$z.displayName=RO;var Fz="PopperAnchor",Bz=k.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...i}=n,s=Nz(Fz,t),o=k.useRef(null),a=_t(e,o);return k.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||o.current)}),r?null:f.jsx(it.div,{...i,ref:a})});Bz.displayName=Fz;var DO="PopperContent",[q0e,W0e]=zz(DO),Uz=k.forwardRef((n,e)=>{var Ue,ct,Je,vt,ut,wr;const{__scopePopper:t,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:g,...m}=n,S=Nz(DO,t),[y,x]=k.useState(null),w=_t(e,xn=>x(xn)),[O,T]=k.useState(null),E=Lz(O),C=(E==null?void 0:E.width)??0,M=(E==null?void 0:E.height)??0,A=r+(s!=="center"?"-"+s:""),D=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},N=Array.isArray(c)?c:[c],F=N.length>0,j={padding:D,boundary:N.filter(G0e),altBoundary:F},{refs:L,floatingStyles:U,placement:Y,isPositioned:V,middlewareData:W}=R0e({strategy:"fixed",placement:A,whileElementsMounted:(...xn)=>C0e(...xn,{animationFrame:p==="always"}),elements:{reference:S.anchor},middleware:[j0e({mainAxis:i+M,alignmentAxis:o}),l&&L0e({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?z0e():void 0,...j}),l&&N0e({...j}),$0e({...j,apply:({elements:xn,rects:In,availableWidth:Bt,availableHeight:wn})=>{const{width:ui,height:Hs}=In.reference,di=xn.floating.style;di.setProperty("--radix-popper-available-width",`${Bt}px`),di.setProperty("--radix-popper-available-height",`${wn}px`),di.setProperty("--radix-popper-anchor-width",`${ui}px`),di.setProperty("--radix-popper-anchor-height",`${Hs}px`)}}),O&&B0e({element:O,padding:a}),X0e({arrowWidth:C,arrowHeight:M}),h&&F0e({strategy:"referenceHidden",...j})]}),[J,ne]=qz(Y),le=Jn(g);Ml(()=>{V&&(le==null||le())},[V,le]);const ue=(Ue=W.arrow)==null?void 0:Ue.x,Pe=(ct=W.arrow)==null?void 0:ct.y,je=((Je=W.arrow)==null?void 0:Je.centerOffset)!==0,[he,et]=k.useState();return Ml(()=>{y&&et(window.getComputedStyle(y).zIndex)},[y]),f.jsx("div",{ref:L.setFloating,"data-radix-popper-content-wrapper":"",style:{...U,transform:V?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:he,"--radix-popper-transform-origin":[(vt=W.transformOrigin)==null?void 0:vt.x,(ut=W.transformOrigin)==null?void 0:ut.y].join(" "),...((wr=W.hide)==null?void 0:wr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:f.jsx(q0e,{scope:t,placedSide:J,onArrowChange:T,arrowX:ue,arrowY:Pe,shouldHideArrow:je,children:f.jsx(it.div,{"data-side":J,"data-align":ne,...m,ref:w,style:{...m.style,animation:V?void 0:"none"}})})})});Uz.displayName=DO;var Hz="PopperArrow",V0e={top:"bottom",right:"left",bottom:"top",left:"right"},Qz=k.forwardRef(function(e,t){const{__scopePopper:r,...i}=e,s=W0e(Hz,r),o=V0e[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(H0e,{...i,ref:t,style:{...i.style,display:"block"}})})});Qz.displayName=Hz;function G0e(n){return n!==null}var X0e=n=>({name:"transformOrigin",options:n,fn(e){var S,y,x;const{placement:t,rects:r,middlewareData:i}=e,o=((S=i.arrow)==null?void 0:S.centerOffset)!==0,a=o?0:n.arrowWidth,l=o?0:n.arrowHeight,[c,u]=qz(t),d={start:"0%",center:"50%",end:"100%"}[u],h=(((y=i.arrow)==null?void 0:y.x)??0)+a/2,p=(((x=i.arrow)==null?void 0:x.y)??0)+l/2;let g="",m="";return c==="bottom"?(g=o?d:`${h}px`,m=`${-l}px`):c==="top"?(g=o?d:`${h}px`,m=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,m=o?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,m=o?d:`${p}px`),{data:{x:g,y:m}}}});function qz(n){const[e,t="center"]=n.split("-");return[e,t]}var jO=$z,LO=Bz,Wz=Uz,Vz=Qz,zO="Popover",[Gz,KOe]=Ro(zO,[cS]),l0=cS(),[K0e,Zl]=Gz(zO),Xz=n=>{const{__scopePopover:e,children:t,open:r,defaultOpen:i,onOpenChange:s,modal:o=!1}=n,a=l0(e),l=k.useRef(null),[c,u]=k.useState(!1),[d=!1,h]=Yl({prop:r,defaultProp:i,onChange:s});return f.jsx(jO,{...a,children:f.jsx(K0e,{scope:e,contentId:fa(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:k.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:c,onCustomAnchorAdd:k.useCallback(()=>u(!0),[]),onCustomAnchorRemove:k.useCallback(()=>u(!1),[]),modal:o,children:t})})};Xz.displayName=zO;var Kz="PopoverAnchor",Y0e=k.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Zl(Kz,t),s=l0(t),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=i;return k.useEffect(()=>(o(),()=>a()),[o,a]),f.jsx(LO,{...s,...r,ref:e})});Y0e.displayName=Kz;var Yz="PopoverTrigger",Zz=k.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Zl(Yz,t),s=l0(t),o=_t(e,i.triggerRef),a=f.jsx(it.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":rN(i.open),...r,ref:o,onClick:be(n.onClick,i.onOpenToggle)});return i.hasCustomAnchor?a:f.jsx(LO,{asChild:!0,...s,children:a})});Zz.displayName=Yz;var NO="PopoverPortal",[Z0e,J0e]=Gz(NO,{forceMount:void 0}),Jz=n=>{const{__scopePopover:e,forceMount:t,children:r,container:i}=n,s=Zl(NO,e);return f.jsx(Z0e,{scope:e,forceMount:t,children:f.jsx(Ns,{present:t||s.open,children:f.jsx(o0,{asChild:!0,container:i,children:r})})})};Jz.displayName=NO;var jd="PopoverContent",eN=k.forwardRef((n,e)=>{const t=J0e(jd,n.__scopePopover),{forceMount:r=t.forceMount,...i}=n,s=Zl(jd,n.__scopePopover);return f.jsx(Ns,{present:r||s.open,children:s.modal?f.jsx(ege,{...i,ref:e}):f.jsx(tge,{...i,ref:e})})});eN.displayName=jd;var ege=k.forwardRef((n,e)=>{const t=Zl(jd,n.__scopePopover),r=k.useRef(null),i=_t(e,r),s=k.useRef(!1);return k.useEffect(()=>{const o=r.current;if(o)return mO(o)},[]),f.jsx(Zv,{as:qc,allowPinchZoom:!0,children:f.jsx(tN,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:be(n.onCloseAutoFocus,o=>{var a;o.preventDefault(),s.current||(a=t.triggerRef.current)==null||a.focus()}),onPointerDownOutside:be(n.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:be(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),tge=k.forwardRef((n,e)=>{const t=Zl(jd,n.__scopePopover),r=k.useRef(!1),i=k.useRef(!1);return f.jsx(tN,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=n.onCloseAutoFocus)==null||o.call(n,s),s.defaultPrevented||(r.current||(a=t.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var l,c;(l=n.onInteractOutside)==null||l.call(n,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((c=t.triggerRef.current)==null?void 0:c.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),tN=k.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=n,h=Zl(jd,t),p=l0(t);return gO(),f.jsx(Kv,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:f.jsx(s0,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:f.jsx(Wz,{"data-state":rN(h.open),role:"dialog",id:h.contentId,...p,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),nN="PopoverClose",nge=k.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Zl(nN,t);return f.jsx(it.button,{type:"button",...r,ref:e,onClick:be(n.onClick,()=>i.onOpenChange(!1))})});nge.displayName=nN;var rge="PopoverArrow",ige=k.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=l0(t);return f.jsx(Vz,{...i,...r,ref:e})});ige.displayName=rge;function rN(n){return n?"open":"closed"}var $O=Xz,FO=Zz,BO=Jz,UO=eN;function La(n,e){const t=G(),r=k.useRef(!1),i=tr(),s=k.useCallback(a=>{r.current=a,t.run(()=>{a?(t.complete(),t.addOpenMenu(n)):t.updateInstanceState({openMenus:t.getOpenMenus().filter(l=>!l.startsWith(n))}),e==null||e(a)})},[t,n,e]),o=ee("is menu open",()=>t.getOpenMenus().includes(n),[t,n]);return k.useEffect(()=>(r.current&&(i("open-menu",{source:"unknown",id:n}),t.addOpenMenu(n)),()=>{r.current&&(t.deleteOpenMenu(n),t.getOpenMenus().forEach(a=>{a.startsWith(n)&&(i("close-menu",{source:"unknown",id:n}),t.deleteOpenMenu(a))}),r.current=!1)}),[t,n,i]),[o,s]}function HO({id:n,children:e,onOpenChange:t,open:r}){const[i,s]=La(n,t);return f.jsx($O,{onOpenChange:s,open:r||i,children:f.jsx("div",{className:"tlui-popover",children:e})})}function QO({children:n}){return f.jsx(FO,{asChild:!0,dir:"ltr",children:n})}function qO({side:n,children:e,align:t="center",sideOffset:r=8,alignOffset:i=0}){const s=Nn();return f.jsx(BO,{container:s,children:f.jsx(UO,{className:"tlui-popover__content",side:n,sideOffset:r,align:t,alignOffset:i,dir:"ltr",children:e})})}const iN=k.createContext(null);function uS(){const n=k.useContext(iN);if(!n)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return n}function ss({type:n,sourceId:e,children:t}){return f.jsx(iN.Provider,{value:{type:n,sourceId:e},children:t})}function sge(n){return n.getSelectedShapeIds().map(r=>n.getShape(r)).filter(r=>{if(!r)return!1;if(n.isShapeOfType(r,"arrow")){const i=Xr(n,r);if(i.start||i.end)return!1}return!0})}const sN=()=>{const n=G();return ee("threeStackableItems",()=>sge(n).length>2,[n])},za=()=>{const n=G();return ee("isInSelectState",()=>n.isIn("select"),[n])},oN=()=>{const n=G();return ee("allow group",()=>{const e=n.getSelectedShapes();if(e.length<2)return!1;for(const t of e)if(n.isShapeOfType(t,"arrow")){const r=Xr(n,t);if(r.start&&!e.some(i=>i.id===r.start.toId)||r.end&&!e.some(i=>i.id===r.end.toId))return!1}return!0},[n])},aN=()=>{const n=G();return ee("allowUngroup",()=>n.getSelectedShapeIds().some(e=>{var t;return((t=n.getShape(e))==null?void 0:t.type)==="group"}),[n])},oge=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function lN(n,e){const t=G();return ee("selectedShapes",()=>t.getSelectedShapes().length>=n,[t,n,e])}function zr(n,e){const t=G();return ee("selectedShapes",()=>{const r=t.getSelectedShapes().filter(i=>!t.isShapeOrAncestorLocked(i)).length;return n===void 0?r:r>=n},[t])}function age(){const n=G();return ee("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}function cN(){const n=G();return ee("hasLinkShapeSelected",()=>{const e=n.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[n])}function lge(){const n=G();return ee("onlyFlippableShape",()=>{const e=n.getOnlySelectedShape();return e&&(n.isShapeOfType(e,"group")||n.isShapeOfType(e,"image")||n.isShapeOfType(e,"arrow")||n.isShapeOfType(e,"line")||n.isShapeOfType(e,"draw"))},[n])}function uN(){const n=G();return ee("useCanRedo",()=>n.getCanRedo(),[n])}function dN(){const n=G();return ee("useCanUndo",()=>n.getCanUndo(),[n])}var cge=k.createContext(void 0);function WO(n){const e=k.useContext(cge);return n||e||"ltr"}var T2="rovingFocusGroup.onEntryFocus",uge={bubbles:!1,cancelable:!0},dS="RovingFocusGroup",[z4,hN,dge]=Jv(dS),[hge,fN]=Ro(dS,[dge]),[fge,pge]=hge(dS),pN=k.forwardRef((n,e)=>f.jsx(z4.Provider,{scope:n.__scopeRovingFocusGroup,children:f.jsx(z4.Slot,{scope:n.__scopeRovingFocusGroup,children:f.jsx(gge,{...n,ref:e})})}));pN.displayName=dS;var gge=k.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...d}=n,h=k.useRef(null),p=_t(e,h),g=WO(s),[m=null,S]=Yl({prop:o,defaultProp:a,onChange:l}),[y,x]=k.useState(!1),w=Jn(c),O=hN(t),T=k.useRef(!1),[E,C]=k.useState(0);return k.useEffect(()=>{const M=h.current;if(M)return M.addEventListener(T2,w),()=>M.removeEventListener(T2,w)},[w]),f.jsx(fge,{scope:t,orientation:r,dir:g,loop:i,currentTabStopId:m,onItemFocus:k.useCallback(M=>S(M),[S]),onItemShiftTab:k.useCallback(()=>x(!0),[]),onFocusableItemAdd:k.useCallback(()=>C(M=>M+1),[]),onFocusableItemRemove:k.useCallback(()=>C(M=>M-1),[]),children:f.jsx(it.div,{tabIndex:y||E===0?-1:0,"data-orientation":r,...d,ref:p,style:{outline:"none",...n.style},onMouseDown:be(n.onMouseDown,()=>{T.current=!0}),onFocus:be(n.onFocus,M=>{const A=!T.current;if(M.target===M.currentTarget&&A&&!y){const D=new CustomEvent(T2,uge);if(M.currentTarget.dispatchEvent(D),!D.defaultPrevented){const N=O().filter(Y=>Y.focusable),F=N.find(Y=>Y.active),j=N.find(Y=>Y.id===m),U=[F,j,...N].filter(Boolean).map(Y=>Y.ref.current);yN(U,u)}}T.current=!1}),onBlur:be(n.onBlur,()=>x(!1))})})}),gN="RovingFocusGroupItem",mN=k.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:i=!1,tabStopId:s,...o}=n,a=fa(),l=s||a,c=pge(gN,t),u=c.currentTabStopId===l,d=hN(t),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return k.useEffect(()=>{if(r)return h(),()=>p()},[r,h,p]),f.jsx(z4.ItemSlot,{scope:t,id:l,focusable:r,active:i,children:f.jsx(it.span,{tabIndex:u?0:-1,"data-orientation":c.orientation,...o,ref:e,onMouseDown:be(n.onMouseDown,g=>{r?c.onItemFocus(l):g.preventDefault()}),onFocus:be(n.onFocus,()=>c.onItemFocus(l)),onKeyDown:be(n.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){c.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const m=vge(g,c.orientation,c.dir);if(m!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let y=d().filter(x=>x.focusable).map(x=>x.ref.current);if(m==="last")y.reverse();else if(m==="prev"||m==="next"){m==="prev"&&y.reverse();const x=y.indexOf(g.currentTarget);y=c.loop?Sge(y,x+1):y.slice(x+1)}setTimeout(()=>yN(y))}})})})});mN.displayName=gN;var mge={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function yge(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function vge(n,e,t){const r=yge(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return mge[r]}function yN(n,e=!1){const t=document.activeElement;for(const r of n)if(r===t||(r.focus({preventScroll:e}),document.activeElement!==t))return}function Sge(n,e){return n.map((t,r)=>n[(e+r)%n.length])}var xge=pN,wge=mN,N4=["Enter"," "],bge=["ArrowDown","PageUp","Home"],vN=["ArrowUp","PageDown","End"],Oge=[...bge,...vN],kge={ltr:[...N4,"ArrowRight"],rtl:[...N4,"ArrowLeft"]},Cge={ltr:["ArrowLeft"],rtl:["ArrowRight"]},c0="Menu",[xp,Pge,Tge]=Jv(c0),[uu,hS]=Ro(c0,[Tge,cS,fN]),u0=cS(),SN=fN(),[xN,Jl]=uu(c0),[Ege,d0]=uu(c0),wN=n=>{const{__scopeMenu:e,open:t=!1,children:r,dir:i,onOpenChange:s,modal:o=!0}=n,a=u0(e),[l,c]=k.useState(null),u=k.useRef(!1),d=Jn(s),h=WO(i);return k.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",g,{capture:!0,once:!0}),document.addEventListener("pointermove",g,{capture:!0,once:!0})},g=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",g,{capture:!0}),document.removeEventListener("pointermove",g,{capture:!0})}},[]),f.jsx(jO,{...a,children:f.jsx(xN,{scope:e,open:t,onOpenChange:d,content:l,onContentChange:c,children:f.jsx(Ege,{scope:e,onClose:k.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:o,children:r})})})};wN.displayName=c0;var Ige="MenuAnchor",VO=k.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=u0(t);return f.jsx(LO,{...i,...r,ref:e})});VO.displayName=Ige;var GO="MenuPortal",[Mge,bN]=uu(GO,{forceMount:void 0}),ON=n=>{const{__scopeMenu:e,forceMount:t,children:r,container:i}=n,s=Jl(GO,e);return f.jsx(Mge,{scope:e,forceMount:t,children:f.jsx(Ns,{present:t||s.open,children:f.jsx(o0,{asChild:!0,container:i,children:r})})})};ON.displayName=GO;var Ji="MenuContent",[Age,XO]=uu(Ji),kN=k.forwardRef((n,e)=>{const t=bN(Ji,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,s=Jl(Ji,n.__scopeMenu),o=d0(Ji,n.__scopeMenu);return f.jsx(xp.Provider,{scope:n.__scopeMenu,children:f.jsx(Ns,{present:r||s.open,children:f.jsx(xp.Slot,{scope:n.__scopeMenu,children:o.modal?f.jsx(_ge,{...i,ref:e}):f.jsx(Rge,{...i,ref:e})})})})}),_ge=k.forwardRef((n,e)=>{const t=Jl(Ji,n.__scopeMenu),r=k.useRef(null),i=_t(e,r);return k.useEffect(()=>{const s=r.current;if(s)return mO(s)},[]),f.jsx(KO,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:be(n.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),Rge=k.forwardRef((n,e)=>{const t=Jl(Ji,n.__scopeMenu);return f.jsx(KO,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),KO=k.forwardRef((n,e)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,disableOutsideScroll:g,...m}=n,S=Jl(Ji,t),y=d0(Ji,t),x=u0(t),w=SN(t),O=Pge(t),[T,E]=k.useState(null),C=k.useRef(null),M=_t(e,C,S.onContentChange),A=k.useRef(0),D=k.useRef(""),N=k.useRef(0),F=k.useRef(null),j=k.useRef("right"),L=k.useRef(0),U=g?Zv:k.Fragment,Y=g?{as:qc,allowPinchZoom:!0}:void 0,V=J=>{var Ue,ct;const ne=D.current+J,le=O().filter(Je=>!Je.disabled),ue=document.activeElement,Pe=(Ue=le.find(Je=>Je.ref.current===ue))==null?void 0:Ue.textValue,je=le.map(Je=>Je.textValue),he=qge(je,ne,Pe),et=(ct=le.find(Je=>Je.textValue===he))==null?void 0:ct.ref.current;(function Je(vt){D.current=vt,window.clearTimeout(A.current),vt!==""&&(A.current=window.setTimeout(()=>Je(""),1e3))})(ne),et&&setTimeout(()=>et.focus())};k.useEffect(()=>()=>window.clearTimeout(A.current),[]),gO();const W=k.useCallback(J=>{var le,ue;return j.current===((le=F.current)==null?void 0:le.side)&&Vge(J,(ue=F.current)==null?void 0:ue.area)},[]);return f.jsx(Age,{scope:t,searchRef:D,onItemEnter:k.useCallback(J=>{W(J)&&J.preventDefault()},[W]),onItemLeave:k.useCallback(J=>{var ne;W(J)||((ne=C.current)==null||ne.focus(),E(null))},[W]),onTriggerLeave:k.useCallback(J=>{W(J)&&J.preventDefault()},[W]),pointerGraceTimerRef:N,onPointerGraceIntentChange:k.useCallback(J=>{F.current=J},[]),children:f.jsx(U,{...Y,children:f.jsx(Kv,{asChild:!0,trapped:i,onMountAutoFocus:be(s,J=>{var ne;J.preventDefault(),(ne=C.current)==null||ne.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:f.jsx(s0,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,children:f.jsx(xge,{asChild:!0,...w,dir:y.dir,orientation:"vertical",loop:r,currentTabStopId:T,onCurrentTabStopIdChange:E,onEntryFocus:be(l,J=>{y.isUsingKeyboardRef.current||J.preventDefault()}),preventScrollOnEntryFocus:!0,children:f.jsx(Wz,{role:"menu","aria-orientation":"vertical","data-state":BN(S.open),"data-radix-menu-content":"",dir:y.dir,...x,...m,ref:M,style:{outline:"none",...m.style},onKeyDown:be(m.onKeyDown,J=>{const le=J.target.closest("[data-radix-menu-content]")===J.currentTarget,ue=J.ctrlKey||J.altKey||J.metaKey,Pe=J.key.length===1;le&&(J.key==="Tab"&&J.preventDefault(),!ue&&Pe&&V(J.key));const je=C.current;if(J.target!==je||!Oge.includes(J.key))return;J.preventDefault();const et=O().filter(Ue=>!Ue.disabled).map(Ue=>Ue.ref.current);vN.includes(J.key)&&et.reverse(),Hge(et)}),onBlur:be(n.onBlur,J=>{J.currentTarget.contains(J.target)||(window.clearTimeout(A.current),D.current="")}),onPointerMove:be(n.onPointerMove,wp(J=>{const ne=J.target,le=L.current!==J.clientX;if(J.currentTarget.contains(ne)&&le){const ue=J.clientX>L.current?"right":"left";j.current=ue,L.current=J.clientX}}))})})})})})})});kN.displayName=Ji;var Dge="MenuGroup",YO=k.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return f.jsx(it.div,{role:"group",...r,ref:e})});YO.displayName=Dge;var jge="MenuLabel",CN=k.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return f.jsx(it.div,{...r,ref:e})});CN.displayName=jge;var Ey="MenuItem",ZT="menu.itemSelect",fS=k.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:r,...i}=n,s=k.useRef(null),o=d0(Ey,n.__scopeMenu),a=XO(Ey,n.__scopeMenu),l=_t(e,s),c=k.useRef(!1),u=()=>{const d=s.current;if(!t&&d){const h=new CustomEvent(ZT,{bubbles:!0,cancelable:!0});d.addEventListener(ZT,p=>r==null?void 0:r(p),{once:!0}),pO(d,h),h.defaultPrevented?c.current=!1:o.onClose()}};return f.jsx(PN,{...i,ref:l,disabled:t,onClick:be(n.onClick,u),onPointerDown:d=>{var h;(h=n.onPointerDown)==null||h.call(n,d),c.current=!0},onPointerUp:be(n.onPointerUp,d=>{var h;c.current||(h=d.currentTarget)==null||h.click()}),onKeyDown:be(n.onKeyDown,d=>{const h=a.searchRef.current!=="";t||h&&d.key===" "||N4.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});fS.displayName=Ey;var PN=k.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:r=!1,textValue:i,...s}=n,o=XO(Ey,t),a=SN(t),l=k.useRef(null),c=_t(e,l),[u,d]=k.useState(!1),[h,p]=k.useState("");return k.useEffect(()=>{const g=l.current;g&&p((g.textContent??"").trim())},[s.children]),f.jsx(xp.ItemSlot,{scope:t,disabled:r,textValue:i??h,children:f.jsx(wge,{asChild:!0,...a,focusable:!r,children:f.jsx(it.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:c,onPointerMove:be(n.onPointerMove,wp(g=>{r?o.onItemLeave(g):(o.onItemEnter(g),g.defaultPrevented||g.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:be(n.onPointerLeave,wp(g=>o.onItemLeave(g))),onFocus:be(n.onFocus,()=>d(!0)),onBlur:be(n.onBlur,()=>d(!1))})})})}),Lge="MenuCheckboxItem",TN=k.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:r,...i}=n;return f.jsx(_N,{scope:n.__scopeMenu,checked:t,children:f.jsx(fS,{role:"menuitemcheckbox","aria-checked":Iy(t)?"mixed":t,...i,ref:e,"data-state":e7(t),onSelect:be(i.onSelect,()=>r==null?void 0:r(Iy(t)?!0:!t),{checkForDefaultPrevented:!1})})})});TN.displayName=Lge;var EN="MenuRadioGroup",[zge,Nge]=uu(EN,{value:void 0,onValueChange:()=>{}}),IN=k.forwardRef((n,e)=>{const{value:t,onValueChange:r,...i}=n,s=Jn(r);return f.jsx(zge,{scope:n.__scopeMenu,value:t,onValueChange:s,children:f.jsx(YO,{...i,ref:e})})});IN.displayName=EN;var MN="MenuRadioItem",AN=k.forwardRef((n,e)=>{const{value:t,...r}=n,i=Nge(MN,n.__scopeMenu),s=t===i.value;return f.jsx(_N,{scope:n.__scopeMenu,checked:s,children:f.jsx(fS,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":e7(s),onSelect:be(r.onSelect,()=>{var o;return(o=i.onValueChange)==null?void 0:o.call(i,t)},{checkForDefaultPrevented:!1})})})});AN.displayName=MN;var ZO="MenuItemIndicator",[_N,$ge]=uu(ZO,{checked:!1}),RN=k.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:r,...i}=n,s=$ge(ZO,t);return f.jsx(Ns,{present:r||Iy(s.checked)||s.checked===!0,children:f.jsx(it.span,{...i,ref:e,"data-state":e7(s.checked)})})});RN.displayName=ZO;var Fge="MenuSeparator",DN=k.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return f.jsx(it.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});DN.displayName=Fge;var Bge="MenuArrow",jN=k.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=u0(t);return f.jsx(Vz,{...i,...r,ref:e})});jN.displayName=Bge;var JO="MenuSub",[Uge,LN]=uu(JO),zN=n=>{const{__scopeMenu:e,children:t,open:r=!1,onOpenChange:i}=n,s=Jl(JO,e),o=u0(e),[a,l]=k.useState(null),[c,u]=k.useState(null),d=Jn(i);return k.useEffect(()=>(s.open===!1&&d(!1),()=>d(!1)),[s.open,d]),f.jsx(jO,{...o,children:f.jsx(xN,{scope:e,open:r,onOpenChange:d,content:c,onContentChange:u,children:f.jsx(Uge,{scope:e,contentId:fa(),triggerId:fa(),trigger:a,onTriggerChange:l,children:t})})})};zN.displayName=JO;var df="MenuSubTrigger",NN=k.forwardRef((n,e)=>{const t=Jl(df,n.__scopeMenu),r=d0(df,n.__scopeMenu),i=LN(df,n.__scopeMenu),s=XO(df,n.__scopeMenu),o=k.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=s,c={__scopeMenu:n.__scopeMenu},u=k.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return k.useEffect(()=>u,[u]),k.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),l(null)}},[a,l]),f.jsx(VO,{asChild:!0,...c,children:f.jsx(PN,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":BN(t.open),...n,ref:Xv(e,i.onTriggerChange),onClick:d=>{var h;(h=n.onClick)==null||h.call(n,d),!(n.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:be(n.onPointerMove,wp(d=>{s.onItemEnter(d),!d.defaultPrevented&&!n.disabled&&!t.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{t.onOpenChange(!0),u()},100))})),onPointerLeave:be(n.onPointerLeave,wp(d=>{var p,g;u();const h=(p=t.content)==null?void 0:p.getBoundingClientRect();if(h){const m=(g=t.content)==null?void 0:g.dataset.side,S=m==="right",y=S?-5:5,x=h[S?"left":"right"],w=h[S?"right":"left"];s.onPointerGraceIntentChange({area:[{x:d.clientX+y,y:d.clientY},{x,y:h.top},{x:w,y:h.top},{x:w,y:h.bottom},{x,y:h.bottom}],side:m}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(d),d.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:be(n.onKeyDown,d=>{var p;const h=s.searchRef.current!=="";n.disabled||h&&d.key===" "||kge[r.dir].includes(d.key)&&(t.onOpenChange(!0),(p=t.content)==null||p.focus(),d.preventDefault())})})})});NN.displayName=df;var $N="MenuSubContent",FN=k.forwardRef((n,e)=>{const t=bN(Ji,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,s=Jl(Ji,n.__scopeMenu),o=d0(Ji,n.__scopeMenu),a=LN($N,n.__scopeMenu),l=k.useRef(null),c=_t(e,l);return f.jsx(xp.Provider,{scope:n.__scopeMenu,children:f.jsx(Ns,{present:r||s.open,children:f.jsx(xp.Slot,{scope:n.__scopeMenu,children:f.jsx(KO,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:c,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;o.isUsingKeyboardRef.current&&((d=l.current)==null||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:be(n.onFocusOutside,u=>{u.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:be(n.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:be(n.onKeyDown,u=>{var p;const d=u.currentTarget.contains(u.target),h=Cge[o.dir].includes(u.key);d&&h&&(s.onOpenChange(!1),(p=a.trigger)==null||p.focus(),u.preventDefault())})})})})})});FN.displayName=$N;function BN(n){return n?"open":"closed"}function Iy(n){return n==="indeterminate"}function e7(n){return Iy(n)?"indeterminate":n?"checked":"unchecked"}function Hge(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function Qge(n,e){return n.map((t,r)=>n[(e+r)%n.length])}function qge(n,e,t){const i=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,s=t?n.indexOf(t):-1;let o=Qge(n,Math.max(s,0));i.length===1&&(o=o.filter(c=>c!==t));const l=o.find(c=>c.toLowerCase().startsWith(i.toLowerCase()));return l!==t?l:void 0}function Wge(n,e){const{x:t,y:r}=n;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s].x,l=e[s].y,c=e[o].x,u=e[o].y;l>r!=u>r&&t<(c-a)*(r-l)/(u-l)+a&&(i=!i)}return i}function Vge(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return Wge(t,e)}function wp(n){return e=>e.pointerType==="mouse"?n(e):void 0}var UN=wN,HN=VO,QN=ON,qN=kN,WN=YO,VN=CN,GN=fS,XN=TN,KN=IN,YN=AN,ZN=RN,JN=DN,e$=jN,t$=zN,n$=NN,r$=FN,t7="ContextMenu",[Gge,YOe]=Ro(t7,[hS]),vr=hS(),[Xge,i$]=Gge(t7),s$=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,dir:i,modal:s=!0}=n,[o,a]=k.useState(!1),l=vr(e),c=Jn(r),u=k.useCallback(d=>{a(d),c(d)},[c]);return f.jsx(Xge,{scope:e,open:o,onOpenChange:u,modal:s,children:f.jsx(UN,{...l,dir:i,open:o,onOpenChange:u,modal:s,children:t})})};s$.displayName=t7;var o$="ContextMenuTrigger",a$=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:r=!1,...i}=n,s=i$(o$,t),o=vr(t),a=k.useRef({x:0,y:0}),l=k.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=k.useRef(0),u=k.useCallback(()=>window.clearTimeout(c.current),[]),d=h=>{a.current={x:h.clientX,y:h.clientY},s.onOpenChange(!0)};return k.useEffect(()=>u,[u]),k.useEffect(()=>void(r&&u()),[r,u]),f.jsxs(f.Fragment,{children:[f.jsx(HN,{...o,virtualRef:l}),f.jsx(it.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:r?n.onContextMenu:be(n.onContextMenu,h=>{u(),d(h),h.preventDefault()}),onPointerDown:r?n.onPointerDown:be(n.onPointerDown,Mg(h=>{u(),c.current=window.setTimeout(()=>d(h),700)})),onPointerMove:r?n.onPointerMove:be(n.onPointerMove,Mg(u)),onPointerCancel:r?n.onPointerCancel:be(n.onPointerCancel,Mg(u)),onPointerUp:r?n.onPointerUp:be(n.onPointerUp,Mg(u))})]})});a$.displayName=o$;var Kge="ContextMenuPortal",n7=n=>{const{__scopeContextMenu:e,...t}=n,r=vr(e);return f.jsx(QN,{...r,...t})};n7.displayName=Kge;var l$="ContextMenuContent",c$=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=i$(l$,t),s=vr(t),o=k.useRef(!1);return f.jsx(qN,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var l;(l=n.onCloseAutoFocus)==null||l.call(n,a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{var l;(l=n.onInteractOutside)==null||l.call(n,a),!a.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});c$.displayName=l$;var Yge="ContextMenuGroup",u$=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(WN,{...i,...r,ref:e})});u$.displayName=Yge;var Zge="ContextMenuLabel",Jge=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(VN,{...i,...r,ref:e})});Jge.displayName=Zge;var eme="ContextMenuItem",d$=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(GN,{...i,...r,ref:e})});d$.displayName=eme;var tme="ContextMenuCheckboxItem",h$=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(XN,{...i,...r,ref:e})});h$.displayName=tme;var nme="ContextMenuRadioGroup",rme=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(KN,{...i,...r,ref:e})});rme.displayName=nme;var ime="ContextMenuRadioItem",sme=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(YN,{...i,...r,ref:e})});sme.displayName=ime;var ome="ContextMenuItemIndicator",ame=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(ZN,{...i,...r,ref:e})});ame.displayName=ome;var lme="ContextMenuSeparator",cme=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(JN,{...i,...r,ref:e})});cme.displayName=lme;var ume="ContextMenuArrow",dme=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(e$,{...i,...r,ref:e})});dme.displayName=ume;var hme="ContextMenuSub",f$=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,open:i,defaultOpen:s}=n,o=vr(e),[a,l]=Yl({prop:i,defaultProp:s,onChange:r});return f.jsx(t$,{...o,open:a,onOpenChange:l,children:t})};f$.displayName=hme;var fme="ContextMenuSubTrigger",p$=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(n$,{...i,...r,ref:e})});p$.displayName=fme;var pme="ContextMenuSubContent",g$=k.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=vr(t);return f.jsx(r$,{...i,...r,ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});g$.displayName=pme;function Mg(n){return e=>e.pointerType!=="mouse"?n(e):void 0}var gme=s$,mme=a$,yme=n7,vme=c$,Sme=h$;const m$=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,xme=m$?"":"Ctrl",wme=m$?"":"Alt";function y$(n){return n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,xme).replace(/\?/g,wme).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)})}function $4(n){return" "+y$(n).join("")}function bme(n){return f.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:f.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[f.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),f.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:f.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}var r7="DropdownMenu",[Ome,ZOe]=Ro(r7,[hS]),Sr=hS(),[kme,v$]=Ome(r7),S$=n=>{const{__scopeDropdownMenu:e,children:t,dir:r,open:i,defaultOpen:s,onOpenChange:o,modal:a=!0}=n,l=Sr(e),c=k.useRef(null),[u=!1,d]=Yl({prop:i,defaultProp:s,onChange:o});return f.jsx(kme,{scope:e,triggerId:fa(),triggerRef:c,contentId:fa(),open:u,onOpenChange:d,onOpenToggle:k.useCallback(()=>d(h=>!h),[d]),modal:a,children:f.jsx(UN,{...l,open:u,onOpenChange:d,dir:r,modal:a,children:t})})};S$.displayName=r7;var x$="DropdownMenuTrigger",w$=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...i}=n,s=v$(x$,t),o=Sr(t);return f.jsx(HN,{asChild:!0,...o,children:f.jsx(it.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:Xv(e,s.triggerRef),onPointerDown:be(n.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:be(n.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});w$.displayName=x$;var Cme="DropdownMenuPortal",b$=n=>{const{__scopeDropdownMenu:e,...t}=n,r=Sr(e);return f.jsx(QN,{...r,...t})};b$.displayName=Cme;var O$="DropdownMenuContent",k$=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=v$(O$,t),s=Sr(t),o=k.useRef(!1);return f.jsx(qN,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...r,ref:e,onCloseAutoFocus:be(n.onCloseAutoFocus,a=>{var l;o.current||(l=i.triggerRef.current)==null||l.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:be(n.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!i.modal||u)&&(o.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});k$.displayName=O$;var Pme="DropdownMenuGroup",C$=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(WN,{...i,...r,ref:e})});C$.displayName=Pme;var Tme="DropdownMenuLabel",Eme=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(VN,{...i,...r,ref:e})});Eme.displayName=Tme;var Ime="DropdownMenuItem",P$=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(GN,{...i,...r,ref:e})});P$.displayName=Ime;var Mme="DropdownMenuCheckboxItem",T$=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(XN,{...i,...r,ref:e})});T$.displayName=Mme;var Ame="DropdownMenuRadioGroup",_me=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(KN,{...i,...r,ref:e})});_me.displayName=Ame;var Rme="DropdownMenuRadioItem",Dme=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(YN,{...i,...r,ref:e})});Dme.displayName=Rme;var jme="DropdownMenuItemIndicator",Lme=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(ZN,{...i,...r,ref:e})});Lme.displayName=jme;var zme="DropdownMenuSeparator",Nme=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(JN,{...i,...r,ref:e})});Nme.displayName=zme;var $me="DropdownMenuArrow",Fme=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(e$,{...i,...r,ref:e})});Fme.displayName=$me;var Bme=n=>{const{__scopeDropdownMenu:e,children:t,open:r,onOpenChange:i,defaultOpen:s}=n,o=Sr(e),[a=!1,l]=Yl({prop:r,defaultProp:s,onChange:i});return f.jsx(t$,{...o,open:a,onOpenChange:l,children:t})},Ume="DropdownMenuSubTrigger",E$=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(n$,{...i,...r,ref:e})});E$.displayName=Ume;var Hme="DropdownMenuSubContent",I$=k.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Sr(t);return f.jsx(r$,{...i,...r,ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});I$.displayName=Hme;var i7=S$,s7=w$,pS=b$,o7=k$,Qme=C$,qme=P$,Wme=T$,Vme=Bme,Gme=E$,Xme=I$;function Gc({id:n,children:e,modal:t=!1,debugOpen:r=!1}){const[i,s]=La(n);return f.jsx(i7,{open:r||i,dir:"ltr",modal:t,onOpenChange:s,children:e})}function Xc({children:n,...e}){return f.jsx(s7,{dir:"ltr",asChild:!0,onTouchEnd:t=>tt(t),...e,children:n})}function Kc({side:n="bottom",align:e="start",sideOffset:t=8,alignOffset:r=8,children:i}){const s=Nn();return f.jsx(pS,{container:s,children:f.jsx(o7,{className:"tlui-menu",side:n,sideOffset:t,align:e,alignOffset:r,collisionPadding:4,children:i})})}function Kme({id:n,children:e}){const[t,r]=La(n);return f.jsx(Vme,{open:t,onOpenChange:r,children:e})}function Yme({id:n,label:e,title:t,disabled:r}){return f.jsx(Gme,{dir:"ltr",asChild:!0,disabled:r,children:f.jsxs(Ee,{"data-testid":n,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:t,children:[f.jsx(dn,{children:e}),f.jsx(We,{icon:"chevron-right",small:!0})]})})}function Zme({id:n,alignOffset:e=-1,sideOffset:t=-4,size:r="small",children:i}){const s=Nn();return f.jsx(pS,{container:s,children:f.jsx(Xme,{"data-testid":n,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,"data-size":r,children:i})})}function Jme({children:n}){return f.jsx(Qme,{dir:"ltr",className:"tlui-menu__group",children:n})}function bp({noClose:n,children:e}){return f.jsx(qme,{dir:"ltr",asChild:!0,onClick:n?tt:void 0,children:e})}function Rf({children:n,visibleOnMobileLayout:e=!1}){const t=Lr();return!e&&t<sn.MOBILE?null:f.jsx("kbd",{className:"tlui-kbd",children:y$(n).map((r,i)=>f.jsx("span",{children:r},i))})}function Z({disabled:n=!1,spinner:e=!1,readonlyOk:t=!1,id:r,kbd:i,label:s,icon:o,onSelect:a,noClose:l,isSelected:c}){const{type:u,sourceId:d}=uS(),h=Xe(),[p,g]=k.useState(!1);if(Da()&&!t)return null;const S=yp(s,u),y=i?$4(i):void 0,x=S?h(S):void 0,w=x&&y?`${x} ${y}`:x;switch(u){case"menu":return f.jsx(bp,{children:f.jsxs(Ee,{type:"menu","data-testid":`${d}.${r}`,disabled:n,title:w,onClick:O=>{l&&tt(O),p?g(!1):a(d)},children:[f.jsx(dn,{children:x}),i&&f.jsx(Rf,{children:i})]})});case"context-menu":return n?null:f.jsxs(d$,{dir:"ltr",title:w,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${d}.${r}`,onSelect:O=>{l&&tt(O),p?g(!1):a(d)},children:[f.jsx("span",{className:"tlui-button__label",draggable:!1,children:x}),i&&f.jsx(Rf,{children:i}),e&&f.jsx(bme,{})]});case"panel":return f.jsxs(Ee,{"data-testid":`${d}.${r}`,type:"menu",title:w,disabled:n,onClick:()=>a(d),children:[f.jsx(dn,{children:x}),o&&f.jsx(We,{icon:o})]});case"small-icons":case"icons":return f.jsx(Ee,{"data-testid":`${d}.${r}`,type:"icon",title:w,disabled:n,onClick:()=>a(d),children:f.jsx(We,{icon:o,small:u==="small-icons"})});case"keyboard-shortcuts":return i?f.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${d}.${r}`,children:[f.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:x}),f.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:f.jsx(Rf,{visibleOnMobileLayout:!0,children:i})})]}):(console.warn(`Menu item '${s}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return f.jsxs(Ee,{type:"low",onClick:()=>a(d),children:[f.jsx(We,{icon:o}),f.jsx(dn,{children:x})]});case"toolbar":return f.jsx(Ee,{type:"tool","data-testid":`tools.${r}`,"aria-label":S,"data-value":r,onClick:()=>a("toolbar"),title:w,onTouchStart:O=>{tt(O),a("toolbar")},role:"radio","aria-checked":c?"true":"false",children:f.jsx(We,{icon:o})});case"toolbar-overflow":return f.jsx(bp,{"aria-label":s,children:f.jsx(Ee,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${r}`,title:w,role:"radio","aria-checked":c?"true":"false","data-value":r,children:f.jsx(We,{icon:o})})});default:throw Vn(u)}}function e1e(){return f.jsxs(f.Fragment,{children:[f.jsx(t1e,{}),f.jsx(n1e,{}),f.jsx(r1e,{}),f.jsx(i1e,{}),f.jsx(s1e,{}),f.jsx(l1e,{}),f.jsx(c1e,{}),f.jsx(u1e,{})]})}function t1e(){const n=Ce(),e=zr(2),t=za(),r=e&&t;return f.jsxs(f.Fragment,{children:[f.jsx(Z,{...n["align-left"],disabled:!r}),f.jsx(Z,{...n["align-center-horizontal"],disabled:!r}),f.jsx(Z,{...n["align-right"],disabled:!r}),f.jsx(Z,{...n["stretch-horizontal"],disabled:!r}),f.jsx(Z,{...n["align-top"],disabled:!r}),f.jsx(Z,{...n["align-center-vertical"],disabled:!r}),f.jsx(Z,{...n["align-bottom"],disabled:!r}),f.jsx(Z,{...n["stretch-vertical"],disabled:!r})]})}function n1e(){const n=Ce(),e=zr(3),t=za(),r=e&&t;return f.jsxs(f.Fragment,{children:[f.jsx(Z,{...n["distribute-horizontal"],disabled:!r}),f.jsx(Z,{...n["distribute-vertical"],disabled:!r})]})}function r1e(){const n=Ce(),e=sN(),t=za(),r=e&&t;return f.jsxs(f.Fragment,{children:[f.jsx(Z,{...n["stack-horizontal"],disabled:!r}),f.jsx(Z,{...n["stack-vertical"],disabled:!r})]})}function i1e(){const n=Ce(),e=zr(1),t=za(),r=e&&t;return f.jsxs(f.Fragment,{children:[f.jsx(Z,{...n["send-to-back"],disabled:!r}),f.jsx(Z,{...n["send-backward"],disabled:!r}),f.jsx(Z,{...n["bring-forward"],disabled:!r}),f.jsx(Z,{...n["bring-to-front"],disabled:!r})]})}function s1e(){return Lr()<sn.TABLET_SM?f.jsx(o1e,{}):f.jsx(a1e,{})}function o1e(){const n=Ce(),e=G(),t=ee("zoom is 1",()=>e.getZoomLevel()===1,[e]);return f.jsx(Z,{...n["zoom-to-100"],disabled:t})}function a1e(){const n=Ce(),e=zr(1),t=za(),r=e&&t;return f.jsx(Z,{...n["rotate-ccw"],disabled:!r})}function l1e(){const n=Ce(),e=zr(1),t=za(),r=e&&t;return f.jsx(Z,{...n["rotate-cw"],disabled:!r})}function c1e(){const n=Ce(),e=cN(),t=za(),r=e&&t;return f.jsx(Z,{...n["edit-link"],disabled:!r})}function u1e(){const n=oN(),e=aN();return n?f.jsx(JT,{}):e?f.jsx(d1e,{}):f.jsx(JT,{})}function JT(){const n=Ce(),e=zr(2),t=za(),r=e&&t;return f.jsx(Z,{...n.group,disabled:!r})}function d1e(){const n=Ce();return f.jsx(Z,{...n.ungroup})}const h1e=k.memo(function({children:e}){const t=Xe(),r=Lr(),i=Da(),s=G(),o=ee("should display quick actions when in readonly",()=>s.isInAny("hand","zoom"),[s]),a=e??f.jsx(e1e,{});if(!(i&&!o))return f.jsxs(HO,{id:"actions-menu",children:[f.jsx(QO,{children:f.jsx(Ee,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:f.jsx(We,{icon:"dots-vertical",small:!0})})}),f.jsx(qO,{side:r>=sn.TABLET?"bottom":"top",sideOffset:6,children:f.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:f.jsx(ss,{type:"icons",sourceId:"actions-menu",children:a})})})]})});function li({id:n,kbd:e,label:t,readonlyOk:r,onSelect:i,toggle:s=!1,disabled:o=!1,checked:a=!1}){const{type:l,sourceId:c}=uS(),u=Da(),d=Xe();if(u&&!r)return null;const h=yp(t,l),p=h?d(h):void 0;switch(l){case"menu":return f.jsxs(Wme,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:p,onSelect:g=>{i==null||i(c),tt(g)},disabled:o,checked:a,children:[f.jsx(To,{small:!0,icon:s?a?"toggle-on":"toggle-off":a?"check":"none"}),p&&f.jsx("span",{className:"tlui-button__label",draggable:!1,children:p}),e&&f.jsx(Rf,{children:e})]});case"context-menu":return f.jsxs(Sme,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:p,onSelect:g=>{i(c),tt(g)},disabled:o,checked:a,children:[f.jsx(To,{small:!0,icon:s?a?"toggle-on":"toggle-off":a?"check":"none"}),p&&f.jsx("span",{className:"tlui-button__label",draggable:!1,children:p}),e&&f.jsx(Rf,{children:e})]},n);default:return null}}function $e({id:n,label:e,children:t}){const{type:r,sourceId:i}=uS(),s=Xe(),o=yp(e,r),a=o?s(o):void 0;switch(r){case"panel":return f.jsx("div",{className:"tlui-menu__group","data-testid":`${i}-group.${n}`,children:t});case"menu":return f.jsx(Jme,{"data-testid":`${i}-group.${n}`,children:t});case"context-menu":return f.jsx(u$,{dir:"ltr",className:"tlui-menu__group","data-testid":`${i}-group.${n}`,children:t});case"keyboard-shortcuts":return f.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${i}-group.${n}`,children:[f.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),f.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:t})]});default:return t}}function Nr({id:n,disabled:e=!1,label:t,size:r="small",children:i}){const{type:s,sourceId:o}=uS(),a=Nn(),l=Xe(),c=t?typeof t=="string"?t:t[s]??t.default:void 0,u=c?l(c):void 0;switch(s){case"menu":return f.jsxs(Kme,{id:`${o}-sub.${n}`,children:[f.jsx(Yme,{id:`${o}-sub.${u?u.toLowerCase()+"-button":""}`,disabled:e,label:u,title:u}),f.jsx(Zme,{id:`${o}-sub.${u?u.toLowerCase()+"-content":""}`,size:r,children:i})]});case"context-menu":return e?null:f.jsxs(f1e,{id:`${o}-sub.${n}`,children:[f.jsx(p$,{dir:"ltr",disabled:e,asChild:!0,children:f.jsxs(Ee,{"data-testid":`${o}-sub-trigger.${n}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[f.jsx(dn,{children:u}),f.jsx(We,{icon:"chevron-right",small:!0})]})}),f.jsx(n7,{container:a,children:f.jsx(g$,{"data-testid":`${o}-sub-content.${n}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:i})})]});default:return i}}function f1e({id:n,children:e}){const[t,r]=La(n);return f.jsx(f$,{open:t,onOpenChange:r,children:e})}function M$(){const n=Ce();return age()?f.jsx(Z,{...n["toggle-auto-size"]}):null}function A$(){const n=Ce();return cN()?f.jsx(Z,{...n["edit-link"]}):null}function p1e(){const n=Ce();return zr(1)?f.jsx(Z,{...n.duplicate}):null}function _$(){const n=Ce(),e=G();return ee("should display flatten option",()=>{if(e.getSelectedShapeIds().length===0)return!1;const i=e.getOnlySelectedShape();return!(i&&e.isShapeOfType(i,"image"))},[e])?f.jsx(Z,{...n["flatten-to-image"]}):null}function R$(){const n=Ce();return oN()?f.jsx(Z,{...n.group}):null}function D$(){const n=Ce();return aN()?f.jsx(Z,{...n.ungroup}):null}function j$(){const n=G(),e=Ce();return ee("allow unframe",()=>{const r=n.getSelectedShapes();return r.length===0?!1:r.every(i=>n.isShapeOfType(i,"frame"))},[n])?f.jsx(Z,{...e["remove-frame"]}):null}function L$(){const n=G(),e=Ce();return ee("allow fit frame to content",()=>{const r=n.getOnlySelectedShape();return r?n.isShapeOfType(r,"frame")&&n.getSortedChildIdsForParent(r).length>0:!1},[n])?f.jsx(Z,{...e["fit-frame-to-content"]}):null}function z$(){const n=G(),e=Ce();return ee("selected shapes",()=>n.getSelectedShapes().length>0,[n])?f.jsx(Z,{...e["toggle-lock"]}):null}function a7(){const n=Ce(),e=G(),t=ee("isTransparentBg",()=>!e.getInstanceState().exportBackground,[e]);return f.jsx(li,{...n["toggle-transparent"],checked:t,toggle:!0})}function g1e(){const n=G(),e=Ce(),t=ee("any shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return f.jsx(Z,{...e["unlock-all"],disabled:!t})}function N$(){const n=G(),e=ee("zoomed to 100",()=>n.getZoomLevel()===1,[n]),t=Ce();return f.jsx(Z,{...t["zoom-to-100"],noClose:!0,disabled:e})}function $$(){const n=G(),e=ee("has shapes",()=>n.getCurrentPageShapeIds().size>0,[n]),t=Ce();return f.jsx(Z,{...t["zoom-to-fit"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function F$(){const n=G(),e=ee("has shapes",()=>n.getSelectedShapeIds().length>0,[n]),t=Ce();return f.jsx(Z,{...t["zoom-to-selection"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function B$(){return f.jsxs($e,{id:"clipboard",children:[f.jsx(y1e,{}),f.jsx(v1e,{}),f.jsx(S1e,{}),f.jsx(p1e,{}),f.jsx(x1e,{})]})}function m1e(){var r;const n=G(),e=Ce(),t=ee("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return f.jsxs(Nr,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!t,children:[f.jsxs($e,{id:"copy-as-group",children:[f.jsx(Z,{...e["copy-as-svg"]}),!!((r=window.navigator.clipboard)!=null&&r.write)&&f.jsx(Z,{...e["copy-as-png"]}),f.jsx(Z,{...e["copy-as-json"]})]}),f.jsx($e,{id:"copy-as-bg",children:f.jsx(a7,{})})]})}function y1e(){const n=Ce(),e=zr(1);return f.jsx(Z,{...n.cut,disabled:!e})}function v1e(){const n=Ce(),e=lN(1);return f.jsx(Z,{...n.copy,disabled:!e})}function S1e(){const n=Ce(),e=oge;return f.jsx(Z,{...n.paste,disabled:!e})}function U$(){const n=G(),e=Ce();return ee("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n])?f.jsxs($e,{id:"conversions",children:[f.jsx(m1e,{}),f.jsxs(Nr,{id:"export-as",label:"context-menu.export-as",size:"small",children:[f.jsxs($e,{id:"export-as-group",children:[f.jsx(Z,{...e["export-as-svg"]}),f.jsx(Z,{...e["export-as-png"]}),f.jsx(Z,{...e["export-as-json"]})]}),f.jsx($e,{id:"export-as-bg",children:f.jsx(a7,{})})]})]}):null}function H$(){const n=Ce(),e=G(),t=ee("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e]);return f.jsx(Z,{...n["select-all"],disabled:!t})}function x1e(){const n=Ce(),e=zr(1);return f.jsx(Z,{...n.delete,disabled:!e})}function w1e(){return lN(1)?f.jsxs(Nr,{id:"edit",label:"context-menu.edit",size:"small",children:[f.jsx(R$,{}),f.jsx(D$,{}),f.jsx(_$,{}),f.jsx(A$,{}),f.jsx(L$,{}),f.jsx(j$,{}),f.jsx(q$,{}),f.jsx(Q$,{}),f.jsx(M$,{}),f.jsx(z$,{})]}):null}function b1e(){const n=zr(2),e=lge(),t=Ce();return n||e?f.jsxs(Nr,{id:"arrange",label:"context-menu.arrange",size:"small",children:[n&&f.jsxs($e,{id:"align",children:[f.jsx(Z,{...t["align-left"]}),f.jsx(Z,{...t["align-center-horizontal"]}),f.jsx(Z,{...t["align-right"]}),f.jsx(Z,{...t["align-top"]}),f.jsx(Z,{...t["align-center-vertical"]}),f.jsx(Z,{...t["align-bottom"]})]}),f.jsx(O1e,{}),n&&f.jsxs($e,{id:"stretch",children:[f.jsx(Z,{...t["stretch-horizontal"]}),f.jsx(Z,{...t["stretch-vertical"]})]}),(n||e)&&f.jsxs($e,{id:"flip",children:[f.jsx(Z,{...t["flip-horizontal"]}),f.jsx(Z,{...t["flip-vertical"]})]}),f.jsx(k1e,{})]}):null}function O1e(){const n=Ce();return zr(3)?f.jsxs($e,{id:"distribute",children:[f.jsx(Z,{...n["distribute-horizontal"]}),f.jsx(Z,{...n["distribute-vertical"]})]}):null}function k1e(){const n=Ce(),e=zr(2),t=sN();return e?f.jsxs($e,{id:"order",children:[f.jsx(Z,{...n.pack}),t&&f.jsx(Z,{...n["stack-horizontal"]}),t&&f.jsx(Z,{...n["stack-vertical"]})]}):null}function C1e(){const n=Ce();return zr(1)?f.jsx(Nr,{id:"reorder",label:"context-menu.reorder",size:"small",children:f.jsxs($e,{id:"reorder",children:[f.jsx(Z,{...n["bring-to-front"]}),f.jsx(Z,{...n["bring-forward"]}),f.jsx(Z,{...n["send-backward"]}),f.jsx(Z,{...n["send-to-back"]})]})}):null}function P1e(){const n=G(),e=ee("pages",()=>n.getPages(),[n]),t=ee("current page id",()=>n.getCurrentPageId(),[n]),{addToast:r}=Fs(),i=Ce(),s=tr();return zr(1)?f.jsxs(Nr,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[f.jsx($e,{id:"pages",children:e.map(a=>f.jsx(Z,{id:a.id,disabled:t===a.id,label:a.name,onSelect:()=>{n.mark("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),a.id);const l=n.getPage(a.id);l&&r({title:"Changed Page",description:`Moved to ${l.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.mark("change-page"),n.setCurrentPage(t)}}]}),s("move-to-page",{source:"context-menu"})}},a.id))}),f.jsx($e,{id:"new-page",children:f.jsx(Z,{...i["move-to-new-page"]})})]}):null}function Q$(){const n=G(),e=Ce();return ee("oneEmbedSelected",()=>{const r=n.getOnlySelectedShape();return r?!!(n.isShapeOfType(r,"embed")&&r.props.url&&!n.isShapeOrAncestorLocked(r)):!1},[n])?f.jsx(Z,{...e["convert-to-bookmark"]}):null}function q$(){const n=G(),e=Ce();return ee("oneEmbeddableBookmarkSelected",()=>{const r=n.getOnlySelectedShape();return r?!!(n.isShapeOfType(r,"bookmark")&&r.props.url&&cl(r.props.url)&&!n.isShapeOrAncestorLocked(r)):!1},[n])?f.jsx(Z,{...e["convert-to-embed"]}):null}function T1e(){const n=Ce(),e=G(),t=ee("isSnapMode",()=>e.user.getIsSnapMode(),[e]);return f.jsx(li,{...n["toggle-snap-mode"],checked:t})}function E1e(){const n=Ce(),e=G(),t=ee("isToolLock",()=>e.getInstanceState().isToolLocked,[e]);return f.jsx(li,{...n["toggle-tool-lock"],checked:t})}function I1e(){const n=Ce(),e=G(),t=ee("isGridMode",()=>e.getInstanceState().isGridMode,[e]);return f.jsx(li,{...n["toggle-grid"],checked:t})}function M1e(){const n=Ce(),e=G(),t=ee("isWrapMode",()=>e.user.getIsWrapMode(),[e]);return f.jsx(li,{...n["toggle-wrap-mode"],checked:t})}function A1e(){const n=Ce(),e=G(),t=ee("isFocusMode",()=>e.getInstanceState().isFocusMode,[e]);return f.jsx(li,{...n["toggle-focus-mode"],checked:t})}function _1e(){const n=Ce(),e=G(),t=ee("edgeScrollSpeed",()=>e.user.getEdgeScrollSpeed(),[e]);return f.jsx(li,{...n["toggle-edge-scrolling"],checked:t===1})}function R1e(){const n=Ce(),e=G(),t=ee("animationSpeed",()=>e.user.getAnimationSpeed(),[e]);return f.jsx(li,{...n["toggle-reduce-motion"],checked:t===0})}function D1e(){const n=Ce(),e=G(),t=ee("isDebugMode",()=>e.getInstanceState().isDebugMode,[e]);return f.jsx(li,{...n["toggle-debug-mode"],checked:t})}function j1e(){const n=Ce(),e=G(),t=ee("dynamic resize",()=>e.user.getIsDynamicResizeMode(),[e]);return f.jsx(li,{...n["toggle-dynamic-size-mode"],checked:t})}function L1e(){const n=Ce(),e=G(),t=ee("paste at cursor",()=>e.user.getIsPasteAtCursorMode(),[e]);return f.jsx(li,{...n["toggle-paste-at-cursor"],checked:t})}function z1e(){const n=G(),e=Ce();return ee("show cursor chat",()=>n.getCurrentToolId()==="select"&&!n.getInstanceState().isCoarsePointer,[n])?f.jsx(Z,{...e["open-cursor-chat"]}):null}function N1e(){const n=G(),e=oS();return ee("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n])?f.jsxs(f.Fragment,{children:[e&&f.jsx(z1e,{}),f.jsxs($e,{id:"modify",children:[f.jsx(w1e,{}),f.jsx(b1e,{}),f.jsx(C1e,{}),f.jsx(P1e,{})]}),f.jsx(B$,{}),f.jsx(U$,{}),f.jsx($e,{id:"select-all",children:f.jsx(H$,{})})]}):null}const $1e=k.memo(function({children:e}){const t=G(),{Canvas:r}=Qt(),i=k.useCallback(c=>{if(c){if(t.getInstanceState().isCoarsePointer){const u=t.getSelectedShapes(),{inputs:{currentPagePoint:d}}=t,h=t.getShapesAtPoint(d);if(!t.getSelectedShapes().length||!h.some(p=>u.includes(p))){const p=h.filter(g=>t.isShapeOrAncestorLocked(g));p.length&&t.select(...p.map(g=>g.id))}}}else{const u=t.getOnlySelectedShape();u&&t.isShapeOrAncestorLocked(u)&&t.setSelectedShapes([])}},[t]),s=Nn(),[o,a]=La("context menu",i),l=e??f.jsx(N1e,{});return f.jsxs(gme,{dir:"ltr",onOpenChange:a,modal:!1,children:[f.jsx(mme,{onContextMenu:void 0,dir:"ltr",children:r?f.jsx(r,{}):null}),o&&f.jsx(yme,{container:s,children:f.jsx(vme,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:tt,children:f.jsx(ss,{type:"context-menu",sourceId:"context-menu",children:l})})})]})}),F1e=2e3,B1e=5e3,U1e=zn(function(){const e=G(),{isChatting:t,chatMessage:r}=e.getInstanceState(),i=k.useRef(-1),[s,o]=k.useState("");return k.useEffect(()=>{if(!t&&r||t){const l=t?B1e:F1e;i.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},l)}return()=>{clearTimeout(i.current)}},[e,r,t]),t?f.jsx(Q1e,{value:s,setValue:o,chatMessage:r}):r.trim()?f.jsx(H1e,{chatMessage:r}):null});function W$(n){const e=G();k.useLayoutEffect(()=>{var o;if(!n.current)return;const{x:r,y:i}=e.inputs.currentScreenPoint;(o=n.current)==null||o.style.setProperty("transform",`translate(${r}px, ${i}px)`);function s(a){var u;const{minX:l,minY:c}=e.getViewportScreenBounds();(u=n.current)==null||u.style.setProperty("transform",`translate(${a.clientX-l}px, ${a.clientY-c}px)`)}return window.addEventListener("pointermove",s),()=>{window.removeEventListener("pointermove",s)}},[n,e])}const H1e=({chatMessage:n})=>{const e=G(),t=k.useRef(null);return W$(t),f.jsx("div",{ref:t,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:n})},Q1e=zn(function({chatMessage:e,value:t,setValue:r}){const i=G(),s=Xe(),o=k.useRef(null),a=e||s("cursor-chat.type-to-chat");W$(o),k.useLayoutEffect(()=>{const h=o.current;if(!h)return;const p=i.textMeasure.measureText(t||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});h.style.setProperty("width",p.w+"px")},[i,t,a]),k.useLayoutEffect(()=>{const h=i.timers.requestAnimationFrame(()=>{var p;(p=o.current)==null||p.focus()});return()=>{cancelAnimationFrame(h)}},[i]);const l=k.useCallback(()=>{i.updateInstanceState({isChatting:!1}),i.focus()},[i]),c=k.useCallback(h=>{const{value:p}=h.target;r(p.slice(0,64)),i.updateInstanceState({chatMessage:p})},[i,r]),u=k.useCallback(h=>{const p=o.current;if(!p)return;const{value:g}=p;switch(h.key){case"Enter":{if(tt(h),h.stopPropagation(),!g){l();return}r("");break}case"Escape":{tt(h),h.stopPropagation(),l();break}}},[l,r]),d=k.useCallback(h=>{h.stopPropagation()},[]);return f.jsx("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:i.user.getColor()},onBlur:l,onChange:c,onKeyDown:u,onPaste:d,value:t,placeholder:a,spellCheck:!1})});function F4({checked:n}){return f.jsx(To,{icon:n?"check":"none",className:"tlui-button__icon",small:!0})}function q1e(){const n=G(),{addToast:e}=Fs(),{addDialog:t}=cu(),[r,i]=Qe.useState(!1);return f.jsxs(f.Fragment,{children:[f.jsxs($e,{id:"items",children:[f.jsx(Z,{id:"add-toast",onSelect:()=>{e({id:wt(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:wt(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:wt(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:wt(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),f.jsx(Z,{id:"show-dialog",label:"Show dialog",onSelect:()=>{t({component:({onClose:s})=>f.jsx(G1e,{displayDontShowAgain:!0,onCancel:()=>s(),onContinue:()=>s()}),onClose:()=>{}})}}),f.jsx(Z,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>X1e(n,100)}),f.jsx(Z,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var a;const s=n.getSelectedShapes(),o=s.length===0?n.getRenderingShapes():s;window.alert(`Shapes ${o.length}, DOM nodes:${(a=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:a.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),f.jsx(Z,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"}),f.jsx(Z,{id:"hard-reset",onSelect:DD,label:"Hard reset"})]}),f.jsxs($e,{id:"flags",children:[f.jsx(W1e,{}),f.jsx(V1e,{})]})]})}function W1e(){const n=Object.values(un);return n.length?f.jsx(Nr,{id:"debug flags",label:"Debug Flags",children:f.jsx($e,{id:"debug flags",children:n.map(e=>f.jsx(V$,{flag:e},e.name))})}):null}function V1e(){const n=Object.values(C6);return n.length?f.jsx(Nr,{id:"feature flags",label:"Feature Flags",children:f.jsx($e,{id:"feature flags",children:n.map(e=>f.jsx(V$,{flag:e},e.name))})}):null}function G1e({title:n="title",body:e="hello hello hello",cancel:t="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:s,onContinue:o}){const[a,l]=Qe.useState(!1);return f.jsxs(f.Fragment,{children:[f.jsxs(nS,{children:[f.jsx(rS,{children:n}),f.jsx(iS,{})]}),f.jsx(mp,{style:{maxWidth:350},children:e}),f.jsxs(CO,{className:"tlui-dialog__footer__actions",children:[i&&f.jsxs(Ee,{type:"normal",onClick:()=>l(!a),style:{marginRight:"auto"},children:[f.jsx(F4,{checked:a}),f.jsx(dn,{children:"Dont show again"})]}),f.jsx(Ee,{type:"normal",onClick:s,children:f.jsx(dn,{children:t})}),f.jsx(Ee,{type:"primary",onClick:async()=>o(),children:f.jsx(dn,{children:r})})]})]})}const V$=zn(function({flag:e,onChange:t}){const r=e.get();return f.jsx(li,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,i=>`${i[0]} ${i[1].toLowerCase()}`).replace(/^[a-z]/,i=>i.toUpperCase()),checked:r,onSelect:()=>{e.set(!r),t==null||t(!r)}})});let e9=0;function X1e(n,e){const t=Array(e),r=Math.floor(Math.sqrt(e));for(let i=0;i<e;i++)e9++,t[i]={id:mt("box"+e9),type:"geo",x:i%r*132,y:Math.floor(i/r)*132};n.run(()=>{n.createShapes(t).setSelectedShapes(t.map(i=>i.id))})}function K1e({children:n}){const e=n??f.jsx(q1e,{});return f.jsxs(Gc,{id:"debug",children:[f.jsx(Xc,{children:f.jsx(Ee,{type:"icon",title:"Debug menu",children:f.jsx(We,{icon:"dots-horizontal"})})}),f.jsx(Kc,{side:"top",align:"end",alignOffset:0,children:f.jsx(ss,{type:"menu",sourceId:"debug-panel",children:e})})]})}const Y1e=k.memo(function(){const{DebugMenu:e}=tc();return f.jsxs("div",{className:"tlui-debug-panel",children:[f.jsx(J1e,{}),f.jsx(eye,{}),e&&f.jsx(e,{})]})});function Z1e(n=!0){const[e,t]=k.useState(0),r=G();k.useEffect(()=>{if(!n)return;const i=()=>t(s=>s+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,n])}const J1e=zn(function(){Z1e();const e=G(),t=e.getPath(),r=e.getHoveredShape(),i=e.getOnlySelectedShape(),s=t==="select.idle"||!t.includes("select.")?r:i,o=s&&t.includes("select.")?` / ${s.type||""}${"geo"in s.props?" / "+s.props.geo:""} / [${b.ToInt(e.getPointInShapeSpace(s,e.inputs.currentPagePoint))}]`:"",a=t.startsWith("select.")&&!t.includes(".idle")?` / [${b.ToInt(e.inputs.originPagePoint)}]  [${b.ToInt(e.inputs.currentPagePoint)}] = ${b.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return f.jsx("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${a}`})});function eye(){const n=G(),e=ee("show_fps",()=>un.showFps.get(),[un]),t=k.useRef(null);return k.useEffect(()=>{if(!e)return;const r=250;let i=0,s=-1,o=performance.now(),a=0,l=0,c=!1;function u(){if(l++,a=performance.now()-o,a>r){const d=Math.round(l*(r/a)*(1e3/r));d>i&&(i=d);const h=i*.75;(d<h&&!c||d>=h&&c)&&(c=!c),t.current.innerHTML=`FPS ${d.toString()}`,t.current.className="tlui-debug-panel__fps"+(c?" tlui-debug-panel__fps__slow":""),a-=r,l=0,o=performance.now()}s=n.timers.requestAnimationFrame(u)}return u(),()=>{cancelAnimationFrame(s)}},[e,n]),e?f.jsx("div",{ref:t}):null}const tye=k.memo(function(){const e=Lr(),{MainMenu:t,QuickActions:r,ActionsMenu:i,PageMenu:s}=tc();return!t&&!s&&e<6?null:f.jsx("div",{className:"tlui-menu-zone",children:f.jsxs("div",{className:"tlui-buttons__horizontal",children:[t&&f.jsx(t,{}),s&&f.jsx(s,{}),e<6?null:f.jsxs(f.Fragment,{children:[r&&f.jsx(r,{}),i&&f.jsx(i,{})]})]})})});function nye(){const n=G(),e=Ce(),[t,r]=k.useState(!1),i=k.useRef(!1);return bl("toggle showback to content",()=>{const s=i.current,o=n.getCurrentPageShapeIds();let a=!1;o.size&&(a=o.size===n.getCulledShapes().size),s!==a&&(r(a),i.current=a)},[n]),t?f.jsx(Z,{...e["back-to-content"],onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function rye(){const n=G(),e=Ce();return ee("is pen mode",()=>n.getInstanceState().isPenMode,[n])?f.jsx(Z,{...e["exit-pen-mode"]}):null}function iye(){const n=G(),e=Ce();return ee("is following user",()=>!!n.getInstanceState().followingUserId,[n])?f.jsx(Z,{...e["stop-following"]}):null}function sye(){return f.jsxs(f.Fragment,{children:[f.jsx(rye,{}),f.jsx(nye,{}),f.jsx(iye,{})]})}function oye({children:n}){const e=n??f.jsx(sye,{});return f.jsx("div",{className:"tlui-helper-buttons",children:f.jsx(ss,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function G$(){const n=Ce(),e=Rd(),t=oS();return f.jsxs(f.Fragment,{children:[f.jsxs($e,{label:"shortcuts-dialog.tools",id:"tools",children:[f.jsx(Z,{...n["toggle-tool-lock"]}),f.jsx(Z,{...n["insert-media"]}),f.jsx(Z,{...e.select}),f.jsx(Z,{...e.draw}),f.jsx(Z,{...e.eraser}),f.jsx(Z,{...e.hand}),f.jsx(Z,{...e.rectangle}),f.jsx(Z,{...e.ellipse}),f.jsx(Z,{...e.arrow}),f.jsx(Z,{...e.line}),f.jsx(Z,{...e.text}),f.jsx(Z,{...e.frame}),f.jsx(Z,{...e.note}),f.jsx(Z,{...e.laser})]}),f.jsxs($e,{label:"shortcuts-dialog.preferences",id:"preferences",children:[f.jsx(Z,{...n["toggle-dark-mode"]}),f.jsx(Z,{...n["toggle-focus-mode"]}),f.jsx(Z,{...n["toggle-grid"]})]}),f.jsxs($e,{label:"shortcuts-dialog.edit",id:"edit",children:[f.jsx(Z,{...n.undo}),f.jsx(Z,{...n.redo}),f.jsx(Z,{...n.cut}),f.jsx(Z,{...n.copy}),f.jsx(Z,{...n.paste}),f.jsx(Z,{...n["select-all"]}),f.jsx(Z,{...n.delete}),f.jsx(Z,{...n.duplicate})]}),f.jsxs($e,{label:"shortcuts-dialog.view",id:"view",children:[f.jsx(Z,{...n["zoom-in"]}),f.jsx(Z,{...n["zoom-out"]}),f.jsx(Z,{...n["zoom-to-100"]}),f.jsx(Z,{...n["zoom-to-fit"]}),f.jsx(Z,{...n["zoom-to-selection"]})]}),f.jsxs($e,{label:"shortcuts-dialog.transform",id:"transform",children:[f.jsx(Z,{...n["bring-to-front"]}),f.jsx(Z,{...n["bring-forward"]}),f.jsx(Z,{...n["send-backward"]}),f.jsx(Z,{...n["send-to-back"]}),f.jsx(Z,{...n.group}),f.jsx(Z,{...n.ungroup}),f.jsx(Z,{...n["flip-horizontal"]}),f.jsx(Z,{...n["flip-vertical"]}),f.jsx(Z,{...n["align-top"]}),f.jsx(Z,{...n["align-center-vertical"]}),f.jsx(Z,{...n["align-bottom"]}),f.jsx(Z,{...n["align-left"]}),f.jsx(Z,{...n["align-center-horizontal"]}),f.jsx(Z,{...n["align-right"]})]}),t&&f.jsx($e,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:f.jsx(Z,{...n["open-cursor-chat"]})})]})}const X$=k.memo(function({children:e}){const t=Xe(),r=Lr(),i=e??f.jsx(G$,{});return f.jsxs(f.Fragment,{children:[f.jsxs(nS,{className:"tlui-shortcuts-dialog__header",children:[f.jsx(rS,{children:t("shortcuts-dialog.title")}),f.jsx(iS,{})]}),f.jsx(mp,{className:Te("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":r<=sn.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":r<=sn.TABLET}),children:f.jsx(ss,{type:"keyboard-shortcuts",sourceId:"kbd",children:i})}),f.jsx("div",{className:"tlui-dialog__scrim"})]})}),aye=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function lye(){const n=G(),e=tr(),t=ee("colorScheme",()=>n.user.getUserPreferences().colorScheme??n.user.getIsDarkMode()?"dark":"light",[n]);return f.jsx(Nr,{id:"help menu color-scheme",label:"menu.theme",children:f.jsx($e,{id:"languages",children:aye.map(({colorScheme:r,label:i})=>f.jsx(li,{id:`color-scheme-${r}`,label:i,checked:r===t,onSelect:()=>{n.user.updateUserPreferences({colorScheme:r}),e("color-scheme",{source:"menu",value:r})}},r))})})}function K$(){const n=G(),e=tr(),t=ee("locale",()=>n.user.getLocale(),[n]);return f.jsx(Nr,{id:"help menu language",label:"menu.language",children:f.jsx($e,{id:"languages",children:hp.map(({locale:r,label:i})=>f.jsx(li,{id:`language-${r}`,title:r,label:i,checked:r===t,onSelect:()=>{n.user.updateUserPreferences({locale:r}),e("change-language",{source:"menu",locale:r})}},r))})})}function cye(){return f.jsxs(f.Fragment,{children:[f.jsx(K$,{}),f.jsx(Y$,{})]})}function Y$(){const{KeyboardShortcutsDialog:n}=tc(),{addDialog:e}=cu();return n?f.jsx(Z,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{e({component:n})}}):null}function Z$(){return f.jsxs(f.Fragment,{children:[f.jsx(dye,{}),f.jsx(gye,{}),f.jsx(uye,{}),f.jsx(mye,{}),f.jsx(vye,{}),f.jsx(yye,{})]})}function uye(){const n=Ce();return f.jsxs(Nr,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[f.jsxs($e,{id:"export-all-as-group",children:[f.jsx(Z,{...n["export-all-as-svg"]}),f.jsx(Z,{...n["export-all-as-png"]}),f.jsx(Z,{...n["export-all-as-json"]})]}),f.jsx($e,{id:"export-all-as-bg",children:f.jsx(a7,{})})]})}function dye(){const n=G(),e=ee("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]);return f.jsxs(Nr,{id:"edit",label:"menu.edit",disabled:!e,children:[f.jsx(pye,{}),f.jsx(B$,{}),f.jsx(U$,{}),f.jsx(hye,{}),f.jsx(fye,{}),f.jsx($e,{id:"select-all",children:f.jsx(H$,{})})]})}function hye(){return f.jsxs($e,{id:"misc",children:[f.jsx(R$,{}),f.jsx(D$,{}),f.jsx(A$,{}),f.jsx(M$,{}),f.jsx(j$,{}),f.jsx(L$,{}),f.jsx(q$,{}),f.jsx(Q$,{}),f.jsx(_$,{})]})}function fye(){return f.jsxs($e,{id:"lock",children:[f.jsx(z$,{}),f.jsx(g1e,{})]})}function pye(){const n=Ce(),e=dN(),t=uN();return f.jsxs($e,{id:"undo-redo",children:[f.jsx(Z,{...n.undo,disabled:!e}),f.jsx(Z,{...n.redo,disabled:!t})]})}function gye(){const n=Ce();return f.jsx(Nr,{id:"view",label:"menu.view",children:f.jsxs($e,{id:"view-actions",children:[f.jsx(Z,{...n["zoom-in"]}),f.jsx(Z,{...n["zoom-out"]}),f.jsx(N$,{}),f.jsx($$,{}),f.jsx(F$,{})]})})}function mye(){const n=Ce();return f.jsxs($e,{id:"extras",children:[f.jsx(Z,{...n["insert-embed"]}),f.jsx(Z,{...n["insert-media"]})]})}function yye(){function n(e){window.open(e,"_blank")}return f.jsx($e,{id:"help",children:f.jsx(Nr,{id:"help",label:"menu.help",children:f.jsxs($e,{id:"help-actions",children:[f.jsx(Y$,{}),f.jsx(Z,{id:"about",label:"help-menu.docs",icon:"external-link",readonlyOk:!0,onSelect:()=>{n("https://tldraw.dev")}})]})})})}function vye(){return f.jsx($e,{id:"preferences",children:f.jsxs(Nr,{id:"preferences",label:"menu.preferences",children:[f.jsxs($e,{id:"preferences-actions",children:[f.jsx(T1e,{}),f.jsx(E1e,{}),f.jsx(I1e,{}),f.jsx(M1e,{}),f.jsx(A1e,{}),f.jsx(_1e,{}),f.jsx(R1e,{}),f.jsx(j1e,{}),f.jsx(L1e,{}),f.jsx(D1e,{})]}),f.jsx($e,{id:"color-scheme",children:f.jsx(lye,{})}),f.jsx($e,{id:"language",children:f.jsx(K$,{})})]})})}const J$=k.memo(function({children:e}){const t=Nn(),[r,i]=La("main menu"),s=Xe(),o=e??f.jsx(Z$,{});return f.jsxs(i7,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[f.jsx(s7,{asChild:!0,dir:"ltr",children:f.jsx(Ee,{type:"icon","data-testid":"main-menu.button",title:s("menu.title"),children:f.jsx(We,{icon:"menu",small:!0})})}),f.jsx(pS,{container:t,children:f.jsx(o7,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:f.jsx(ss,{type:"menu",sourceId:"main-menu",children:o})})})]})}),E2={};function jh(n){if(E2[n])return E2[n];const t=document.createElement("canvas").getContext("2d");t.fillStyle=n,t.fillRect(0,0,1,1);const[r,i,s,o]=t.getImageData(0,0,1,1).data,a=new Float32Array([r/255,i/255,s/255,o/255]);return E2[n]=a,a}const r1=10,eF=4*6*r1+12+4*12;function Eu(n,{center:e,radius:t,numArcSegments:r=20,startAngle:i=0,endAngle:s=pt,offset:o=0}){const a=(s-i)/r;let l=o;for(let c=i;c<s;c+=a)n[l++]=e.x,n[l++]=e.y,n[l++]=e.x+Math.cos(c)*t,n[l++]=e.y+Math.sin(c)*t,n[l++]=e.x+Math.cos(c+a)*t,n[l++]=e.y+Math.sin(c+a)*t;return n}function Iu(n,e,t,r,i,s){n[e++]=t,n[e++]=r,n[e++]=t,n[e++]=r+s,n[e++]=t+i,n[e++]=r,n[e++]=t+i,n[e++]=r,n[e++]=t,n[e++]=r+s,n[e++]=t+i,n[e++]=r+s}function Sye(n,e,t){const r=r1;t=Math.min(t,Math.min(e.w,e.h)/2);const i=ye.ExpandBy(e,-t);if(i.w<=0||i.h<=0)return Eu(n,{center:e.center,radius:t,numArcSegments:r1*4}),r1*4*6;let s=0;return Iu(n,s,i.minX,i.minY,i.w,i.h),s+=12,Iu(n,s,i.minX,e.minY,i.w,t),s+=12,Iu(n,s,i.maxX,i.minY,t,i.h),s+=12,Iu(n,s,i.minX,i.maxY,i.w,t),s+=12,Iu(n,s,e.minX,i.minY,t,i.h),s+=12,Eu(n,{numArcSegments:r,offset:s,center:i.point,radius:t,startAngle:at,endAngle:at*1.5}),s+=r*6,Eu(n,{numArcSegments:r,offset:s,center:b.Add(i.point,new b(i.w,0)),radius:t,startAngle:at*1.5,endAngle:pt}),s+=r*6,Eu(n,{numArcSegments:r,offset:s,center:b.Add(i.point,i.size),radius:t,startAngle:0,endAngle:Mt}),s+=r*6,Eu(n,{numArcSegments:r,offset:s,center:b.Add(i.point,new b(0,i.h)),radius:t,startAngle:Mt,endAngle:at}),eF}function xye(n){if(!n)throw new Error("Canvas element not found");const e=n.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const t=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=e.createShader(e.VERTEX_SHADER);if(!r)throw new Error("Failed to create vertex shader");if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,s=e.createShader(e.FRAGMENT_SHADER);if(!s)throw new Error("Failed to create fragment shader");if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const o=e.createProgram();if(!o)throw new Error("Failed to create program");if(e.attachShader(o,r),e.attachShader(o,s),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(o);const a=e.getAttribLocation(o,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const l=e.getUniformLocation(o,"canvasPageBounds"),c=e.getUniformLocation(o,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:Ag(e,1024),unselectedShapes:Ag(e,4096),viewport:Ag(e,eF),collaborators:Ag(e,1024),prepareTriangles(h,p){e.bindBuffer(e.ARRAY_BUFFER,h.buffer),e.bufferData(e.ARRAY_BUFFER,h.vertices,e.STATIC_DRAW,0,p),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(h){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,h/2),e.disable(e.BLEND)},drawTriangles(h){e.drawArrays(e.TRIANGLES,0,h/2)},setFillColor(h){e.uniform4fv(c,h)},setCanvasPageBounds(h){e.uniform4fv(l,h)}}}function Ag(n,e){const t=n.createBuffer();if(!t)throw new Error("Failed to create buffer");return{buffer:t,vertices:new Float32Array(e)}}function t9(n,e,t){let r=n.vertices.length;for(;r<e+t.length;)r*=2;if(r!=n.vertices.length){const i=new Float32Array(r);i.set(n.vertices),n.vertices=i}n.vertices.set(t,e)}var wye=Object.defineProperty,bye=Object.getOwnPropertyDescriptor,ec=(n,e,t,r)=>{for(var i=bye(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&wye(e,t,i),i};class Na{constructor(e,t,r){v(this,"disposables",[]);v(this,"close",()=>this.disposables.forEach(e=>e()));v(this,"gl");v(this,"shapeGeometryCache");v(this,"colors");v(this,"id",wt());v(this,"canvasBoundingClientRect",mn("canvasBoundingClientRect",new ye));v(this,"originPagePoint",new b);v(this,"originPageCenter",new b);v(this,"isInViewport",!1);v(this,"getMinimapPagePoint",(e,t)=>{const r=this.getCanvasPageBounds(),i=this.getCanvasScreenBounds();let s=e-i.x,o=t-i.y;return s*=r.width/i.width,o*=r.height/i.height,s+=r.minX,o+=r.minY,new b(s,o,1)});v(this,"minimapScreenPointToPagePoint",(e,t,r=!1,i=!1)=>{const{editor:s}=this,o=s.getViewportPageBounds();let{x:a,y:l}=this.getMinimapPagePoint(e,t);if(i){const c=this.editor.getCurrentPageBounds()??new ye,u=c.minX-o.width/2,d=c.maxX+o.width/2,h=c.minY-o.height/2,p=c.maxY+o.height/2,g=Math.max(0,u+o.width-a),m=Math.max(0,-(d-o.width-a)),S=Math.max(0,h+o.height-l),y=Math.max(0,-(p-o.height-l));a+=(g-m)/2,l+=(S-y)/2,a=An(a,u,d),l=An(l,h,p)}if(r){const{originPagePoint:c}=this,u=Math.abs(a-c.x),d=Math.abs(l-c.y);u>d?l=c.y:a=c.x}return new b(a,l)});v(this,"render",()=>{const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const r=new Set(this.editor.getSelectedShapeIds()),i=this.colors;let s=0,o=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let l=0,c=a.length;l<c;l++){const u=a[l],d=this.shapeGeometryCache.get(u);if(!d)continue;const h=d.length;r.has(u)?(t9(this.gl.selectedShapes,s,d),s+=h):(t9(this.gl.unselectedShapes,o,d),o+=h)}this.drawShapes(this.gl.unselectedShapes,o,i.shapeFill),this.drawShapes(this.gl.selectedShapes,s,i.selectFill),this.drawViewport(),this.drawCollaborators()});this.editor=e,this.elem=t,this.container=r,this.gl=xye(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",i=>{const s=e.getShapeMaskedPageBounds(i.id);if(!s)return null;const o=new Float32Array(12);return Iu(o,0,s.x,s.y,s.w,s.h),o}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),Xl("minimap render",this.render))}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:jh(e.getPropertyValue("--color-text-3").trim()),selectFill:jh(e.getPropertyValue("--color-selected").trim()),viewportFill:jh(e.getPropertyValue("--color-muted-1").trim()),background:jh(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?ye.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),r=this.editor.pageToScreen(new b(e.maxX,e.maxY));return new ye(t.x,t.y,r.x-t.x,r.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:r,height:i}=this.elem.getBoundingClientRect();return new ye(e,t,r,i)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const t=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(t)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new b(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),r=e.width/e.height;let i=t.width,s=i/r;s<t.height&&(s=t.height,i=s*r);const o=new ye(0,0,i,s);return o.center=t.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:r,h:i}=this.getCanvasPageBounds();return new Float32Array([e,t,r,i])}drawShapes(e,t,r){this.gl.prepareTriangles(e,t),this.gl.setFillColor(r),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=Sye(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),this.editor.environment.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=20,r=t*6,i=r*e.length;this.gl.collaborators.vertices.length<i&&(this.gl.collaborators.vertices=new Float32Array(i));const s=this.gl.collaborators.vertices;let o=0;const a=this.getZoom();for(const{cursor:l}of e)Eu(s,{center:b.From(l),radius:3*a,offset:o,numArcSegments:t}),o+=r;this.gl.prepareTriangles(this.gl.collaborators,i),o=0;for(const{color:l}of e)this.gl.setFillColor(jh(l)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,o/2,r/2),o+=r}}ec([te],Na.prototype,"getDpr");ec([te],Na.prototype,"getContentPageBounds");ec([te],Na.prototype,"getContentScreenBounds");ec([te],Na.prototype,"getCanvasSize");ec([te],Na.prototype,"getCanvasClientPosition");ec([te],Na.prototype,"getCanvasPageBounds");ec([te],Na.prototype,"getZoom");ec([te],Na.prototype,"getCanvasPageBoundsArray");function Oye(){const n=G(),e=Nn(),t=k.useRef(null),r=k.useRef(!1),i=k.useRef();k.useEffect(()=>{try{const u=new Na(n,t.current,e);return i.current=u,i.current.close}catch(u){n.annotateError(u,{origin:"minimap",willCrashApp:!1}),n.timers.setTimeout(()=>{throw u})}},[n,e]);const s=k.useCallback(u=>{if(!n.getCurrentPageShapeIds().size||!i.current)return;const d=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),h=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);i.current.originPagePoint.setTo(h),i.current.originPageCenter.setTo(n.getViewportPageBounds().center),n.centerOnPoint(d,{animation:{duration:n.options.animationMediumMs}})},[n]),o=k.useCallback(u=>{if(!i.current)return;const d=u.currentTarget;if(Kp(d,u),!n.getCurrentPageShapeIds().size)return;r.current=!0,i.current.isInViewport=!1;const h=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),p=n.getViewportPageBounds(),g=i.current.getContentPageBounds();if(new ye(g.x-p.width/2,g.y-p.height/2,g.width+p.width,g.height+p.height).containsPoint(h)&&!p.containsPoint(h)){i.current.isInViewport=p.containsPoint(h);const y=b.Sub(p.center,p.point),x=b.Add(h,y);i.current.originPagePoint.setTo(x),i.current.originPageCenter.setTo(h),n.centerOnPoint(h,{animation:{duration:n.options.animationMediumMs}})}else{const y=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);i.current.isInViewport=p.containsPoint(y),i.current.originPagePoint.setTo(y),i.current.originPageCenter.setTo(p.center)}function S(y){d&&Yp(d,y),r.current=!1,document.body.removeEventListener("pointerup",S)}document.body.addEventListener("pointerup",S)},[n]),a=k.useCallback(u=>{if(!i.current)return;const d=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,u.shiftKey,!0);if(r.current){if(i.current.isInViewport){const m=i.current.originPagePoint.clone().sub(i.current.originPageCenter);n.centerOnPoint(b.Sub(d,m));return}n.centerOnPoint(d)}const h=i.current.getMinimapPagePoint(u.clientX,u.clientY),p=n.pageToScreen(h),g={type:"pointer",target:"canvas",name:"pointer_move",...Zr(u),point:p,isPen:n.getInstanceState().isPenMode};n.dispatch(g)},[n]),l=k.useCallback(u=>{const d=bD(u);n.dispatch({type:"wheel",name:"wheel",delta:d,point:new b(u.clientX,u.clientY),shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey})},[n]),c=r0();return k.useEffect(()=>{n.timers.setTimeout(()=>{var u,d;(u=i.current)==null||u.updateColors(),(d=i.current)==null||d.render()})},[c,n]),f.jsx("div",{className:"tlui-minimap",children:f.jsx("canvas",{role:"img","aria-label":"minimap",ref:t,className:"tlui-minimap__canvas",onDoubleClick:s,onPointerMove:a,onPointerDown:o,onWheel:l})})}function kye(n,e){const[t,r]=Qe.useState(e);Qe.useLayoutEffect(()=>{const s=w6(n);if(s)try{r(JSON.parse(s))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const i=Qe.useCallback(s=>{r(o=>{const a=typeof s=="function"?s(o):s;return b6(n,JSON.stringify(a)),a})},[n]);return[t,i]}const Cye=k.memo(function(){const e=Ce(),t=Xe(),r=Lr(),[i,s]=kye("minimap",!0),o=k.useCallback(()=>{s(c=>!c)},[s]),{ZoomMenu:a,Minimap:l}=tc();return r<sn.MOBILE?null:f.jsxs("div",{className:"tlui-navigation-panel",children:[f.jsx("div",{className:"tlui-buttons__horizontal",children:a&&r<sn.TABLET?f.jsx(a,{}):i?f.jsxs(f.Fragment,{children:[a&&f.jsx(a,{}),l&&f.jsx(Ee,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:f.jsx(We,{icon:i?"chevrons-ne":"chevrons-sw"})})]}):f.jsxs(f.Fragment,{children:[f.jsx(Ee,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(yp(e["zoom-out"].label))} ${$4(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:f.jsx(We,{icon:"minus"})}),a&&f.jsx(a,{}),f.jsx(Ee,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(yp(e["zoom-in"].label))} ${$4(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:f.jsx(We,{icon:"plus"})}),l&&f.jsx(Ee,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:f.jsx(We,{icon:i?"chevrons-ne":"chevrons-sw"})})]})}),l&&r>=sn.TABLET&&!i&&f.jsx(l,{})]})}),Pye=function({name:e,id:t,isCurrentPage:r}){const i=G(),s=tr(),o=k.useRef(null),a=k.useCallback(()=>{i.mark("rename page")},[i]),l=k.useCallback(c=>{i.renamePage(t,c||"New Page"),s("rename-page",{source:"page-menu"})},[i,t,s]);return f.jsx(sS,{className:"tlui-page-menu__item__input",ref:c=>o.current=c,defaultValue:e,onValueChange:l,onFocus:a,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},B4=(n,e,t,r,i)=>{let s;const o=n.getPages(),a=t>r?o[r-1]:o[r],l=t>r?o[r]:o[r+1];a&&!l?s=bs(a.index):!a&&l?s=ane(o[0].index):s=ap(a.index,l.index),s!==o[t].index&&(n.mark("moving page"),n.updatePage({id:e,index:s}),i("move-page",{source:"page-menu"}))},n9=zn(function({index:e,listSize:t,item:r,onRename:i}){const s=G(),o=Xe(),a=s.getPages(),l=tr(),c=k.useCallback(()=>{s.mark("creating page");const p=ba.createId();s.duplicatePage(r.id,p),l("duplicate-page",{source:"page-menu"})},[s,r,l]),u=k.useCallback(()=>{B4(s,r.id,e,e-1,l)},[s,r,e,l]),d=k.useCallback(()=>{B4(s,r.id,e,e+1,l)},[s,r,e,l]),h=k.useCallback(()=>{s.mark("deleting page"),s.deletePage(r.id),l("delete-page",{source:"page-menu"})},[s,r,l]);return f.jsxs(Gc,{id:`page item submenu ${e}`,children:[f.jsx(Xc,{children:f.jsx(Ee,{type:"icon",title:o("page-menu.submenu.title"),children:f.jsx(We,{icon:"dots-vertical"})})}),f.jsx(Kc,{alignOffset:0,side:"right",sideOffset:-4,children:f.jsxs(ss,{type:"menu",sourceId:"page-menu",children:[f.jsxs($e,{id:"modify",children:[i&&f.jsx(Z,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),f.jsx(Z,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:c,disabled:a.length>=s.options.maxPages}),e>0&&f.jsx(Z,{id:"move-up",onSelect:u,label:"page-menu.submenu.move-up"}),e<t-1&&f.jsx(Z,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:d})]}),t>1&&f.jsx($e,{id:"delete",children:f.jsx(Z,{id:"delete",onSelect:h,label:"page-menu.submenu.delete"})})]})})]})}),Tye=k.memo(function(){const e=G(),t=tr(),r=Xe(),i=Lr(),s=k.useCallback(()=>y(!1),[]),[o,a]=La("page-menu",s),l=36,c=k.useRef(null),u=ee("pages",()=>e.getPages(),[e]),d=ee("currentPage",()=>e.getCurrentPage(),[e]),h=ee("currentPageId",()=>e.getCurrentPageId(),[e]),p=Da(),g=ee("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),m=ee("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[S,y]=k.useState(!1),x=k.useCallback(()=>{p||y(j=>!j)},[p]),w=k.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[O,T]=k.useState(Object.fromEntries(u.map((j,L)=>[j.id,{y:L*l,offsetY:0,isSelected:!1}])));k.useLayoutEffect(()=>{T(Object.fromEntries(u.map((j,L)=>[j.id,{y:L*l,offsetY:0,isSelected:!1}])))},[l,u]),k.useEffect(()=>{o&&e.timers.requestAnimationFrame(()=>{const j=document.querySelector(`[data-testid="page-menu-item-${h}"]`);if(j){const L=c.current;if(!L)return;const U=j.offsetTop,Y=L.scrollTop;U<Y&&L.scrollTo({top:U});const V=U+l,W=L.scrollTop+L.offsetHeight;V>W&&L.scrollTo({top:V-L.offsetHeight})}})},[l,h,o,e]);const E=k.useCallback(j=>{const{clientY:L,currentTarget:U}=j,{dataset:{id:Y,index:V}}=U;if(!Y||!V)return;const W=w.current;Kp(j.currentTarget,j),W.status="pointing",W.pointing={id:Y,index:+V};const ne=O[Y].y;W.startY=L,W.startIndex=Math.max(0,Math.min(Math.round(ne/l),u.length-1))},[l,u.length,O]),C=k.useCallback(j=>{const L=w.current;if(L.status==="pointing"){const{clientY:U}=j,Y=U-L.startY;Math.abs(Y)>5&&(L.status="dragging")}if(L.status==="dragging"){const{clientY:U}=j,Y=U-L.startY,V=O[L.pointing.id],{startIndex:W,pointing:J}=L,ne=V.y+Y,le=Math.max(0,Math.min(Math.round(ne/l),u.length-1)),ue={...O};if(ue[J.id]={y:V.y,offsetY:Y,isSelected:!0},le!==L.dragIndex){L.dragIndex=le;for(let Pe=0;Pe<u.length;Pe++){const je=u[Pe];if(je.id===L.pointing.id)continue;let{y:he}=ue[je.id];le===W?he=Pe*l:le<W?le<=Pe&&Pe<W?he=(Pe+1)*l:he=Pe*l:le>W&&(le>=Pe&&Pe>W?he=(Pe-1)*l:he=Pe*l),he!==ue[je.id].y&&(ue[je.id]={y:he,offsetY:0,isSelected:!0})}}T(ue)}},[l,u,O]),M=k.useCallback(j=>{const L=w.current;if(L.status==="dragging"){const{id:U,index:Y}=L.pointing;B4(e,U,Y,L.dragIndex,t)}Yp(j.currentTarget,j),L.status="idle"},[e,t]),A=k.useCallback(j=>{const L=w.current;j.key==="Escape"&&(L.status==="dragging"&&T(Object.fromEntries(u.map((U,Y)=>[U.id,{y:Y*l,offsetY:0,isSelected:!1}]))),L.status="idle")},[l,u]),D=k.useCallback(()=>{p||(e.run(()=>{e.mark("creating page");const j=ba.createId();e.createPage({name:r("page-menu.new-page-initial-name"),id:j}),e.setCurrentPage(j),y(!0)}),t("new-page",{source:"page-menu"}))},[e,r,p,t]),N=k.useCallback(j=>{e.setCurrentPage(j),t("change-page",{source:"page-menu"})},[e,t]),F=k.useCallback((j,L)=>{e.renamePage(j,L),t("rename-page",{source:"page-menu"})},[e,t]);return f.jsxs(HO,{id:"pages",onOpenChange:a,open:o,children:[f.jsx(QO,{"data-testid":"main.page-menu",children:f.jsxs(Ee,{type:"menu",title:d.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[f.jsx("div",{className:"tlui-page-menu__name",children:d.name}),f.jsx(We,{icon:"chevron-down",small:!0})]})}),f.jsx(qO,{side:"bottom",align:"start",sideOffset:6,children:f.jsxs("div",{className:"tlui-page-menu__wrapper",children:[f.jsxs("div",{className:"tlui-page-menu__header",children:[f.jsx("div",{className:"tlui-page-menu__header__title",children:r("page-menu.title")}),!p&&f.jsxs("div",{className:"tlui-buttons__horizontal",children:[f.jsx(Ee,{type:"icon","data-testid":"page-menu.edit",title:r(S?"page-menu.edit-done":"page-menu.edit-start"),onClick:x,children:f.jsx(We,{icon:S?"check":"edit"})}),f.jsx(Ee,{type:"icon","data-testid":"page-menu.create",title:r(g?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:g,onClick:D,children:f.jsx(We,{icon:"plus"})})]})]}),f.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:l*u.length+4},ref:c,children:u.map((j,L)=>{const U=O[j.id]??{position:L*40,offsetY:0};return S?f.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:j.id===d.id?888:L,transform:`translate(0px, ${U.y+U.offsetY}px)`},children:[f.jsx(Ee,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:E,onPointerUp:M,onPointerMove:C,onKeyDown:A,"data-id":j.id,"data-index":L,children:f.jsx(We,{icon:"drag-handle-dots"})}),i<sn.TABLET_SM&&m?f.jsxs(Ee,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const Y=window.prompt("Rename page",j.name);Y&&Y!==j.name&&F(j.id,Y)},onDoubleClick:x,children:[f.jsx(F4,{checked:j.id===d.id}),f.jsx(dn,{children:j.name})]}):f.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:l},children:f.jsx(Pye,{id:j.id,name:j.name,isCurrentPage:j.id===d.id})}),!p&&f.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":S,children:f.jsx(n9,{index:L,item:j,listSize:u.length})})]},j.id+"_editing"):f.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[f.jsxs(Ee,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>N(j.id),onDoubleClick:x,title:r("page-menu.go-to-page"),children:[f.jsx(F4,{checked:j.id===d.id}),f.jsx(dn,{children:j.name})]}),!p&&f.jsx("div",{className:"tlui-page_menu__item__submenu",children:f.jsx(n9,{index:L,item:j,listSize:u.length,onRename:()=>{if(e.environment.isIos){const Y=window.prompt("Rename page",j.name);Y&&Y!==j.name&&F(j.id,Y)}else y(!0),h!==j.id&&N(j.id)}})})]},j.id)})})]})})]})});function Eye(){const n=Ce(),e=G(),t=dN(),r=uN(),i=zr(1),s=Da(),o=ee("should display quick actions",()=>e.isInAny("select","hand","zoom"),[e]),a=za(),l=i&&a;if(!(s&&!o))return f.jsxs(f.Fragment,{children:[f.jsx(Z,{...n.undo,disabled:!t}),f.jsx(Z,{...n.redo,disabled:!r}),f.jsx(Z,{...n.delete,disabled:!l}),f.jsx(Z,{...n.duplicate,disabled:!l})]})}const Iye=k.memo(function({children:e}){const t=e??f.jsx(Eye,{});return f.jsx(ss,{type:"small-icons",sourceId:"quick-actions",children:t})});function Mye({userId:n}){const e=zv(n);return e?f.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},n):null}const Aye=zn(function({userId:e}){const t=G(),r=Xe(),i=tr(),s=zv(e),o=k.useCallback(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),i("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),i("start-following",{source:"people-menu"}))},[t,e,i]),a=(s==null?void 0:s.followingUserId)===t.user.getId(),l=t.getInstanceState().followingUserId===e;return s?f.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[f.jsxs(Ee,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:o,children:[f.jsx(To,{icon:"color",color:s.color}),f.jsx("div",{className:"tlui-people-menu__name",children:s.userName??"New User"})]}),f.jsx(Ee,{type:"icon",className:"tlui-people-menu__item__follow",title:r(a?"people-menu.leading":l?"people-menu.following":"people-menu.follow"),onClick:o,disabled:a,"data-active":l||a,children:f.jsx(We,{icon:a?"leading":l?"following":"follow"})})]}):null});function _ye({count:n}){return f.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(n)})}const Rye=zn(function(){const e=G(),t=Nn(),r=Xe(),i=tr(),s=k.useRef(!1),[o,a]=k.useState(!1),l=k.useCallback(m=>{a(m)},[]),c=e.user.getColor(),u=k.useCallback(m=>{e.user.updateUserPreferences({color:m}),i("set-color",{source:"people-menu"})},[e,i]),{handleButtonClick:d,handleButtonPointerDown:h,handleButtonPointerEnter:p,handleButtonPointerUp:g}=Qe.useMemo(()=>{const m=()=>{s.current=!1,window.removeEventListener("pointerup",m)};return{handleButtonClick:O=>{const{id:T}=O.currentTarget.dataset;T&&c!==T&&u(T)},handleButtonPointerDown:O=>{const{id:T}=O.currentTarget.dataset;T&&(u(T),s.current=!0,window.addEventListener("pointerup",m))},handleButtonPointerEnter:O=>{if(!s.current)return;const{id:T}=O.currentTarget.dataset;T&&u(T)},handleButtonPointerUp:O=>{const{id:T}=O.currentTarget.dataset;T&&u(T)}}},[c,u]);return f.jsxs($O,{onOpenChange:l,open:o,children:[f.jsx(FO,{dir:"ltr",asChild:!0,children:f.jsx(Ee,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:r("people-menu.change-color"),children:f.jsx(We,{icon:"color"})})}),f.jsx(BO,{container:t,children:f.jsx(UO,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:f.jsx("div",{className:"tlui-buttons__grid",children:a4.map(m=>f.jsx(Ee,{type:"icon","data-id":m,"data-testid":m,"aria-label":m,"data-state":c===m?"hinted":void 0,title:m,className:"tlui-button-grid__button",style:{color:m},onPointerEnter:p,onPointerDown:h,onPointerUp:g,onClick:d,children:f.jsx(We,{icon:"color"})},m))})})})]})});function Dye(){const n=G(),e=tr(),t=ee("userName",()=>n.user.getName(),[]),r=Xe(),i=k.useRef(t),s=k.useRef(t),[o,a]=k.useState(!1),l=k.useCallback(()=>{a(d=>!d)},[]),c=k.useCallback(d=>{s.current=d,n.user.updateUserPreferences({name:d})},[n]),u=k.useCallback(()=>{i.current!==s.current&&(e("change-user-name",{source:"people-menu"}),i.current=s.current)},[e]);return f.jsxs("div",{className:"tlui-people-menu__user",children:[f.jsx(Rye,{}),o?f.jsx(sS,{className:"tlui-people-menu__user__input",defaultValue:t,onValueChange:c,onComplete:l,onCancel:l,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{o||a(!0)},children:t}),t==="New User"?f.jsx("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")}):null]}),f.jsx(Ee,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:l,children:f.jsx(We,{icon:o?"check":"edit"})})]})}const jye=zn(function({children:e}){const t=Xe(),r=Nn(),i=G(),s=TD(),o=ee("user",()=>i.user.getColor(),[i]),a=ee("user",()=>i.user.getName(),[i]),[l,c]=La("people menu");return f.jsxs($O,{onOpenChange:c,open:l,children:[f.jsx(FO,{dir:"ltr",asChild:!0,children:f.jsxs("button",{className:"tlui-people-menu__avatars-button",title:t("people-menu.title"),children:[s.length>5&&f.jsx(_ye,{count:s.length-5}),f.jsxs("div",{className:"tlui-people-menu__avatars",children:[s.slice(-5).map(u=>f.jsx(Mye,{userId:u},u)),f.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o},children:a==="New User"?"":a[0]??""})]})]})}),f.jsx(BO,{container:r,children:f.jsx(UO,{dir:"ltr",className:"tlui-menu",align:"end",side:"bottom",sideOffset:2,alignOffset:-5,children:f.jsxs("div",{className:"tlui-people-menu__wrapper",children:[f.jsx("div",{className:"tlui-people-menu__section",children:f.jsx(Dye,{})}),s.length>0&&f.jsx("div",{className:"tlui-people-menu__section",children:s.map(u=>f.jsx(Aye,{userId:u},u+"_presence"))}),e]})})})]})});function Lye(){return f.jsx("div",{className:"tlui-share-zone",draggable:!1,children:f.jsx(jye,{})})}const zye=Object.freeze([Ai,Bc,Uc,Co]);function tF(n=zye){const e=G();return ee("getRelevantStyles",()=>{var s;const t=new c4(e.getSharedStyles()),r=!!((s=e.root.getCurrent())!=null&&s.shapeType),i=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const o of n)t.applyValue(o,e.getStyleForNextShape(o));return r||i||t.size>0?t:null},[e])}const Xi={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},Oc=k.memo(function(e){const{uiType:t,items:r,title:i,style:s,value:o,onValueChange:a,theme:l}=e,c=G(),u=Xe(),d=k.useRef(!1),h=k.useRef(null),{handleButtonClick:p,handleButtonPointerDown:g,handleButtonPointerEnter:m,handleButtonPointerUp:S}=k.useMemo(()=>{const y=()=>{d.current=!1,window.removeEventListener("pointerup",y);const E=h.current;E&&["TEXTAREA","INPUT"].includes(E.nodeName)&&E.focus(),h.current=null};return{handleButtonClick:E=>{const{id:C}=E.currentTarget.dataset;o.type==="shared"&&o.value===C||(c.mark("point picker item"),a(s,C))},handleButtonPointerDown:E=>{const{id:C}=E.currentTarget.dataset;c.mark("point picker item"),a(s,C),d.current=!0,h.current=document.activeElement,window.addEventListener("pointerup",y)},handleButtonPointerEnter:E=>{if(!d.current)return;const{id:C}=E.currentTarget.dataset;a(s,C)},handleButtonPointerUp:E=>{const{id:C}=E.currentTarget.dataset;o.type==="shared"&&o.value===C||a(s,C)}}},[o,c,a,s]);return f.jsx("div",{"data-testid":`style.${t}`,className:Te("tlui-buttons__grid"),children:r.map(y=>f.jsx(Ee,{type:"icon","data-id":y.value,"data-testid":`style.${t}.${y.value}`,"aria-label":y.value,"data-state":o.type==="shared"&&o.value===y.value?"hinted":void 0,title:i+"  "+u(`${t}-style.${y.value}`),className:Te("tlui-button-grid__button"),style:s===Ai?{color:l[y.value].solid}:void 0,onPointerEnter:m,onPointerDown:g,onPointerUp:S,onClick:p,children:f.jsx(We,{icon:y.icon})},y.value))})});function nF(n,[e,t]){return Math.min(t,Math.max(e,n))}function Nye(n){const e=k.useRef({value:n,previous:n});return k.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var rF=["PageUp","PageDown"],iF=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],sF={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ih="Slider",[U4,$ye,Fye]=Jv(ih),[oF,JOe]=Ro(ih,[Fye]),[Bye,gS]=oF(ih),aF=k.forwardRef((n,e)=>{const{name:t,min:r=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:p=!1,...g}=n,m=k.useRef(new Set),S=k.useRef(0),x=o==="horizontal"?Uye:Hye,[w=[],O]=Yl({prop:u,defaultProp:c,onChange:D=>{var F;(F=[...m.current][S.current])==null||F.focus(),d(D)}}),T=k.useRef(w);function E(D){const N=Gye(w,D);A(D,N)}function C(D){A(D,S.current)}function M(){const D=T.current[S.current];w[S.current]!==D&&h(w)}function A(D,N,{commit:F}={commit:!1}){const j=Zye(s),L=Jye(Math.round((D-r)/s)*s+r,j),U=nF(L,[r,i]);O((Y=[])=>{const V=Wye(Y,U,N);if(Yye(V,l*s)){S.current=V.indexOf(U);const W=String(V)!==String(Y);return W&&F&&h(V),W?V:Y}else return Y})}return f.jsx(Bye,{scope:n.__scopeSlider,name:t,disabled:a,min:r,max:i,valueIndexToChangeRef:S,thumbs:m.current,values:w,orientation:o,children:f.jsx(U4.Provider,{scope:n.__scopeSlider,children:f.jsx(U4.Slot,{scope:n.__scopeSlider,children:f.jsx(x,{"aria-disabled":a,"data-disabled":a?"":void 0,...g,ref:e,onPointerDown:be(g.onPointerDown,()=>{a||(T.current=w)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:E,onSlideMove:a?void 0:C,onSlideEnd:a?void 0:M,onHomeKeyDown:()=>!a&&A(r,0,{commit:!0}),onEndKeyDown:()=>!a&&A(i,w.length-1,{commit:!0}),onStepKeyDown:({event:D,direction:N})=>{if(!a){const L=rF.includes(D.key)||D.shiftKey&&iF.includes(D.key)?10:1,U=S.current,Y=w[U],V=s*L*N;A(Y+V,U,{commit:!0})}}})})})})});aF.displayName=ih;var[lF,cF]=oF(ih,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Uye=k.forwardRef((n,e)=>{const{min:t,max:r,dir:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=n,[d,h]=k.useState(null),p=_t(e,w=>h(w)),g=k.useRef(),m=WO(i),S=m==="ltr",y=S&&!s||!S&&s;function x(w){const O=g.current||d.getBoundingClientRect(),T=[0,O.width],C=l7(T,y?[t,r]:[r,t]);return g.current=O,C(w-O.left)}return f.jsx(lF,{scope:n.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:f.jsx(uF,{dir:m,"data-orientation":"horizontal",...u,ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const O=x(w.clientX);o==null||o(O)},onSlideMove:w=>{const O=x(w.clientX);a==null||a(O)},onSlideEnd:()=>{g.current=void 0,l==null||l()},onStepKeyDown:w=>{const T=sF[y?"from-left":"from-right"].includes(w.key);c==null||c({event:w,direction:T?-1:1})}})})}),Hye=k.forwardRef((n,e)=>{const{min:t,max:r,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onStepKeyDown:l,...c}=n,u=k.useRef(null),d=_t(e,u),h=k.useRef(),p=!i;function g(m){const S=h.current||u.current.getBoundingClientRect(),y=[0,S.height],w=l7(y,p?[r,t]:[t,r]);return h.current=S,w(m-S.top)}return f.jsx(lF,{scope:n.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:f.jsx(uF,{"data-orientation":"vertical",...c,ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:m=>{const S=g(m.clientY);s==null||s(S)},onSlideMove:m=>{const S=g(m.clientY);o==null||o(S)},onSlideEnd:()=>{h.current=void 0,a==null||a()},onStepKeyDown:m=>{const y=sF[p?"from-bottom":"from-top"].includes(m.key);l==null||l({event:m,direction:y?-1:1})}})})}),uF=k.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:l,...c}=n,u=gS(ih,t);return f.jsx(it.span,{...c,ref:e,onKeyDown:be(n.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):rF.concat(iF).includes(d.key)&&(l(d),d.preventDefault())}),onPointerDown:be(n.onPointerDown,d=>{const h=d.target;h.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(h)?h.focus():r(d)}),onPointerMove:be(n.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&i(d)}),onPointerUp:be(n.onPointerUp,d=>{const h=d.target;h.hasPointerCapture(d.pointerId)&&(h.releasePointerCapture(d.pointerId),s(d))})})}),dF="SliderTrack",hF=k.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=gS(dF,t);return f.jsx(it.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});hF.displayName=dF;var H4="SliderRange",fF=k.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=gS(H4,t),s=cF(H4,t),o=k.useRef(null),a=_t(e,o),l=i.values.length,c=i.values.map(h=>gF(h,i.min,i.max)),u=l>1?Math.min(...c):0,d=100-Math.max(...c);return f.jsx(it.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:a,style:{...n.style,[s.startEdge]:u+"%",[s.endEdge]:d+"%"}})});fF.displayName=H4;var Q4="SliderThumb",pF=k.forwardRef((n,e)=>{const t=$ye(n.__scopeSlider),[r,i]=k.useState(null),s=_t(e,a=>i(a)),o=k.useMemo(()=>r?t().findIndex(a=>a.ref.current===r):-1,[t,r]);return f.jsx(Qye,{...n,ref:s,index:o})}),Qye=k.forwardRef((n,e)=>{const{__scopeSlider:t,index:r,name:i,...s}=n,o=gS(Q4,t),a=cF(Q4,t),[l,c]=k.useState(null),u=_t(e,x=>c(x)),d=l?!!l.closest("form"):!0,h=Lz(l),p=o.values[r],g=p===void 0?0:gF(p,o.min,o.max),m=Vye(r,o.values.length),S=h==null?void 0:h[a.size],y=S?Xye(S,g,a.direction):0;return k.useEffect(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),f.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${g}% + ${y}px)`},children:[f.jsx(U4.ItemSlot,{scope:n.__scopeSlider,children:f.jsx(it.span,{role:"slider","aria-label":n["aria-label"]||m,"aria-valuemin":o.min,"aria-valuenow":p,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:u,style:p===void 0?{display:"none"}:n.style,onFocus:be(n.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),d&&f.jsx(qye,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),value:p},r)]})});pF.displayName=Q4;var qye=n=>{const{value:e,...t}=n,r=k.useRef(null),i=Nye(e);return k.useEffect(()=>{const s=r.current,o=window.HTMLInputElement.prototype,l=Object.getOwnPropertyDescriptor(o,"value").set;if(i!==e&&l){const c=new Event("input",{bubbles:!0});l.call(s,e),s.dispatchEvent(c)}},[i,e]),f.jsx("input",{style:{display:"none"},...t,ref:r,defaultValue:e})};function Wye(n=[],e,t){const r=[...n];return r[t]=e,r.sort((i,s)=>i-s)}function gF(n,e,t){const s=100/(t-e)*(n-e);return nF(s,[0,100])}function Vye(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function Gye(n,e){if(n.length===1)return 0;const t=n.map(i=>Math.abs(i-e)),r=Math.min(...t);return t.indexOf(r)}function Xye(n,e,t){const r=n/2,s=l7([0,50],[0,r]);return(r-s(e)*t)*t}function Kye(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function Yye(n,e){if(e>0){const t=Kye(n);return Math.min(...t)>=e}return!0}function l7(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(n[1]-n[0]);return e[0]+r*(t-n[0])}}function Zye(n){return(String(n).split(".")[1]||"").length}function Jye(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}var eve=aF,tve=hF,nve=fF,rve=pF;const ive=k.memo(function(e){const{title:t,steps:r,value:i,label:s,onValueChange:o}=e,a=G(),l=Xe(),c=k.useCallback(h=>{o(h[0])},[o]),u=k.useCallback(()=>{a.mark("click slider")},[a]),d=k.useCallback(()=>{i&&o(i)},[i,o]);return f.jsx("div",{className:"tlui-slider__container",children:f.jsxs(eve,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:i?[i]:void 0,onPointerDown:u,onValueChange:c,onPointerUp:d,title:t+"  "+l(s),children:[f.jsx(tve,{className:"tlui-slider__track",dir:"ltr",children:i!==null&&f.jsx(nve,{className:"tlui-slider__range",dir:"ltr"})}),i!==null&&f.jsx(rve,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function sve({label:n,uiTypeA:e,uiTypeB:t,labelA:r,labelB:i,itemsA:s,itemsB:o,styleA:a,styleB:l,valueA:c,valueB:u,onValueChange:d}){const h=Xe(),p=k.useMemo(()=>{var m;return((m=s.find(S=>c.type==="shared"&&c.value===S.value))==null?void 0:m.icon)??"mixed"},[s,c]),g=k.useMemo(()=>{var m;return((m=o.find(S=>u.type==="shared"&&u.value===S.value))==null?void 0:m.icon)??"mixed"},[o,u]);return c===void 0&&u===void 0?null:f.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[f.jsx("div",{title:h(n),className:"tlui-style-panel__double-select-picker-label",children:h(n)}),f.jsxs("div",{className:"tlui-buttons__horizontal",children:[f.jsxs(Gc,{id:`style panel ${e} A`,children:[f.jsx(Xc,{children:f.jsx(Ee,{type:"icon","data-testid":`style.${e}`,title:h(r)+"  "+(c===null||c.type==="mixed"?h("style-panel.mixed"):h(`${e}-style.${c.value}`)),children:f.jsx(We,{icon:p,small:!0,invertIcon:!0})})}),f.jsx(Kc,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:f.jsx("div",{className:"tlui-buttons__grid",children:s.map((m,S)=>f.jsx(bp,{"data-testid":`style.${e}.${m.value}`,children:f.jsx(Ee,{type:"icon",onClick:()=>d(a,m.value),title:`${h(r)}  ${h(`${e}-style.${m.value}`)}`,children:f.jsx(We,{icon:m.icon,invertIcon:!0})},m.value)},S))})})]}),f.jsxs(Gc,{id:`style panel ${t}`,children:[f.jsx(Xc,{children:f.jsx(Ee,{type:"icon","data-testid":`style.${t}`,title:h(i)+"  "+(u===null||u.type==="mixed"?h("style-panel.mixed"):h(`${t}-style.${u.value}`)),children:f.jsx(We,{icon:g,small:!0})})}),f.jsx(Kc,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:f.jsx("div",{className:"tlui-buttons__grid",children:o.map(m=>f.jsx(bp,{children:f.jsx(Ee,{type:"icon",title:`${h(i)}  ${h(`${t}-style.${m.value}`)}`,"data-testid":`style.${t}.${m.value}`,onClick:()=>d(l,m.value),children:f.jsx(We,{icon:m.icon})})},m.value))})})]})]})]})}const ove=k.memo(sve);function ave({id:n,label:e,uiType:t,style:r,items:i,type:s,value:o,onValueChange:a}){const l=Xe(),c=G(),u=k.useMemo(()=>{var p;return(p=i.find(g=>o.type==="shared"&&g.value===o.value))==null?void 0:p.icon},[i,o]),d=o.type==="mixed"?l("style-panel.mixed"):l(`${t}-style.${o.value}`),h=e?l(e):"";return f.jsxs(Gc,{id:`style panel ${n}`,children:[f.jsx(Xc,{children:f.jsxs(Ee,{type:s,"data-testid":`style.${t}`,title:d,children:[f.jsx(dn,{children:h}),f.jsx(We,{icon:u??"mixed"})]})}),f.jsx(Kc,{side:"left",align:"center",alignOffset:0,children:f.jsx("div",{className:"tlui-buttons__grid",children:i.map(p=>f.jsx(bp,{children:f.jsx(Ee,{type:"icon","data-testid":`style.${t}.${p.value}`,title:l(`${t}-style.${p.value}`),onClick:()=>{c.mark("select style dropdown item"),a(r,p.value)},children:f.jsx(We,{icon:p.icon})})},p.value))})})]})}const c7=k.memo(ave);function lve({styles:n}){const e=r0();if(!n)return null;const t=n.get(ks),r=n.get(ay),i=n.get(oy),s=n.get(uy),o=n.get(ko),a=t===void 0,l=r===void 0&&i===void 0,c=s===void 0,u=o===void 0,d=Ra({isDarkMode:e});return f.jsxs(f.Fragment,{children:[f.jsx(cve,{theme:d,styles:n}),!u&&f.jsx(uve,{theme:d,styles:n}),!(a&&l&&c)&&f.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[f.jsx(dve,{styles:n}),f.jsx(fve,{styles:n}),f.jsx(hve,{styles:n})]})]})}function h0(){const n=G(),e=tr();return Qe.useMemo(()=>function(r,i){n.run(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(r,i),n.setStyleForNextShapes(r,i),n.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:r.id,value:i})},[n,e])}function cve({styles:n,theme:e}){const t=Xe(),r=G(),i=h0(),s=n.get(Ai),o=n.get(Uc),a=n.get(Bc),l=n.get(Co),c=o!==void 0||a!==void 0||l!==void 0;return f.jsxs(f.Fragment,{children:[f.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[s===void 0?null:f.jsx(Oc,{title:t("style-panel.color"),uiType:"color",style:Ai,items:Xi.color,value:s,onValueChange:i,theme:e}),f.jsx(pve,{})]}),c&&f.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[o===void 0?null:f.jsx(Oc,{title:t("style-panel.fill"),uiType:"fill",style:Uc,items:Xi.fill,value:o,onValueChange:i,theme:e}),a===void 0?null:f.jsx(Oc,{title:t("style-panel.dash"),uiType:"dash",style:Bc,items:Xi.dash,value:a,onValueChange:i,theme:e}),l===void 0?null:f.jsx(Oc,{title:t("style-panel.size"),uiType:"size",style:Co,items:Xi.size,value:l,onValueChange:(u,d)=>{i(u,d);const h=r.getSelectedShapeIds();h.length>0&&Pt(r,h)},theme:e})]})]})}function uve({theme:n,styles:e}){const t=Xe(),r=h0(),i=e.get(ko),s=e.get(n4),o=e.get(ly),a=e.get(cy);return i===void 0&&o===void 0?null:f.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[i===void 0?null:f.jsx(Oc,{title:t("style-panel.font"),uiType:"font",style:ko,items:Xi.font,value:i,onValueChange:r,theme:n}),s===void 0?null:f.jsxs("div",{className:"tlui-style-panel__row",children:[f.jsx(Oc,{title:t("style-panel.align"),uiType:"align",style:n4,items:Xi.textAlign,value:s,onValueChange:r,theme:n}),f.jsx("div",{className:"tlui-style-panel__row__extra-button",children:f.jsx(Ee,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:f.jsx(We,{icon:"vertical-align-middle"})})})]}),o===void 0?null:f.jsxs("div",{className:"tlui-style-panel__row",children:[f.jsx(Oc,{title:t("style-panel.align"),uiType:"align",style:ly,items:Xi.horizontalAlign,value:o,onValueChange:r,theme:n}),f.jsx("div",{className:"tlui-style-panel__row__extra-button",children:a===void 0?f.jsx(Ee,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:f.jsx(We,{icon:"vertical-align-middle"})}):f.jsx(c7,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:cy,items:Xi.verticalAlign,value:a,onValueChange:r})})]})]})}function dve({styles:n}){const e=h0(),t=n.get(ks);return t===void 0?null:f.jsx(c7,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:ks,items:Xi.geo,value:t,onValueChange:e})}function hve({styles:n}){const e=h0(),t=n.get(uy);return t===void 0?null:f.jsx(c7,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:uy,items:Xi.spline,value:t,onValueChange:e})}function fve({styles:n}){const e=h0(),t=n.get(ay),r=n.get(oy);return!t||!r?null:f.jsx(ove,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:oy,itemsA:Xi.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:ay,itemsB:Xi.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const Lh=[.1,.25,.5,.75,1];function pve(){const n=G(),e=ee("opacity",()=>n.getSharedOpacity(),[n]),t=tr(),r=Xe(),i=Qe.useCallback(o=>{const a=Lh[o];n.run(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(a),n.setOpacityForNextShapes(a),n.updateInstanceState({isChangingStyle:!0})}),t("set-style",{source:"style-panel",id:"opacity",value:o})},[n,t]);if(e===void 0)return null;const s=e.type==="mixed"?-1:Lh.indexOf(Gte(Lh,o=>Math.abs(o-e.value)));return f.jsx(ive,{"data-testid":"style.opacity",value:s>=0?s:Lh.length-1,label:e.type==="mixed"?"style-panel.mixed":`opacity-style.${e.value}`,onValueChange:i,steps:Lh.length-1,title:r("style-panel.opacity")})}const gve=k.memo(function({isMobile:e,children:t}){const r=G(),i=tF(),s=k.useCallback(()=>{e||r.updateInstanceState({isChangingStyle:!1})},[r,e]),o=t??f.jsx(lve,{styles:i});return f.jsx("div",{className:Te("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:s,children:o})});function mve(){const n=G(),e=Xe(),t=tF(),r=t==null?void 0:t.get(Ai),i=Ra({isDarkMode:n.user.getIsDarkMode()}),s=((r==null?void 0:r.type)==="shared"?i[r.value]:i.black).solid,o=ee("disable style panel",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),a=k.useCallback(c=>{c||n.updateInstanceState({isChangingStyle:!1})},[n]),{StylePanel:l}=tc();return l?f.jsxs(HO,{id:"mobile style menu",onOpenChange:a,children:[f.jsx(QO,{children:f.jsx(Ee,{type:"tool","data-testid":"mobile-styles.button",style:{color:o?"var(--color-muted-1)":s},title:e("style-panel.title"),disabled:o,children:f.jsx(We,{icon:o?"blob":(r==null?void 0:r.type)==="mixed"?"mixed":"blob"})})}),f.jsx(qO,{side:"top",align:"end",children:l&&f.jsx(l,{isMobile:!0})})]}):null}function mF(){return f.jsxs(f.Fragment,{children:[f.jsx(yve,{}),f.jsx(vve,{}),f.jsx(Sve,{}),f.jsx(xve,{}),f.jsx(wve,{}),f.jsx(bve,{}),f.jsx(Ove,{}),f.jsx(kve,{}),f.jsx(Cve,{}),f.jsx(Pve,{}),f.jsx(Eve,{}),f.jsx(Tve,{}),f.jsx(Ave,{}),f.jsx(Dve,{}),f.jsx(Ive,{}),f.jsx(Rve,{}),f.jsx(_ve,{}),f.jsx(Mve,{}),f.jsx(jve,{}),f.jsx(Lve,{}),f.jsx(zve,{}),f.jsx(Nve,{}),f.jsx($ve,{}),f.jsx(Fve,{}),f.jsx(Bve,{}),f.jsx(Uve,{}),f.jsx(Qve,{}),f.jsx(Hve,{})]})}function q4(n){var r;const e=G(),t=(r=n.meta)==null?void 0:r.geo;return ee("is tool selected",()=>{const i=e.getCurrentToolId(),s=e.getSharedStyles().getAsKnownValue(ks);return t?i==="geo"&&s===t:i===n.id},[e,n.id,t])}function Ct({tool:n}){const e=Rd(),t=q4(e[n]);return f.jsx(Z,{...e[n],isSelected:t})}function yve(){return f.jsx(Ct,{tool:"select"})}function vve(){return f.jsx(Ct,{tool:"hand"})}function Sve(){return f.jsx(Ct,{tool:"draw"})}function xve(){return f.jsx(Ct,{tool:"eraser"})}function wve(){return f.jsx(Ct,{tool:"arrow"})}function bve(){return f.jsx(Ct,{tool:"text"})}function Ove(){return f.jsx(Ct,{tool:"note"})}function kve(){const n=Rd();return f.jsx(Z,{...n.asset})}function Cve(){return f.jsx(Ct,{tool:"rectangle"})}function Pve(){return f.jsx(Ct,{tool:"ellipse"})}function Tve(){return f.jsx(Ct,{tool:"diamond"})}function Eve(){return f.jsx(Ct,{tool:"triangle"})}function Ive(){return f.jsx(Ct,{tool:"rhombus"})}function Mve(){return f.jsx(Ct,{tool:"heart"})}function Ave(){return f.jsx(Ct,{tool:"hexagon"})}function _ve(){return f.jsx(Ct,{tool:"cloud"})}function Rve(){return f.jsx(Ct,{tool:"star"})}function Dve(){return f.jsx(Ct,{tool:"oval"})}function jve(){return f.jsx(Ct,{tool:"x-box"})}function Lve(){return f.jsx(Ct,{tool:"check-box"})}function zve(){return f.jsx(Ct,{tool:"arrow-left"})}function Nve(){return f.jsx(Ct,{tool:"arrow-up"})}function $ve(){return f.jsx(Ct,{tool:"arrow-down"})}function Fve(){return f.jsx(Ct,{tool:"arrow-right"})}function Bve(){return f.jsx(Ct,{tool:"line"})}function Uve(){return f.jsx(Ct,{tool:"highlight"})}function Hve(){return f.jsx(Ct,{tool:"frame"})}function Qve(){return f.jsx(Ct,{tool:"laser"})}const I2=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function M2(n,e,t,r){n.addEventListener?n.addEventListener(e,t,r):n.attachEvent&&n.attachEvent("on".concat(e),t)}function zh(n,e,t,r){n.removeEventListener?n.removeEventListener(e,t,r):n.detachEvent&&n.detachEvent("on".concat(e),t)}function yF(n,e){const t=e.slice(0,e.length-1);for(let r=0;r<t.length;r++)t[r]=n[t[r].toLowerCase()];return t}function vF(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function qve(n,e){const t=n.length>=e.length?n:e,r=n.length>=e.length?e:n;let i=!0;for(let s=0;s<t.length;s++)r.indexOf(t[s])===-1&&(i=!1);return i}const Op={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":I2?173:189,"=":I2?61:187,";":I2?59:186,"'":222,"[":219,"]":221,"\\":220},Io={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},W4={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Un={16:!1,18:!1,17:!1,91:!1},Zt={};for(let n=1;n<20;n++)Op["f".concat(n)]=111+n;let Tt=[],Df=null,SF="all";const Yo=new Map,f0=n=>Op[n.toLowerCase()]||Io[n.toLowerCase()]||n.toUpperCase().charCodeAt(0),Wve=n=>Object.keys(Op).find(e=>Op[e]===n),Vve=n=>Object.keys(Io).find(e=>Io[e]===n);function xF(n){SF=n||"all"}function kp(){return SF||"all"}function Gve(){return Tt.slice(0)}function Xve(){return Tt.map(n=>Wve(n)||Vve(n)||String.fromCharCode(n))}function Kve(){const n=[];return Object.keys(Zt).forEach(e=>{Zt[e].forEach(t=>{let{key:r,scope:i,mods:s,shortcut:o}=t;n.push({scope:i,shortcut:o,mods:s,keys:r.split("+").map(a=>f0(a))})})}),n}function Yve(n){const e=n.target||n.srcElement,{tagName:t}=e;let r=!0;const i=t==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(i||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(r=!1),r}function Zve(n){return typeof n=="string"&&(n=f0(n)),Tt.indexOf(n)!==-1}function Jve(n,e){let t,r;n||(n=kp());for(const i in Zt)if(Object.prototype.hasOwnProperty.call(Zt,i))for(t=Zt[i],r=0;r<t.length;)t[r].scope===n?t.splice(r,1).forEach(o=>{let{element:a}=o;return u7(a)}):r++;kp()===n&&xF(e||"all")}function eSe(n){let e=n.keyCode||n.which||n.charCode;const t=Tt.indexOf(e);if(t>=0&&Tt.splice(t,1),n.key&&n.key.toLowerCase()==="meta"&&Tt.splice(0,Tt.length),(e===93||e===224)&&(e=91),e in Un){Un[e]=!1;for(const r in Io)Io[r]===e&&(Jr[r]=!1)}}function wF(n){if(typeof n>"u")Object.keys(Zt).forEach(i=>{Array.isArray(Zt[i])&&Zt[i].forEach(s=>_g(s)),delete Zt[i]}),u7(null);else if(Array.isArray(n))n.forEach(i=>{i.key&&_g(i)});else if(typeof n=="object")n.key&&_g(n);else if(typeof n=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];let[i,s]=t;typeof i=="function"&&(s=i,i=""),_g({key:n,scope:i,method:s,splitKey:"+"})}}const _g=n=>{let{key:e,scope:t,method:r,splitKey:i="+"}=n;vF(e).forEach(o=>{const a=o.split(i),l=a.length,c=a[l-1],u=c==="*"?"*":f0(c);if(!Zt[u])return;t||(t=kp());const d=l>1?yF(Io,a):[],h=[];Zt[u]=Zt[u].filter(p=>{const m=(r?p.method===r:!0)&&p.scope===t&&qve(p.mods,d);return m&&h.push(p.element),!m}),h.forEach(p=>u7(p))})};function r9(n,e,t,r){if(e.element!==r)return;let i;if(e.scope===t||e.scope==="all"){i=e.mods.length>0;for(const s in Un)Object.prototype.hasOwnProperty.call(Un,s)&&(!Un[s]&&e.mods.indexOf(+s)>-1||Un[s]&&e.mods.indexOf(+s)===-1)&&(i=!1);(e.mods.length===0&&!Un[16]&&!Un[18]&&!Un[17]&&!Un[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Tt),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}function i9(n,e){const t=Zt["*"];let r=n.keyCode||n.which||n.charCode;if(!Jr.filter.call(this,n))return;if((r===93||r===224)&&(r=91),Tt.indexOf(r)===-1&&r!==229&&Tt.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(a=>{const l=W4[a];n[a]&&Tt.indexOf(l)===-1?Tt.push(l):!n[a]&&Tt.indexOf(l)>-1?Tt.splice(Tt.indexOf(l),1):a==="metaKey"&&n[a]&&Tt.length===3&&(n.ctrlKey||n.shiftKey||n.altKey||(Tt=Tt.slice(Tt.indexOf(l))))}),r in Un){Un[r]=!0;for(const a in Io)Io[a]===r&&(Jr[a]=!0);if(!t)return}for(const a in Un)Object.prototype.hasOwnProperty.call(Un,a)&&(Un[a]=n[W4[a]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(Tt.indexOf(17)===-1&&Tt.push(17),Tt.indexOf(18)===-1&&Tt.push(18),Un[17]=!0,Un[18]=!0);const i=kp();if(t)for(let a=0;a<t.length;a++)t[a].scope===i&&(n.type==="keydown"&&t[a].keydown||n.type==="keyup"&&t[a].keyup)&&r9(n,t[a],i,e);if(!(r in Zt))return;const s=Zt[r],o=s.length;for(let a=0;a<o;a++)if((n.type==="keydown"&&s[a].keydown||n.type==="keyup"&&s[a].keyup)&&s[a].key){const l=s[a],{splitKey:c}=l,u=l.key.split(c),d=[];for(let h=0;h<u.length;h++)d.push(f0(u[h]));d.sort().join("")===Tt.sort().join("")&&r9(n,l,i,e)}}function Jr(n,e,t){Tt=[];const r=vF(n);let i=[],s="all",o=document,a=0,l=!1,c=!0,u="+",d=!1,h=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(s=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(h=!0)),typeof e=="string"&&(s=e),h&&wF(n,s);a<r.length;a++)n=r[a].split(u),i=[],n.length>1&&(i=yF(Io,n)),n=n[n.length-1],n=n==="*"?"*":f0(n),n in Zt||(Zt[n]=[]),Zt[n].push({keyup:l,keydown:c,scope:s,mods:i,shortcut:r[a],method:t,key:r[a],splitKey:u,element:o});if(typeof o<"u"&&window){if(!Yo.has(o)){const p=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return i9(m,o)},g=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;i9(m,o),eSe(m)};Yo.set(o,{keydownListener:p,keyupListenr:g,capture:d}),M2(o,"keydown",p,d),M2(o,"keyup",g,d)}if(!Df){const p=()=>{Tt=[]};Df={listener:p,capture:d},M2(window,"focus",p,d)}}}function tSe(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Zt).forEach(t=>{Zt[t].filter(i=>i.scope===e&&i.shortcut===n).forEach(i=>{i&&i.method&&i.method()})})}function u7(n){const e=Object.values(Zt).flat();if(e.findIndex(r=>{let{element:i}=r;return i===n})<0){const{keydownListener:r,keyupListenr:i,capture:s}=Yo.get(n)||{};r&&i&&(zh(n,"keyup",i,s),zh(n,"keydown",r,s),Yo.delete(n))}if((e.length<=0||Yo.size<=0)&&(Object.keys(Yo).forEach(i=>{const{keydownListener:s,keyupListenr:o,capture:a}=Yo.get(i)||{};s&&o&&(zh(i,"keyup",o,a),zh(i,"keydown",s,a),Yo.delete(i))}),Yo.clear(),Object.keys(Zt).forEach(i=>delete Zt[i]),Df)){const{listener:i,capture:s}=Df;zh(window,"focus",i,s),Df=null}}const A2={getPressedKeyString:Xve,setScope:xF,getScope:kp,deleteScope:Jve,getPressedKeyCodes:Gve,getAllKeyCodes:Kve,isPressed:Zve,filter:Yve,trigger:tSe,unbind:wF,keyMap:Op,modifier:Io,modifierMap:W4};for(const n in A2)Object.prototype.hasOwnProperty.call(A2,n)&&(Jr[n]=A2[n]);if(typeof window<"u"){const n=window.hotkeys;Jr.noConflict=e=>(e&&window.hotkeys===Jr&&(window.hotkeys=n),Jr),window.hotkeys=Jr}const s9=["copy","cut","paste","asset"];function nSe(){const n=G(),e=Da(),t=Ce(),r=Rd(),i=ee("is focused",()=>n.getInstanceState().isFocused,[n]);k.useEffect(()=>{if(!i)return;const s=new Array,o=(l,c)=>{Jr(l,{element:document.body},c),s.push(()=>{Jr.unbind(l,c)})},a=(l,c)=>{Jr(l,{element:document.body,keyup:!0,keydown:!1},c),s.push(()=>{Jr.unbind(l,c)})};for(const l of Object.values(t))l.kbd&&(e&&!l.readonlyOk||s9.includes(l.id)||o(o9(l.kbd),c=>{hf(n)||(tt(c),l.onSelect("kbd"))}));for(const l of Object.values(r))!l.kbd||!l.readonlyOk&&n.getInstanceState().isReadonly||s9.includes(l.id)||o(o9(l.kbd),c=>{hf(n)||(tt(c),l.onSelect("kbd"))});return o(",",l=>{if(hf(n)||n.inputs.keys.has("Comma"))return;tt(l),n.focus(),n.inputs.keys.add("Comma");const{x:c,y:u,z:d}=n.inputs.currentScreenPoint,h={type:"pointer",name:"pointer_down",point:{x:c,y:u,z:d},shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(h)}),a(",",l=>{if(hf(n)||!n.inputs.keys.has("Comma"))return;n.inputs.keys.delete("Comma");const{x:c,y:u,z:d}=n.inputs.currentScreenPoint,h={type:"pointer",name:"pointer_up",point:{x:c,y:u,z:d},shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(h)}),()=>{s.forEach(l=>l())}},[t,r,e,n,i])}function o9(n){return rSe(n).map(e=>{let t="";const r=e.split("");return r.length===1?t=r[0]:r[0]==="!"?t=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?t=`alt+shift+${r[2]}`:t=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?t=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?t=`cmd++${r[2]},ctrl+alt+${r[2]}`:t=`cmd+${r[1]},ctrl+${r[1]}`:t=e,t}).join(",")}function rSe(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function hf(n){return n.getIsMenuOpen()||n.getEditingShapeId()!==null||n.getCrashingError()}const iSe=k.createContext(!1);function sSe({children:n}){const e=G(),t=ID(),r=Lr(),i=Xe(),s=Math.min(8,5+r),[o,a]=k.useState(0),l=k.useRef(null),[c,u]=k.useState(null),d=k.useMemo(()=>{const p=c?`:not([data-value="${c}"])`:"";return`
			#${t}_main > *:nth-child(n + ${s+(c?1:2)})${p} {
				display: none;
			}
			#${t}_more > *:nth-child(-n + ${s}) {
				display: none;
			}
        `},[c,t,s]),h=sj(()=>{if(!l.current)return;const p=Array.from(l.current.children);a(p.length),p.findIndex(S=>S.getAttribute("data-value")===c)<=s&&u(null);const m=Array.from(l.current.children).findIndex(S=>S.getAttribute("aria-checked")==="true");m!==-1&&m>=s&&u(p[m].getAttribute("data-value"))});return k.useLayoutEffect(()=>{h()}),k.useLayoutEffect(()=>{if(!l.current)return;const p=new MutationObserver(h);return p.observe(l.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{p.disconnect()}},[h]),k.useEffect(()=>{const p=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[g,m]of p)Jr(g,S=>{var w;if(hf(e))return;tt(S);const x=Array.from(((w=l.current)==null?void 0:w.children)??[]).filter(O=>!(O instanceof HTMLElement)||O.tagName.toLowerCase()!=="button"?!1:!!(O.offsetWidth||O.offsetHeight))[m];x&&x.click()});return()=>{Jr.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),f.jsxs(f.Fragment,{children:[f.jsx("style",{children:d}),f.jsxs("div",{className:Te("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<sn.TABLET_SM}),role:"radiogroup",children:[f.jsx("div",{id:`${t}_main`,ref:l,className:"tlui-toolbar__tools__list",children:f.jsx(ss,{type:"toolbar",sourceId:"toolbar",children:n})}),o>s+1&&f.jsx(iSe.Provider,{value:!0,children:f.jsxs(Gc,{id:"toolbar overflow",modal:!1,children:[f.jsx(Xc,{children:f.jsx(Ee,{title:i("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:f.jsx(We,{icon:"chevron-up"})})}),f.jsx(Kc,{side:"top",align:"center",children:f.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${t}_more`,children:f.jsx(ss,{type:"toolbar-overflow",sourceId:"toolbar",children:n})})})]})})]})]})}function oSe({activeToolId:n}){const e=G(),t=Lr(),r=Xe(),i=ee("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),s=ee("current tool",()=>e.getCurrentTool(),[e]);return!n||!s.isLockable?null:f.jsx(Ee,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:Te("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<sn.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!i}),children:f.jsx(We,{icon:i?"lock":"unlock",small:!0})})}const bF=k.memo(function({children:e}){const t=G(),r=Lr(),i=Da(),s=ee("current tool id",()=>t.getCurrentToolId(),[t]),{ActionsMenu:o,QuickActions:a}=tc();return f.jsx("div",{className:"tlui-toolbar",children:f.jsxs("div",{className:"tlui-toolbar__inner",children:[f.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&f.jsxs("div",{className:"tlui-toolbar__extras",children:[r<sn.TABLET&&f.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[a&&f.jsx(a,{}),o&&f.jsx(o,{})]}),f.jsx(oSe,{activeToolId:s})]}),f.jsx(sSe,{children:e??f.jsx(mF,{})})]}),r<sn.TABLET_SM&&!i&&f.jsx("div",{className:"tlui-toolbar__tools",children:f.jsx(mve,{})})]})})});function aSe(){const n=Xe();return f.jsxs("div",{className:Te("tlui-offline-indicator"),children:[n("status.offline"),f.jsx(To,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function lSe({maxWidth:n=420,ignoreRightWidth:e=0,stylePanelWidth:t=148,marginBetweenZones:r=12,squeezeAmount:i=52,children:s}){const o=k.useRef(null),a=Lr(),l=k.useCallback(()=>{const c=o.current;if(!c)return;const u=c.parentElement.parentElement,d=u.querySelector(".tlui-layout__top__left"),h=u.querySelector(".tlui-layout__top__right"),p=u.offsetWidth,g=d.offsetWidth,m=h.offsetWidth,S=c.offsetWidth-e;let y=(p-S)/2;p%2!==0&&(y-=.5);const x=g+r,w=c.offsetLeft,O=Math.min(p-m-g-2*r,n),T=Math.max(y,x)-w;h.offsetWidth>t&&a<=6?c.style.setProperty("max-width",O-i+"px"):c.style.setProperty("max-width",O+"px"),c.style.setProperty("transform",`translate(${T}px, 0px)`)},[a,e,r,n,i,t]);return k.useLayoutEffect(()=>{const c=o.current;if(!c)return;const u=c.parentElement.parentElement,d=u.querySelector(".tlui-layout__top__left"),h=u.querySelector(".tlui-layout__top__right"),p=new ResizeObserver(l);return p.observe(d),p.observe(h),p.observe(u),p.observe(c),l(),()=>{p.disconnect()}},[l]),k.useLayoutEffect(()=>{l()}),f.jsx("div",{ref:o,className:"tlui-top-panel__container",children:s})}function cSe(){const n=Bpe()==="offline";return f.jsx(lSe,{children:n&&f.jsx(aSe,{})})}function uSe(){const n=Ce();return f.jsxs(f.Fragment,{children:[f.jsx(Z,{...n["zoom-in"],noClose:!0}),f.jsx(Z,{...n["zoom-out"],noClose:!0}),f.jsx(N$,{}),f.jsx($$,{}),f.jsx(F$,{})]})}const dSe=k.memo(function({children:e}){const t=Nn(),[r,i]=La("zoom menu"),s=e??f.jsx(uSe,{});return f.jsxs(i7,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[f.jsx(s7,{asChild:!0,dir:"ltr",children:f.jsx(hSe,{})}),f.jsx(pS,{container:t,children:f.jsx(o7,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:f.jsx(ss,{type:"menu",sourceId:"zoom-menu",children:s})})})]})}),hSe=k.forwardRef(function(e,t){const r=G(),i=Lr(),s=ee("zoom",()=>r.getZoomLevel(),[r]),o=Xe(),a=k.useCallback(()=>{r.resetZoom(r.getViewportScreenCenter(),{animation:{duration:r.options.animationMediumMs}})},[r]);return f.jsx(Ee,{ref:t,...e,type:"icon",title:`${o("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:i<sn.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:i<sn.MOBILE?"zoom-in":void 0,children:i<sn.MOBILE?null:f.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(s*100),"%"]})})}),OF=k.createContext(null);function fSe({overrides:n={},children:e}){const t=e0(n),r=oS();return f.jsx(OF.Provider,{value:k.useMemo(()=>({ContextMenu:$1e,ActionsMenu:h1e,HelpMenu:null,ZoomMenu:dSe,MainMenu:J$,Minimap:Oye,StylePanel:gve,PageMenu:Tye,NavigationPanel:Cye,Toolbar:bF,KeyboardShortcutsDialog:X$,QuickActions:Iye,HelperButtons:oye,DebugPanel:Y1e,DebugMenu:K1e,MenuPanel:tye,SharePanel:r?Lye:null,CursorChatBubble:r?U1e:null,TopPanel:r?cSe:null,...t}),[t,r]),children:e})}function tc(){const n=k.useContext(OF);if(!n)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return n}function pSe({overrides:n,components:e,assetUrls:t,onUiEvent:r,forceMobile:i,children:s}){return f.jsx(cde,{assetUrls:Yfe(t),children:f.jsx(hde,{overrides:npe(n),children:f.jsx(gfe,{onEvent:r,children:f.jsx(Qfe,{children:f.jsx(mfe,{children:f.jsx(Jfe,{forceMobile:i,children:f.jsx(fSe,{overrides:e,children:f.jsx(gSe,{overrides:n,children:s})})})})})})})})}function gSe({overrides:n,children:e}){const t=rpe(n);return f.jsx(Qpe,{overrides:t.actions,children:f.jsx(Zfe,{overrides:t.tools,children:e})})}function mSe(){const n=G(),{addToast:e}=Fs();k.useEffect(()=>{function t({name:r,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${i}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return n.addListener("max-shapes",t),()=>{n.removeListener("max-shapes",t)}},[n,e])}const ySe=Qe.memo(function({renderDebugMenuItems:e,children:t,hideUi:r,components:i,...s}){return f.jsx(pSe,{...s,components:i,children:f.jsx(vSe,{hideUi:r,renderDebugMenuItems:e,children:t})})}),vSe=Qe.memo(function({children:e,hideUi:t,...r}){return f.jsxs(f.Fragment,{children:[e,t?null:f.jsx(SSe,{...r})]})}),SSe=Qe.memo(function(){const e=G(),t=Xe(),r=Lr(),i=Da(),s=ee("focus",()=>e.getInstanceState().isFocusMode,[e]),o=ee("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:l,MenuPanel:c,StylePanel:u,Toolbar:d,HelpMenu:h,NavigationPanel:p,HelperButtons:g,DebugPanel:m,CursorChatBubble:S}=tc();nSe(),Ape(),mSe();const{"toggle-focus-mode":y}=Ce();return f.jsxs("div",{className:Te("tlui-layout",{"tlui-layout__mobile":r<sn.TABLET_SM}),"data-breakpoint":r,children:[s?f.jsx("div",{className:"tlui-layout__top",children:f.jsx(Ee,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>y.onSelect("menu"),children:f.jsx(We,{icon:"dot"})})}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"tlui-layout__top",children:[f.jsxs("div",{className:"tlui-layout__top__left",children:[c&&f.jsx(c,{}),g&&f.jsx(g,{})]}),f.jsx("div",{className:"tlui-layout__top__center",children:l&&f.jsx(l,{})}),f.jsxs("div",{className:"tlui-layout__top__right",children:[a&&f.jsx(a,{}),u&&r>=sn.TABLET_SM&&!i&&f.jsx(u,{})]})]}),f.jsxs("div",{className:"tlui-layout__bottom",children:[f.jsxs("div",{className:"tlui-layout__bottom__main",children:[p&&f.jsx(p,{}),d&&f.jsx(d,{}),h&&f.jsx(h,{})]}),o&&m&&f.jsx(m,{})]})]}),f.jsx(Gfe,{}),f.jsx(Sfe,{}),f.jsx(Xfe,{}),f.jsx(xfe,{}),S&&f.jsx(S,{})]})});async function xSe(n,e){const{url:t,style:r="normal",weight:i="500",display:s,featureSettings:o,stretch:a,unicodeRange:l,variant:c,format:u}=e,d={style:r,weight:i,display:s,featureSettings:o,stretch:a,unicodeRange:l,variant:c},h=new FontFace(n,`url(${t})`,d);return await h.load(),document.fonts.add(h),h.$$_url=t,h.$$_fontface=`
@font-face {
	font-family: ${h.family};
	font-stretch: ${h.stretch};
	font-weight: ${h.weight};
	font-style: ${h.style};
	src: url("${t}") format("${u}")
}`,h}const Rg=(n,e)=>{const[t,r]=k.useState(2);return k.useEffect(()=>{let i=!1;return r(2),xSe(n,e).then(()=>{i||r(0)}).catch(s=>{i||(console.error(s),r(1))}),()=>{i=!0}},[n,e]),t};function wSe(n){return{draw:{url:n.fonts.draw,format:n.fonts.draw.split(".").pop()},serif:{url:n.fonts.serif,format:n.fonts.serif.split(".").pop()},sansSerif:{url:n.fonts.sansSerif,format:n.fonts.sansSerif.split(".").pop()},monospace:{url:n.fonts.monospace,format:n.fonts.monospace.split(".").pop()}}}function kF(n){const e=k.useMemo(()=>wSe(n),[n]),t=[Rg("tldraw_draw",e.draw),Rg("tldraw_serif",e.serif),Rg("tldraw_sans",e.sansSerif),Rg("tldraw_mono",e.monospace)];return{error:t.some(r=>r===1),done:!t.some(r=>r===2)}}function bSe(n){const{children:e,maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s,onMount:o,components:a={},shapeUtils:l=[],bindingUtils:c=[],tools:u=[],...d}=n,h=e0(a),p=k.useMemo(()=>({Scribble:BP,ShapeIndicators:Wle,CollaboratorScribble:BP,SelectionForeground:Hle,SelectionBackground:Ble,Handles:Lle,...h}),[h]),g=Af(l),m=k.useMemo(()=>[...dO,...g],[g]),S=Af(c),y=k.useMemo(()=>[...Sj,...S],[S]),x=Af(u),w=k.useMemo(()=>[...Nde,...Wce,...x],[x]),O=fz(d.assetUrls),{done:T,error:E}=kF(O);return E?f.jsx(gj,{children:"Could not load assets. Please refresh the page."}):T?f.jsx(wle,{initialState:"select",...d,components:p,shapeUtils:m,bindingUtils:y,tools:w,children:f.jsxs(ySe,{...d,components:p,children:[f.jsx(OSe,{maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s,onMount:o}),e]})}):f.jsx(Z6,{children:f.jsx($6,{})})}function OSe({maxImageDimension:n=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:t=S6,acceptedVideoMimeTypes:r=tR,onMount:i}){const s=G(),o=Fs(),a=Xe();mj(()=>{const u=[];return u.push(bde(s)),Ece(s,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:r},{toasts:o,msg:a}),u.push(s.store.props.onMount(s)),u.push(i==null?void 0:i(s)),()=>{u.forEach(d=>d==null?void 0:d())}});const{Canvas:l}=Qt(),{ContextMenu:c}=tc();return c?f.jsx(c,{}):l?f.jsx(l,{}):null}k.memo(function(e){const[t,r]=k.useState(null),[i,s]=k.useState(null),o=Af(e.shapeUtils??[]),a=k.useMemo(()=>[...dO,...o],[o]),l=Af(e.bindingUtils??[]),c=k.useMemo(()=>[...Sj,...l],[l]),u=Tle({snapshot:e.snapshot,shapeUtils:a}),d=fz(),{done:h,error:p}=kF(d),{pageId:g,bounds:m,scale:S,background:y,padding:x,darkMode:w,preserveAspectRatio:O,format:T="svg",licenseKey:E}=e;return k.useLayoutEffect(()=>{if(!i||!u||!h)return;let C=!1;const M=document.createElement("div");i.appendChild(M),i.classList.add("tl-container","tl-theme__light");const A=new ge({store:u,shapeUtils:a,bindingUtils:c,tools:[],getContainer:()=>M,licenseKey:E});g&&A.setCurrentPage(g);const D=A.getCurrentPageShapeIds();async function N(){const F=await A.getSvgString([...D],{bounds:m,scale:S,background:y,padding:x,darkMode:w,preserveAspectRatio:O});if(F&&!C){if(T==="svg"){if(!C){const j=new Blob([F.svg],{type:"image/svg+xml"}),L=URL.createObjectURL(j);r(L)}}else if(T==="png"){const j=await bz(A,F.svg,{type:T,quality:1,scale:2,width:F.width,height:F.height});if(j&&!C){const L=URL.createObjectURL(j);r(L)}}}A.dispose()}return N(),()=>{C=!0}},[T,i,u,a,c,g,m,S,y,x,w,O,h,p,E]),p?f.jsx(gj,{children:"Could not load assets."}):h?f.jsx("div",{ref:s,style:{position:"relative",width:"100%",height:"100%"},children:t&&f.jsx("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):f.jsx(Z6,{children:f.jsx($6,{})})});k.memo(function({children:e}){const t=Xe(),r=Lr(),i=e??f.jsx(cye,{});return r<sn.MOBILE?null:f.jsx("div",{className:"tlui-help-menu",children:f.jsxs(Gc,{id:"help menu",children:[f.jsx(Xc,{children:f.jsx(Ee,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:f.jsx(We,{icon:"question-mark",small:!0})})}),f.jsx(Kc,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:f.jsx(ss,{type:"menu",sourceId:"help-menu",children:i})})]})})});const kSe=Ve({schemaVersion:yr(1),storeVersion:Pm,recordVersions:iy(ze,Ve({version:Pm,subTypeVersions:iy(ze,Pm).optional(),subTypeKey:ze.optional()}))}),CSe=Ve({schemaVersion:yr(2),sequences:iy(ze,Pm)});Ve({tldrawFileFormatVersion:Lne,schema:zne("schemaVersion",{1:kSe,2:CSe}),records:qn(Ve({id:ze,typeName:ze}).allowUnknownProperties())});const PSe=1024*1024,TSe=4,ESe=PSe/TSe;function ISe(n,e=ESe){if(n.length<e)return[n];{const t=[];let r=0,i=n.length;for(;i>0;){const s=`${r}_`,o=Math.max(Math.min(e-s.length,i),1);t.unshift(s+n.slice(i-o,i)),i-=o,r++}return t}}let MSe=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const Jo={Put:"put",Patch:"patch",Remove:"remove"},ASe=n=>{let e=null;for(const[t,r]of Kn(n.added))e||(e={}),e[t]=[Jo.Put,r];for(const[t,r]of Gt(n.updated)){const i=CF(t,r);i&&(e||(e={}),e[r.id]=[Jo.Patch,i])}for(const t of Object.keys(n.removed))e||(e={}),e[t]=[Jo.Remove];return e},hr={Put:"put",Delete:"delete",Append:"append",Patch:"patch"};function CF(n,e){return d7(n,e,new Set(["props"]))}function d7(n,e,t){if(n===e)return null;let r=null;for(const i of Object.keys(n)){if(!(i in e)){r||(r={}),r[i]=[hr.Delete];continue}const s=n[i],o=e[i];if(!Nc(s,o))if(t!=null&&t.has(i)&&s&&o){const a=d7(s,o);a&&(r||(r={}),r[i]=[hr.Patch,a])}else if(Array.isArray(o)&&Array.isArray(s)){const a=PF(s,o);a&&(r||(r={}),r[i]=a)}else r||(r={}),r[i]=[hr.Put,o]}for(const i of Object.keys(e))i in n||(r||(r={}),r[i]=[hr.Put,e[i]]);return r}function _Se(n,e){if(Object.is(n,e))return null;if(Array.isArray(n)&&Array.isArray(e))return PF(n,e);if(!n||!e||typeof n!="object"||typeof e!="object")return Nc(n,e)?null:[hr.Put,e];{const t=d7(n,e);return t?[hr.Patch,t]:null}}function PF(n,e){if(Object.is(n,e))return null;if(n.length===e.length){const t=Math.max(n.length/5,1),r=[];for(let s=0;s<n.length;s++)if(!Nc(n[s],e[s])&&(r.push(s),r.length>t))return[hr.Put,e];if(r.length===0)return null;const i={};for(const s of r){const o=n[s],a=e[s];if(!o||!a)i[s]=[hr.Put,a];else if(typeof o=="object"&&typeof a=="object"){const l=_Se(o,a);l&&(i[s]=l)}else i[s]=[hr.Put,a]}return[hr.Patch,i]}for(let t=0;t<n.length;t++)if(!Nc(n[t],e[t]))return[hr.Put,e];return[hr.Append,e.slice(n.length),n.length]}function TF(n,e){if(!n||typeof n!="object")return n;const t=Array.isArray(n);let r;const i=(s,o)=>{r||(t?r=[...n]:r={...n}),t?r[Number(s)]=o:r[s]=o};for(const[s,o]of Object.entries(e))switch(o[0]){case hr.Put:{const a=o[1];Nc(n[s],a)||i(s,a);break}case hr.Append:{const a=o[1],l=o[2],c=n[s];Array.isArray(c)&&c.length===l&&i(s,[...c,...a]);break}case hr.Patch:{if(n[s]&&typeof n[s]=="object"){const a=o[1],l=TF(n[s],a);l!==n[s]&&i(s,l)}break}case hr.Delete:s in n&&(r||(t?(console.error("Can't delete array item yet (this should never happen)"),r=[...n]):r={...n}),delete r[s])}return r??n}function a9(n,e){const t=setInterval(n,e);return()=>clearInterval(t)}const RSe=6;function DSe(){return RSe}const jSe={ClientTooOld:"clientTooOld",ServerTooOld:"serverTooOld",InvalidRecord:"invalidRecord",InvalidOperation:"invalidOperation",RoomNotFound:"roomNotFound"},EF={NOT_FOUND:4099},V4=5e3,LSe=V4*2;class zSe{constructor(e){v(this,"lastServerClock",0);v(this,"lastServerInteractionTimestamp",Date.now());v(this,"pendingPushRequests",[]);v(this,"speculativeChanges",{added:{},updated:{},removed:{}});v(this,"disposables",[]);v(this,"store");v(this,"socket");v(this,"presenceState");v(this,"isConnectedToRoom",!1);v(this,"clientClock",0);v(this,"onAfterConnect");v(this,"onSyncError");v(this,"isDebugging",!1);v(this,"presenceType");v(this,"didCancel");v(this,"latestConnectRequestId",null);v(this,"incomingDiffBuffer",[]);v(this,"handleServerEvent",e=>{switch(this.debug("received server event",e),this.lastServerInteractionTimestamp=Date.now(),e.type){case"connect":this.didReconnect(e);break;case"error":console.error("Server error",e.error),console.error("Restarting socket"),this.socket.restart();break;case"patch":case"push_result":if(!this.isConnectedToRoom)break;this.incomingDiffBuffer.push(e),this.scheduleRebase();break;case"data":if(!this.isConnectedToRoom)break;this.incomingDiffBuffer.push(...e.data),this.scheduleRebase();break;case"incompatibility_error":this.onSyncError(e.reason);break;case"pong":break;default:Vn(e)}});v(this,"lastPushedPresenceState",null);v(this,"flushPendingPushRequests",$C(()=>{if(this.debug("flushing pending push requests",{isConnectedToRoom:this.isConnectedToRoom,pendingPushRequests:this.pendingPushRequests}),!(!this.isConnectedToRoom||this.store.isPossiblyCorrupted())){for(const e of this.pendingPushRequests)if(!e.sent){if(this.socket.connectionStatus!=="online")return;this.socket.sendMessage(e.request),e.sent=!0}}}));v(this,"rebase",()=>{var t;if(this.store._flushHistory(),this.incomingDiffBuffer.length===0)return;const e=this.incomingDiffBuffer;this.incomingDiffBuffer=[];try{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(cp(this.speculativeChanges),{runCallbacks:!1});for(const r of e){if(r.type==="patch"){this.applyNetworkDiff(r.diff,!0);continue}if(this.pendingPushRequests.length===0)throw new Error("Received push_result but there are no pending push requests");if(this.pendingPushRequests[0].request.clientClock!==r.clientClock)throw new Error("Received push_result for a push request that is not at the front of the queue");if(r.action==="discard")this.pendingPushRequests.shift();else if(r.action==="commit"){const{request:i}=this.pendingPushRequests.shift();"diff"in i&&i.diff&&this.applyNetworkDiff(i.diff,!0)}else this.applyNetworkDiff(r.action.rebaseWithDiff,!0),this.pendingPushRequests.shift()}try{this.speculativeChanges=this.store.extractingChanges(()=>{for(const{request:r}of this.pendingPushRequests)!("diff"in r)||!r.diff||this.applyNetworkDiff(r.diff,!0)})}catch(r){console.error(r),this.speculativeChanges={added:{},updated:{},removed:{}},this.resetConnection()}}),this.store.ensureStoreIsUsable(),this.lastServerClock=((t=e.at(-1))==null?void 0:t.serverClock)??this.lastServerClock}catch(r){console.error(r),this.store.ensureStoreIsUsable(),this.resetConnection()}});v(this,"scheduleRebase",$C(this.rebase));if(this.didCancel=e.didCancel,this.presenceType=e.store.scopedTypes.presence.values().next().value,!this.presenceType||e.store.scopedTypes.presence.size>1)throw new Error("Store must have exactly one presence type");typeof window<"u"&&(window.tlsync=this),this.store=e.store,this.socket=e.socket,this.onAfterConnect=e.onAfterConnect,this.onSyncError=e.onSyncError;let t=!1;this.presenceState=e.presence,this.disposables.push(this.store.listen(({changes:r})=>{var i;if((i=this.didCancel)!=null&&i.call(this))return this.close();this.debug("received store changes",{changes:r}),this.push(r)},{source:"user",scope:"document"}),this.socket.onReceiveMessage(r=>{var i;if((i=this.didCancel)!=null&&i.call(this))return this.close();this.debug("received message from server",r),this.handleServerEvent(r),t||(t=!0,r.type==="error"?e.onLoadError(r.error):e.onLoad(this))}),this.socket.onStatusChange(r=>{var i;if((i=this.didCancel)!=null&&i.call(this))return this.close();this.debug("socket status changed",r),r==="online"?this.sendConnectMessage():(this.resetConnection(),r==="error"&&!t&&(t=!0,e.onLoadError(new Error("socket error"))))}),a9(()=>{var r;if((r=this.didCancel)!=null&&r.call(this))return this.close();if(this.debug("ping loop",{isConnectedToRoom:this.isConnectedToRoom}),!!this.isConnectedToRoom)try{this.socket.sendMessage({type:"ping"})}catch(i){console.warn("ping failed, resetting",i),this.resetConnection()}},V4),a9(()=>{var i;if((i=this.didCancel)!=null&&i.call(this))return this.close();if(this.debug("health check loop",{isConnectedToRoom:this.isConnectedToRoom}),!this.isConnectedToRoom)return;const r=Date.now()-this.lastServerInteractionTimestamp;if(r<LSe){this.debug("health check passed",{timeSinceLastServerInteraction:r});return}console.warn("Haven't heard from the server in a while, resetting connection..."),this.resetConnection()},V4*2)),this.presenceState&&this.disposables.push(Xl("pushPresence",()=>{var r;if((r=this.didCancel)!=null&&r.call(this))return this.close();this.pushPresence(this.presenceState.get())})),this.socket.connectionStatus==="online"&&this.sendConnectMessage()}debug(...e){this.isDebugging&&console.debug(...e)}sendConnectMessage(){if(this.isConnectedToRoom){console.error("sendConnectMessage called while already connected");return}this.debug("sending connect message"),this.latestConnectRequestId=MSe(),this.socket.sendMessage({type:"connect",connectRequestId:this.latestConnectRequestId,schema:this.store.schema.serialize(),protocolVersion:DSe(),lastServerClock:this.lastServerClock})}resetConnection(e=!1){this.debug("resetting connection"),e&&(this.lastServerClock=0),this.store.mergeRemoteChanges(()=>{this.store.remove(Object.keys(this.store.serialize("presence")))}),this.lastPushedPresenceState=null,this.isConnectedToRoom=!1,this.pendingPushRequests=[],this.incomingDiffBuffer=[],this.socket.connectionStatus==="online"&&this.socket.restart()}didReconnect(e){if(this.debug("did reconnect",e),e.connectRequestId===this.latestConnectRequestId){if(this.latestConnectRequestId=null,this.isConnectedToRoom){console.error("didReconnect called while already connected"),this.resetConnection(!0);return}if(this.pendingPushRequests.length>0){console.error("pendingPushRequests should already be empty when we reconnect"),this.resetConnection(!0);return}Es(()=>{var r;const t=this.speculativeChanges;this.speculativeChanges={added:{},updated:{},removed:{}},this.store.mergeRemoteChanges(()=>{const i={},s=e.hydrationType==="wipe_all";s||this.store.applyDiff(cp(t),{runCallbacks:!1});for(const[a,l]of Kn(this.store.serialize("all")))(s&&this.store.scopedTypes.document.has(l.typeName)||l.typeName===this.presenceType)&&(i[a]=[Jo.Remove]);this.applyNetworkDiff({...i,...e.diff},!0),this.isConnectedToRoom=!0;const o=this.store.filterChangesByScope(this.store.extractingChanges(()=>{this.store.applyDiff(t)}),"document");o&&this.push(o)}),this.store.ensureStoreIsUsable(),(r=this.onAfterConnect)==null||r.call(this,this,!1)}),this.lastServerClock=e.serverClock}}close(){var e,t,r,i;this.debug("closing"),this.disposables.forEach(s=>s()),(t=(e=this.flushPendingPushRequests).cancel)==null||t.call(e),(i=(r=this.scheduleRebase).cancel)==null||i.call(r)}pushPresence(e){if(this.store._flushHistory(),!this.isConnectedToRoom)return;let t;if(!this.lastPushedPresenceState&&e)t=[Jo.Put,e];else if(this.lastPushedPresenceState&&e){const s=CF(this.lastPushedPresenceState,e);s&&(t=[Jo.Patch,s])}if(!t)return;this.lastPushedPresenceState=e;const r=this.pendingPushRequests.at(-1);if(r&&!r.sent&&!r.request.presence){r.request.presence=t;return}const i={type:"push",clientClock:this.clientClock++,presence:t};i&&(this.pendingPushRequests.push({request:i,sent:!1}),this.flushPendingPushRequests())}push(e){this.debug("push",e);const t=ASe(e);if(!t||(this.speculativeChanges=Mv([this.speculativeChanges,e]),!this.isConnectedToRoom))return;const r={type:"push",diff:t,clientClock:this.clientClock++};this.pendingPushRequests.push({request:r,sent:!1}),this.flushPendingPushRequests()}applyNetworkDiff(e,t){this.debug("applyNetworkDiff",e);const r={added:{},updated:{},removed:{}};let i=!1;for(const[s,o]of Kn(e))if(o[0]===Jo.Put){const a=this.store.get(s);a&&!Nc(a,o[1])?(i=!0,r.updated[s]=[a,o[1]]):(i=!0,r.added[s]=o[1])}else if(o[0]===Jo.Patch){const a=this.store.get(s);if(!a)continue;const l=TF(a,o[1]);i=!0,r.updated[s]=[a,l]}else o[0]===Jo.Remove&&this.store.has(s)&&(i=!0,r.removed[s]=this.store.get(s));i&&this.store.applyDiff(r,{runCallbacks:t})}}function Dg(n,e,t){return n.addEventListener(e,t),()=>{n.removeEventListener(e,t)}}function zt(...n){if(typeof window<"u"&&window.__tldraw_socket_debug){const e=new Date;console.log(`${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}.${e.getMilliseconds()}`,...n)}}class NSe{constructor(e){v(this,"_ws",null);v(this,"isDisposed",!1);v(this,"_reconnectManager");v(this,"_connectionStatus",mn("websocket connection status","initial"));v(this,"messageListeners",new Set);v(this,"statusListeners",new Set);this._reconnectManager=new HSe(this,e)}close(){var e;this.isDisposed=!0,this._reconnectManager.close(),(e=this._ws)==null||e.close()}_handleConnect(){zt("handleConnect"),this._connectionStatus.set("online"),this.statusListeners.forEach(e=>e("online")),this._reconnectManager.connected()}_handleDisconnect(e,t,r){zt("handleDisconnect",{currentStatus:this.connectionStatus,closeCode:t,reason:e});let i;switch(e){case"closed":if(t===EF.NOT_FOUND){i="error";break}i="offline";break;case"error":i="error";break;case"manual":i="offline";break}t===1006&&!r&&yne("Could not open WebSocket connection. This might be because you're trying to load a URL that doesn't support websockets. Check the URL you're trying to connect to."),this.connectionStatus!==i&&!(i==="error"&&this.connectionStatus==="offline")&&(this._connectionStatus.set(i),this.statusListeners.forEach(s=>s(i,t))),this._reconnectManager.disconnected()}_setNewSocket(e){var r;Ye(!this.isDisposed,"Tried to set a new websocket on a disposed socket"),Ye(this._ws===null||this._ws.readyState===WebSocket.CLOSED||this._ws.readyState===WebSocket.CLOSING,`Tried to set a new websocket in when the existing one was ${(r=this._ws)==null?void 0:r.readyState}`);let t=!1;e.onopen=()=>{zt("ws.onopen"),Ye(this._ws===e,"sockets must only be orphaned when they are CLOSING or CLOSED, so they can't open"),t=!0,this._handleConnect()},e.onclose=i=>{zt("ws.onclose",i),this._ws===e?this._handleDisconnect("closed",i.code,t):zt("ignoring onclose for an orphaned socket")},e.onerror=i=>{zt("ws.onerror",i),this._ws===e?this._handleDisconnect("error"):zt("ignoring onerror for an orphaned socket")},e.onmessage=i=>{Ye(this._ws===e,"sockets must only be orphaned when they are CLOSING or CLOSED, so they can't receive messages");const s=JSON.parse(i.data.toString());this.messageListeners.forEach(o=>o(s))},this._ws=e}_closeSocket(){this._ws!==null&&(this._ws.close(),this._ws=null,this._handleDisconnect("manual"))}get connectionStatus(){const e=this._connectionStatus.get();return e==="initial"?"offline":e}sendMessage(e){if(Ye(!this.isDisposed,"Tried to send message on a disposed socket"),!!this._ws)if(this.connectionStatus==="online"){const t=ISe(JSON.stringify(e));for(const r of t)this._ws.send(r)}else console.warn("Tried to send message while "+this.connectionStatus)}onReceiveMessage(e){return Ye(!this.isDisposed,"Tried to add message listener on a disposed socket"),this.messageListeners.add(e),()=>{this.messageListeners.delete(e)}}onStatusChange(e){return Ye(!this.isDisposed,"Tried to add status listener on a disposed socket"),this.statusListeners.add(e),()=>{this.statusListeners.delete(e)}}restart(){Ye(!this.isDisposed,"Tried to restart a disposed socket"),zt("restarting"),this._closeSocket(),this._reconnectManager.maybeReconnected()}}const Nh=500,$Se=2e3,FSe=1e3,BSe=1e3*60*5,USe=1.5,l9=1e3;class HSe{constructor(e,t){v(this,"isDisposed",!1);v(this,"disposables",[()=>{this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.recheckConnectingTimeout&&clearTimeout(this.recheckConnectingTimeout)}]);v(this,"reconnectTimeout",null);v(this,"recheckConnectingTimeout",null);v(this,"lastAttemptStart",null);v(this,"intendedDelay",Nh);v(this,"state");this.socketAdapter=e,this.getUri=t,this.subscribeToReconnectHints(),this.disposables.push(Dg(window,"offline",()=>{zt("window went offline"),this.socketAdapter._closeSocket()})),this.state="pendingAttempt",this.intendedDelay=Nh,this.scheduleAttempt()}subscribeToReconnectHints(){if(this.disposables.push(Dg(window,"online",()=>{zt("window went online"),this.maybeReconnected()}),Dg(document,"visibilitychange",()=>{document.hidden||(zt("document became visible"),this.maybeReconnected())})),Object.prototype.hasOwnProperty.call(navigator,"connection")){const e=navigator.connection;this.disposables.push(Dg(e,"change",()=>{zt("navigator.connection change"),this.maybeReconnected()}))}}scheduleAttempt(){Ye(this.state==="pendingAttempt"),zt("scheduling a connection attempt"),Promise.resolve(this.getUri()).then(e=>{var t;this.state!=="pendingAttempt"||this.isDisposed||(Ye(((t=this.socketAdapter._ws)==null?void 0:t.readyState)!==WebSocket.OPEN,"There should be no connection attempts while already connected"),this.lastAttemptStart=Date.now(),this.socketAdapter._setNewSocket(new WebSocket(QSe(e))),this.state="pendingAttemptResult")})}getMaxDelay(){return document.hidden?BSe:$Se}getMinDelay(){return document.hidden?FSe:Nh}clearReconnectTimeout(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}clearRecheckConnectingTimeout(){this.recheckConnectingTimeout&&(clearTimeout(this.recheckConnectingTimeout),this.recheckConnectingTimeout=null)}maybeReconnected(){var e,t;if(zt("ReconnectManager.maybeReconnected"),this.clearRecheckConnectingTimeout(),((e=this.socketAdapter._ws)==null?void 0:e.readyState)===WebSocket.OPEN){zt("ReconnectManager.maybeReconnected: already connected");return}if(((t=this.socketAdapter._ws)==null?void 0:t.readyState)===WebSocket.CONNECTING){zt("ReconnectManager.maybeReconnected: connecting"),Ye(this.lastAttemptStart,"ReadyState=CONNECTING without lastAttemptStart should be impossible");const r=Date.now()-this.lastAttemptStart;r<l9?(zt("ReconnectManager.maybeReconnected: connecting, rechecking later"),this.recheckConnectingTimeout=setTimeout(()=>this.maybeReconnected(),l9-r)):(zt("ReconnectManager.maybeReconnected: connecting, but for too long, retry now"),this.clearRecheckConnectingTimeout(),this.socketAdapter._closeSocket());return}zt("ReconnectManager.maybeReconnected: closing/closed/null, retry now"),this.intendedDelay=Nh,this.disconnected()}disconnected(){var e,t;if(zt("ReconnectManager.disconnected"),((e=this.socketAdapter._ws)==null?void 0:e.readyState)!==WebSocket.OPEN&&((t=this.socketAdapter._ws)==null?void 0:t.readyState)!==WebSocket.CONNECTING){zt("ReconnectManager.disconnected: websocket is not OPEN or CONNECTING"),this.clearReconnectTimeout();let r;this.state==="connected"?(this.intendedDelay=this.getMinDelay(),r=this.intendedDelay):r=this.lastAttemptStart!==null?this.lastAttemptStart+this.intendedDelay-Date.now():0,r>0?(zt("ReconnectManager.disconnected: delaying, delayLeft",r),this.state="delay",this.reconnectTimeout=setTimeout(()=>this.disconnected(),r)):(this.state="pendingAttempt",this.intendedDelay=Math.min(this.getMaxDelay(),Math.max(this.getMinDelay(),this.intendedDelay)*USe),zt("ReconnectManager.disconnected: attempting a connection, next delay",this.intendedDelay),this.scheduleAttempt())}}connected(){var e;zt("ReconnectManager.connected"),((e=this.socketAdapter._ws)==null?void 0:e.readyState)===WebSocket.OPEN&&(zt("ReconnectManager.connected: websocket is OPEN"),this.state="connected",this.clearReconnectTimeout(),this.intendedDelay=Nh)}close(){this.disposables.forEach(e=>e()),this.isDisposed=!0}}function QSe(n){return n.replace(/^http(s)?:/,"ws$1:")}class c9 extends Error{constructor(t){super(`remote sync error: ${t}`);v(this,"name","RemoteSyncError");this.reason=t}}const jg="multiplayer.client";function qSe(n){const[e,t]=K6(null),{uri:r,roomId:i="default",assets:s,onMount:o,trackAnalyticsEvent:a,userInfo:l,...c}=n,u=Ele(c),d=e0(l),h=Wre("userAtom",d);return k.useEffect(()=>{h.set(d)},[d,h]),k.useEffect(()=>{const p=wt(),g=te("userPreferences",()=>{const O=h.get(),T=(Aee(O)?O.get():O)??U6();return{id:T.id,color:T.color??gs.color,name:T.name??gs.name}}),m=new NSe(async()=>{const O=new URL(r);if(O.searchParams.has("sessionId"))throw new Error('useSync. "sessionId" is a reserved query param name. Please use a different name');if(O.searchParams.has("storeId"))throw new Error('useSync. "storeId" is a reserved query param name. Please use a different name');return O.searchParams.set("sessionId",pp),O.searchParams.set("storeId",p),O.toString()});m.onStatusChange((O,T)=>{if(O==="error"&&T===EF.NOT_FOUND){a==null||a(jg,{name:"room-not-found",roomId:i}),t({error:new c9(jSe.RoomNotFound)}),w.close(),m.close();return}});let S=!1;const y=te("collaboration status",()=>m.connectionStatus==="error"?"offline":m.connectionStatus),x=gp({id:p,schema:u,assets:s,onMount:o,collaboration:{status:y}}),w=new zSe({store:x,socket:m,didCancel:()=>S,onLoad(O){a==null||a(jg,{name:"load",roomId:i}),t({readyClient:O})},onLoadError(O){a==null||a(jg,{name:"load-error",roomId:i}),console.error(O),t({error:O})},onSyncError(O){a==null||a(jg,{name:"sync-error",roomId:i,reason:O}),t({error:new c9(O)})},onAfterConnect(){x.ensureStoreIsUsable()},presence:mre(g)(x)});return()=>{S=!0,w.close(),m.close(),t(null)}},[s,o,h,i,u,t,a,r]),ee("remote synced store",()=>{if(!e)return{status:"loading"};if(e.error)return{status:"error",error:e.error};if(!e.readyClient)return{status:"loading"};const p=e.readyClient.socket.connectionStatus;return{status:"synced-remote",connectionStatus:p==="error"?"offline":p,store:e.readyClient.store}},[e])}var WSe={};function IF(n){try{return n()}catch{return}}IF(()=>"https://demo.tldraw.xyz");IF(()=>WSe.TLDRAW_IMAGE_URL);const VSe={tools(n,e){return e.card={id:"card",icon:"sigma-icon",label:"Card",kbd:"c",onSelect:()=>{n.setCurrentTool("card")}},e.code={id:"code",icon:"python-icon",label:"Python",kbd:"p",onSelect:()=>{n.setCurrentTool("code")}},e}},GSe={Toolbar:n=>{const e=Rd(),t=q4(e.card),r=q4(e.code);return f.jsxs(bF,{...n,children:[f.jsx(mF,{}),f.jsx(Z,{...e.card,isSelected:t}),f.jsx(Z,{...e.code,isSelected:r})]})},KeyboardShortcutsDialog:n=>{const e=Rd();return f.jsxs(X$,{...n,children:[f.jsx(G$,{}),f.jsx(Z,{...e.card}),f.jsx(Z,{...e.code})]})}},ev=class ev extends cd{constructor(){super(...arguments),this.shapeType="card"}};ev.id="card",ev.initial="idle";let G4=ev;const XSe={w:Me,h:Me,text:ze};class vi{constructor(e,t,r){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=r}static range(e,t){return t?!e||!e.loc||!t.loc||e.loc.lexer!==t.loc.lexer?null:new vi(e.loc.lexer,e.loc.start,t.loc.end):e&&e.loc}}class es{constructor(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}range(e,t){return new es(t,vi.range(this,e))}}class oe{constructor(e,t){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var r="KaTeX parse error: "+e,i,s,o=t&&t.loc;if(o&&o.start<=o.end){var a=o.lexer.input;i=o.start,s=o.end,i===a.length?r+=" at end of input: ":r+=" at position "+(i+1)+": ";var l=a.slice(i,s).replace(/[^]/g,"$&"),c;i>15?c=""+a.slice(i-15,i):c=a.slice(0,i);var u;s+15<a.length?u=a.slice(s,s+15)+"":u=a.slice(s),r+=c+l+u}var d=new Error(r);return d.name="ParseError",d.__proto__=oe.prototype,d.position=i,i!=null&&s!=null&&(d.length=s-i),d.rawMessage=e,d}}oe.prototype.__proto__=Error.prototype;var KSe=function(e,t){return e.indexOf(t)!==-1},YSe=function(e,t){return e===void 0?t:e},ZSe=/([A-Z])/g,JSe=function(e){return e.replace(ZSe,"-$1").toLowerCase()},exe={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},txe=/[&><"']/g;function nxe(n){return String(n).replace(txe,e=>exe[e])}var MF=function n(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?n(e.body[0]):e:e.type==="font"?n(e.body):e},rxe=function(e){var t=MF(e);return t.type==="mathord"||t.type==="textord"||t.type==="atom"},ixe=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},sxe=function(e){var t=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return t?t[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(t[1])?null:t[1].toLowerCase():"_relative"},Ae={contains:KSe,deflt:YSe,escape:nxe,hyphenate:JSe,getBaseElem:MF,isCharacterBox:rxe,protocolFromUrl:sxe},i1={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:n=>"#"+n},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(n,e)=>(e.push(n),e)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:n=>Math.max(0,n),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:n=>Math.max(0,n),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:n=>Math.max(0,n),cli:"-e, --max-expand <n>",cliProcessor:n=>n==="Infinity"?1/0:parseInt(n)},globalGroup:{type:"boolean",cli:!1}};function oxe(n){if(n.default)return n.default;var e=n.type,t=Array.isArray(e)?e[0]:e;if(typeof t!="string")return t.enum[0];switch(t){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class h7{constructor(e){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{};for(var t in i1)if(i1.hasOwnProperty(t)){var r=i1[t];this[t]=e[t]!==void 0?r.processor?r.processor(e[t]):e[t]:oxe(r)}}reportNonstrict(e,t,r){var i=this.strict;if(typeof i=="function"&&(i=i(e,t,r)),!(!i||i==="ignore")){if(i===!0||i==="error")throw new oe("LaTeX-incompatible input and strict mode is set to 'error': "+(t+" ["+e+"]"),r);i==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+i+"': "+t+" ["+e+"]"))}}useStrictBehavior(e,t,r){var i=this.strict;if(typeof i=="function")try{i=i(e,t,r)}catch{i="error"}return!i||i==="ignore"?!1:i===!0||i==="error"?!0:i==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+i+"': "+t+" ["+e+"]")),!1)}isTrusted(e){if(e.url&&!e.protocol){var t=Ae.protocolFromUrl(e.url);if(t==null)return!1;e.protocol=t}var r=typeof this.trust=="function"?this.trust(e):this.trust;return!!r}}class Wa{constructor(e,t,r){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=r}sup(){return to[axe[this.id]]}sub(){return to[lxe[this.id]]}fracNum(){return to[cxe[this.id]]}fracDen(){return to[uxe[this.id]]}cramp(){return to[dxe[this.id]]}text(){return to[hxe[this.id]]}isTight(){return this.size>=2}}var f7=0,My=1,fd=2,pa=3,Cp=4,Ki=5,Ld=6,Pr=7,to=[new Wa(f7,0,!1),new Wa(My,0,!0),new Wa(fd,1,!1),new Wa(pa,1,!0),new Wa(Cp,2,!1),new Wa(Ki,2,!0),new Wa(Ld,3,!1),new Wa(Pr,3,!0)],axe=[Cp,Ki,Cp,Ki,Ld,Pr,Ld,Pr],lxe=[Ki,Ki,Ki,Ki,Pr,Pr,Pr,Pr],cxe=[fd,pa,Cp,Ki,Ld,Pr,Ld,Pr],uxe=[pa,pa,Ki,Ki,Pr,Pr,Pr,Pr],dxe=[My,My,pa,pa,Ki,Ki,Pr,Pr],hxe=[f7,My,fd,pa,fd,pa,fd,pa],De={DISPLAY:to[f7],TEXT:to[fd],SCRIPT:to[Cp],SCRIPTSCRIPT:to[Ld]},X4=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function fxe(n){for(var e=0;e<X4.length;e++)for(var t=X4[e],r=0;r<t.blocks.length;r++){var i=t.blocks[r];if(n>=i[0]&&n<=i[1])return t.name}return null}var s1=[];X4.forEach(n=>n.blocks.forEach(e=>s1.push(...e)));function AF(n){for(var e=0;e<s1.length;e+=2)if(n>=s1[e]&&n<=s1[e+1])return!0;return!1}var Cu=80,pxe=function(e,t){return"M95,"+(622+e+t)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+e/2.075+" -"+e+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+e)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},gxe=function(e,t){return"M263,"+(601+e+t)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+e/2.084+" -"+e+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+e)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},mxe=function(e,t){return"M983 "+(10+e+t)+`
l`+e/3.13+" -"+e+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+e)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},yxe=function(e,t){return"M424,"+(2398+e+t)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+e/4.223+" -"+e+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+e)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+e)+" "+t+`
h400000v`+(40+e)+"h-400000z"},vxe=function(e,t){return"M473,"+(2713+e+t)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+e/5.298+" -"+e+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+e)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+e)+" "+t+"h400000v"+(40+e)+"H1017.7z"},Sxe=function(e){var t=e/2;return"M400000 "+e+" H0 L"+t+" 0 l65 45 L145 "+(e-80)+" H400000z"},xxe=function(e,t,r){var i=r-54-t-e;return"M702 "+(e+t)+"H400000"+(40+e)+`
H742v`+i+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+t+"H400000v"+(40+e)+"H742z"},wxe=function(e,t,r){t=1e3*t;var i="";switch(e){case"sqrtMain":i=pxe(t,Cu);break;case"sqrtSize1":i=gxe(t,Cu);break;case"sqrtSize2":i=mxe(t,Cu);break;case"sqrtSize3":i=yxe(t,Cu);break;case"sqrtSize4":i=vxe(t,Cu);break;case"sqrtTall":i=xxe(t,Cu,r)}return i},bxe=function(e,t){switch(e){case"":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z"+("M367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z");case"":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257z"+("M478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z");default:return""}},u9={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},Oxe=function(e,t){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+t+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+t+" v1759 h84z";case"vert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+" v585 h43z";case"doublevert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+` v585 h43z
M367 15 v585 v`+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+t+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+t+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+t+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v602 h84z
M403 1759 V0 H319 V1759 v`+t+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v602 h84z
M347 1759 V0 h-84 V1759 v`+t+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(t+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(t+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(t+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(t+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class p0{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return Ae.contains(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){var e=t=>t.toText();return this.children.map(e).join("")}}var ho={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},Lg={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},d9={:"A",:"D",:"o",:"a",:"d",:"o",:"A",:"B",:"B",:"F",:"A",:"E",:"K",:"3",:"N",:"N",:"K",:"N",:"M",:"H",:"O",:"N",:"P",:"C",:"T",:"y",:"O",:"X",:"U",:"h",:"W",:"W",:"B",:"X",:"B",:"3",:"X",:"R",:"a",:"b",:"a",:"r",:"y",:"e",:"m",:"e",:"n",:"n",:"n",:"n",:"m",:"n",:"o",:"n",:"p",:"c",:"o",:"y",:"b",:"x",:"n",:"n",:"w",:"w",:"a",:"m",:"a",:"e",:"m",:"r"};function kxe(n,e){ho[n]=e}function p7(n,e,t){if(!ho[e])throw new Error("Font metrics not found for font: "+e+".");var r=n.charCodeAt(0),i=ho[e][r];if(!i&&n[0]in d9&&(r=d9[n[0]].charCodeAt(0),i=ho[e][r]),!i&&t==="text"&&AF(r)&&(i=ho[e][77]),i)return{depth:i[0],height:i[1],italic:i[2],skew:i[3],width:i[4]}}var _2={};function Cxe(n){var e;if(n>=5?e=0:n>=3?e=1:e=2,!_2[e]){var t=_2[e]={cssEmPerMu:Lg.quad[e]/18};for(var r in Lg)Lg.hasOwnProperty(r)&&(t[r]=Lg[r][e])}return _2[e]}var Pxe=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],h9=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],f9=function(e,t){return t.size<2?e:Pxe[e-1][t.size-1]};class ea{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||ea.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=h9[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var t={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return new ea(t)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:f9(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:h9[e-1]})}havingBaseStyle(e){e=e||this.style.text();var t=f9(ea.BASESIZE,e);return this.size===t&&this.textSize===ea.BASESIZE&&this.style===e?this:this.extend({style:e,size:t})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==ea.BASESIZE?["sizing","reset-size"+this.size,"size"+ea.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=Cxe(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}ea.BASESIZE=6;var K4={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},Txe={ex:!0,em:!0,mu:!0},_F=function(e){return typeof e!="string"&&(e=e.unit),e in K4||e in Txe||e==="ex"},Kt=function(e,t){var r;if(e.unit in K4)r=K4[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if(e.unit==="mu")r=t.fontMetrics().cssEmPerMu;else{var i;if(t.style.isTight()?i=t.havingStyle(t.style.text()):i=t,e.unit==="ex")r=i.fontMetrics().xHeight;else if(e.unit==="em")r=i.fontMetrics().quad;else throw new oe("Invalid unit: '"+e.unit+"'");i!==t&&(r*=i.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*r,t.maxSize)},de=function(e){return+e.toFixed(4)+"em"},Dl=function(e){return e.filter(t=>t).join(" ")},RF=function(e,t,r){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=r||{},t){t.style.isTight()&&this.classes.push("mtight");var i=t.getColor();i&&(this.style.color=i)}},DF=function(e){var t=document.createElement(e);t.className=Dl(this.classes);for(var r in this.style)this.style.hasOwnProperty(r)&&(t.style[r]=this.style[r]);for(var i in this.attributes)this.attributes.hasOwnProperty(i)&&t.setAttribute(i,this.attributes[i]);for(var s=0;s<this.children.length;s++)t.appendChild(this.children[s].toNode());return t},Exe=/[\s"'>/=\x00-\x1f]/,jF=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+Ae.escape(Dl(this.classes))+'"');var r="";for(var i in this.style)this.style.hasOwnProperty(i)&&(r+=Ae.hyphenate(i)+":"+this.style[i]+";");r&&(t+=' style="'+Ae.escape(r)+'"');for(var s in this.attributes)if(this.attributes.hasOwnProperty(s)){if(Exe.test(s))throw new oe("Invalid attribute name '"+s+"'");t+=" "+s+'="'+Ae.escape(this.attributes[s])+'"'}t+=">";for(var o=0;o<this.children.length;o++)t+=this.children[o].toMarkup();return t+="</"+e+">",t};class g0{constructor(e,t,r,i){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,RF.call(this,e,r,i),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return Ae.contains(this.classes,e)}toNode(){return DF.call(this,"span")}toMarkup(){return jF.call(this,"span")}}class g7{constructor(e,t,r,i){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,RF.call(this,t,i),this.children=r||[],this.setAttribute("href",e)}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return Ae.contains(this.classes,e)}toNode(){return DF.call(this,"a")}toMarkup(){return jF.call(this,"a")}}class Ixe{constructor(e,t,r){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=r}hasClass(e){return Ae.contains(this.classes,e)}toNode(){var e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(var t in this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e}toMarkup(){var e='<img src="'+Ae.escape(this.src)+'"'+(' alt="'+Ae.escape(this.alt)+'"'),t="";for(var r in this.style)this.style.hasOwnProperty(r)&&(t+=Ae.hyphenate(r)+":"+this.style[r]+";");return t&&(e+=' style="'+Ae.escape(t)+'"'),e+="'/>",e}}var Mxe={:"",:"",:"",:""};class os{constructor(e,t,r,i,s,o,a,l){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=r||0,this.italic=i||0,this.skew=s||0,this.width=o||0,this.classes=a||[],this.style=l||{},this.maxFontSize=0;var c=fxe(this.text.charCodeAt(0));c&&this.classes.push(c+"_fallback"),/[]/.test(this.text)&&(this.text=Mxe[this.text])}hasClass(e){return Ae.contains(this.classes,e)}toNode(){var e=document.createTextNode(this.text),t=null;this.italic>0&&(t=document.createElement("span"),t.style.marginRight=de(this.italic)),this.classes.length>0&&(t=t||document.createElement("span"),t.className=Dl(this.classes));for(var r in this.style)this.style.hasOwnProperty(r)&&(t=t||document.createElement("span"),t.style[r]=this.style[r]);return t?(t.appendChild(e),t):e}toMarkup(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=Ae.escape(Dl(this.classes)),t+='"');var r="";this.italic>0&&(r+="margin-right:"+this.italic+"em;");for(var i in this.style)this.style.hasOwnProperty(i)&&(r+=Ae.hyphenate(i)+":"+this.style[i]+";");r&&(e=!0,t+=' style="'+Ae.escape(r)+'"');var s=Ae.escape(this.text);return e?(t+=">",t+=s,t+="</span>",t):s}}class Pa{constructor(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&t.setAttribute(r,this.attributes[r]);for(var i=0;i<this.children.length;i++)t.appendChild(this.children[i].toNode());return t}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+Ae.escape(this.attributes[t])+'"');e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</svg>",e}}class jl{constructor(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"path");return this.alternate?t.setAttribute("d",this.alternate):t.setAttribute("d",u9[this.pathName]),t}toMarkup(){return this.alternate?'<path d="'+Ae.escape(this.alternate)+'"/>':'<path d="'+Ae.escape(u9[this.pathName])+'"/>'}}class Y4{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"line");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&t.setAttribute(r,this.attributes[r]);return t}toMarkup(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+Ae.escape(this.attributes[t])+'"');return e+="/>",e}}function p9(n){if(n instanceof os)return n;throw new Error("Expected symbolNode but got "+String(n)+".")}function Axe(n){if(n instanceof g0)return n;throw new Error("Expected span<HtmlDomNode> but got "+String(n)+".")}var _xe={bin:1,close:1,inner:1,open:1,punct:1,rel:1},Rxe={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},At={math:{},text:{}};function P(n,e,t,r,i,s){At[n][i]={font:e,group:t,replace:r},s&&r&&(At[n][r]=At[n][i])}var I="math",ie="text",_="main",$="ams",qt="accent-token",me="bin",$r="close",sh="inner",Re="mathord",Sn="op-token",Li="open",mS="punct",B="rel",$a="spacing",H="textord";P(I,_,B,"","\\equiv",!0);P(I,_,B,"","\\prec",!0);P(I,_,B,"","\\succ",!0);P(I,_,B,"","\\sim",!0);P(I,_,B,"","\\perp");P(I,_,B,"","\\preceq",!0);P(I,_,B,"","\\succeq",!0);P(I,_,B,"","\\simeq",!0);P(I,_,B,"","\\mid",!0);P(I,_,B,"","\\ll",!0);P(I,_,B,"","\\gg",!0);P(I,_,B,"","\\asymp",!0);P(I,_,B,"","\\parallel");P(I,_,B,"","\\bowtie",!0);P(I,_,B,"","\\smile",!0);P(I,_,B,"","\\sqsubseteq",!0);P(I,_,B,"","\\sqsupseteq",!0);P(I,_,B,"","\\doteq",!0);P(I,_,B,"","\\frown",!0);P(I,_,B,"","\\ni",!0);P(I,_,B,"","\\propto",!0);P(I,_,B,"","\\vdash",!0);P(I,_,B,"","\\dashv",!0);P(I,_,B,"","\\owns");P(I,_,mS,".","\\ldotp");P(I,_,mS,"","\\cdotp");P(I,_,H,"#","\\#");P(ie,_,H,"#","\\#");P(I,_,H,"&","\\&");P(ie,_,H,"&","\\&");P(I,_,H,"","\\aleph",!0);P(I,_,H,"","\\forall",!0);P(I,_,H,"","\\hbar",!0);P(I,_,H,"","\\exists",!0);P(I,_,H,"","\\nabla",!0);P(I,_,H,"","\\flat",!0);P(I,_,H,"","\\ell",!0);P(I,_,H,"","\\natural",!0);P(I,_,H,"","\\clubsuit",!0);P(I,_,H,"","\\wp",!0);P(I,_,H,"","\\sharp",!0);P(I,_,H,"","\\diamondsuit",!0);P(I,_,H,"","\\Re",!0);P(I,_,H,"","\\heartsuit",!0);P(I,_,H,"","\\Im",!0);P(I,_,H,"","\\spadesuit",!0);P(I,_,H,"","\\S",!0);P(ie,_,H,"","\\S");P(I,_,H,"","\\P",!0);P(ie,_,H,"","\\P");P(I,_,H,"","\\dag");P(ie,_,H,"","\\dag");P(ie,_,H,"","\\textdagger");P(I,_,H,"","\\ddag");P(ie,_,H,"","\\ddag");P(ie,_,H,"","\\textdaggerdbl");P(I,_,$r,"","\\rmoustache",!0);P(I,_,Li,"","\\lmoustache",!0);P(I,_,$r,"","\\rgroup",!0);P(I,_,Li,"","\\lgroup",!0);P(I,_,me,"","\\mp",!0);P(I,_,me,"","\\ominus",!0);P(I,_,me,"","\\uplus",!0);P(I,_,me,"","\\sqcap",!0);P(I,_,me,"","\\ast");P(I,_,me,"","\\sqcup",!0);P(I,_,me,"","\\bigcirc",!0);P(I,_,me,"","\\bullet",!0);P(I,_,me,"","\\ddagger");P(I,_,me,"","\\wr",!0);P(I,_,me,"","\\amalg");P(I,_,me,"&","\\And");P(I,_,B,"","\\longleftarrow",!0);P(I,_,B,"","\\Leftarrow",!0);P(I,_,B,"","\\Longleftarrow",!0);P(I,_,B,"","\\longrightarrow",!0);P(I,_,B,"","\\Rightarrow",!0);P(I,_,B,"","\\Longrightarrow",!0);P(I,_,B,"","\\leftrightarrow",!0);P(I,_,B,"","\\longleftrightarrow",!0);P(I,_,B,"","\\Leftrightarrow",!0);P(I,_,B,"","\\Longleftrightarrow",!0);P(I,_,B,"","\\mapsto",!0);P(I,_,B,"","\\longmapsto",!0);P(I,_,B,"","\\nearrow",!0);P(I,_,B,"","\\hookleftarrow",!0);P(I,_,B,"","\\hookrightarrow",!0);P(I,_,B,"","\\searrow",!0);P(I,_,B,"","\\leftharpoonup",!0);P(I,_,B,"","\\rightharpoonup",!0);P(I,_,B,"","\\swarrow",!0);P(I,_,B,"","\\leftharpoondown",!0);P(I,_,B,"","\\rightharpoondown",!0);P(I,_,B,"","\\nwarrow",!0);P(I,_,B,"","\\rightleftharpoons",!0);P(I,$,B,"","\\nless",!0);P(I,$,B,"","\\@nleqslant");P(I,$,B,"","\\@nleqq");P(I,$,B,"","\\lneq",!0);P(I,$,B,"","\\lneqq",!0);P(I,$,B,"","\\@lvertneqq");P(I,$,B,"","\\lnsim",!0);P(I,$,B,"","\\lnapprox",!0);P(I,$,B,"","\\nprec",!0);P(I,$,B,"","\\npreceq",!0);P(I,$,B,"","\\precnsim",!0);P(I,$,B,"","\\precnapprox",!0);P(I,$,B,"","\\nsim",!0);P(I,$,B,"","\\@nshortmid");P(I,$,B,"","\\nmid",!0);P(I,$,B,"","\\nvdash",!0);P(I,$,B,"","\\nvDash",!0);P(I,$,B,"","\\ntriangleleft");P(I,$,B,"","\\ntrianglelefteq",!0);P(I,$,B,"","\\subsetneq",!0);P(I,$,B,"","\\@varsubsetneq");P(I,$,B,"","\\subsetneqq",!0);P(I,$,B,"","\\@varsubsetneqq");P(I,$,B,"","\\ngtr",!0);P(I,$,B,"","\\@ngeqslant");P(I,$,B,"","\\@ngeqq");P(I,$,B,"","\\gneq",!0);P(I,$,B,"","\\gneqq",!0);P(I,$,B,"","\\@gvertneqq");P(I,$,B,"","\\gnsim",!0);P(I,$,B,"","\\gnapprox",!0);P(I,$,B,"","\\nsucc",!0);P(I,$,B,"","\\nsucceq",!0);P(I,$,B,"","\\succnsim",!0);P(I,$,B,"","\\succnapprox",!0);P(I,$,B,"","\\ncong",!0);P(I,$,B,"","\\@nshortparallel");P(I,$,B,"","\\nparallel",!0);P(I,$,B,"","\\nVDash",!0);P(I,$,B,"","\\ntriangleright");P(I,$,B,"","\\ntrianglerighteq",!0);P(I,$,B,"","\\@nsupseteqq");P(I,$,B,"","\\supsetneq",!0);P(I,$,B,"","\\@varsupsetneq");P(I,$,B,"","\\supsetneqq",!0);P(I,$,B,"","\\@varsupsetneqq");P(I,$,B,"","\\nVdash",!0);P(I,$,B,"","\\precneqq",!0);P(I,$,B,"","\\succneqq",!0);P(I,$,B,"","\\@nsubseteqq");P(I,$,me,"","\\unlhd");P(I,$,me,"","\\unrhd");P(I,$,B,"","\\nleftarrow",!0);P(I,$,B,"","\\nrightarrow",!0);P(I,$,B,"","\\nLeftarrow",!0);P(I,$,B,"","\\nRightarrow",!0);P(I,$,B,"","\\nleftrightarrow",!0);P(I,$,B,"","\\nLeftrightarrow",!0);P(I,$,B,"","\\vartriangle");P(I,$,H,"","\\hslash");P(I,$,H,"","\\triangledown");P(I,$,H,"","\\lozenge");P(I,$,H,"","\\circledS");P(I,$,H,"","\\circledR");P(ie,$,H,"","\\circledR");P(I,$,H,"","\\measuredangle",!0);P(I,$,H,"","\\nexists");P(I,$,H,"","\\mho");P(I,$,H,"","\\Finv",!0);P(I,$,H,"","\\Game",!0);P(I,$,H,"","\\backprime");P(I,$,H,"","\\blacktriangle");P(I,$,H,"","\\blacktriangledown");P(I,$,H,"","\\blacksquare");P(I,$,H,"","\\blacklozenge");P(I,$,H,"","\\bigstar");P(I,$,H,"","\\sphericalangle",!0);P(I,$,H,"","\\complement",!0);P(I,$,H,"","\\eth",!0);P(ie,_,H,"","");P(I,$,H,"","\\diagup");P(I,$,H,"","\\diagdown");P(I,$,H,"","\\square");P(I,$,H,"","\\Box");P(I,$,H,"","\\Diamond");P(I,$,H,"","\\yen",!0);P(ie,$,H,"","\\yen",!0);P(I,$,H,"","\\checkmark",!0);P(ie,$,H,"","\\checkmark");P(I,$,H,"","\\beth",!0);P(I,$,H,"","\\daleth",!0);P(I,$,H,"","\\gimel",!0);P(I,$,H,"","\\digamma",!0);P(I,$,H,"","\\varkappa");P(I,$,Li,"","\\@ulcorner",!0);P(I,$,$r,"","\\@urcorner",!0);P(I,$,Li,"","\\@llcorner",!0);P(I,$,$r,"","\\@lrcorner",!0);P(I,$,B,"","\\leqq",!0);P(I,$,B,"","\\leqslant",!0);P(I,$,B,"","\\eqslantless",!0);P(I,$,B,"","\\lesssim",!0);P(I,$,B,"","\\lessapprox",!0);P(I,$,B,"","\\approxeq",!0);P(I,$,me,"","\\lessdot");P(I,$,B,"","\\lll",!0);P(I,$,B,"","\\lessgtr",!0);P(I,$,B,"","\\lesseqgtr",!0);P(I,$,B,"","\\lesseqqgtr",!0);P(I,$,B,"","\\doteqdot");P(I,$,B,"","\\risingdotseq",!0);P(I,$,B,"","\\fallingdotseq",!0);P(I,$,B,"","\\backsim",!0);P(I,$,B,"","\\backsimeq",!0);P(I,$,B,"","\\subseteqq",!0);P(I,$,B,"","\\Subset",!0);P(I,$,B,"","\\sqsubset",!0);P(I,$,B,"","\\preccurlyeq",!0);P(I,$,B,"","\\curlyeqprec",!0);P(I,$,B,"","\\precsim",!0);P(I,$,B,"","\\precapprox",!0);P(I,$,B,"","\\vartriangleleft");P(I,$,B,"","\\trianglelefteq");P(I,$,B,"","\\vDash",!0);P(I,$,B,"","\\Vvdash",!0);P(I,$,B,"","\\smallsmile");P(I,$,B,"","\\smallfrown");P(I,$,B,"","\\bumpeq",!0);P(I,$,B,"","\\Bumpeq",!0);P(I,$,B,"","\\geqq",!0);P(I,$,B,"","\\geqslant",!0);P(I,$,B,"","\\eqslantgtr",!0);P(I,$,B,"","\\gtrsim",!0);P(I,$,B,"","\\gtrapprox",!0);P(I,$,me,"","\\gtrdot");P(I,$,B,"","\\ggg",!0);P(I,$,B,"","\\gtrless",!0);P(I,$,B,"","\\gtreqless",!0);P(I,$,B,"","\\gtreqqless",!0);P(I,$,B,"","\\eqcirc",!0);P(I,$,B,"","\\circeq",!0);P(I,$,B,"","\\triangleq",!0);P(I,$,B,"","\\thicksim");P(I,$,B,"","\\thickapprox");P(I,$,B,"","\\supseteqq",!0);P(I,$,B,"","\\Supset",!0);P(I,$,B,"","\\sqsupset",!0);P(I,$,B,"","\\succcurlyeq",!0);P(I,$,B,"","\\curlyeqsucc",!0);P(I,$,B,"","\\succsim",!0);P(I,$,B,"","\\succapprox",!0);P(I,$,B,"","\\vartriangleright");P(I,$,B,"","\\trianglerighteq");P(I,$,B,"","\\Vdash",!0);P(I,$,B,"","\\shortmid");P(I,$,B,"","\\shortparallel");P(I,$,B,"","\\between",!0);P(I,$,B,"","\\pitchfork",!0);P(I,$,B,"","\\varpropto");P(I,$,B,"","\\blacktriangleleft");P(I,$,B,"","\\therefore",!0);P(I,$,B,"","\\backepsilon");P(I,$,B,"","\\blacktriangleright");P(I,$,B,"","\\because",!0);P(I,$,B,"","\\llless");P(I,$,B,"","\\gggtr");P(I,$,me,"","\\lhd");P(I,$,me,"","\\rhd");P(I,$,B,"","\\eqsim",!0);P(I,_,B,"","\\Join");P(I,$,B,"","\\Doteq",!0);P(I,$,me,"","\\dotplus",!0);P(I,$,me,"","\\smallsetminus");P(I,$,me,"","\\Cap",!0);P(I,$,me,"","\\Cup",!0);P(I,$,me,"","\\doublebarwedge",!0);P(I,$,me,"","\\boxminus",!0);P(I,$,me,"","\\boxplus",!0);P(I,$,me,"","\\divideontimes",!0);P(I,$,me,"","\\ltimes",!0);P(I,$,me,"","\\rtimes",!0);P(I,$,me,"","\\leftthreetimes",!0);P(I,$,me,"","\\rightthreetimes",!0);P(I,$,me,"","\\curlywedge",!0);P(I,$,me,"","\\curlyvee",!0);P(I,$,me,"","\\circleddash",!0);P(I,$,me,"","\\circledast",!0);P(I,$,me,"","\\centerdot");P(I,$,me,"","\\intercal",!0);P(I,$,me,"","\\doublecap");P(I,$,me,"","\\doublecup");P(I,$,me,"","\\boxtimes",!0);P(I,$,B,"","\\dashrightarrow",!0);P(I,$,B,"","\\dashleftarrow",!0);P(I,$,B,"","\\leftleftarrows",!0);P(I,$,B,"","\\leftrightarrows",!0);P(I,$,B,"","\\Lleftarrow",!0);P(I,$,B,"","\\twoheadleftarrow",!0);P(I,$,B,"","\\leftarrowtail",!0);P(I,$,B,"","\\looparrowleft",!0);P(I,$,B,"","\\leftrightharpoons",!0);P(I,$,B,"","\\curvearrowleft",!0);P(I,$,B,"","\\circlearrowleft",!0);P(I,$,B,"","\\Lsh",!0);P(I,$,B,"","\\upuparrows",!0);P(I,$,B,"","\\upharpoonleft",!0);P(I,$,B,"","\\downharpoonleft",!0);P(I,_,B,"","\\origof",!0);P(I,_,B,"","\\imageof",!0);P(I,$,B,"","\\multimap",!0);P(I,$,B,"","\\leftrightsquigarrow",!0);P(I,$,B,"","\\rightrightarrows",!0);P(I,$,B,"","\\rightleftarrows",!0);P(I,$,B,"","\\twoheadrightarrow",!0);P(I,$,B,"","\\rightarrowtail",!0);P(I,$,B,"","\\looparrowright",!0);P(I,$,B,"","\\curvearrowright",!0);P(I,$,B,"","\\circlearrowright",!0);P(I,$,B,"","\\Rsh",!0);P(I,$,B,"","\\downdownarrows",!0);P(I,$,B,"","\\upharpoonright",!0);P(I,$,B,"","\\downharpoonright",!0);P(I,$,B,"","\\rightsquigarrow",!0);P(I,$,B,"","\\leadsto");P(I,$,B,"","\\Rrightarrow",!0);P(I,$,B,"","\\restriction");P(I,_,H,"","`");P(I,_,H,"$","\\$");P(ie,_,H,"$","\\$");P(ie,_,H,"$","\\textdollar");P(I,_,H,"%","\\%");P(ie,_,H,"%","\\%");P(I,_,H,"_","\\_");P(ie,_,H,"_","\\_");P(ie,_,H,"_","\\textunderscore");P(I,_,H,"","\\angle",!0);P(I,_,H,"","\\infty",!0);P(I,_,H,"","\\prime");P(I,_,H,"","\\triangle");P(I,_,H,"","\\Gamma",!0);P(I,_,H,"","\\Delta",!0);P(I,_,H,"","\\Theta",!0);P(I,_,H,"","\\Lambda",!0);P(I,_,H,"","\\Xi",!0);P(I,_,H,"","\\Pi",!0);P(I,_,H,"","\\Sigma",!0);P(I,_,H,"","\\Upsilon",!0);P(I,_,H,"","\\Phi",!0);P(I,_,H,"","\\Psi",!0);P(I,_,H,"","\\Omega",!0);P(I,_,H,"A","");P(I,_,H,"B","");P(I,_,H,"E","");P(I,_,H,"Z","");P(I,_,H,"H","");P(I,_,H,"I","");P(I,_,H,"K","");P(I,_,H,"M","");P(I,_,H,"N","");P(I,_,H,"O","");P(I,_,H,"P","");P(I,_,H,"T","");P(I,_,H,"X","");P(I,_,H,"","\\neg",!0);P(I,_,H,"","\\lnot");P(I,_,H,"","\\top");P(I,_,H,"","\\bot");P(I,_,H,"","\\emptyset");P(I,$,H,"","\\varnothing");P(I,_,Re,"","\\alpha",!0);P(I,_,Re,"","\\beta",!0);P(I,_,Re,"","\\gamma",!0);P(I,_,Re,"","\\delta",!0);P(I,_,Re,"","\\epsilon",!0);P(I,_,Re,"","\\zeta",!0);P(I,_,Re,"","\\eta",!0);P(I,_,Re,"","\\theta",!0);P(I,_,Re,"","\\iota",!0);P(I,_,Re,"","\\kappa",!0);P(I,_,Re,"","\\lambda",!0);P(I,_,Re,"","\\mu",!0);P(I,_,Re,"","\\nu",!0);P(I,_,Re,"","\\xi",!0);P(I,_,Re,"","\\omicron",!0);P(I,_,Re,"","\\pi",!0);P(I,_,Re,"","\\rho",!0);P(I,_,Re,"","\\sigma",!0);P(I,_,Re,"","\\tau",!0);P(I,_,Re,"","\\upsilon",!0);P(I,_,Re,"","\\phi",!0);P(I,_,Re,"","\\chi",!0);P(I,_,Re,"","\\psi",!0);P(I,_,Re,"","\\omega",!0);P(I,_,Re,"","\\varepsilon",!0);P(I,_,Re,"","\\vartheta",!0);P(I,_,Re,"","\\varpi",!0);P(I,_,Re,"","\\varrho",!0);P(I,_,Re,"","\\varsigma",!0);P(I,_,Re,"","\\varphi",!0);P(I,_,me,"","*",!0);P(I,_,me,"+","+");P(I,_,me,"","-",!0);P(I,_,me,"","\\cdot",!0);P(I,_,me,"","\\circ",!0);P(I,_,me,"","\\div",!0);P(I,_,me,"","\\pm",!0);P(I,_,me,"","\\times",!0);P(I,_,me,"","\\cap",!0);P(I,_,me,"","\\cup",!0);P(I,_,me,"","\\setminus",!0);P(I,_,me,"","\\land");P(I,_,me,"","\\lor");P(I,_,me,"","\\wedge",!0);P(I,_,me,"","\\vee",!0);P(I,_,H,"","\\surd");P(I,_,Li,"","\\langle",!0);P(I,_,Li,"","\\lvert");P(I,_,Li,"","\\lVert");P(I,_,$r,"?","?");P(I,_,$r,"!","!");P(I,_,$r,"","\\rangle",!0);P(I,_,$r,"","\\rvert");P(I,_,$r,"","\\rVert");P(I,_,B,"=","=");P(I,_,B,":",":");P(I,_,B,"","\\approx",!0);P(I,_,B,"","\\cong",!0);P(I,_,B,"","\\ge");P(I,_,B,"","\\geq",!0);P(I,_,B,"","\\gets");P(I,_,B,">","\\gt",!0);P(I,_,B,"","\\in",!0);P(I,_,B,"","\\@not");P(I,_,B,"","\\subset",!0);P(I,_,B,"","\\supset",!0);P(I,_,B,"","\\subseteq",!0);P(I,_,B,"","\\supseteq",!0);P(I,$,B,"","\\nsubseteq",!0);P(I,$,B,"","\\nsupseteq",!0);P(I,_,B,"","\\models");P(I,_,B,"","\\leftarrow",!0);P(I,_,B,"","\\le");P(I,_,B,"","\\leq",!0);P(I,_,B,"<","\\lt",!0);P(I,_,B,"","\\rightarrow",!0);P(I,_,B,"","\\to");P(I,$,B,"","\\ngeq",!0);P(I,$,B,"","\\nleq",!0);P(I,_,$a,"","\\ ");P(I,_,$a,"","\\space");P(I,_,$a,"","\\nobreakspace");P(ie,_,$a,"","\\ ");P(ie,_,$a,""," ");P(ie,_,$a,"","\\space");P(ie,_,$a,"","\\nobreakspace");P(I,_,$a,null,"\\nobreak");P(I,_,$a,null,"\\allowbreak");P(I,_,mS,",",",");P(I,_,mS,";",";");P(I,$,me,"","\\barwedge",!0);P(I,$,me,"","\\veebar",!0);P(I,_,me,"","\\odot",!0);P(I,_,me,"","\\oplus",!0);P(I,_,me,"","\\otimes",!0);P(I,_,H,"","\\partial",!0);P(I,_,me,"","\\oslash",!0);P(I,$,me,"","\\circledcirc",!0);P(I,$,me,"","\\boxdot",!0);P(I,_,me,"","\\bigtriangleup");P(I,_,me,"","\\bigtriangledown");P(I,_,me,"","\\dagger");P(I,_,me,"","\\diamond");P(I,_,me,"","\\star");P(I,_,me,"","\\triangleleft");P(I,_,me,"","\\triangleright");P(I,_,Li,"{","\\{");P(ie,_,H,"{","\\{");P(ie,_,H,"{","\\textbraceleft");P(I,_,$r,"}","\\}");P(ie,_,H,"}","\\}");P(ie,_,H,"}","\\textbraceright");P(I,_,Li,"{","\\lbrace");P(I,_,$r,"}","\\rbrace");P(I,_,Li,"[","\\lbrack",!0);P(ie,_,H,"[","\\lbrack",!0);P(I,_,$r,"]","\\rbrack",!0);P(ie,_,H,"]","\\rbrack",!0);P(I,_,Li,"(","\\lparen",!0);P(I,_,$r,")","\\rparen",!0);P(ie,_,H,"<","\\textless",!0);P(ie,_,H,">","\\textgreater",!0);P(I,_,Li,"","\\lfloor",!0);P(I,_,$r,"","\\rfloor",!0);P(I,_,Li,"","\\lceil",!0);P(I,_,$r,"","\\rceil",!0);P(I,_,H,"\\","\\backslash");P(I,_,H,"","|");P(I,_,H,"","\\vert");P(ie,_,H,"|","\\textbar",!0);P(I,_,H,"","\\|");P(I,_,H,"","\\Vert");P(ie,_,H,"","\\textbardbl");P(ie,_,H,"~","\\textasciitilde");P(ie,_,H,"\\","\\textbackslash");P(ie,_,H,"^","\\textasciicircum");P(I,_,B,"","\\uparrow",!0);P(I,_,B,"","\\Uparrow",!0);P(I,_,B,"","\\downarrow",!0);P(I,_,B,"","\\Downarrow",!0);P(I,_,B,"","\\updownarrow",!0);P(I,_,B,"","\\Updownarrow",!0);P(I,_,Sn,"","\\coprod");P(I,_,Sn,"","\\bigvee");P(I,_,Sn,"","\\bigwedge");P(I,_,Sn,"","\\biguplus");P(I,_,Sn,"","\\bigcap");P(I,_,Sn,"","\\bigcup");P(I,_,Sn,"","\\int");P(I,_,Sn,"","\\intop");P(I,_,Sn,"","\\iint");P(I,_,Sn,"","\\iiint");P(I,_,Sn,"","\\prod");P(I,_,Sn,"","\\sum");P(I,_,Sn,"","\\bigotimes");P(I,_,Sn,"","\\bigoplus");P(I,_,Sn,"","\\bigodot");P(I,_,Sn,"","\\oint");P(I,_,Sn,"","\\oiint");P(I,_,Sn,"","\\oiiint");P(I,_,Sn,"","\\bigsqcup");P(I,_,Sn,"","\\smallint");P(ie,_,sh,"","\\textellipsis");P(I,_,sh,"","\\mathellipsis");P(ie,_,sh,"","\\ldots",!0);P(I,_,sh,"","\\ldots",!0);P(I,_,sh,"","\\@cdots",!0);P(I,_,sh,"","\\ddots",!0);P(I,_,H,"","\\varvdots");P(ie,_,H,"","\\varvdots");P(I,_,qt,"","\\acute");P(I,_,qt,"","\\grave");P(I,_,qt,"","\\ddot");P(I,_,qt,"~","\\tilde");P(I,_,qt,"","\\bar");P(I,_,qt,"","\\breve");P(I,_,qt,"","\\check");P(I,_,qt,"^","\\hat");P(I,_,qt,"","\\vec");P(I,_,qt,"","\\dot");P(I,_,qt,"","\\mathring");P(I,_,Re,"","\\@imath");P(I,_,Re,"","\\@jmath");P(I,_,H,"","");P(I,_,H,"","");P(ie,_,H,"","\\i",!0);P(ie,_,H,"","\\j",!0);P(ie,_,H,"","\\ss",!0);P(ie,_,H,"","\\ae",!0);P(ie,_,H,"","\\oe",!0);P(ie,_,H,"","\\o",!0);P(ie,_,H,"","\\AE",!0);P(ie,_,H,"","\\OE",!0);P(ie,_,H,"","\\O",!0);P(ie,_,qt,"","\\'");P(ie,_,qt,"","\\`");P(ie,_,qt,"","\\^");P(ie,_,qt,"","\\~");P(ie,_,qt,"","\\=");P(ie,_,qt,"","\\u");P(ie,_,qt,"","\\.");P(ie,_,qt,"","\\c");P(ie,_,qt,"","\\r");P(ie,_,qt,"","\\v");P(ie,_,qt,"",'\\"');P(ie,_,qt,"","\\H");P(ie,_,qt,"","\\textcircled");var LF={"--":!0,"---":!0,"``":!0,"''":!0};P(ie,_,H,"","--",!0);P(ie,_,H,"","\\textendash");P(ie,_,H,"","---",!0);P(ie,_,H,"","\\textemdash");P(ie,_,H,"","`",!0);P(ie,_,H,"","\\textquoteleft");P(ie,_,H,"","'",!0);P(ie,_,H,"","\\textquoteright");P(ie,_,H,"","``",!0);P(ie,_,H,"","\\textquotedblleft");P(ie,_,H,"","''",!0);P(ie,_,H,"","\\textquotedblright");P(I,_,H,"","\\degree",!0);P(ie,_,H,"","\\degree");P(ie,_,H,"","\\textdegree",!0);P(I,_,H,"","\\pounds");P(I,_,H,"","\\mathsterling",!0);P(ie,_,H,"","\\pounds");P(ie,_,H,"","\\textsterling",!0);P(I,$,H,"","\\maltese");P(ie,$,H,"","\\maltese");var g9='0123456789/@."';for(var R2=0;R2<g9.length;R2++){var m9=g9.charAt(R2);P(I,_,H,m9,m9)}var y9='0123456789!@*()-=+";:?/.,';for(var D2=0;D2<y9.length;D2++){var v9=y9.charAt(D2);P(ie,_,H,v9,v9)}var Ay="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var j2=0;j2<Ay.length;j2++){var zg=Ay.charAt(j2);P(I,_,Re,zg,zg),P(ie,_,H,zg,zg)}P(I,$,H,"C","");P(ie,$,H,"C","");P(I,$,H,"H","");P(ie,$,H,"H","");P(I,$,H,"N","");P(ie,$,H,"N","");P(I,$,H,"P","");P(ie,$,H,"P","");P(I,$,H,"Q","");P(ie,$,H,"Q","");P(I,$,H,"R","");P(ie,$,H,"R","");P(I,$,H,"Z","");P(ie,$,H,"Z","");P(I,_,Re,"h","");P(ie,_,Re,"h","");var Le="";for(var br=0;br<Ay.length;br++){var nn=Ay.charAt(br);Le=String.fromCharCode(55349,56320+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),Le=String.fromCharCode(55349,56372+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),Le=String.fromCharCode(55349,56424+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),Le=String.fromCharCode(55349,56580+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),Le=String.fromCharCode(55349,56684+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),Le=String.fromCharCode(55349,56736+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),Le=String.fromCharCode(55349,56788+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),Le=String.fromCharCode(55349,56840+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),Le=String.fromCharCode(55349,56944+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),br<26&&(Le=String.fromCharCode(55349,56632+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le),Le=String.fromCharCode(55349,56476+br),P(I,_,Re,nn,Le),P(ie,_,H,nn,Le))}Le="";P(I,_,Re,"k",Le);P(ie,_,H,"k",Le);for(var dc=0;dc<10;dc++){var Va=dc.toString();Le=String.fromCharCode(55349,57294+dc),P(I,_,Re,Va,Le),P(ie,_,H,Va,Le),Le=String.fromCharCode(55349,57314+dc),P(I,_,Re,Va,Le),P(ie,_,H,Va,Le),Le=String.fromCharCode(55349,57324+dc),P(I,_,Re,Va,Le),P(ie,_,H,Va,Le),Le=String.fromCharCode(55349,57334+dc),P(I,_,Re,Va,Le),P(ie,_,H,Va,Le)}var Z4="";for(var L2=0;L2<Z4.length;L2++){var Ng=Z4.charAt(L2);P(I,_,Re,Ng,Ng),P(ie,_,H,Ng,Ng)}var $g=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],S9=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],Dxe=function(e,t){var r=e.charCodeAt(0),i=e.charCodeAt(1),s=(r-55296)*1024+(i-56320)+65536,o=t==="math"?0:1;if(119808<=s&&s<120484){var a=Math.floor((s-119808)/26);return[$g[a][2],$g[a][o]]}else if(120782<=s&&s<=120831){var l=Math.floor((s-120782)/10);return[S9[l][2],S9[l][o]]}else{if(s===120485||s===120486)return[$g[0][2],$g[0][o]];if(120486<s&&s<120782)return["",""];throw new oe("Unsupported character: "+e)}},yS=function(e,t,r){return At[r][e]&&At[r][e].replace&&(e=At[r][e].replace),{value:e,metrics:p7(e,t,r)}},Ss=function(e,t,r,i,s){var o=yS(e,t,r),a=o.metrics;e=o.value;var l;if(a){var c=a.italic;(r==="text"||i&&i.font==="mathit")&&(c=0),l=new os(e,a.height,a.depth,c,a.skew,a.width,s)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+e+"' in style '"+t+"' and mode '"+r+"'")),l=new os(e,0,0,0,0,0,s);if(i){l.maxFontSize=i.sizeMultiplier,i.style.isTight()&&l.classes.push("mtight");var u=i.getColor();u&&(l.style.color=u)}return l},jxe=function(e,t,r,i){return i===void 0&&(i=[]),r.font==="boldsymbol"&&yS(e,"Main-Bold",t).metrics?Ss(e,"Main-Bold",t,r,i.concat(["mathbf"])):e==="\\"||At[t][e].font==="main"?Ss(e,"Main-Regular",t,r,i):Ss(e,"AMS-Regular",t,r,i.concat(["amsrm"]))},Lxe=function(e,t,r,i,s){return s!=="textord"&&yS(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},zxe=function(e,t,r){var i=e.mode,s=e.text,o=["mord"],a=i==="math"||i==="text"&&t.font,l=a?t.font:t.fontFamily,c="",u="";if(s.charCodeAt(0)===55349&&([c,u]=Dxe(s,i)),c.length>0)return Ss(s,c,i,t,o.concat(u));if(l){var d,h;if(l==="boldsymbol"){var p=Lxe(s,i,t,o,r);d=p.fontName,h=[p.fontClass]}else a?(d=$F[l].fontName,h=[l]):(d=Fg(l,t.fontWeight,t.fontShape),h=[l,t.fontWeight,t.fontShape]);if(yS(s,d,i).metrics)return Ss(s,d,i,t,o.concat(h));if(LF.hasOwnProperty(s)&&d.slice(0,10)==="Typewriter"){for(var g=[],m=0;m<s.length;m++)g.push(Ss(s[m],d,i,t,o.concat(h)));return NF(g)}}if(r==="mathord")return Ss(s,"Math-Italic",i,t,o.concat(["mathnormal"]));if(r==="textord"){var S=At[i][s]&&At[i][s].font;if(S==="ams"){var y=Fg("amsrm",t.fontWeight,t.fontShape);return Ss(s,y,i,t,o.concat("amsrm",t.fontWeight,t.fontShape))}else if(S==="main"||!S){var x=Fg("textrm",t.fontWeight,t.fontShape);return Ss(s,x,i,t,o.concat(t.fontWeight,t.fontShape))}else{var w=Fg(S,t.fontWeight,t.fontShape);return Ss(s,w,i,t,o.concat(w,t.fontWeight,t.fontShape))}}else throw new Error("unexpected type: "+r+" in makeOrd")},Nxe=(n,e)=>{if(Dl(n.classes)!==Dl(e.classes)||n.skew!==e.skew||n.maxFontSize!==e.maxFontSize)return!1;if(n.classes.length===1){var t=n.classes[0];if(t==="mbin"||t==="mord")return!1}for(var r in n.style)if(n.style.hasOwnProperty(r)&&n.style[r]!==e.style[r])return!1;for(var i in e.style)if(e.style.hasOwnProperty(i)&&n.style[i]!==e.style[i])return!1;return!0},$xe=n=>{for(var e=0;e<n.length-1;e++){var t=n[e],r=n[e+1];t instanceof os&&r instanceof os&&Nxe(t,r)&&(t.text+=r.text,t.height=Math.max(t.height,r.height),t.depth=Math.max(t.depth,r.depth),t.italic=r.italic,n.splice(e+1,1),e--)}return n},m7=function(e){for(var t=0,r=0,i=0,s=0;s<e.children.length;s++){var o=e.children[s];o.height>t&&(t=o.height),o.depth>r&&(r=o.depth),o.maxFontSize>i&&(i=o.maxFontSize)}e.height=t,e.depth=r,e.maxFontSize=i},Ur=function(e,t,r,i){var s=new g0(e,t,r,i);return m7(s),s},zF=(n,e,t,r)=>new g0(n,e,t,r),Fxe=function(e,t,r){var i=Ur([e],[],t);return i.height=Math.max(r||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),i.style.borderBottomWidth=de(i.height),i.maxFontSize=1,i},Bxe=function(e,t,r,i){var s=new g7(e,t,r,i);return m7(s),s},NF=function(e){var t=new p0(e);return m7(t),t},Uxe=function(e,t){return e instanceof p0?Ur([],[e],t):e},Hxe=function(e){if(e.positionType==="individualShift"){for(var t=e.children,r=[t[0]],i=-t[0].shift-t[0].elem.depth,s=i,o=1;o<t.length;o++){var a=-t[o].shift-s-t[o].elem.depth,l=a-(t[o-1].elem.height+t[o-1].elem.depth);s=s+a,r.push({type:"kern",size:l}),r.push(t[o])}return{children:r,depth:i}}var c;if(e.positionType==="top"){for(var u=e.positionData,d=0;d<e.children.length;d++){var h=e.children[d];u-=h.type==="kern"?h.size:h.elem.height+h.elem.depth}c=u}else if(e.positionType==="bottom")c=-e.positionData;else{var p=e.children[0];if(p.type!=="elem")throw new Error('First child must have type "elem".');if(e.positionType==="shift")c=-p.elem.depth-e.positionData;else if(e.positionType==="firstBaseline")c=-p.elem.depth;else throw new Error("Invalid positionType "+e.positionType+".")}return{children:e.children,depth:c}},Qxe=function(e,t){for(var{children:r,depth:i}=Hxe(e),s=0,o=0;o<r.length;o++){var a=r[o];if(a.type==="elem"){var l=a.elem;s=Math.max(s,l.maxFontSize,l.height)}}s+=2;var c=Ur(["pstrut"],[]);c.style.height=de(s);for(var u=[],d=i,h=i,p=i,g=0;g<r.length;g++){var m=r[g];if(m.type==="kern")p+=m.size;else{var S=m.elem,y=m.wrapperClasses||[],x=m.wrapperStyle||{},w=Ur(y,[c,S],void 0,x);w.style.top=de(-s-p-S.depth),m.marginLeft&&(w.style.marginLeft=m.marginLeft),m.marginRight&&(w.style.marginRight=m.marginRight),u.push(w),p+=S.height+S.depth}d=Math.min(d,p),h=Math.max(h,p)}var O=Ur(["vlist"],u);O.style.height=de(h);var T;if(d<0){var E=Ur([],[]),C=Ur(["vlist"],[E]);C.style.height=de(-d);var M=Ur(["vlist-s"],[new os("")]);T=[Ur(["vlist-r"],[O,M]),Ur(["vlist-r"],[C])]}else T=[Ur(["vlist-r"],[O])];var A=Ur(["vlist-t"],T);return T.length===2&&A.classes.push("vlist-t2"),A.height=h,A.depth=-d,A},qxe=(n,e)=>{var t=Ur(["mspace"],[],e),r=Kt(n,e);return t.style.marginRight=de(r),t},Fg=function(e,t,r){var i="";switch(e){case"amsrm":i="AMS";break;case"textrm":i="Main";break;case"textsf":i="SansSerif";break;case"texttt":i="Typewriter";break;default:i=e}var s;return t==="textbf"&&r==="textit"?s="BoldItalic":t==="textbf"?s="Bold":t==="textit"?s="Italic":s="Regular",i+"-"+s},$F={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},FF={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},Wxe=function(e,t){var[r,i,s]=FF[e],o=new jl(r),a=new Pa([o],{width:de(i),height:de(s),style:"width:"+de(i),viewBox:"0 0 "+1e3*i+" "+1e3*s,preserveAspectRatio:"xMinYMin"}),l=zF(["overlay"],[a],t);return l.height=s,l.style.height=de(s),l.style.width=de(i),l},K={fontMap:$F,makeSymbol:Ss,mathsym:jxe,makeSpan:Ur,makeSvgSpan:zF,makeLineSpan:Fxe,makeAnchor:Bxe,makeFragment:NF,wrapFragment:Uxe,makeVList:Qxe,makeOrd:zxe,makeGlue:qxe,staticSvg:Wxe,svgData:FF,tryCombineChars:$xe},Vt={number:3,unit:"mu"},hc={number:4,unit:"mu"},Uo={number:5,unit:"mu"},Vxe={mord:{mop:Vt,mbin:hc,mrel:Uo,minner:Vt},mop:{mord:Vt,mop:Vt,mrel:Uo,minner:Vt},mbin:{mord:hc,mop:hc,mopen:hc,minner:hc},mrel:{mord:Uo,mop:Uo,mopen:Uo,minner:Uo},mopen:{},mclose:{mop:Vt,mbin:hc,mrel:Uo,minner:Vt},mpunct:{mord:Vt,mop:Vt,mrel:Uo,mopen:Vt,mclose:Vt,mpunct:Vt,minner:Vt},minner:{mord:Vt,mop:Vt,mbin:hc,mrel:Uo,mopen:Vt,mpunct:Vt,minner:Vt}},Gxe={mord:{mop:Vt},mop:{mord:Vt,mop:Vt},mbin:{},mrel:{},mopen:{},mclose:{mop:Vt},mpunct:{},minner:{mop:Vt}},BF={},_y={},Ry={};function pe(n){for(var{type:e,names:t,props:r,handler:i,htmlBuilder:s,mathmlBuilder:o}=n,a={type:e,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:r.allowedInMath===void 0?!0:r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:i},l=0;l<t.length;++l)BF[t[l]]=a;e&&(s&&(_y[e]=s),o&&(Ry[e]=o))}function du(n){var{type:e,htmlBuilder:t,mathmlBuilder:r}=n;pe({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:t,mathmlBuilder:r})}var Dy=function(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},hn=function(e){return e.type==="ordgroup"?e.body:[e]},Ta=K.makeSpan,Xxe=["leftmost","mbin","mopen","mrel","mop","mpunct"],Kxe=["rightmost","mrel","mclose","mpunct"],Yxe={display:De.DISPLAY,text:De.TEXT,script:De.SCRIPT,scriptscript:De.SCRIPTSCRIPT},Zxe={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},En=function(e,t,r,i){i===void 0&&(i=[null,null]);for(var s=[],o=0;o<e.length;o++){var a=lt(e[o],t);if(a instanceof p0){var l=a.children;s.push(...l)}else s.push(a)}if(K.tryCombineChars(s),!r)return s;var c=t;if(e.length===1){var u=e[0];u.type==="sizing"?c=t.havingSize(u.size):u.type==="styling"&&(c=t.havingStyle(Yxe[u.style]))}var d=Ta([i[0]||"leftmost"],[],t),h=Ta([i[1]||"rightmost"],[],t),p=r==="root";return x9(s,(g,m)=>{var S=m.classes[0],y=g.classes[0];S==="mbin"&&Ae.contains(Kxe,y)?m.classes[0]="mord":y==="mbin"&&Ae.contains(Xxe,S)&&(g.classes[0]="mord")},{node:d},h,p),x9(s,(g,m)=>{var S=J4(m),y=J4(g),x=S&&y?g.hasClass("mtight")?Gxe[S][y]:Vxe[S][y]:null;if(x)return K.makeGlue(x,c)},{node:d},h,p),s},x9=function n(e,t,r,i,s){i&&e.push(i);for(var o=0;o<e.length;o++){var a=e[o],l=UF(a);if(l){n(l.children,t,r,null,s);continue}var c=!a.hasClass("mspace");if(c){var u=t(a,r.node);u&&(r.insertAfter?r.insertAfter(u):(e.unshift(u),o++))}c?r.node=a:s&&a.hasClass("newline")&&(r.node=Ta(["leftmost"])),r.insertAfter=(d=>h=>{e.splice(d+1,0,h),o++})(o)}i&&e.pop()},UF=function(e){return e instanceof p0||e instanceof g7||e instanceof g0&&e.hasClass("enclosing")?e:null},Jxe=function n(e,t){var r=UF(e);if(r){var i=r.children;if(i.length){if(t==="right")return n(i[i.length-1],"right");if(t==="left")return n(i[0],"left")}}return e},J4=function(e,t){return e?(t&&(e=Jxe(e,t)),Zxe[e.classes[0]]||null):null},Pp=function(e,t){var r=["nulldelimiter"].concat(e.baseSizingClasses());return Ta(t.concat(r))},lt=function(e,t,r){if(!e)return Ta();if(_y[e.type]){var i=_y[e.type](e,t);if(r&&t.size!==r.size){i=Ta(t.sizingClasses(r),[i],t);var s=t.sizeMultiplier/r.sizeMultiplier;i.height*=s,i.depth*=s}return i}else throw new oe("Got group of unknown type: '"+e.type+"'")};function Bg(n,e){var t=Ta(["base"],n,e),r=Ta(["strut"]);return r.style.height=de(t.height+t.depth),t.depth&&(r.style.verticalAlign=de(-t.depth)),t.children.unshift(r),t}function e5(n,e){var t=null;n.length===1&&n[0].type==="tag"&&(t=n[0].tag,n=n[0].body);var r=En(n,e,"root"),i;r.length===2&&r[1].hasClass("tag")&&(i=r.pop());for(var s=[],o=[],a=0;a<r.length;a++)if(o.push(r[a]),r[a].hasClass("mbin")||r[a].hasClass("mrel")||r[a].hasClass("allowbreak")){for(var l=!1;a<r.length-1&&r[a+1].hasClass("mspace")&&!r[a+1].hasClass("newline");)a++,o.push(r[a]),r[a].hasClass("nobreak")&&(l=!0);l||(s.push(Bg(o,e)),o=[])}else r[a].hasClass("newline")&&(o.pop(),o.length>0&&(s.push(Bg(o,e)),o=[]),s.push(r[a]));o.length>0&&s.push(Bg(o,e));var c;t?(c=Bg(En(t,e,!0)),c.classes=["tag"],s.push(c)):i&&s.push(i);var u=Ta(["katex-html"],s);if(u.setAttribute("aria-hidden","true"),c){var d=c.children[0];d.style.height=de(u.height+u.depth),u.depth&&(d.style.verticalAlign=de(-u.depth))}return u}function HF(n){return new p0(n)}class wi{constructor(e,t,r){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=r||[]}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=Dl(this.classes));for(var r=0;r<this.children.length;r++)if(this.children[r]instanceof fo&&this.children[r+1]instanceof fo){for(var i=this.children[r].toText()+this.children[++r].toText();this.children[r+1]instanceof fo;)i+=this.children[++r].toText();e.appendChild(new fo(i).toNode())}else e.appendChild(this.children[r].toNode());return e}toMarkup(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=Ae.escape(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+Ae.escape(Dl(this.classes))+'"'),e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map(e=>e.toText()).join("")}}let fo=class{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return Ae.escape(this.toText())}toText(){return this.text}};class e2e{constructor(e){this.width=void 0,this.character=void 0,this.width=e,e>=.05555&&e<=.05556?this.character="":e>=.1666&&e<=.1667?this.character="":e>=.2222&&e<=.2223?this.character="":e>=.2777&&e<=.2778?this.character="":e>=-.05556&&e<=-.05555?this.character="":e>=-.1667&&e<=-.1666?this.character="":e>=-.2223&&e<=-.2222?this.character="":e>=-.2778&&e<=-.2777?this.character="":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",de(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+de(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var se={MathNode:wi,TextNode:fo,SpaceNode:e2e,newDocumentFragment:HF},as=function(e,t,r){return At[t][e]&&At[t][e].replace&&e.charCodeAt(0)!==55349&&!(LF.hasOwnProperty(e)&&r&&(r.fontFamily&&r.fontFamily.slice(4,6)==="tt"||r.font&&r.font.slice(4,6)==="tt"))&&(e=At[t][e].replace),new se.TextNode(e)},y7=function(e){return e.length===1?e[0]:new se.MathNode("mrow",e)},v7=function(e,t){if(t.fontFamily==="texttt")return"monospace";if(t.fontFamily==="textsf")return t.fontShape==="textit"&&t.fontWeight==="textbf"?"sans-serif-bold-italic":t.fontShape==="textit"?"sans-serif-italic":t.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(t.fontShape==="textit"&&t.fontWeight==="textbf")return"bold-italic";if(t.fontShape==="textit")return"italic";if(t.fontWeight==="textbf")return"bold";var r=t.font;if(!r||r==="mathnormal")return null;var i=e.mode;if(r==="mathit")return"italic";if(r==="boldsymbol")return e.type==="textord"?"bold":"bold-italic";if(r==="mathbf")return"bold";if(r==="mathbb")return"double-struck";if(r==="mathsfit")return"sans-serif-italic";if(r==="mathfrak")return"fraktur";if(r==="mathscr"||r==="mathcal")return"script";if(r==="mathsf")return"sans-serif";if(r==="mathtt")return"monospace";var s=e.text;if(Ae.contains(["\\imath","\\jmath"],s))return null;At[i][s]&&At[i][s].replace&&(s=At[i][s].replace);var o=K.fontMap[r].fontName;return p7(s,o,i)?K.fontMap[r].variant:null};function z2(n){if(!n)return!1;if(n.type==="mi"&&n.children.length===1){var e=n.children[0];return e instanceof fo&&e.text==="."}else if(n.type==="mo"&&n.children.length===1&&n.getAttribute("separator")==="true"&&n.getAttribute("lspace")==="0em"&&n.getAttribute("rspace")==="0em"){var t=n.children[0];return t instanceof fo&&t.text===","}else return!1}var ci=function(e,t,r){if(e.length===1){var i=kt(e[0],t);return r&&i instanceof wi&&i.type==="mo"&&(i.setAttribute("lspace","0em"),i.setAttribute("rspace","0em")),[i]}for(var s=[],o,a=0;a<e.length;a++){var l=kt(e[a],t);if(l instanceof wi&&o instanceof wi){if(l.type==="mtext"&&o.type==="mtext"&&l.getAttribute("mathvariant")===o.getAttribute("mathvariant")){o.children.push(...l.children);continue}else if(l.type==="mn"&&o.type==="mn"){o.children.push(...l.children);continue}else if(z2(l)&&o.type==="mn"){o.children.push(...l.children);continue}else if(l.type==="mn"&&z2(o))l.children=[...o.children,...l.children],s.pop();else if((l.type==="msup"||l.type==="msub")&&l.children.length>=1&&(o.type==="mn"||z2(o))){var c=l.children[0];c instanceof wi&&c.type==="mn"&&(c.children=[...o.children,...c.children],s.pop())}else if(o.type==="mi"&&o.children.length===1){var u=o.children[0];if(u instanceof fo&&u.text===""&&(l.type==="mo"||l.type==="mi"||l.type==="mn")){var d=l.children[0];d instanceof fo&&d.text.length>0&&(d.text=d.text.slice(0,1)+""+d.text.slice(1),s.pop())}}}s.push(l),o=l}return s},Ll=function(e,t,r){return y7(ci(e,t,r))},kt=function(e,t){if(!e)return new se.MathNode("mrow");if(Ry[e.type]){var r=Ry[e.type](e,t);return r}else throw new oe("Got group of unknown type: '"+e.type+"'")};function w9(n,e,t,r,i){var s=ci(n,t),o;s.length===1&&s[0]instanceof wi&&Ae.contains(["mrow","mtable"],s[0].type)?o=s[0]:o=new se.MathNode("mrow",s);var a=new se.MathNode("annotation",[new se.TextNode(e)]);a.setAttribute("encoding","application/x-tex");var l=new se.MathNode("semantics",[o,a]),c=new se.MathNode("math",[l]);c.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&c.setAttribute("display","block");var u=i?"katex":"katex-mathml";return K.makeSpan([u],[c])}var QF=function(e){return new ea({style:e.displayMode?De.DISPLAY:De.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},qF=function(e,t){if(t.displayMode){var r=["katex-display"];t.leqno&&r.push("leqno"),t.fleqn&&r.push("fleqn"),e=K.makeSpan(r,[e])}return e},t2e=function(e,t,r){var i=QF(r),s;if(r.output==="mathml")return w9(e,t,i,r.displayMode,!0);if(r.output==="html"){var o=e5(e,i);s=K.makeSpan(["katex"],[o])}else{var a=w9(e,t,i,r.displayMode,!1),l=e5(e,i);s=K.makeSpan(["katex"],[a,l])}return qF(s,r)},n2e=function(e,t,r){var i=QF(r),s=e5(e,i),o=K.makeSpan(["katex"],[s]);return qF(o,r)},r2e={widehat:"^",widecheck:"",widetilde:"~",utilde:"~",overleftarrow:"",underleftarrow:"",xleftarrow:"",overrightarrow:"",underrightarrow:"",xrightarrow:"",underbrace:"",overbrace:"",overgroup:"",undergroup:"",overleftrightarrow:"",underleftrightarrow:"",xleftrightarrow:"",Overrightarrow:"",xRightarrow:"",overleftharpoon:"",xleftharpoonup:"",overrightharpoon:"",xrightharpoonup:"",xLeftarrow:"",xLeftrightarrow:"",xhookleftarrow:"",xhookrightarrow:"",xmapsto:"",xrightharpoondown:"",xleftharpoondown:"",xrightleftharpoons:"",xleftrightharpoons:"",xtwoheadleftarrow:"",xtwoheadrightarrow:"",xlongequal:"=",xtofrom:"",xrightleftarrows:"",xrightequilibrium:"",xleftequilibrium:"","\\cdrightarrow":"","\\cdleftarrow":"","\\cdlongequal":"="},i2e=function(e){var t=new se.MathNode("mo",[new se.TextNode(r2e[e.replace(/^\\/,"")])]);return t.setAttribute("stretchy","true"),t},s2e={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},o2e=function(e){return e.type==="ordgroup"?e.body.length:1},a2e=function(e,t){function r(){var a=4e5,l=e.label.slice(1);if(Ae.contains(["widehat","widecheck","widetilde","utilde"],l)){var c=e,u=o2e(c.base),d,h,p;if(u>5)l==="widehat"||l==="widecheck"?(d=420,a=2364,p=.42,h=l+"4"):(d=312,a=2340,p=.34,h="tilde4");else{var g=[1,1,2,2,3,3][u];l==="widehat"||l==="widecheck"?(a=[0,1062,2364,2364,2364][g],d=[0,239,300,360,420][g],p=[0,.24,.3,.3,.36,.42][g],h=l+g):(a=[0,600,1033,2339,2340][g],d=[0,260,286,306,312][g],p=[0,.26,.286,.3,.306,.34][g],h="tilde"+g)}var m=new jl(h),S=new Pa([m],{width:"100%",height:de(p),viewBox:"0 0 "+a+" "+d,preserveAspectRatio:"none"});return{span:K.makeSvgSpan([],[S],t),minWidth:0,height:p}}else{var y=[],x=s2e[l],[w,O,T]=x,E=T/1e3,C=w.length,M,A;if(C===1){var D=x[3];M=["hide-tail"],A=[D]}else if(C===2)M=["halfarrow-left","halfarrow-right"],A=["xMinYMin","xMaxYMin"];else if(C===3)M=["brace-left","brace-center","brace-right"],A=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+C+" children.");for(var N=0;N<C;N++){var F=new jl(w[N]),j=new Pa([F],{width:"400em",height:de(E),viewBox:"0 0 "+a+" "+T,preserveAspectRatio:A[N]+" slice"}),L=K.makeSvgSpan([M[N]],[j],t);if(C===1)return{span:L,minWidth:O,height:E};L.style.height=de(E),y.push(L)}return{span:K.makeSpan(["stretchy"],y,t),minWidth:O,height:E}}}var{span:i,minWidth:s,height:o}=r();return i.height=o,i.style.height=de(o),s>0&&(i.style.minWidth=de(s)),i},l2e=function(e,t,r,i,s){var o,a=e.height+e.depth+r+i;if(/fbox|color|angl/.test(t)){if(o=K.makeSpan(["stretchy",t],[],s),t==="fbox"){var l=s.color&&s.getColor();l&&(o.style.borderColor=l)}}else{var c=[];/^[bx]cancel$/.test(t)&&c.push(new Y4({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&c.push(new Y4({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var u=new Pa(c,{width:"100%",height:de(a)});o=K.makeSvgSpan([],[u],s)}return o.height=a,o.style.height=de(a),o},Ea={encloseSpan:l2e,mathMLnode:i2e,svgSpan:a2e};function Be(n,e){if(!n||n.type!==e)throw new Error("Expected node of type "+e+", but got "+(n?"node of type "+n.type:String(n)));return n}function S7(n){var e=vS(n);if(!e)throw new Error("Expected node of symbol group type, but got "+(n?"node of type "+n.type:String(n)));return e}function vS(n){return n&&(n.type==="atom"||Rxe.hasOwnProperty(n.type))?n:null}var x7=(n,e)=>{var t,r,i;n&&n.type==="supsub"?(r=Be(n.base,"accent"),t=r.base,n.base=t,i=Axe(lt(n,e)),n.base=r):(r=Be(n,"accent"),t=r.base);var s=lt(t,e.havingCrampedStyle()),o=r.isShifty&&Ae.isCharacterBox(t),a=0;if(o){var l=Ae.getBaseElem(t),c=lt(l,e.havingCrampedStyle());a=p9(c).skew}var u=r.label==="\\c",d=u?s.height+s.depth:Math.min(s.height,e.fontMetrics().xHeight),h;if(r.isStretchy)h=Ea.svgSpan(r,e),h=K.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"elem",elem:h,wrapperClasses:["svg-align"],wrapperStyle:a>0?{width:"calc(100% - "+de(2*a)+")",marginLeft:de(2*a)}:void 0}]},e);else{var p,g;r.label==="\\vec"?(p=K.staticSvg("vec",e),g=K.svgData.vec[1]):(p=K.makeOrd({mode:r.mode,text:r.label},e,"textord"),p=p9(p),p.italic=0,g=p.width,u&&(d+=p.depth)),h=K.makeSpan(["accent-body"],[p]);var m=r.label==="\\textcircled";m&&(h.classes.push("accent-full"),d=s.height);var S=a;m||(S-=g/2),h.style.left=de(S),r.label==="\\textcircled"&&(h.style.top=".2em"),h=K.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"kern",size:-d},{type:"elem",elem:h}]},e)}var y=K.makeSpan(["mord","accent"],[h],e);return i?(i.children[0]=y,i.height=Math.max(y.height,i.height),i.classes[0]="mord",i):y},WF=(n,e)=>{var t=n.isStretchy?Ea.mathMLnode(n.label):new se.MathNode("mo",[as(n.label,n.mode)]),r=new se.MathNode("mover",[kt(n.base,e),t]);return r.setAttribute("accent","true"),r},c2e=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(n=>"\\"+n).join("|"));pe({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(n,e)=>{var t=Dy(e[0]),r=!c2e.test(n.funcName),i=!r||n.funcName==="\\widehat"||n.funcName==="\\widetilde"||n.funcName==="\\widecheck";return{type:"accent",mode:n.parser.mode,label:n.funcName,isStretchy:r,isShifty:i,base:t}},htmlBuilder:x7,mathmlBuilder:WF});pe({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(n,e)=>{var t=e[0],r=n.parser.mode;return r==="math"&&(n.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+n.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:n.funcName,isStretchy:!1,isShifty:!0,base:t}},htmlBuilder:x7,mathmlBuilder:WF});pe({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0];return{type:"accentUnder",mode:t.mode,label:r,base:i}},htmlBuilder:(n,e)=>{var t=lt(n.base,e),r=Ea.svgSpan(n,e),i=n.label==="\\utilde"?.12:0,s=K.makeVList({positionType:"top",positionData:t.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:i},{type:"elem",elem:t}]},e);return K.makeSpan(["mord","accentunder"],[s],e)},mathmlBuilder:(n,e)=>{var t=Ea.mathMLnode(n.label),r=new se.MathNode("munder",[kt(n.base,e),t]);return r.setAttribute("accentunder","true"),r}});var Ug=n=>{var e=new se.MathNode("mpadded",n?[n]:[]);return e.setAttribute("width","+0.6em"),e.setAttribute("lspace","0.3em"),e};pe({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(n,e,t){var{parser:r,funcName:i}=n;return{type:"xArrow",mode:r.mode,label:i,body:e[0],below:t[0]}},htmlBuilder(n,e){var t=e.style,r=e.havingStyle(t.sup()),i=K.wrapFragment(lt(n.body,r,e),e),s=n.label.slice(0,2)==="\\x"?"x":"cd";i.classes.push(s+"-arrow-pad");var o;n.below&&(r=e.havingStyle(t.sub()),o=K.wrapFragment(lt(n.below,r,e),e),o.classes.push(s+"-arrow-pad"));var a=Ea.svgSpan(n,e),l=-e.fontMetrics().axisHeight+.5*a.height,c=-e.fontMetrics().axisHeight-.5*a.height-.111;(i.depth>.25||n.label==="\\xleftequilibrium")&&(c-=i.depth);var u;if(o){var d=-e.fontMetrics().axisHeight+o.height+.5*a.height+.111;u=K.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:c},{type:"elem",elem:a,shift:l},{type:"elem",elem:o,shift:d}]},e)}else u=K.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:c},{type:"elem",elem:a,shift:l}]},e);return u.children[0].children[0].children[1].classes.push("svg-align"),K.makeSpan(["mrel","x-arrow"],[u],e)},mathmlBuilder(n,e){var t=Ea.mathMLnode(n.label);t.setAttribute("minsize",n.label.charAt(0)==="x"?"1.75em":"3.0em");var r;if(n.body){var i=Ug(kt(n.body,e));if(n.below){var s=Ug(kt(n.below,e));r=new se.MathNode("munderover",[t,s,i])}else r=new se.MathNode("mover",[t,i])}else if(n.below){var o=Ug(kt(n.below,e));r=new se.MathNode("munder",[t,o])}else r=Ug(),r=new se.MathNode("mover",[t,r]);return r}});var u2e=K.makeSpan;function VF(n,e){var t=En(n.body,e,!0);return u2e([n.mclass],t,e)}function GF(n,e){var t,r=ci(n.body,e);return n.mclass==="minner"?t=new se.MathNode("mpadded",r):n.mclass==="mord"?n.isCharacterBox?(t=r[0],t.type="mi"):t=new se.MathNode("mi",r):(n.isCharacterBox?(t=r[0],t.type="mo"):t=new se.MathNode("mo",r),n.mclass==="mbin"?(t.attributes.lspace="0.22em",t.attributes.rspace="0.22em"):n.mclass==="mpunct"?(t.attributes.lspace="0em",t.attributes.rspace="0.17em"):n.mclass==="mopen"||n.mclass==="mclose"?(t.attributes.lspace="0em",t.attributes.rspace="0em"):n.mclass==="minner"&&(t.attributes.lspace="0.0556em",t.attributes.width="+0.1111em")),t}pe({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(n,e){var{parser:t,funcName:r}=n,i=e[0];return{type:"mclass",mode:t.mode,mclass:"m"+r.slice(5),body:hn(i),isCharacterBox:Ae.isCharacterBox(i)}},htmlBuilder:VF,mathmlBuilder:GF});var SS=n=>{var e=n.type==="ordgroup"&&n.body.length?n.body[0]:n;return e.type==="atom"&&(e.family==="bin"||e.family==="rel")?"m"+e.family:"mord"};pe({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(n,e){var{parser:t}=n;return{type:"mclass",mode:t.mode,mclass:SS(e[0]),body:hn(e[1]),isCharacterBox:Ae.isCharacterBox(e[1])}}});pe({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(n,e){var{parser:t,funcName:r}=n,i=e[1],s=e[0],o;r!=="\\stackrel"?o=SS(i):o="mrel";var a={type:"op",mode:i.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:r!=="\\stackrel",body:hn(i)},l={type:"supsub",mode:s.mode,base:a,sup:r==="\\underset"?null:s,sub:r==="\\underset"?s:null};return{type:"mclass",mode:t.mode,mclass:o,body:[l],isCharacterBox:Ae.isCharacterBox(l)}},htmlBuilder:VF,mathmlBuilder:GF});pe({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"pmb",mode:t.mode,mclass:SS(e[0]),body:hn(e[0])}},htmlBuilder(n,e){var t=En(n.body,e,!0),r=K.makeSpan([n.mclass],t,e);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(n,e){var t=ci(n.body,e),r=new se.MathNode("mstyle",t);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var d2e={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},b9=()=>({type:"styling",body:[],mode:"math",style:"display"}),O9=n=>n.type==="textord"&&n.text==="@",h2e=(n,e)=>(n.type==="mathord"||n.type==="atom")&&n.text===e;function f2e(n,e,t){var r=d2e[n];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return t.callFunction(r,[e[0]],[e[1]]);case"\\uparrow":case"\\downarrow":{var i=t.callFunction("\\\\cdleft",[e[0]],[]),s={type:"atom",text:r,mode:"math",family:"rel"},o=t.callFunction("\\Big",[s],[]),a=t.callFunction("\\\\cdright",[e[1]],[]),l={type:"ordgroup",mode:"math",body:[i,o,a]};return t.callFunction("\\\\cdparent",[l],[])}case"\\\\cdlongequal":return t.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var c={type:"textord",text:"\\Vert",mode:"math"};return t.callFunction("\\Big",[c],[])}default:return{type:"textord",text:" ",mode:"math"}}}function p2e(n){var e=[];for(n.gullet.beginGroup(),n.gullet.macros.set("\\cr","\\\\\\relax"),n.gullet.beginGroup();;){e.push(n.parseExpression(!1,"\\\\")),n.gullet.endGroup(),n.gullet.beginGroup();var t=n.fetch().text;if(t==="&"||t==="\\\\")n.consume();else if(t==="\\end"){e[e.length-1].length===0&&e.pop();break}else throw new oe("Expected \\\\ or \\cr or \\end",n.nextToken)}for(var r=[],i=[r],s=0;s<e.length;s++){for(var o=e[s],a=b9(),l=0;l<o.length;l++)if(!O9(o[l]))a.body.push(o[l]);else{r.push(a),l+=1;var c=S7(o[l]).text,u=new Array(2);if(u[0]={type:"ordgroup",mode:"math",body:[]},u[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(c)>-1))if("<>AV".indexOf(c)>-1)for(var d=0;d<2;d++){for(var h=!0,p=l+1;p<o.length;p++){if(h2e(o[p],c)){h=!1,l=p;break}if(O9(o[p]))throw new oe("Missing a "+c+" character to complete a CD arrow.",o[p]);u[d].body.push(o[p])}if(h)throw new oe("Missing a "+c+" character to complete a CD arrow.",o[l])}else throw new oe('Expected one of "<>AV=|." after @',o[l]);var g=f2e(c,u,n),m={type:"styling",body:[g],mode:"math",style:"display"};r.push(m),a=b9()}s%2===0?r.push(a):r.shift(),r=[],i.push(r)}n.gullet.endGroup(),n.gullet.endGroup();var S=new Array(i[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:i,arraystretch:1,addJot:!0,rowGaps:[null],cols:S,colSeparationType:"CD",hLinesBeforeRow:new Array(i.length+1).fill([])}}pe({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:r}=n;return{type:"cdlabel",mode:t.mode,side:r.slice(4),label:e[0]}},htmlBuilder(n,e){var t=e.havingStyle(e.style.sup()),r=K.wrapFragment(lt(n.label,t,e),e);return r.classes.push("cd-label-"+n.side),r.style.bottom=de(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(n,e){var t=new se.MathNode("mrow",[kt(n.label,e)]);return t=new se.MathNode("mpadded",[t]),t.setAttribute("width","0"),n.side==="left"&&t.setAttribute("lspace","-1width"),t.setAttribute("voffset","0.7em"),t=new se.MathNode("mstyle",[t]),t.setAttribute("displaystyle","false"),t.setAttribute("scriptlevel","1"),t}});pe({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(n,e){var{parser:t}=n;return{type:"cdlabelparent",mode:t.mode,fragment:e[0]}},htmlBuilder(n,e){var t=K.wrapFragment(lt(n.fragment,e),e);return t.classes.push("cd-vert-arrow"),t},mathmlBuilder(n,e){return new se.MathNode("mrow",[kt(n.fragment,e)])}});pe({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(n,e){for(var{parser:t}=n,r=Be(e[0],"ordgroup"),i=r.body,s="",o=0;o<i.length;o++){var a=Be(i[o],"textord");s+=a.text}var l=parseInt(s),c;if(isNaN(l))throw new oe("\\@char has non-numeric argument "+s);if(l<0||l>=1114111)throw new oe("\\@char with invalid code point "+s);return l<=65535?c=String.fromCharCode(l):(l-=65536,c=String.fromCharCode((l>>10)+55296,(l&1023)+56320)),{type:"textord",mode:t.mode,text:c}}});var XF=(n,e)=>{var t=En(n.body,e.withColor(n.color),!1);return K.makeFragment(t)},KF=(n,e)=>{var t=ci(n.body,e.withColor(n.color)),r=new se.MathNode("mstyle",t);return r.setAttribute("mathcolor",n.color),r};pe({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(n,e){var{parser:t}=n,r=Be(e[0],"color-token").color,i=e[1];return{type:"color",mode:t.mode,color:r,body:hn(i)}},htmlBuilder:XF,mathmlBuilder:KF});pe({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(n,e){var{parser:t,breakOnTokenText:r}=n,i=Be(e[0],"color-token").color;t.gullet.macros.set("\\current@color",i);var s=t.parseExpression(!0,r);return{type:"color",mode:t.mode,color:i,body:s}},htmlBuilder:XF,mathmlBuilder:KF});pe({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(n,e,t){var{parser:r}=n,i=r.gullet.future().text==="["?r.parseSizeGroup(!0):null,s=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:s,size:i&&Be(i,"size").value}},htmlBuilder(n,e){var t=K.makeSpan(["mspace"],[],e);return n.newLine&&(t.classes.push("newline"),n.size&&(t.style.marginTop=de(Kt(n.size,e)))),t},mathmlBuilder(n,e){var t=new se.MathNode("mspace");return n.newLine&&(t.setAttribute("linebreak","newline"),n.size&&t.setAttribute("height",de(Kt(n.size,e)))),t}});var t5={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},YF=n=>{var e=n.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(e))throw new oe("Expected a control sequence",n);return e},g2e=n=>{var e=n.gullet.popToken();return e.text==="="&&(e=n.gullet.popToken(),e.text===" "&&(e=n.gullet.popToken())),e},ZF=(n,e,t,r)=>{var i=n.gullet.macros.get(t.text);i==null&&(t.noexpand=!0,i={tokens:[t],numArgs:0,unexpandable:!n.gullet.isExpandable(t.text)}),n.gullet.macros.set(e,i,r)};pe({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(n){var{parser:e,funcName:t}=n;e.consumeSpaces();var r=e.fetch();if(t5[r.text])return(t==="\\global"||t==="\\\\globallong")&&(r.text=t5[r.text]),Be(e.parseFunction(),"internal");throw new oe("Invalid token after macro prefix",r)}});pe({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,r=e.gullet.popToken(),i=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(i))throw new oe("Expected a control sequence",r);for(var s=0,o,a=[[]];e.gullet.future().text!=="{";)if(r=e.gullet.popToken(),r.text==="#"){if(e.gullet.future().text==="{"){o=e.gullet.future(),a[s].push("{");break}if(r=e.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new oe('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==s+1)throw new oe('Argument number "'+r.text+'" out of order');s++,a.push([])}else{if(r.text==="EOF")throw new oe("Expected a macro definition");a[s].push(r.text)}var{tokens:l}=e.gullet.consumeArg();return o&&l.unshift(o),(t==="\\edef"||t==="\\xdef")&&(l=e.gullet.expandTokens(l),l.reverse()),e.gullet.macros.set(i,{tokens:l,numArgs:s,delimiters:a},t===t5[t]),{type:"internal",mode:e.mode}}});pe({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,r=YF(e.gullet.popToken());e.gullet.consumeSpaces();var i=g2e(e);return ZF(e,r,i,t==="\\\\globallet"),{type:"internal",mode:e.mode}}});pe({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,r=YF(e.gullet.popToken()),i=e.gullet.popToken(),s=e.gullet.popToken();return ZF(e,r,s,t==="\\\\globalfuture"),e.gullet.pushToken(s),e.gullet.pushToken(i),{type:"internal",mode:e.mode}}});var ff=function(e,t,r){var i=At.math[e]&&At.math[e].replace,s=p7(i||e,t,r);if(!s)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return s},w7=function(e,t,r,i){var s=r.havingBaseStyle(t),o=K.makeSpan(i.concat(s.sizingClasses(r)),[e],r),a=s.sizeMultiplier/r.sizeMultiplier;return o.height*=a,o.depth*=a,o.maxFontSize=s.sizeMultiplier,o},JF=function(e,t,r){var i=t.havingBaseStyle(r),s=(1-t.sizeMultiplier/i.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=de(s),e.height-=s,e.depth+=s},m2e=function(e,t,r,i,s,o){var a=K.makeSymbol(e,"Main-Regular",s,i),l=w7(a,t,i,o);return r&&JF(l,i,t),l},y2e=function(e,t,r,i){return K.makeSymbol(e,"Size"+t+"-Regular",r,i)},eB=function(e,t,r,i,s,o){var a=y2e(e,t,s,i),l=w7(K.makeSpan(["delimsizing","size"+t],[a],i),De.TEXT,i,o);return r&&JF(l,i,De.TEXT),l},N2=function(e,t,r){var i;t==="Size1-Regular"?i="delim-size1":i="delim-size4";var s=K.makeSpan(["delimsizinginner",i],[K.makeSpan([],[K.makeSymbol(e,t,r)])]);return{type:"elem",elem:s}},$2=function(e,t,r){var i=ho["Size4-Regular"][e.charCodeAt(0)]?ho["Size4-Regular"][e.charCodeAt(0)][4]:ho["Size1-Regular"][e.charCodeAt(0)][4],s=new jl("inner",bxe(e,Math.round(1e3*t))),o=new Pa([s],{width:de(i),height:de(t),style:"width:"+de(i),viewBox:"0 0 "+1e3*i+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),a=K.makeSvgSpan([],[o],r);return a.height=t,a.style.height=de(t),a.style.width=de(i),{type:"elem",elem:a}},n5=.008,Hg={type:"kern",size:-1*n5},v2e=["|","\\lvert","\\rvert","\\vert"],S2e=["\\|","\\lVert","\\rVert","\\Vert"],tB=function(e,t,r,i,s,o){var a,l,c,u,d="",h=0;a=c=u=e,l=null;var p="Size1-Regular";e==="\\uparrow"?c=u="":e==="\\Uparrow"?c=u="":e==="\\downarrow"?a=c="":e==="\\Downarrow"?a=c="":e==="\\updownarrow"?(a="\\uparrow",c="",u="\\downarrow"):e==="\\Updownarrow"?(a="\\Uparrow",c="",u="\\Downarrow"):Ae.contains(v2e,e)?(c="",d="vert",h=333):Ae.contains(S2e,e)?(c="",d="doublevert",h=556):e==="["||e==="\\lbrack"?(a="",c="",u="",p="Size4-Regular",d="lbrack",h=667):e==="]"||e==="\\rbrack"?(a="",c="",u="",p="Size4-Regular",d="rbrack",h=667):e==="\\lfloor"||e===""?(c=a="",u="",p="Size4-Regular",d="lfloor",h=667):e==="\\lceil"||e===""?(a="",c=u="",p="Size4-Regular",d="lceil",h=667):e==="\\rfloor"||e===""?(c=a="",u="",p="Size4-Regular",d="rfloor",h=667):e==="\\rceil"||e===""?(a="",c=u="",p="Size4-Regular",d="rceil",h=667):e==="("||e==="\\lparen"?(a="",c="",u="",p="Size4-Regular",d="lparen",h=875):e===")"||e==="\\rparen"?(a="",c="",u="",p="Size4-Regular",d="rparen",h=875):e==="\\{"||e==="\\lbrace"?(a="",l="",u="",c="",p="Size4-Regular"):e==="\\}"||e==="\\rbrace"?(a="",l="",u="",c="",p="Size4-Regular"):e==="\\lgroup"||e===""?(a="",u="",c="",p="Size4-Regular"):e==="\\rgroup"||e===""?(a="",u="",c="",p="Size4-Regular"):e==="\\lmoustache"||e===""?(a="",u="",c="",p="Size4-Regular"):(e==="\\rmoustache"||e==="")&&(a="",u="",c="",p="Size4-Regular");var g=ff(a,p,s),m=g.height+g.depth,S=ff(c,p,s),y=S.height+S.depth,x=ff(u,p,s),w=x.height+x.depth,O=0,T=1;if(l!==null){var E=ff(l,p,s);O=E.height+E.depth,T=2}var C=m+w+O,M=Math.max(0,Math.ceil((t-C)/(T*y))),A=C+M*T*y,D=i.fontMetrics().axisHeight;r&&(D*=i.sizeMultiplier);var N=A/2-D,F=[];if(d.length>0){var j=A-m-w,L=Math.round(A*1e3),U=Oxe(d,Math.round(j*1e3)),Y=new jl(d,U),V=(h/1e3).toFixed(3)+"em",W=(L/1e3).toFixed(3)+"em",J=new Pa([Y],{width:V,height:W,viewBox:"0 0 "+h+" "+L}),ne=K.makeSvgSpan([],[J],i);ne.height=L/1e3,ne.style.width=V,ne.style.height=W,F.push({type:"elem",elem:ne})}else{if(F.push(N2(u,p,s)),F.push(Hg),l===null){var le=A-m-w+2*n5;F.push($2(c,le,i))}else{var ue=(A-m-w-O)/2+2*n5;F.push($2(c,ue,i)),F.push(Hg),F.push(N2(l,p,s)),F.push(Hg),F.push($2(c,ue,i))}F.push(Hg),F.push(N2(a,p,s))}var Pe=i.havingBaseStyle(De.TEXT),je=K.makeVList({positionType:"bottom",positionData:N,children:F},Pe);return w7(K.makeSpan(["delimsizing","mult"],[je],Pe),De.TEXT,i,o)},F2=80,B2=.08,U2=function(e,t,r,i,s){var o=wxe(e,i,r),a=new jl(e,o),l=new Pa([a],{width:"400em",height:de(t),viewBox:"0 0 400000 "+r,preserveAspectRatio:"xMinYMin slice"});return K.makeSvgSpan(["hide-tail"],[l],s)},x2e=function(e,t){var r=t.havingBaseSizing(),i=sB("\\surd",e*r.sizeMultiplier,iB,r),s=r.sizeMultiplier,o=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),a,l=0,c=0,u=0,d;return i.type==="small"?(u=1e3+1e3*o+F2,e<1?s=1:e<1.4&&(s=.7),l=(1+o+B2)/s,c=(1+o)/s,a=U2("sqrtMain",l,u,o,t),a.style.minWidth="0.853em",d=.833/s):i.type==="large"?(u=(1e3+F2)*jf[i.size],c=(jf[i.size]+o)/s,l=(jf[i.size]+o+B2)/s,a=U2("sqrtSize"+i.size,l,u,o,t),a.style.minWidth="1.02em",d=1/s):(l=e+o+B2,c=e+o,u=Math.floor(1e3*e+o)+F2,a=U2("sqrtTall",l,u,o,t),a.style.minWidth="0.742em",d=1.056),a.height=c,a.style.height=de(l),{span:a,advanceWidth:d,ruleWidth:(t.fontMetrics().sqrtRuleThickness+o)*s}},nB=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","\\surd"],w2e=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","",""],rB=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],jf=[0,1.2,1.8,2.4,3],b2e=function(e,t,r,i,s){if(e==="<"||e==="\\lt"||e===""?e="\\langle":(e===">"||e==="\\gt"||e==="")&&(e="\\rangle"),Ae.contains(nB,e)||Ae.contains(rB,e))return eB(e,t,!1,r,i,s);if(Ae.contains(w2e,e))return tB(e,jf[t],!1,r,i,s);throw new oe("Illegal delimiter: '"+e+"'")},O2e=[{type:"small",style:De.SCRIPTSCRIPT},{type:"small",style:De.SCRIPT},{type:"small",style:De.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],k2e=[{type:"small",style:De.SCRIPTSCRIPT},{type:"small",style:De.SCRIPT},{type:"small",style:De.TEXT},{type:"stack"}],iB=[{type:"small",style:De.SCRIPTSCRIPT},{type:"small",style:De.SCRIPT},{type:"small",style:De.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],C2e=function(e){if(e.type==="small")return"Main-Regular";if(e.type==="large")return"Size"+e.size+"-Regular";if(e.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},sB=function(e,t,r,i){for(var s=Math.min(2,3-i.style.size),o=s;o<r.length&&r[o].type!=="stack";o++){var a=ff(e,C2e(r[o]),"math"),l=a.height+a.depth;if(r[o].type==="small"){var c=i.havingBaseStyle(r[o].style);l*=c.sizeMultiplier}if(l>t)return r[o]}return r[r.length-1]},oB=function(e,t,r,i,s,o){e==="<"||e==="\\lt"||e===""?e="\\langle":(e===">"||e==="\\gt"||e==="")&&(e="\\rangle");var a;Ae.contains(rB,e)?a=O2e:Ae.contains(nB,e)?a=iB:a=k2e;var l=sB(e,t,a,i);return l.type==="small"?m2e(e,l.style,r,i,s,o):l.type==="large"?eB(e,l.size,r,i,s,o):tB(e,t,r,i,s,o)},P2e=function(e,t,r,i,s,o){var a=i.fontMetrics().axisHeight*i.sizeMultiplier,l=901,c=5/i.fontMetrics().ptPerEm,u=Math.max(t-a,r+a),d=Math.max(u/500*l,2*u-c);return oB(e,d,!0,i,s,o)},ga={sqrtImage:x2e,sizedDelim:b2e,sizeToMaxHeight:jf,customSizedDelim:oB,leftRightDelim:P2e},k9={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},T2e=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","<",">","\\langle","","\\rangle","","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","","","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function xS(n,e){var t=vS(n);if(t&&Ae.contains(T2e,t.text))return t;throw t?new oe("Invalid delimiter '"+t.text+"' after '"+e.funcName+"'",n):new oe("Invalid delimiter type '"+n.type+"'",n)}pe({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(n,e)=>{var t=xS(e[0],n);return{type:"delimsizing",mode:n.parser.mode,size:k9[n.funcName].size,mclass:k9[n.funcName].mclass,delim:t.text}},htmlBuilder:(n,e)=>n.delim==="."?K.makeSpan([n.mclass]):ga.sizedDelim(n.delim,n.size,e,n.mode,[n.mclass]),mathmlBuilder:n=>{var e=[];n.delim!=="."&&e.push(as(n.delim,n.mode));var t=new se.MathNode("mo",e);n.mclass==="mopen"||n.mclass==="mclose"?t.setAttribute("fence","true"):t.setAttribute("fence","false"),t.setAttribute("stretchy","true");var r=de(ga.sizeToMaxHeight[n.size]);return t.setAttribute("minsize",r),t.setAttribute("maxsize",r),t}});function C9(n){if(!n.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}pe({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=n.parser.gullet.macros.get("\\current@color");if(t&&typeof t!="string")throw new oe("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:n.parser.mode,delim:xS(e[0],n).text,color:t}}});pe({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=xS(e[0],n),r=n.parser;++r.leftrightDepth;var i=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var s=Be(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:i,left:t.text,right:s.delim,rightColor:s.color}},htmlBuilder:(n,e)=>{C9(n);for(var t=En(n.body,e,!0,["mopen","mclose"]),r=0,i=0,s=!1,o=0;o<t.length;o++)t[o].isMiddle?s=!0:(r=Math.max(t[o].height,r),i=Math.max(t[o].depth,i));r*=e.sizeMultiplier,i*=e.sizeMultiplier;var a;if(n.left==="."?a=Pp(e,["mopen"]):a=ga.leftRightDelim(n.left,r,i,e,n.mode,["mopen"]),t.unshift(a),s)for(var l=1;l<t.length;l++){var c=t[l],u=c.isMiddle;u&&(t[l]=ga.leftRightDelim(u.delim,r,i,u.options,n.mode,[]))}var d;if(n.right===".")d=Pp(e,["mclose"]);else{var h=n.rightColor?e.withColor(n.rightColor):e;d=ga.leftRightDelim(n.right,r,i,h,n.mode,["mclose"])}return t.push(d),K.makeSpan(["minner"],t,e)},mathmlBuilder:(n,e)=>{C9(n);var t=ci(n.body,e);if(n.left!=="."){var r=new se.MathNode("mo",[as(n.left,n.mode)]);r.setAttribute("fence","true"),t.unshift(r)}if(n.right!=="."){var i=new se.MathNode("mo",[as(n.right,n.mode)]);i.setAttribute("fence","true"),n.rightColor&&i.setAttribute("mathcolor",n.rightColor),t.push(i)}return y7(t)}});pe({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=xS(e[0],n);if(!n.parser.leftrightDepth)throw new oe("\\middle without preceding \\left",t);return{type:"middle",mode:n.parser.mode,delim:t.text}},htmlBuilder:(n,e)=>{var t;if(n.delim===".")t=Pp(e,[]);else{t=ga.sizedDelim(n.delim,1,e,n.mode,[]);var r={delim:n.delim,options:e};t.isMiddle=r}return t},mathmlBuilder:(n,e)=>{var t=n.delim==="\\vert"||n.delim==="|"?as("|","text"):as(n.delim,n.mode),r=new se.MathNode("mo",[t]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var b7=(n,e)=>{var t=K.wrapFragment(lt(n.body,e),e),r=n.label.slice(1),i=e.sizeMultiplier,s,o=0,a=Ae.isCharacterBox(n.body);if(r==="sout")s=K.makeSpan(["stretchy","sout"]),s.height=e.fontMetrics().defaultRuleThickness/i,o=-.5*e.fontMetrics().xHeight;else if(r==="phase"){var l=Kt({number:.6,unit:"pt"},e),c=Kt({number:.35,unit:"ex"},e),u=e.havingBaseSizing();i=i/u.sizeMultiplier;var d=t.height+t.depth+l+c;t.style.paddingLeft=de(d/2+l);var h=Math.floor(1e3*d*i),p=Sxe(h),g=new Pa([new jl("phase",p)],{width:"400em",height:de(h/1e3),viewBox:"0 0 400000 "+h,preserveAspectRatio:"xMinYMin slice"});s=K.makeSvgSpan(["hide-tail"],[g],e),s.style.height=de(d),o=t.depth+l+c}else{/cancel/.test(r)?a||t.classes.push("cancel-pad"):r==="angl"?t.classes.push("anglpad"):t.classes.push("boxpad");var m=0,S=0,y=0;/box/.test(r)?(y=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness),m=e.fontMetrics().fboxsep+(r==="colorbox"?0:y),S=m):r==="angl"?(y=Math.max(e.fontMetrics().defaultRuleThickness,e.minRuleThickness),m=4*y,S=Math.max(0,.25-t.depth)):(m=a?.2:0,S=m),s=Ea.encloseSpan(t,r,m,S,e),/fbox|boxed|fcolorbox/.test(r)?(s.style.borderStyle="solid",s.style.borderWidth=de(y)):r==="angl"&&y!==.049&&(s.style.borderTopWidth=de(y),s.style.borderRightWidth=de(y)),o=t.depth+S,n.backgroundColor&&(s.style.backgroundColor=n.backgroundColor,n.borderColor&&(s.style.borderColor=n.borderColor))}var x;if(n.backgroundColor)x=K.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:o},{type:"elem",elem:t,shift:0}]},e);else{var w=/cancel|phase/.test(r)?["svg-align"]:[];x=K.makeVList({positionType:"individualShift",children:[{type:"elem",elem:t,shift:0},{type:"elem",elem:s,shift:o,wrapperClasses:w}]},e)}return/cancel/.test(r)&&(x.height=t.height,x.depth=t.depth),/cancel/.test(r)&&!a?K.makeSpan(["mord","cancel-lap"],[x],e):K.makeSpan(["mord"],[x],e)},O7=(n,e)=>{var t=0,r=new se.MathNode(n.label.indexOf("colorbox")>-1?"mpadded":"menclose",[kt(n.body,e)]);switch(n.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(t=e.fontMetrics().fboxsep*e.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*t+"pt"),r.setAttribute("height","+"+2*t+"pt"),r.setAttribute("lspace",t+"pt"),r.setAttribute("voffset",t+"pt"),n.label==="\\fcolorbox"){var i=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness);r.setAttribute("style","border: "+i+"em solid "+String(n.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return n.backgroundColor&&r.setAttribute("mathbackground",n.backgroundColor),r};pe({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(n,e,t){var{parser:r,funcName:i}=n,s=Be(e[0],"color-token").color,o=e[1];return{type:"enclose",mode:r.mode,label:i,backgroundColor:s,body:o}},htmlBuilder:b7,mathmlBuilder:O7});pe({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(n,e,t){var{parser:r,funcName:i}=n,s=Be(e[0],"color-token").color,o=Be(e[1],"color-token").color,a=e[2];return{type:"enclose",mode:r.mode,label:i,backgroundColor:o,borderColor:s,body:a}},htmlBuilder:b7,mathmlBuilder:O7});pe({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"enclose",mode:t.mode,label:"\\fbox",body:e[0]}}});pe({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:r}=n,i=e[0];return{type:"enclose",mode:t.mode,label:r,body:i}},htmlBuilder:b7,mathmlBuilder:O7});pe({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(n,e){var{parser:t}=n;return{type:"enclose",mode:t.mode,label:"\\angl",body:e[0]}}});var aB={};function Do(n){for(var{type:e,names:t,props:r,handler:i,htmlBuilder:s,mathmlBuilder:o}=n,a={type:e,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:i},l=0;l<t.length;++l)aB[t[l]]=a;s&&(_y[e]=s),o&&(Ry[e]=o)}var lB={};function R(n,e){lB[n]=e}function P9(n){var e=[];n.consumeSpaces();var t=n.fetch().text;for(t==="\\relax"&&(n.consume(),n.consumeSpaces(),t=n.fetch().text);t==="\\hline"||t==="\\hdashline";)n.consume(),e.push(t==="\\hdashline"),n.consumeSpaces(),t=n.fetch().text;return e}var wS=n=>{var e=n.parser.settings;if(!e.displayMode)throw new oe("{"+n.envName+"} can be used only in display mode.")};function k7(n){if(n.indexOf("ed")===-1)return n.indexOf("*")===-1}function nc(n,e,t){var{hskipBeforeAndAfter:r,addJot:i,cols:s,arraystretch:o,colSeparationType:a,autoTag:l,singleRow:c,emptySingleRow:u,maxNumCols:d,leqno:h}=e;if(n.gullet.beginGroup(),c||n.gullet.macros.set("\\cr","\\\\\\relax"),!o){var p=n.gullet.expandMacroAsText("\\arraystretch");if(p==null)o=1;else if(o=parseFloat(p),!o||o<0)throw new oe("Invalid \\arraystretch: "+p)}n.gullet.beginGroup();var g=[],m=[g],S=[],y=[],x=l!=null?[]:void 0;function w(){l&&n.gullet.macros.set("\\@eqnsw","1",!0)}function O(){x&&(n.gullet.macros.get("\\df@tag")?(x.push(n.subparse([new es("\\df@tag")])),n.gullet.macros.set("\\df@tag",void 0,!0)):x.push(!!l&&n.gullet.macros.get("\\@eqnsw")==="1"))}for(w(),y.push(P9(n));;){var T=n.parseExpression(!1,c?"\\end":"\\\\");n.gullet.endGroup(),n.gullet.beginGroup(),T={type:"ordgroup",mode:n.mode,body:T},t&&(T={type:"styling",mode:n.mode,style:t,body:[T]}),g.push(T);var E=n.fetch().text;if(E==="&"){if(d&&g.length===d){if(c||a)throw new oe("Too many tab characters: &",n.nextToken);n.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}n.consume()}else if(E==="\\end"){O(),g.length===1&&T.type==="styling"&&T.body[0].body.length===0&&(m.length>1||!u)&&m.pop(),y.length<m.length+1&&y.push([]);break}else if(E==="\\\\"){n.consume();var C=void 0;n.gullet.future().text!==" "&&(C=n.parseSizeGroup(!0)),S.push(C?C.value:null),O(),y.push(P9(n)),g=[],m.push(g),w()}else throw new oe("Expected & or \\\\ or \\cr or \\end",n.nextToken)}return n.gullet.endGroup(),n.gullet.endGroup(),{type:"array",mode:n.mode,addJot:i,arraystretch:o,body:m,cols:s,rowGaps:S,hskipBeforeAndAfter:r,hLinesBeforeRow:y,colSeparationType:a,tags:x,leqno:h}}function C7(n){return n.slice(0,1)==="d"?"display":"text"}var jo=function(e,t){var r,i,s=e.body.length,o=e.hLinesBeforeRow,a=0,l=new Array(s),c=[],u=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),d=1/t.fontMetrics().ptPerEm,h=5*d;if(e.colSeparationType&&e.colSeparationType==="small"){var p=t.havingStyle(De.SCRIPT).sizeMultiplier;h=.2778*(p/t.sizeMultiplier)}var g=e.colSeparationType==="CD"?Kt({number:3,unit:"ex"},t):12*d,m=3*d,S=e.arraystretch*g,y=.7*S,x=.3*S,w=0;function O(Hs){for(var di=0;di<Hs.length;++di)di>0&&(w+=.25),c.push({pos:w,isDashed:Hs[di]})}for(O(o[0]),r=0;r<e.body.length;++r){var T=e.body[r],E=y,C=x;a<T.length&&(a=T.length);var M=new Array(T.length);for(i=0;i<T.length;++i){var A=lt(T[i],t);C<A.depth&&(C=A.depth),E<A.height&&(E=A.height),M[i]=A}var D=e.rowGaps[r],N=0;D&&(N=Kt(D,t),N>0&&(N+=x,C<N&&(C=N),N=0)),e.addJot&&(C+=m),M.height=E,M.depth=C,w+=E,M.pos=w,w+=C+N,l[r]=M,O(o[r+1])}var F=w/2+t.fontMetrics().axisHeight,j=e.cols||[],L=[],U,Y,V=[];if(e.tags&&e.tags.some(Hs=>Hs))for(r=0;r<s;++r){var W=l[r],J=W.pos-F,ne=e.tags[r],le=void 0;ne===!0?le=K.makeSpan(["eqn-num"],[],t):ne===!1?le=K.makeSpan([],[],t):le=K.makeSpan([],En(ne,t,!0),t),le.depth=W.depth,le.height=W.height,V.push({type:"elem",elem:le,shift:J})}for(i=0,Y=0;i<a||Y<j.length;++i,++Y){for(var ue=j[Y]||{},Pe=!0;ue.type==="separator";){if(Pe||(U=K.makeSpan(["arraycolsep"],[]),U.style.width=de(t.fontMetrics().doubleRuleSep),L.push(U)),ue.separator==="|"||ue.separator===":"){var je=ue.separator==="|"?"solid":"dashed",he=K.makeSpan(["vertical-separator"],[],t);he.style.height=de(w),he.style.borderRightWidth=de(u),he.style.borderRightStyle=je,he.style.margin="0 "+de(-u/2);var et=w-F;et&&(he.style.verticalAlign=de(-et)),L.push(he)}else throw new oe("Invalid separator type: "+ue.separator);Y++,ue=j[Y]||{},Pe=!1}if(!(i>=a)){var Ue=void 0;(i>0||e.hskipBeforeAndAfter)&&(Ue=Ae.deflt(ue.pregap,h),Ue!==0&&(U=K.makeSpan(["arraycolsep"],[]),U.style.width=de(Ue),L.push(U)));var ct=[];for(r=0;r<s;++r){var Je=l[r],vt=Je[i];if(vt){var ut=Je.pos-F;vt.depth=Je.depth,vt.height=Je.height,ct.push({type:"elem",elem:vt,shift:ut})}}ct=K.makeVList({positionType:"individualShift",children:ct},t),ct=K.makeSpan(["col-align-"+(ue.align||"c")],[ct]),L.push(ct),(i<a-1||e.hskipBeforeAndAfter)&&(Ue=Ae.deflt(ue.postgap,h),Ue!==0&&(U=K.makeSpan(["arraycolsep"],[]),U.style.width=de(Ue),L.push(U)))}}if(l=K.makeSpan(["mtable"],L),c.length>0){for(var wr=K.makeLineSpan("hline",t,u),xn=K.makeLineSpan("hdashline",t,u),In=[{type:"elem",elem:l,shift:0}];c.length>0;){var Bt=c.pop(),wn=Bt.pos-F;Bt.isDashed?In.push({type:"elem",elem:xn,shift:wn}):In.push({type:"elem",elem:wr,shift:wn})}l=K.makeVList({positionType:"individualShift",children:In},t)}if(V.length===0)return K.makeSpan(["mord"],[l],t);var ui=K.makeVList({positionType:"individualShift",children:V},t);return ui=K.makeSpan(["tag"],[ui],t),K.makeFragment([l,ui])},E2e={c:"center ",l:"left ",r:"right "},Lo=function(e,t){for(var r=[],i=new se.MathNode("mtd",[],["mtr-glue"]),s=new se.MathNode("mtd",[],["mml-eqn-num"]),o=0;o<e.body.length;o++){for(var a=e.body[o],l=[],c=0;c<a.length;c++)l.push(new se.MathNode("mtd",[kt(a[c],t)]));e.tags&&e.tags[o]&&(l.unshift(i),l.push(i),e.leqno?l.unshift(s):l.push(s)),r.push(new se.MathNode("mtr",l))}var u=new se.MathNode("mtable",r),d=e.arraystretch===.5?.1:.16+e.arraystretch-1+(e.addJot?.09:0);u.setAttribute("rowspacing",de(d));var h="",p="";if(e.cols&&e.cols.length>0){var g=e.cols,m="",S=!1,y=0,x=g.length;g[0].type==="separator"&&(h+="top ",y=1),g[g.length-1].type==="separator"&&(h+="bottom ",x-=1);for(var w=y;w<x;w++)g[w].type==="align"?(p+=E2e[g[w].align],S&&(m+="none "),S=!0):g[w].type==="separator"&&S&&(m+=g[w].separator==="|"?"solid ":"dashed ",S=!1);u.setAttribute("columnalign",p.trim()),/[sd]/.test(m)&&u.setAttribute("columnlines",m.trim())}if(e.colSeparationType==="align"){for(var O=e.cols||[],T="",E=1;E<O.length;E++)T+=E%2?"0em ":"1em ";u.setAttribute("columnspacing",T.trim())}else e.colSeparationType==="alignat"||e.colSeparationType==="gather"?u.setAttribute("columnspacing","0em"):e.colSeparationType==="small"?u.setAttribute("columnspacing","0.2778em"):e.colSeparationType==="CD"?u.setAttribute("columnspacing","0.5em"):u.setAttribute("columnspacing","1em");var C="",M=e.hLinesBeforeRow;h+=M[0].length>0?"left ":"",h+=M[M.length-1].length>0?"right ":"";for(var A=1;A<M.length-1;A++)C+=M[A].length===0?"none ":M[A][0]?"dashed ":"solid ";return/[sd]/.test(C)&&u.setAttribute("rowlines",C.trim()),h!==""&&(u=new se.MathNode("menclose",[u]),u.setAttribute("notation",h.trim())),e.arraystretch&&e.arraystretch<1&&(u=new se.MathNode("mstyle",[u]),u.setAttribute("scriptlevel","1")),u},cB=function(e,t){e.envName.indexOf("ed")===-1&&wS(e);var r=[],i=e.envName.indexOf("at")>-1?"alignat":"align",s=e.envName==="split",o=nc(e.parser,{cols:r,addJot:!0,autoTag:s?void 0:k7(e.envName),emptySingleRow:!0,colSeparationType:i,maxNumCols:s?2:void 0,leqno:e.parser.settings.leqno},"display"),a,l=0,c={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&t[0].type==="ordgroup"){for(var u="",d=0;d<t[0].body.length;d++){var h=Be(t[0].body[d],"textord");u+=h.text}a=Number(u),l=a*2}var p=!l;o.body.forEach(function(y){for(var x=1;x<y.length;x+=2){var w=Be(y[x],"styling"),O=Be(w.body[0],"ordgroup");O.body.unshift(c)}if(p)l<y.length&&(l=y.length);else{var T=y.length/2;if(a<T)throw new oe("Too many math in a row: "+("expected "+a+", but got "+T),y[0])}});for(var g=0;g<l;++g){var m="r",S=0;g%2===1?m="l":g>0&&p&&(S=1),r[g]={type:"align",align:m,pregap:S,postgap:0}}return o.colSeparationType=p?"align":"alignat",o};Do({type:"array",names:["array","darray"],props:{numArgs:1},handler(n,e){var t=vS(e[0]),r=t?[e[0]]:Be(e[0],"ordgroup").body,i=r.map(function(o){var a=S7(o),l=a.text;if("lcr".indexOf(l)!==-1)return{type:"align",align:l};if(l==="|")return{type:"separator",separator:"|"};if(l===":")return{type:"separator",separator:":"};throw new oe("Unknown column alignment: "+l,o)}),s={cols:i,hskipBeforeAndAfter:!0,maxNumCols:i.length};return nc(n.parser,s,C7(n.envName))},htmlBuilder:jo,mathmlBuilder:Lo});Do({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(n){var e={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[n.envName.replace("*","")],t="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:t}]};if(n.envName.charAt(n.envName.length-1)==="*"){var i=n.parser;if(i.consumeSpaces(),i.fetch().text==="["){if(i.consume(),i.consumeSpaces(),t=i.fetch().text,"lcr".indexOf(t)===-1)throw new oe("Expected l or c or r",i.nextToken);i.consume(),i.consumeSpaces(),i.expect("]"),i.consume(),r.cols=[{type:"align",align:t}]}}var s=nc(n.parser,r,C7(n.envName)),o=Math.max(0,...s.body.map(a=>a.length));return s.cols=new Array(o).fill({type:"align",align:t}),e?{type:"leftright",mode:n.mode,body:[s],left:e[0],right:e[1],rightColor:void 0}:s},htmlBuilder:jo,mathmlBuilder:Lo});Do({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(n){var e={arraystretch:.5},t=nc(n.parser,e,"script");return t.colSeparationType="small",t},htmlBuilder:jo,mathmlBuilder:Lo});Do({type:"array",names:["subarray"],props:{numArgs:1},handler(n,e){var t=vS(e[0]),r=t?[e[0]]:Be(e[0],"ordgroup").body,i=r.map(function(o){var a=S7(o),l=a.text;if("lc".indexOf(l)!==-1)return{type:"align",align:l};throw new oe("Unknown column alignment: "+l,o)});if(i.length>1)throw new oe("{subarray} can contain only one column");var s={cols:i,hskipBeforeAndAfter:!1,arraystretch:.5};if(s=nc(n.parser,s,"script"),s.body.length>0&&s.body[0].length>1)throw new oe("{subarray} can contain only one column");return s},htmlBuilder:jo,mathmlBuilder:Lo});Do({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(n){var e={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},t=nc(n.parser,e,C7(n.envName));return{type:"leftright",mode:n.mode,body:[t],left:n.envName.indexOf("r")>-1?".":"\\{",right:n.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:jo,mathmlBuilder:Lo});Do({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:cB,htmlBuilder:jo,mathmlBuilder:Lo});Do({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(n){Ae.contains(["gather","gather*"],n.envName)&&wS(n);var e={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:k7(n.envName),emptySingleRow:!0,leqno:n.parser.settings.leqno};return nc(n.parser,e,"display")},htmlBuilder:jo,mathmlBuilder:Lo});Do({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:cB,htmlBuilder:jo,mathmlBuilder:Lo});Do({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(n){wS(n);var e={autoTag:k7(n.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:n.parser.settings.leqno};return nc(n.parser,e,"display")},htmlBuilder:jo,mathmlBuilder:Lo});Do({type:"array",names:["CD"],props:{numArgs:0},handler(n){return wS(n),p2e(n.parser)},htmlBuilder:jo,mathmlBuilder:Lo});R("\\nonumber","\\gdef\\@eqnsw{0}");R("\\notag","\\nonumber");pe({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(n,e){throw new oe(n.funcName+" valid only within array environment")}});var T9=aB;pe({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(n,e){var{parser:t,funcName:r}=n,i=e[0];if(i.type!=="ordgroup")throw new oe("Invalid environment name",i);for(var s="",o=0;o<i.body.length;++o)s+=Be(i.body[o],"textord").text;if(r==="\\begin"){if(!T9.hasOwnProperty(s))throw new oe("No such environment: "+s,i);var a=T9[s],{args:l,optArgs:c}=t.parseArguments("\\begin{"+s+"}",a),u={mode:t.mode,envName:s,parser:t},d=a.handler(u,l,c);t.expect("\\end",!1);var h=t.nextToken,p=Be(t.parseFunction(),"environment");if(p.name!==s)throw new oe("Mismatch: \\begin{"+s+"} matched by \\end{"+p.name+"}",h);return d}return{type:"environment",mode:t.mode,name:s,nameGroup:i}}});var uB=(n,e)=>{var t=n.font,r=e.withFont(t);return lt(n.body,r)},dB=(n,e)=>{var t=n.font,r=e.withFont(t);return kt(n.body,r)},E9={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};pe({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=Dy(e[0]),s=r;return s in E9&&(s=E9[s]),{type:"font",mode:t.mode,font:s.slice(1),body:i}},htmlBuilder:uB,mathmlBuilder:dB});pe({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(n,e)=>{var{parser:t}=n,r=e[0],i=Ae.isCharacterBox(r);return{type:"mclass",mode:t.mode,mclass:SS(r),body:[{type:"font",mode:t.mode,font:"boldsymbol",body:r}],isCharacterBox:i}}});pe({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:r,breakOnTokenText:i}=n,{mode:s}=t,o=t.parseExpression(!0,i),a="math"+r.slice(1);return{type:"font",mode:s,font:a,body:{type:"ordgroup",mode:t.mode,body:o}}},htmlBuilder:uB,mathmlBuilder:dB});var hB=(n,e)=>{var t=e;return n==="display"?t=t.id>=De.SCRIPT.id?t.text():De.DISPLAY:n==="text"&&t.size===De.DISPLAY.size?t=De.TEXT:n==="script"?t=De.SCRIPT:n==="scriptscript"&&(t=De.SCRIPTSCRIPT),t},P7=(n,e)=>{var t=hB(n.size,e.style),r=t.fracNum(),i=t.fracDen(),s;s=e.havingStyle(r);var o=lt(n.numer,s,e);if(n.continued){var a=8.5/e.fontMetrics().ptPerEm,l=3.5/e.fontMetrics().ptPerEm;o.height=o.height<a?a:o.height,o.depth=o.depth<l?l:o.depth}s=e.havingStyle(i);var c=lt(n.denom,s,e),u,d,h;n.hasBarLine?(n.barSize?(d=Kt(n.barSize,e),u=K.makeLineSpan("frac-line",e,d)):u=K.makeLineSpan("frac-line",e),d=u.height,h=u.height):(u=null,d=0,h=e.fontMetrics().defaultRuleThickness);var p,g,m;t.size===De.DISPLAY.size||n.size==="display"?(p=e.fontMetrics().num1,d>0?g=3*h:g=7*h,m=e.fontMetrics().denom1):(d>0?(p=e.fontMetrics().num2,g=h):(p=e.fontMetrics().num3,g=3*h),m=e.fontMetrics().denom2);var S;if(u){var x=e.fontMetrics().axisHeight;p-o.depth-(x+.5*d)<g&&(p+=g-(p-o.depth-(x+.5*d))),x-.5*d-(c.height-m)<g&&(m+=g-(x-.5*d-(c.height-m)));var w=-(x-.5*d);S=K.makeVList({positionType:"individualShift",children:[{type:"elem",elem:c,shift:m},{type:"elem",elem:u,shift:w},{type:"elem",elem:o,shift:-p}]},e)}else{var y=p-o.depth-(c.height-m);y<g&&(p+=.5*(g-y),m+=.5*(g-y)),S=K.makeVList({positionType:"individualShift",children:[{type:"elem",elem:c,shift:m},{type:"elem",elem:o,shift:-p}]},e)}s=e.havingStyle(t),S.height*=s.sizeMultiplier/e.sizeMultiplier,S.depth*=s.sizeMultiplier/e.sizeMultiplier;var O;t.size===De.DISPLAY.size?O=e.fontMetrics().delim1:t.size===De.SCRIPTSCRIPT.size?O=e.havingStyle(De.SCRIPT).fontMetrics().delim2:O=e.fontMetrics().delim2;var T,E;return n.leftDelim==null?T=Pp(e,["mopen"]):T=ga.customSizedDelim(n.leftDelim,O,!0,e.havingStyle(t),n.mode,["mopen"]),n.continued?E=K.makeSpan([]):n.rightDelim==null?E=Pp(e,["mclose"]):E=ga.customSizedDelim(n.rightDelim,O,!0,e.havingStyle(t),n.mode,["mclose"]),K.makeSpan(["mord"].concat(s.sizingClasses(e)),[T,K.makeSpan(["mfrac"],[S]),E],e)},T7=(n,e)=>{var t=new se.MathNode("mfrac",[kt(n.numer,e),kt(n.denom,e)]);if(!n.hasBarLine)t.setAttribute("linethickness","0px");else if(n.barSize){var r=Kt(n.barSize,e);t.setAttribute("linethickness",de(r))}var i=hB(n.size,e.style);if(i.size!==e.style.size){t=new se.MathNode("mstyle",[t]);var s=i.size===De.DISPLAY.size?"true":"false";t.setAttribute("displaystyle",s),t.setAttribute("scriptlevel","0")}if(n.leftDelim!=null||n.rightDelim!=null){var o=[];if(n.leftDelim!=null){var a=new se.MathNode("mo",[new se.TextNode(n.leftDelim.replace("\\",""))]);a.setAttribute("fence","true"),o.push(a)}if(o.push(t),n.rightDelim!=null){var l=new se.MathNode("mo",[new se.TextNode(n.rightDelim.replace("\\",""))]);l.setAttribute("fence","true"),o.push(l)}return y7(o)}return t};pe({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0],s=e[1],o,a=null,l=null,c="auto";switch(r){case"\\dfrac":case"\\frac":case"\\tfrac":o=!0;break;case"\\\\atopfrac":o=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":o=!1,a="(",l=")";break;case"\\\\bracefrac":o=!1,a="\\{",l="\\}";break;case"\\\\brackfrac":o=!1,a="[",l="]";break;default:throw new Error("Unrecognized genfrac command")}switch(r){case"\\dfrac":case"\\dbinom":c="display";break;case"\\tfrac":case"\\tbinom":c="text";break}return{type:"genfrac",mode:t.mode,continued:!1,numer:i,denom:s,hasBarLine:o,leftDelim:a,rightDelim:l,size:c,barSize:null}},htmlBuilder:P7,mathmlBuilder:T7});pe({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0],s=e[1];return{type:"genfrac",mode:t.mode,continued:!0,numer:i,denom:s,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});pe({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(n){var{parser:e,funcName:t,token:r}=n,i;switch(t){case"\\over":i="\\frac";break;case"\\choose":i="\\binom";break;case"\\atop":i="\\\\atopfrac";break;case"\\brace":i="\\\\bracefrac";break;case"\\brack":i="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:i,token:r}}});var I9=["display","text","script","scriptscript"],M9=function(e){var t=null;return e.length>0&&(t=e,t=t==="."?null:t),t};pe({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(n,e){var{parser:t}=n,r=e[4],i=e[5],s=Dy(e[0]),o=s.type==="atom"&&s.family==="open"?M9(s.text):null,a=Dy(e[1]),l=a.type==="atom"&&a.family==="close"?M9(a.text):null,c=Be(e[2],"size"),u,d=null;c.isBlank?u=!0:(d=c.value,u=d.number>0);var h="auto",p=e[3];if(p.type==="ordgroup"){if(p.body.length>0){var g=Be(p.body[0],"textord");h=I9[Number(g.text)]}}else p=Be(p,"textord"),h=I9[Number(p.text)];return{type:"genfrac",mode:t.mode,numer:r,denom:i,continued:!1,hasBarLine:u,barSize:d,leftDelim:o,rightDelim:l,size:h}},htmlBuilder:P7,mathmlBuilder:T7});pe({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(n,e){var{parser:t,funcName:r,token:i}=n;return{type:"infix",mode:t.mode,replaceWith:"\\\\abovefrac",size:Be(e[0],"size").value,token:i}}});pe({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0],s=ixe(Be(e[1],"infix").size),o=e[2],a=s.number>0;return{type:"genfrac",mode:t.mode,numer:i,denom:o,continued:!1,hasBarLine:a,barSize:s,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:P7,mathmlBuilder:T7});var fB=(n,e)=>{var t=e.style,r,i;n.type==="supsub"?(r=n.sup?lt(n.sup,e.havingStyle(t.sup()),e):lt(n.sub,e.havingStyle(t.sub()),e),i=Be(n.base,"horizBrace")):i=Be(n,"horizBrace");var s=lt(i.base,e.havingBaseStyle(De.DISPLAY)),o=Ea.svgSpan(i,e),a;if(i.isOver?(a=K.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"kern",size:.1},{type:"elem",elem:o}]},e),a.children[0].children[0].children[1].classes.push("svg-align")):(a=K.makeVList({positionType:"bottom",positionData:s.depth+.1+o.height,children:[{type:"elem",elem:o},{type:"kern",size:.1},{type:"elem",elem:s}]},e),a.children[0].children[0].children[0].classes.push("svg-align")),r){var l=K.makeSpan(["mord",i.isOver?"mover":"munder"],[a],e);i.isOver?a=K.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:.2},{type:"elem",elem:r}]},e):a=K.makeVList({positionType:"bottom",positionData:l.depth+.2+r.height+r.depth,children:[{type:"elem",elem:r},{type:"kern",size:.2},{type:"elem",elem:l}]},e)}return K.makeSpan(["mord",i.isOver?"mover":"munder"],[a],e)},I2e=(n,e)=>{var t=Ea.mathMLnode(n.label);return new se.MathNode(n.isOver?"mover":"munder",[kt(n.base,e),t])};pe({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:r}=n;return{type:"horizBrace",mode:t.mode,label:r,isOver:/^\\over/.test(r),base:e[0]}},htmlBuilder:fB,mathmlBuilder:I2e});pe({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[1],i=Be(e[0],"url").url;return t.settings.isTrusted({command:"\\href",url:i})?{type:"href",mode:t.mode,href:i,body:hn(r)}:t.formatUnsupportedCmd("\\href")},htmlBuilder:(n,e)=>{var t=En(n.body,e,!1);return K.makeAnchor(n.href,[],t,e)},mathmlBuilder:(n,e)=>{var t=Ll(n.body,e);return t instanceof wi||(t=new wi("mrow",[t])),t.setAttribute("href",n.href),t}});pe({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=Be(e[0],"url").url;if(!t.settings.isTrusted({command:"\\url",url:r}))return t.formatUnsupportedCmd("\\url");for(var i=[],s=0;s<r.length;s++){var o=r[s];o==="~"&&(o="\\textasciitilde"),i.push({type:"textord",mode:"text",text:o})}var a={type:"text",mode:t.mode,font:"\\texttt",body:i};return{type:"href",mode:t.mode,href:r,body:hn(a)}}});pe({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(n,e){var{parser:t}=n;return{type:"hbox",mode:t.mode,body:hn(e[0])}},htmlBuilder(n,e){var t=En(n.body,e,!1);return K.makeFragment(t)},mathmlBuilder(n,e){return new se.MathNode("mrow",ci(n.body,e))}});pe({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:r,token:i}=n,s=Be(e[0],"raw").string,o=e[1];t.settings.strict&&t.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var a,l={};switch(r){case"\\htmlClass":l.class=s,a={command:"\\htmlClass",class:s};break;case"\\htmlId":l.id=s,a={command:"\\htmlId",id:s};break;case"\\htmlStyle":l.style=s,a={command:"\\htmlStyle",style:s};break;case"\\htmlData":{for(var c=s.split(","),u=0;u<c.length;u++){var d=c[u].split("=");if(d.length!==2)throw new oe("Error parsing key-value for \\htmlData");l["data-"+d[0].trim()]=d[1].trim()}a={command:"\\htmlData",attributes:l};break}default:throw new Error("Unrecognized html command")}return t.settings.isTrusted(a)?{type:"html",mode:t.mode,attributes:l,body:hn(o)}:t.formatUnsupportedCmd(r)},htmlBuilder:(n,e)=>{var t=En(n.body,e,!1),r=["enclosing"];n.attributes.class&&r.push(...n.attributes.class.trim().split(/\s+/));var i=K.makeSpan(r,t,e);for(var s in n.attributes)s!=="class"&&n.attributes.hasOwnProperty(s)&&i.setAttribute(s,n.attributes[s]);return i},mathmlBuilder:(n,e)=>Ll(n.body,e)});pe({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n;return{type:"htmlmathml",mode:t.mode,html:hn(e[0]),mathml:hn(e[1])}},htmlBuilder:(n,e)=>{var t=En(n.html,e,!1);return K.makeFragment(t)},mathmlBuilder:(n,e)=>Ll(n.mathml,e)});var H2=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new oe("Invalid size: '"+e+"' in \\includegraphics");var r={number:+(t[1]+t[2]),unit:t[3]};if(!_F(r))throw new oe("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r};pe({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(n,e,t)=>{var{parser:r}=n,i={number:0,unit:"em"},s={number:.9,unit:"em"},o={number:0,unit:"em"},a="";if(t[0])for(var l=Be(t[0],"raw").string,c=l.split(","),u=0;u<c.length;u++){var d=c[u].split("=");if(d.length===2){var h=d[1].trim();switch(d[0].trim()){case"alt":a=h;break;case"width":i=H2(h);break;case"height":s=H2(h);break;case"totalheight":o=H2(h);break;default:throw new oe("Invalid key: '"+d[0]+"' in \\includegraphics.")}}}var p=Be(e[0],"url").url;return a===""&&(a=p,a=a.replace(/^.*[\\/]/,""),a=a.substring(0,a.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:p})?{type:"includegraphics",mode:r.mode,alt:a,width:i,height:s,totalheight:o,src:p}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(n,e)=>{var t=Kt(n.height,e),r=0;n.totalheight.number>0&&(r=Kt(n.totalheight,e)-t);var i=0;n.width.number>0&&(i=Kt(n.width,e));var s={height:de(t+r)};i>0&&(s.width=de(i)),r>0&&(s.verticalAlign=de(-r));var o=new Ixe(n.src,n.alt,s);return o.height=t,o.depth=r,o},mathmlBuilder:(n,e)=>{var t=new se.MathNode("mglyph",[]);t.setAttribute("alt",n.alt);var r=Kt(n.height,e),i=0;if(n.totalheight.number>0&&(i=Kt(n.totalheight,e)-r,t.setAttribute("valign",de(-i))),t.setAttribute("height",de(r+i)),n.width.number>0){var s=Kt(n.width,e);t.setAttribute("width",de(s))}return t.setAttribute("src",n.src),t}});pe({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(n,e){var{parser:t,funcName:r}=n,i=Be(e[0],"size");if(t.settings.strict){var s=r[1]==="m",o=i.value.unit==="mu";s?(o||t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, "+("not "+i.value.unit+" units")),t.mode!=="math"&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):o&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:t.mode,dimension:i.value}},htmlBuilder(n,e){return K.makeGlue(n.dimension,e)},mathmlBuilder(n,e){var t=Kt(n.dimension,e);return new se.SpaceNode(t)}});pe({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0];return{type:"lap",mode:t.mode,alignment:r.slice(5),body:i}},htmlBuilder:(n,e)=>{var t;n.alignment==="clap"?(t=K.makeSpan([],[lt(n.body,e)]),t=K.makeSpan(["inner"],[t],e)):t=K.makeSpan(["inner"],[lt(n.body,e)]);var r=K.makeSpan(["fix"],[]),i=K.makeSpan([n.alignment],[t,r],e),s=K.makeSpan(["strut"]);return s.style.height=de(i.height+i.depth),i.depth&&(s.style.verticalAlign=de(-i.depth)),i.children.unshift(s),i=K.makeSpan(["thinbox"],[i],e),K.makeSpan(["mord","vbox"],[i],e)},mathmlBuilder:(n,e)=>{var t=new se.MathNode("mpadded",[kt(n.body,e)]);if(n.alignment!=="rlap"){var r=n.alignment==="llap"?"-1":"-0.5";t.setAttribute("lspace",r+"width")}return t.setAttribute("width","0px"),t}});pe({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(n,e){var{funcName:t,parser:r}=n,i=r.mode;r.switchMode("math");var s=t==="\\("?"\\)":"$",o=r.parseExpression(!1,s);return r.expect(s),r.switchMode(i),{type:"styling",mode:r.mode,style:"text",body:o}}});pe({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(n,e){throw new oe("Mismatched "+n.funcName)}});var A9=(n,e)=>{switch(e.style.size){case De.DISPLAY.size:return n.display;case De.TEXT.size:return n.text;case De.SCRIPT.size:return n.script;case De.SCRIPTSCRIPT.size:return n.scriptscript;default:return n.text}};pe({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(n,e)=>{var{parser:t}=n;return{type:"mathchoice",mode:t.mode,display:hn(e[0]),text:hn(e[1]),script:hn(e[2]),scriptscript:hn(e[3])}},htmlBuilder:(n,e)=>{var t=A9(n,e),r=En(t,e,!1);return K.makeFragment(r)},mathmlBuilder:(n,e)=>{var t=A9(n,e);return Ll(t,e)}});var pB=(n,e,t,r,i,s,o)=>{n=K.makeSpan([],[n]);var a=t&&Ae.isCharacterBox(t),l,c;if(e){var u=lt(e,r.havingStyle(i.sup()),r);c={elem:u,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-u.depth)}}if(t){var d=lt(t,r.havingStyle(i.sub()),r);l={elem:d,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-d.height)}}var h;if(c&&l){var p=r.fontMetrics().bigOpSpacing5+l.elem.height+l.elem.depth+l.kern+n.depth+o;h=K.makeVList({positionType:"bottom",positionData:p,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:de(-s)},{type:"kern",size:l.kern},{type:"elem",elem:n},{type:"kern",size:c.kern},{type:"elem",elem:c.elem,marginLeft:de(s)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(l){var g=n.height-o;h=K.makeVList({positionType:"top",positionData:g,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:de(-s)},{type:"kern",size:l.kern},{type:"elem",elem:n}]},r)}else if(c){var m=n.depth+o;h=K.makeVList({positionType:"bottom",positionData:m,children:[{type:"elem",elem:n},{type:"kern",size:c.kern},{type:"elem",elem:c.elem,marginLeft:de(s)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else return n;var S=[h];if(l&&s!==0&&!a){var y=K.makeSpan(["mspace"],[],r);y.style.marginRight=de(s),S.unshift(y)}return K.makeSpan(["mop","op-limits"],S,r)},gB=["\\smallint"],oh=(n,e)=>{var t,r,i=!1,s;n.type==="supsub"?(t=n.sup,r=n.sub,s=Be(n.base,"op"),i=!0):s=Be(n,"op");var o=e.style,a=!1;o.size===De.DISPLAY.size&&s.symbol&&!Ae.contains(gB,s.name)&&(a=!0);var l;if(s.symbol){var c=a?"Size2-Regular":"Size1-Regular",u="";if((s.name==="\\oiint"||s.name==="\\oiiint")&&(u=s.name.slice(1),s.name=u==="oiint"?"\\iint":"\\iiint"),l=K.makeSymbol(s.name,c,"math",e,["mop","op-symbol",a?"large-op":"small-op"]),u.length>0){var d=l.italic,h=K.staticSvg(u+"Size"+(a?"2":"1"),e);l=K.makeVList({positionType:"individualShift",children:[{type:"elem",elem:l,shift:0},{type:"elem",elem:h,shift:a?.08:0}]},e),s.name="\\"+u,l.classes.unshift("mop"),l.italic=d}}else if(s.body){var p=En(s.body,e,!0);p.length===1&&p[0]instanceof os?(l=p[0],l.classes[0]="mop"):l=K.makeSpan(["mop"],p,e)}else{for(var g=[],m=1;m<s.name.length;m++)g.push(K.mathsym(s.name[m],s.mode,e));l=K.makeSpan(["mop"],g,e)}var S=0,y=0;return(l instanceof os||s.name==="\\oiint"||s.name==="\\oiiint")&&!s.suppressBaseShift&&(S=(l.height-l.depth)/2-e.fontMetrics().axisHeight,y=l.italic),i?pB(l,t,r,e,o,y,S):(S&&(l.style.position="relative",l.style.top=de(S)),l)},m0=(n,e)=>{var t;if(n.symbol)t=new wi("mo",[as(n.name,n.mode)]),Ae.contains(gB,n.name)&&t.setAttribute("largeop","false");else if(n.body)t=new wi("mo",ci(n.body,e));else{t=new wi("mi",[new fo(n.name.slice(1))]);var r=new wi("mo",[as("","text")]);n.parentIsSupSub?t=new wi("mrow",[t,r]):t=HF([t,r])}return t},M2e={"":"\\prod","":"\\coprod","":"\\sum","":"\\bigwedge","":"\\bigvee","":"\\bigcap","":"\\bigcup","":"\\bigodot","":"\\bigoplus","":"\\bigotimes","":"\\biguplus","":"\\bigsqcup"};pe({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","","","","","","","","","","","",""],props:{numArgs:0},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=r;return i.length===1&&(i=M2e[i]),{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:i}},htmlBuilder:oh,mathmlBuilder:m0});pe({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:hn(r)}},htmlBuilder:oh,mathmlBuilder:m0});var A2e={"":"\\int","":"\\iint","":"\\iiint","":"\\oint","":"\\oiint","":"\\oiiint"};pe({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:oh,mathmlBuilder:m0});pe({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:oh,mathmlBuilder:m0});pe({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","","","","","",""],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n,r=t;return r.length===1&&(r=A2e[r]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:oh,mathmlBuilder:m0});var mB=(n,e)=>{var t,r,i=!1,s;n.type==="supsub"?(t=n.sup,r=n.sub,s=Be(n.base,"operatorname"),i=!0):s=Be(n,"operatorname");var o;if(s.body.length>0){for(var a=s.body.map(d=>{var h=d.text;return typeof h=="string"?{type:"textord",mode:d.mode,text:h}:d}),l=En(a,e.withFont("mathrm"),!0),c=0;c<l.length;c++){var u=l[c];u instanceof os&&(u.text=u.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}o=K.makeSpan(["mop"],l,e)}else o=K.makeSpan(["mop"],[],e);return i?pB(o,t,r,e,e.style,0,0):o},_2e=(n,e)=>{for(var t=ci(n.body,e.withFont("mathrm")),r=!0,i=0;i<t.length;i++){var s=t[i];if(!(s instanceof se.SpaceNode))if(s instanceof se.MathNode)switch(s.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var o=s.children[0];s.children.length===1&&o instanceof se.TextNode?o.text=o.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break}default:r=!1}else r=!1}if(r){var a=t.map(u=>u.toText()).join("");t=[new se.TextNode(a)]}var l=new se.MathNode("mi",t);l.setAttribute("mathvariant","normal");var c=new se.MathNode("mo",[as("","text")]);return n.parentIsSupSub?new se.MathNode("mrow",[l,c]):se.newDocumentFragment([l,c])};pe({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0];return{type:"operatorname",mode:t.mode,body:hn(i),alwaysHandleSupSub:r==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:mB,mathmlBuilder:_2e});R("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");du({type:"ordgroup",htmlBuilder(n,e){return n.semisimple?K.makeFragment(En(n.body,e,!1)):K.makeSpan(["mord"],En(n.body,e,!0),e)},mathmlBuilder(n,e){return Ll(n.body,e,!0)}});pe({type:"overline",names:["\\overline"],props:{numArgs:1},handler(n,e){var{parser:t}=n,r=e[0];return{type:"overline",mode:t.mode,body:r}},htmlBuilder(n,e){var t=lt(n.body,e.havingCrampedStyle()),r=K.makeLineSpan("overline-line",e),i=e.fontMetrics().defaultRuleThickness,s=K.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t},{type:"kern",size:3*i},{type:"elem",elem:r},{type:"kern",size:i}]},e);return K.makeSpan(["mord","overline"],[s],e)},mathmlBuilder(n,e){var t=new se.MathNode("mo",[new se.TextNode("")]);t.setAttribute("stretchy","true");var r=new se.MathNode("mover",[kt(n.body,e),t]);return r.setAttribute("accent","true"),r}});pe({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"phantom",mode:t.mode,body:hn(r)}},htmlBuilder:(n,e)=>{var t=En(n.body,e.withPhantom(),!1);return K.makeFragment(t)},mathmlBuilder:(n,e)=>{var t=ci(n.body,e);return new se.MathNode("mphantom",t)}});pe({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"hphantom",mode:t.mode,body:r}},htmlBuilder:(n,e)=>{var t=K.makeSpan([],[lt(n.body,e.withPhantom())]);if(t.height=0,t.depth=0,t.children)for(var r=0;r<t.children.length;r++)t.children[r].height=0,t.children[r].depth=0;return t=K.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e),K.makeSpan(["mord"],[t],e)},mathmlBuilder:(n,e)=>{var t=ci(hn(n.body),e),r=new se.MathNode("mphantom",t),i=new se.MathNode("mpadded",[r]);return i.setAttribute("height","0px"),i.setAttribute("depth","0px"),i}});pe({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"vphantom",mode:t.mode,body:r}},htmlBuilder:(n,e)=>{var t=K.makeSpan(["inner"],[lt(n.body,e.withPhantom())]),r=K.makeSpan(["fix"],[]);return K.makeSpan(["mord","rlap"],[t,r],e)},mathmlBuilder:(n,e)=>{var t=ci(hn(n.body),e),r=new se.MathNode("mphantom",t),i=new se.MathNode("mpadded",[r]);return i.setAttribute("width","0px"),i}});pe({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(n,e){var{parser:t}=n,r=Be(e[0],"size").value,i=e[1];return{type:"raisebox",mode:t.mode,dy:r,body:i}},htmlBuilder(n,e){var t=lt(n.body,e),r=Kt(n.dy,e);return K.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(n,e){var t=new se.MathNode("mpadded",[kt(n.body,e)]),r=n.dy.number+n.dy.unit;return t.setAttribute("voffset",r),t}});pe({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0},handler(n){var{parser:e}=n;return{type:"internal",mode:e.mode}}});pe({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(n,e,t){var{parser:r}=n,i=t[0],s=Be(e[0],"size"),o=Be(e[1],"size");return{type:"rule",mode:r.mode,shift:i&&Be(i,"size").value,width:s.value,height:o.value}},htmlBuilder(n,e){var t=K.makeSpan(["mord","rule"],[],e),r=Kt(n.width,e),i=Kt(n.height,e),s=n.shift?Kt(n.shift,e):0;return t.style.borderRightWidth=de(r),t.style.borderTopWidth=de(i),t.style.bottom=de(s),t.width=r,t.height=i+s,t.depth=-s,t.maxFontSize=i*1.125*e.sizeMultiplier,t},mathmlBuilder(n,e){var t=Kt(n.width,e),r=Kt(n.height,e),i=n.shift?Kt(n.shift,e):0,s=e.color&&e.getColor()||"black",o=new se.MathNode("mspace");o.setAttribute("mathbackground",s),o.setAttribute("width",de(t)),o.setAttribute("height",de(r));var a=new se.MathNode("mpadded",[o]);return i>=0?a.setAttribute("height",de(i)):(a.setAttribute("height",de(i)),a.setAttribute("depth",de(-i))),a.setAttribute("voffset",de(i)),a}});function yB(n,e,t){for(var r=En(n,e,!1),i=e.sizeMultiplier/t.sizeMultiplier,s=0;s<r.length;s++){var o=r[s].classes.indexOf("sizing");o<0?Array.prototype.push.apply(r[s].classes,e.sizingClasses(t)):r[s].classes[o+1]==="reset-size"+e.size&&(r[s].classes[o+1]="reset-size"+t.size),r[s].height*=i,r[s].depth*=i}return K.makeFragment(r)}var _9=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],R2e=(n,e)=>{var t=e.havingSize(n.size);return yB(n.body,t,e)};pe({type:"sizing",names:_9,props:{numArgs:0,allowedInText:!0},handler:(n,e)=>{var{breakOnTokenText:t,funcName:r,parser:i}=n,s=i.parseExpression(!1,t);return{type:"sizing",mode:i.mode,size:_9.indexOf(r)+1,body:s}},htmlBuilder:R2e,mathmlBuilder:(n,e)=>{var t=e.havingSize(n.size),r=ci(n.body,t),i=new se.MathNode("mstyle",r);return i.setAttribute("mathsize",de(t.sizeMultiplier)),i}});pe({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(n,e,t)=>{var{parser:r}=n,i=!1,s=!1,o=t[0]&&Be(t[0],"ordgroup");if(o)for(var a="",l=0;l<o.body.length;++l){var c=o.body[l];if(a=c.text,a==="t")i=!0;else if(a==="b")s=!0;else{i=!1,s=!1;break}}else i=!0,s=!0;var u=e[0];return{type:"smash",mode:r.mode,body:u,smashHeight:i,smashDepth:s}},htmlBuilder:(n,e)=>{var t=K.makeSpan([],[lt(n.body,e)]);if(!n.smashHeight&&!n.smashDepth)return t;if(n.smashHeight&&(t.height=0,t.children))for(var r=0;r<t.children.length;r++)t.children[r].height=0;if(n.smashDepth&&(t.depth=0,t.children))for(var i=0;i<t.children.length;i++)t.children[i].depth=0;var s=K.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e);return K.makeSpan(["mord"],[s],e)},mathmlBuilder:(n,e)=>{var t=new se.MathNode("mpadded",[kt(n.body,e)]);return n.smashHeight&&t.setAttribute("height","0px"),n.smashDepth&&t.setAttribute("depth","0px"),t}});pe({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(n,e,t){var{parser:r}=n,i=t[0],s=e[0];return{type:"sqrt",mode:r.mode,body:s,index:i}},htmlBuilder(n,e){var t=lt(n.body,e.havingCrampedStyle());t.height===0&&(t.height=e.fontMetrics().xHeight),t=K.wrapFragment(t,e);var r=e.fontMetrics(),i=r.defaultRuleThickness,s=i;e.style.id<De.TEXT.id&&(s=e.fontMetrics().xHeight);var o=i+s/4,a=t.height+t.depth+o+i,{span:l,ruleWidth:c,advanceWidth:u}=ga.sqrtImage(a,e),d=l.height-c;d>t.height+t.depth+o&&(o=(o+d-t.height-t.depth)/2);var h=l.height-t.height-o-c;t.style.paddingLeft=de(u);var p=K.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t,wrapperClasses:["svg-align"]},{type:"kern",size:-(t.height+h)},{type:"elem",elem:l},{type:"kern",size:c}]},e);if(n.index){var g=e.havingStyle(De.SCRIPTSCRIPT),m=lt(n.index,g,e),S=.6*(p.height-p.depth),y=K.makeVList({positionType:"shift",positionData:-S,children:[{type:"elem",elem:m}]},e),x=K.makeSpan(["root"],[y]);return K.makeSpan(["mord","sqrt"],[x,p],e)}else return K.makeSpan(["mord","sqrt"],[p],e)},mathmlBuilder(n,e){var{body:t,index:r}=n;return r?new se.MathNode("mroot",[kt(t,e),kt(r,e)]):new se.MathNode("msqrt",[kt(t,e)])}});var R9={display:De.DISPLAY,text:De.TEXT,script:De.SCRIPT,scriptscript:De.SCRIPTSCRIPT};pe({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n,e){var{breakOnTokenText:t,funcName:r,parser:i}=n,s=i.parseExpression(!0,t),o=r.slice(1,r.length-5);return{type:"styling",mode:i.mode,style:o,body:s}},htmlBuilder(n,e){var t=R9[n.style],r=e.havingStyle(t).withFont("");return yB(n.body,r,e)},mathmlBuilder(n,e){var t=R9[n.style],r=e.havingStyle(t),i=ci(n.body,r),s=new se.MathNode("mstyle",i),o={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},a=o[n.style];return s.setAttribute("scriptlevel",a[0]),s.setAttribute("displaystyle",a[1]),s}});var D2e=function(e,t){var r=e.base;if(r)if(r.type==="op"){var i=r.limits&&(t.style.size===De.DISPLAY.size||r.alwaysHandleSupSub);return i?oh:null}else if(r.type==="operatorname"){var s=r.alwaysHandleSupSub&&(t.style.size===De.DISPLAY.size||r.limits);return s?mB:null}else{if(r.type==="accent")return Ae.isCharacterBox(r.base)?x7:null;if(r.type==="horizBrace"){var o=!e.sub;return o===r.isOver?fB:null}else return null}else return null};du({type:"supsub",htmlBuilder(n,e){var t=D2e(n,e);if(t)return t(n,e);var{base:r,sup:i,sub:s}=n,o=lt(r,e),a,l,c=e.fontMetrics(),u=0,d=0,h=r&&Ae.isCharacterBox(r);if(i){var p=e.havingStyle(e.style.sup());a=lt(i,p,e),h||(u=o.height-p.fontMetrics().supDrop*p.sizeMultiplier/e.sizeMultiplier)}if(s){var g=e.havingStyle(e.style.sub());l=lt(s,g,e),h||(d=o.depth+g.fontMetrics().subDrop*g.sizeMultiplier/e.sizeMultiplier)}var m;e.style===De.DISPLAY?m=c.sup1:e.style.cramped?m=c.sup3:m=c.sup2;var S=e.sizeMultiplier,y=de(.5/c.ptPerEm/S),x=null;if(l){var w=n.base&&n.base.type==="op"&&n.base.name&&(n.base.name==="\\oiint"||n.base.name==="\\oiiint");(o instanceof os||w)&&(x=de(-o.italic))}var O;if(a&&l){u=Math.max(u,m,a.depth+.25*c.xHeight),d=Math.max(d,c.sub2);var T=c.defaultRuleThickness,E=4*T;if(u-a.depth-(l.height-d)<E){d=E-(u-a.depth)+l.height;var C=.8*c.xHeight-(u-a.depth);C>0&&(u+=C,d-=C)}var M=[{type:"elem",elem:l,shift:d,marginRight:y,marginLeft:x},{type:"elem",elem:a,shift:-u,marginRight:y}];O=K.makeVList({positionType:"individualShift",children:M},e)}else if(l){d=Math.max(d,c.sub1,l.height-.8*c.xHeight);var A=[{type:"elem",elem:l,marginLeft:x,marginRight:y}];O=K.makeVList({positionType:"shift",positionData:d,children:A},e)}else if(a)u=Math.max(u,m,a.depth+.25*c.xHeight),O=K.makeVList({positionType:"shift",positionData:-u,children:[{type:"elem",elem:a,marginRight:y}]},e);else throw new Error("supsub must have either sup or sub.");var D=J4(o,"right")||"mord";return K.makeSpan([D],[o,K.makeSpan(["msupsub"],[O])],e)},mathmlBuilder(n,e){var t=!1,r,i;n.base&&n.base.type==="horizBrace"&&(i=!!n.sup,i===n.base.isOver&&(t=!0,r=n.base.isOver)),n.base&&(n.base.type==="op"||n.base.type==="operatorname")&&(n.base.parentIsSupSub=!0);var s=[kt(n.base,e)];n.sub&&s.push(kt(n.sub,e)),n.sup&&s.push(kt(n.sup,e));var o;if(t)o=r?"mover":"munder";else if(n.sub)if(n.sup){var c=n.base;c&&c.type==="op"&&c.limits&&e.style===De.DISPLAY||c&&c.type==="operatorname"&&c.alwaysHandleSupSub&&(e.style===De.DISPLAY||c.limits)?o="munderover":o="msubsup"}else{var l=n.base;l&&l.type==="op"&&l.limits&&(e.style===De.DISPLAY||l.alwaysHandleSupSub)||l&&l.type==="operatorname"&&l.alwaysHandleSupSub&&(l.limits||e.style===De.DISPLAY)?o="munder":o="msub"}else{var a=n.base;a&&a.type==="op"&&a.limits&&(e.style===De.DISPLAY||a.alwaysHandleSupSub)||a&&a.type==="operatorname"&&a.alwaysHandleSupSub&&(a.limits||e.style===De.DISPLAY)?o="mover":o="msup"}return new se.MathNode(o,s)}});du({type:"atom",htmlBuilder(n,e){return K.mathsym(n.text,n.mode,e,["m"+n.family])},mathmlBuilder(n,e){var t=new se.MathNode("mo",[as(n.text,n.mode)]);if(n.family==="bin"){var r=v7(n,e);r==="bold-italic"&&t.setAttribute("mathvariant",r)}else n.family==="punct"?t.setAttribute("separator","true"):(n.family==="open"||n.family==="close")&&t.setAttribute("stretchy","false");return t}});var vB={mi:"italic",mn:"normal",mtext:"normal"};du({type:"mathord",htmlBuilder(n,e){return K.makeOrd(n,e,"mathord")},mathmlBuilder(n,e){var t=new se.MathNode("mi",[as(n.text,n.mode,e)]),r=v7(n,e)||"italic";return r!==vB[t.type]&&t.setAttribute("mathvariant",r),t}});du({type:"textord",htmlBuilder(n,e){return K.makeOrd(n,e,"textord")},mathmlBuilder(n,e){var t=as(n.text,n.mode,e),r=v7(n,e)||"normal",i;return n.mode==="text"?i=new se.MathNode("mtext",[t]):/[0-9]/.test(n.text)?i=new se.MathNode("mn",[t]):n.text==="\\prime"?i=new se.MathNode("mo",[t]):i=new se.MathNode("mi",[t]),r!==vB[i.type]&&i.setAttribute("mathvariant",r),i}});var Q2={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},q2={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};du({type:"spacing",htmlBuilder(n,e){if(q2.hasOwnProperty(n.text)){var t=q2[n.text].className||"";if(n.mode==="text"){var r=K.makeOrd(n,e,"textord");return r.classes.push(t),r}else return K.makeSpan(["mspace",t],[K.mathsym(n.text,n.mode,e)],e)}else{if(Q2.hasOwnProperty(n.text))return K.makeSpan(["mspace",Q2[n.text]],[],e);throw new oe('Unknown type of space "'+n.text+'"')}},mathmlBuilder(n,e){var t;if(q2.hasOwnProperty(n.text))t=new se.MathNode("mtext",[new se.TextNode("")]);else{if(Q2.hasOwnProperty(n.text))return new se.MathNode("mspace");throw new oe('Unknown type of space "'+n.text+'"')}return t}});var D9=()=>{var n=new se.MathNode("mtd",[]);return n.setAttribute("width","50%"),n};du({type:"tag",mathmlBuilder(n,e){var t=new se.MathNode("mtable",[new se.MathNode("mtr",[D9(),new se.MathNode("mtd",[Ll(n.body,e)]),D9(),new se.MathNode("mtd",[Ll(n.tag,e)])])]);return t.setAttribute("width","100%"),t}});var j9={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},L9={"\\textbf":"textbf","\\textmd":"textmd"},j2e={"\\textit":"textit","\\textup":"textup"},z9=(n,e)=>{var t=n.font;if(t){if(j9[t])return e.withTextFontFamily(j9[t]);if(L9[t])return e.withTextFontWeight(L9[t]);if(t==="\\emph")return e.fontShape==="textit"?e.withTextFontShape("textup"):e.withTextFontShape("textit")}else return e;return e.withTextFontShape(j2e[t])};pe({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(n,e){var{parser:t,funcName:r}=n,i=e[0];return{type:"text",mode:t.mode,body:hn(i),font:r}},htmlBuilder(n,e){var t=z9(n,e),r=En(n.body,t,!0);return K.makeSpan(["mord","text"],r,t)},mathmlBuilder(n,e){var t=z9(n,e);return Ll(n.body,t)}});pe({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"underline",mode:t.mode,body:e[0]}},htmlBuilder(n,e){var t=lt(n.body,e),r=K.makeLineSpan("underline-line",e),i=e.fontMetrics().defaultRuleThickness,s=K.makeVList({positionType:"top",positionData:t.height,children:[{type:"kern",size:i},{type:"elem",elem:r},{type:"kern",size:3*i},{type:"elem",elem:t}]},e);return K.makeSpan(["mord","underline"],[s],e)},mathmlBuilder(n,e){var t=new se.MathNode("mo",[new se.TextNode("")]);t.setAttribute("stretchy","true");var r=new se.MathNode("munder",[kt(n.body,e),t]);return r.setAttribute("accentunder","true"),r}});pe({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(n,e){var{parser:t}=n;return{type:"vcenter",mode:t.mode,body:e[0]}},htmlBuilder(n,e){var t=lt(n.body,e),r=e.fontMetrics().axisHeight,i=.5*(t.height-r-(t.depth+r));return K.makeVList({positionType:"shift",positionData:i,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(n,e){return new se.MathNode("mpadded",[kt(n.body,e)],["vcenter"])}});pe({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(n,e,t){throw new oe("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(n,e){for(var t=N9(n),r=[],i=e.havingStyle(e.style.text()),s=0;s<t.length;s++){var o=t[s];o==="~"&&(o="\\textasciitilde"),r.push(K.makeSymbol(o,"Typewriter-Regular",n.mode,i,["mord","texttt"]))}return K.makeSpan(["mord","text"].concat(i.sizingClasses(e)),K.tryCombineChars(r),i)},mathmlBuilder(n,e){var t=new se.TextNode(N9(n)),r=new se.MathNode("mtext",[t]);return r.setAttribute("mathvariant","monospace"),r}});var N9=n=>n.body.replace(/ /g,n.star?"":""),ul=BF,SB=`[ \r
	]`,L2e="\\\\[a-zA-Z@]+",z2e="\\\\[^\uD800-\uDFFF]",N2e="("+L2e+")"+SB+"*",$2e=`\\\\(
|[ \r	]+
?)[ \r	]*`,r5="[-]",F2e=new RegExp(r5+"+$"),B2e="("+SB+"+)|"+($2e+"|")+"([!-\\[\\]---]"+(r5+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(r5+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+N2e)+("|"+z2e+")");class $9{constructor(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp(B2e,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,t){this.catcodes[e]=t}lex(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new es("EOF",new vi(this,t,t));var r=this.tokenRegex.exec(e);if(r===null||r.index!==t)throw new oe("Unexpected character: '"+e[t]+"'",new es(e[t],new vi(this,t,t+1)));var i=r[6]||r[3]||(r[2]?"\\ ":" ");if(this.catcodes[i]===14){var s=e.indexOf(`
`,this.tokenRegex.lastIndex);return s===-1?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=s+1,this.lex()}return new es(i,new vi(this,t,this.tokenRegex.lastIndex))}}class U2e{constructor(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new oe("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(e[t]==null?delete this.current[t]:this.current[t]=e[t])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,t,r){if(r===void 0&&(r=!1),r){for(var i=0;i<this.undefStack.length;i++)delete this.undefStack[i][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var s=this.undefStack[this.undefStack.length-1];s&&!s.hasOwnProperty(e)&&(s[e]=this.current[e])}t==null?delete this.current[e]:this.current[e]=t}}var H2e=lB;R("\\noexpand",function(n){var e=n.popToken();return n.isExpandable(e.text)&&(e.noexpand=!0,e.treatAsRelax=!0),{tokens:[e],numArgs:0}});R("\\expandafter",function(n){var e=n.popToken();return n.expandOnce(!0),{tokens:[e],numArgs:0}});R("\\@firstoftwo",function(n){var e=n.consumeArgs(2);return{tokens:e[0],numArgs:0}});R("\\@secondoftwo",function(n){var e=n.consumeArgs(2);return{tokens:e[1],numArgs:0}});R("\\@ifnextchar",function(n){var e=n.consumeArgs(3);n.consumeSpaces();var t=n.future();return e[0].length===1&&e[0][0].text===t.text?{tokens:e[1],numArgs:0}:{tokens:e[2],numArgs:0}});R("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");R("\\TextOrMath",function(n){var e=n.consumeArgs(2);return n.mode==="text"?{tokens:e[0],numArgs:0}:{tokens:e[1],numArgs:0}});var F9={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};R("\\char",function(n){var e=n.popToken(),t,r="";if(e.text==="'")t=8,e=n.popToken();else if(e.text==='"')t=16,e=n.popToken();else if(e.text==="`")if(e=n.popToken(),e.text[0]==="\\")r=e.text.charCodeAt(1);else{if(e.text==="EOF")throw new oe("\\char` missing argument");r=e.text.charCodeAt(0)}else t=10;if(t){if(r=F9[e.text],r==null||r>=t)throw new oe("Invalid base-"+t+" digit "+e.text);for(var i;(i=F9[n.future().text])!=null&&i<t;)r*=t,r+=i,n.popToken()}return"\\@char{"+r+"}"});var E7=(n,e,t,r)=>{var i=n.consumeArg().tokens;if(i.length!==1)throw new oe("\\newcommand's first argument must be a macro name");var s=i[0].text,o=n.isDefined(s);if(o&&!e)throw new oe("\\newcommand{"+s+"} attempting to redefine "+(s+"; use \\renewcommand"));if(!o&&!t)throw new oe("\\renewcommand{"+s+"} when command "+s+" does not yet exist; use \\newcommand");var a=0;if(i=n.consumeArg().tokens,i.length===1&&i[0].text==="["){for(var l="",c=n.expandNextToken();c.text!=="]"&&c.text!=="EOF";)l+=c.text,c=n.expandNextToken();if(!l.match(/^\s*[0-9]+\s*$/))throw new oe("Invalid number of arguments: "+l);a=parseInt(l),i=n.consumeArg().tokens}return o&&r||n.macros.set(s,{tokens:i,numArgs:a}),""};R("\\newcommand",n=>E7(n,!1,!0,!1));R("\\renewcommand",n=>E7(n,!0,!1,!1));R("\\providecommand",n=>E7(n,!0,!0,!0));R("\\message",n=>{var e=n.consumeArgs(1)[0];return console.log(e.reverse().map(t=>t.text).join("")),""});R("\\errmessage",n=>{var e=n.consumeArgs(1)[0];return console.error(e.reverse().map(t=>t.text).join("")),""});R("\\show",n=>{var e=n.popToken(),t=e.text;return console.log(e,n.macros.get(t),ul[t],At.math[t],At.text[t]),""});R("\\bgroup","{");R("\\egroup","}");R("~","\\nobreakspace");R("\\lq","`");R("\\rq","'");R("\\aa","\\r a");R("\\AA","\\r A");R("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`}");R("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");R("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`}");R("","\\mathscr{B}");R("","\\mathscr{E}");R("","\\mathscr{F}");R("","\\mathscr{H}");R("","\\mathscr{I}");R("","\\mathscr{L}");R("","\\mathscr{M}");R("","\\mathscr{R}");R("","\\mathfrak{C}");R("","\\mathfrak{H}");R("","\\mathfrak{Z}");R("\\Bbbk","\\Bbb{k}");R("","\\cdotp");R("\\llap","\\mathllap{\\textrm{#1}}");R("\\rlap","\\mathrlap{\\textrm{#1}}");R("\\clap","\\mathclap{\\textrm{#1}}");R("\\mathstrut","\\vphantom{(}");R("\\underbar","\\underline{\\text{#1}}");R("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');R("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`}}");R("\\ne","\\neq");R("","\\neq");R("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`}}");R("","\\notin");R("","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`}}");R("","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`}}");R("","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`}}");R("","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`}}");R("","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`}}");R("","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`}}");R("","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`}}");R("","\\perp");R("","\\mathclose{!\\mkern-0.8mu!}");R("","\\notni");R("","\\ulcorner");R("","\\urcorner");R("","\\llcorner");R("","\\lrcorner");R("","\\copyright");R("","\\textregistered");R("","\\textregistered");R("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');R("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');R("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');R("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');R("\\vdots","{\\varvdots\\rule{0pt}{15pt}}");R("","\\vdots");R("\\varGamma","\\mathit{\\Gamma}");R("\\varDelta","\\mathit{\\Delta}");R("\\varTheta","\\mathit{\\Theta}");R("\\varLambda","\\mathit{\\Lambda}");R("\\varXi","\\mathit{\\Xi}");R("\\varPi","\\mathit{\\Pi}");R("\\varSigma","\\mathit{\\Sigma}");R("\\varUpsilon","\\mathit{\\Upsilon}");R("\\varPhi","\\mathit{\\Phi}");R("\\varPsi","\\mathit{\\Psi}");R("\\varOmega","\\mathit{\\Omega}");R("\\substack","\\begin{subarray}{c}#1\\end{subarray}");R("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");R("\\boxed","\\fbox{$\\displaystyle{#1}$}");R("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");R("\\implies","\\DOTSB\\;\\Longrightarrow\\;");R("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");R("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}");R("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var B9={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};R("\\dots",function(n){var e="\\dotso",t=n.expandAfterFuture().text;return t in B9?e=B9[t]:(t.slice(0,4)==="\\not"||t in At.math&&Ae.contains(["bin","rel"],At.math[t].group))&&(e="\\dotsb"),e});var I7={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};R("\\dotso",function(n){var e=n.future().text;return e in I7?"\\ldots\\,":"\\ldots"});R("\\dotsc",function(n){var e=n.future().text;return e in I7&&e!==","?"\\ldots\\,":"\\ldots"});R("\\cdots",function(n){var e=n.future().text;return e in I7?"\\@cdots\\,":"\\@cdots"});R("\\dotsb","\\cdots");R("\\dotsm","\\cdots");R("\\dotsi","\\!\\cdots");R("\\dotsx","\\ldots\\,");R("\\DOTSI","\\relax");R("\\DOTSB","\\relax");R("\\DOTSX","\\relax");R("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");R("\\,","\\tmspace+{3mu}{.1667em}");R("\\thinspace","\\,");R("\\>","\\mskip{4mu}");R("\\:","\\tmspace+{4mu}{.2222em}");R("\\medspace","\\:");R("\\;","\\tmspace+{5mu}{.2777em}");R("\\thickspace","\\;");R("\\!","\\tmspace-{3mu}{.1667em}");R("\\negthinspace","\\!");R("\\negmedspace","\\tmspace-{4mu}{.2222em}");R("\\negthickspace","\\tmspace-{5mu}{.277em}");R("\\enspace","\\kern.5em ");R("\\enskip","\\hskip.5em\\relax");R("\\quad","\\hskip1em\\relax");R("\\qquad","\\hskip2em\\relax");R("\\tag","\\@ifstar\\tag@literal\\tag@paren");R("\\tag@paren","\\tag@literal{({#1})}");R("\\tag@literal",n=>{if(n.macros.get("\\df@tag"))throw new oe("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});R("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");R("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");R("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");R("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");R("\\newline","\\\\\\relax");R("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var xB=de(ho["Main-Regular"][84][1]-.7*ho["Main-Regular"][65][1]);R("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+xB+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");R("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+xB+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");R("\\hspace","\\@ifstar\\@hspacer\\@hspace");R("\\@hspace","\\hskip #1\\relax");R("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");R("\\ordinarycolon",":");R("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");R("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');R("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');R("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');R("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');R("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');R("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');R("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');R("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');R("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');R("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');R("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');R("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');R("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');R("","\\dblcolon");R("","\\eqcolon");R("","\\coloneqq");R("","\\eqqcolon");R("","\\Coloneqq");R("\\ratio","\\vcentcolon");R("\\coloncolon","\\dblcolon");R("\\colonequals","\\coloneqq");R("\\coloncolonequals","\\Coloneqq");R("\\equalscolon","\\eqqcolon");R("\\equalscoloncolon","\\Eqqcolon");R("\\colonminus","\\coloneq");R("\\coloncolonminus","\\Coloneq");R("\\minuscolon","\\eqcolon");R("\\minuscoloncolon","\\Eqcolon");R("\\coloncolonapprox","\\Colonapprox");R("\\coloncolonsim","\\Colonsim");R("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");R("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");R("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");R("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");R("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`}}");R("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");R("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");R("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");R("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");R("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");R("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");R("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");R("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");R("\\gvertneqq","\\html@mathml{\\@gvertneqq}{}");R("\\lvertneqq","\\html@mathml{\\@lvertneqq}{}");R("\\ngeqq","\\html@mathml{\\@ngeqq}{}");R("\\ngeqslant","\\html@mathml{\\@ngeqslant}{}");R("\\nleqq","\\html@mathml{\\@nleqq}{}");R("\\nleqslant","\\html@mathml{\\@nleqslant}{}");R("\\nshortmid","\\html@mathml{\\@nshortmid}{}");R("\\nshortparallel","\\html@mathml{\\@nshortparallel}{}");R("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{}");R("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{}");R("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{}");R("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{}");R("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{}");R("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{}");R("\\imath","\\html@mathml{\\@imath}{}");R("\\jmath","\\html@mathml{\\@jmath}{}");R("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`}}");R("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`}}");R("","\\llbracket");R("","\\rrbracket");R("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`}}");R("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`}}");R("","\\lBrace");R("","\\rBrace");R("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`}}");R("","\\minuso");R("\\darr","\\downarrow");R("\\dArr","\\Downarrow");R("\\Darr","\\Downarrow");R("\\lang","\\langle");R("\\rang","\\rangle");R("\\uarr","\\uparrow");R("\\uArr","\\Uparrow");R("\\Uarr","\\Uparrow");R("\\N","\\mathbb{N}");R("\\R","\\mathbb{R}");R("\\Z","\\mathbb{Z}");R("\\alef","\\aleph");R("\\alefsym","\\aleph");R("\\Alpha","\\mathrm{A}");R("\\Beta","\\mathrm{B}");R("\\bull","\\bullet");R("\\Chi","\\mathrm{X}");R("\\clubs","\\clubsuit");R("\\cnums","\\mathbb{C}");R("\\Complex","\\mathbb{C}");R("\\Dagger","\\ddagger");R("\\diamonds","\\diamondsuit");R("\\empty","\\emptyset");R("\\Epsilon","\\mathrm{E}");R("\\Eta","\\mathrm{H}");R("\\exist","\\exists");R("\\harr","\\leftrightarrow");R("\\hArr","\\Leftrightarrow");R("\\Harr","\\Leftrightarrow");R("\\hearts","\\heartsuit");R("\\image","\\Im");R("\\infin","\\infty");R("\\Iota","\\mathrm{I}");R("\\isin","\\in");R("\\Kappa","\\mathrm{K}");R("\\larr","\\leftarrow");R("\\lArr","\\Leftarrow");R("\\Larr","\\Leftarrow");R("\\lrarr","\\leftrightarrow");R("\\lrArr","\\Leftrightarrow");R("\\Lrarr","\\Leftrightarrow");R("\\Mu","\\mathrm{M}");R("\\natnums","\\mathbb{N}");R("\\Nu","\\mathrm{N}");R("\\Omicron","\\mathrm{O}");R("\\plusmn","\\pm");R("\\rarr","\\rightarrow");R("\\rArr","\\Rightarrow");R("\\Rarr","\\Rightarrow");R("\\real","\\Re");R("\\reals","\\mathbb{R}");R("\\Reals","\\mathbb{R}");R("\\Rho","\\mathrm{P}");R("\\sdot","\\cdot");R("\\sect","\\S");R("\\spades","\\spadesuit");R("\\sub","\\subset");R("\\sube","\\subseteq");R("\\supe","\\supseteq");R("\\Tau","\\mathrm{T}");R("\\thetasym","\\vartheta");R("\\weierp","\\wp");R("\\Zeta","\\mathrm{Z}");R("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");R("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");R("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");R("\\bra","\\mathinner{\\langle{#1}|}");R("\\ket","\\mathinner{|{#1}\\rangle}");R("\\braket","\\mathinner{\\langle{#1}\\rangle}");R("\\Bra","\\left\\langle#1\\right|");R("\\Ket","\\left|#1\\right\\rangle");var wB=n=>e=>{var t=e.consumeArg().tokens,r=e.consumeArg().tokens,i=e.consumeArg().tokens,s=e.consumeArg().tokens,o=e.macros.get("|"),a=e.macros.get("\\|");e.macros.beginGroup();var l=d=>h=>{n&&(h.macros.set("|",o),i.length&&h.macros.set("\\|",a));var p=d;if(!d&&i.length){var g=h.future();g.text==="|"&&(h.popToken(),p=!0)}return{tokens:p?i:r,numArgs:0}};e.macros.set("|",l(!1)),i.length&&e.macros.set("\\|",l(!0));var c=e.consumeArg().tokens,u=e.expandTokens([...s,...c,...t]);return e.macros.endGroup(),{tokens:u.reverse(),numArgs:0}};R("\\bra@ket",wB(!1));R("\\bra@set",wB(!0));R("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");R("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");R("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");R("\\angln","{\\angl n}");R("\\blue","\\textcolor{##6495ed}{#1}");R("\\orange","\\textcolor{##ffa500}{#1}");R("\\pink","\\textcolor{##ff00af}{#1}");R("\\red","\\textcolor{##df0030}{#1}");R("\\green","\\textcolor{##28ae7b}{#1}");R("\\gray","\\textcolor{gray}{#1}");R("\\purple","\\textcolor{##9d38bd}{#1}");R("\\blueA","\\textcolor{##ccfaff}{#1}");R("\\blueB","\\textcolor{##80f6ff}{#1}");R("\\blueC","\\textcolor{##63d9ea}{#1}");R("\\blueD","\\textcolor{##11accd}{#1}");R("\\blueE","\\textcolor{##0c7f99}{#1}");R("\\tealA","\\textcolor{##94fff5}{#1}");R("\\tealB","\\textcolor{##26edd5}{#1}");R("\\tealC","\\textcolor{##01d1c1}{#1}");R("\\tealD","\\textcolor{##01a995}{#1}");R("\\tealE","\\textcolor{##208170}{#1}");R("\\greenA","\\textcolor{##b6ffb0}{#1}");R("\\greenB","\\textcolor{##8af281}{#1}");R("\\greenC","\\textcolor{##74cf70}{#1}");R("\\greenD","\\textcolor{##1fab54}{#1}");R("\\greenE","\\textcolor{##0d923f}{#1}");R("\\goldA","\\textcolor{##ffd0a9}{#1}");R("\\goldB","\\textcolor{##ffbb71}{#1}");R("\\goldC","\\textcolor{##ff9c39}{#1}");R("\\goldD","\\textcolor{##e07d10}{#1}");R("\\goldE","\\textcolor{##a75a05}{#1}");R("\\redA","\\textcolor{##fca9a9}{#1}");R("\\redB","\\textcolor{##ff8482}{#1}");R("\\redC","\\textcolor{##f9685d}{#1}");R("\\redD","\\textcolor{##e84d39}{#1}");R("\\redE","\\textcolor{##bc2612}{#1}");R("\\maroonA","\\textcolor{##ffbde0}{#1}");R("\\maroonB","\\textcolor{##ff92c6}{#1}");R("\\maroonC","\\textcolor{##ed5fa6}{#1}");R("\\maroonD","\\textcolor{##ca337c}{#1}");R("\\maroonE","\\textcolor{##9e034e}{#1}");R("\\purpleA","\\textcolor{##ddd7ff}{#1}");R("\\purpleB","\\textcolor{##c6b9fc}{#1}");R("\\purpleC","\\textcolor{##aa87ff}{#1}");R("\\purpleD","\\textcolor{##7854ab}{#1}");R("\\purpleE","\\textcolor{##543b78}{#1}");R("\\mintA","\\textcolor{##f5f9e8}{#1}");R("\\mintB","\\textcolor{##edf2df}{#1}");R("\\mintC","\\textcolor{##e0e5cc}{#1}");R("\\grayA","\\textcolor{##f6f7f7}{#1}");R("\\grayB","\\textcolor{##f0f1f2}{#1}");R("\\grayC","\\textcolor{##e3e5e6}{#1}");R("\\grayD","\\textcolor{##d6d8da}{#1}");R("\\grayE","\\textcolor{##babec2}{#1}");R("\\grayF","\\textcolor{##888d93}{#1}");R("\\grayG","\\textcolor{##626569}{#1}");R("\\grayH","\\textcolor{##3b3e40}{#1}");R("\\grayI","\\textcolor{##21242c}{#1}");R("\\kaBlue","\\textcolor{##314453}{#1}");R("\\kaGreen","\\textcolor{##71B307}{#1}");var bB={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class Q2e{constructor(e,t,r){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new U2e(H2e,t.macros),this.mode=r,this.stack=[]}feed(e){this.lexer=new $9(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var t,r,i;if(e){if(this.consumeSpaces(),this.future().text!=="[")return null;t=this.popToken(),{tokens:i,end:r}=this.consumeArg(["]"])}else({tokens:i,start:t,end:r}=this.consumeArg());return this.pushToken(new es("EOF",r.loc)),this.pushTokens(i),t.range(r,"")}consumeSpaces(){for(;;){var e=this.future();if(e.text===" ")this.stack.pop();else break}}consumeArg(e){var t=[],r=e&&e.length>0;r||this.consumeSpaces();var i=this.future(),s,o=0,a=0;do{if(s=this.popToken(),t.push(s),s.text==="{")++o;else if(s.text==="}"){if(--o,o===-1)throw new oe("Extra }",s)}else if(s.text==="EOF")throw new oe("Unexpected end of input in a macro argument, expected '"+(e&&r?e[a]:"}")+"'",s);if(e&&r)if((o===0||o===1&&e[a]==="{")&&s.text===e[a]){if(++a,a===e.length){t.splice(-a,a);break}}else a=0}while(o!==0||r);return i.text==="{"&&t[t.length-1].text==="}"&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:i,end:s}}consumeArgs(e,t){if(t){if(t.length!==e+1)throw new oe("The length of delimiters doesn't match the number of args!");for(var r=t[0],i=0;i<r.length;i++){var s=this.popToken();if(r[i]!==s.text)throw new oe("Use of the macro doesn't match its definition",s)}}for(var o=[],a=0;a<e;a++)o.push(this.consumeArg(t&&t[a+1]).tokens);return o}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new oe("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var t=this.popToken(),r=t.text,i=t.noexpand?null:this._getExpansion(r);if(i==null||e&&i.unexpandable){if(e&&i==null&&r[0]==="\\"&&!this.isDefined(r))throw new oe("Undefined control sequence: "+r);return this.pushToken(t),!1}this.countExpansion(1);var s=i.tokens,o=this.consumeArgs(i.numArgs,i.delimiters);if(i.numArgs){s=s.slice();for(var a=s.length-1;a>=0;--a){var l=s[a];if(l.text==="#"){if(a===0)throw new oe("Incomplete placeholder at end of macro body",l);if(l=s[--a],l.text==="#")s.splice(a+1,1);else if(/^[1-9]$/.test(l.text))s.splice(a,2,...o[+l.text-1]);else throw new oe("Not a valid argument number",l)}}}return this.pushTokens(s),s.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new es(e)]):void 0}expandTokens(e){var t=[],r=this.stack.length;for(this.pushTokens(e);this.stack.length>r;)if(this.expandOnce(!0)===!1){var i=this.stack.pop();i.treatAsRelax&&(i.noexpand=!1,i.treatAsRelax=!1),t.push(i)}return this.countExpansion(t.length),t}expandMacroAsText(e){var t=this.expandMacro(e);return t&&t.map(r=>r.text).join("")}_getExpansion(e){var t=this.macros.get(e);if(t==null)return t;if(e.length===1){var r=this.lexer.catcodes[e];if(r!=null&&r!==13)return}var i=typeof t=="function"?t(this):t;if(typeof i=="string"){var s=0;if(i.indexOf("#")!==-1)for(var o=i.replace(/##/g,"");o.indexOf("#"+(s+1))!==-1;)++s;for(var a=new $9(i,this.settings),l=[],c=a.lex();c.text!=="EOF";)l.push(c),c=a.lex();l.reverse();var u={tokens:l,numArgs:s};return u}return i}isDefined(e){return this.macros.has(e)||ul.hasOwnProperty(e)||At.math.hasOwnProperty(e)||At.text.hasOwnProperty(e)||bB.hasOwnProperty(e)}isExpandable(e){var t=this.macros.get(e);return t!=null?typeof t=="string"||typeof t=="function"||!t.unexpandable:ul.hasOwnProperty(e)&&!ul[e].primitive}}var U9=/^[]/,Qg=Object.freeze({"":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"a","":"e","":"h","":"i","":"j","":"k","":"l","":"m","":"n","":"o","":"p","":"r","":"s","":"t","":"u","":"v","":"x","":"","":"","":"","":"","":"","":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"A","":"B","":"D","":"E","":"G","":"H","":"I","":"J","":"K","":"L","":"M","":"N","":"O","":"P","":"R","":"T","":"U","":"V","":"W","":"a","":"b","":"c","":"d","":"e","":"f","":"g",:"h","":"i",:"j","":"k",:"l","":"m",:"n","":"o","":"p",:"r",:"s","":"t","":"u","":"v",:"w",:"x",:"y","":"z","":"","":"","":"","":"","":"","":""}),W2={"":{text:"\\'",math:"\\acute"},"":{text:"\\`",math:"\\grave"},"":{text:'\\"',math:"\\ddot"},"":{text:"\\~",math:"\\tilde"},"":{text:"\\=",math:"\\bar"},"":{text:"\\u",math:"\\breve"},"":{text:"\\v",math:"\\check"},"":{text:"\\^",math:"\\hat"},"":{text:"\\.",math:"\\dot"},"":{text:"\\r",math:"\\mathring"},"":{text:"\\H"},"":{text:"\\c"}},H9={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"b",:"c",:"c",:"c",:"c",:"c",:"c",:"d",:"d",:"d",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"f",:"g",:"g",:"g",:"g",:"g",:"g",:"g",:"h",:"h",:"h",:"h",:"h",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"j",:"j",:"k",:"k",:"k",:"l",:"l",:"l",:"m",:"m",:"n",:"n",:"n",:"n",:"n",:"n",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"p",:"p",:"r",:"r",:"r",:"r",:"s",:"s",:"s",:"s",:"s",:"s",:"s",:"t",:"t",:"t",:"t",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"v",:"w",:"w",:"w",:"w",:"w",:"w",:"x",:"x",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"z",:"z",:"z",:"z",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"B",:"C",:"C",:"C",:"C",:"C",:"C",:"D",:"D",:"D",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"F",:"G",:"G",:"G",:"G",:"G",:"G",:"G",:"H",:"H",:"H",:"H",:"H",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"J",:"K",:"K",:"K",:"L",:"L",:"L",:"M",:"M",:"N",:"N",:"N",:"N",:"N",:"N",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"P",:"P",:"R",:"R",:"R",:"R",:"S",:"S",:"S",:"S",:"S",:"S",:"S",:"T",:"T",:"T",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"V",:"W",:"W",:"W",:"W",:"W",:"X",:"X",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Z",:"Z",:"Z",:"Z",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""};let OB=class kB{constructor(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new Q2e(e,t,this.mode),this.settings=t,this.leftrightDepth=0}expect(e,t){if(t===void 0&&(t=!0),this.fetch().text!==e)throw new oe("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var t=this.nextToken;this.consume(),this.gullet.pushToken(new es("}")),this.gullet.pushTokens(e);var r=this.parseExpression(!1);return this.expect("}"),this.nextToken=t,r}parseExpression(e,t){for(var r=[];;){this.mode==="math"&&this.consumeSpaces();var i=this.fetch();if(kB.endOfExpression.indexOf(i.text)!==-1||t&&i.text===t||e&&ul[i.text]&&ul[i.text].infix)break;var s=this.parseAtom(t);if(s){if(s.type==="internal")continue}else break;r.push(s)}return this.mode==="text"&&this.formLigatures(r),this.handleInfixNodes(r)}handleInfixNodes(e){for(var t=-1,r,i=0;i<e.length;i++)if(e[i].type==="infix"){if(t!==-1)throw new oe("only one infix operator per group",e[i].token);t=i,r=e[i].replaceWith}if(t!==-1&&r){var s,o,a=e.slice(0,t),l=e.slice(t+1);a.length===1&&a[0].type==="ordgroup"?s=a[0]:s={type:"ordgroup",mode:this.mode,body:a},l.length===1&&l[0].type==="ordgroup"?o=l[0]:o={type:"ordgroup",mode:this.mode,body:l};var c;return r==="\\\\abovefrac"?c=this.callFunction(r,[s,e[t],o],[]):c=this.callFunction(r,[s,o],[]),[c]}else return e}handleSupSubscript(e){var t=this.fetch(),r=t.text;this.consume(),this.consumeSpaces();var i=this.parseGroup(e);if(!i)throw new oe("Expected group after '"+r+"'",t);return i}formatUnsupportedCmd(e){for(var t=[],r=0;r<e.length;r++)t.push({type:"textord",mode:"text",text:e[r]});var i={type:"text",mode:this.mode,body:t},s={type:"color",mode:this.mode,color:this.settings.errorColor,body:[i]};return s}parseAtom(e){var t=this.parseGroup("atom",e);if(this.mode==="text")return t;for(var r,i;;){this.consumeSpaces();var s=this.fetch();if(s.text==="\\limits"||s.text==="\\nolimits"){if(t&&t.type==="op"){var o=s.text==="\\limits";t.limits=o,t.alwaysHandleSupSub=!0}else if(t&&t.type==="operatorname")t.alwaysHandleSupSub&&(t.limits=s.text==="\\limits");else throw new oe("Limit controls must follow a math operator",s);this.consume()}else if(s.text==="^"){if(r)throw new oe("Double superscript",s);r=this.handleSupSubscript("superscript")}else if(s.text==="_"){if(i)throw new oe("Double subscript",s);i=this.handleSupSubscript("subscript")}else if(s.text==="'"){if(r)throw new oe("Double superscript",s);var a={type:"textord",mode:this.mode,text:"\\prime"},l=[a];for(this.consume();this.fetch().text==="'";)l.push(a),this.consume();this.fetch().text==="^"&&l.push(this.handleSupSubscript("superscript")),r={type:"ordgroup",mode:this.mode,body:l}}else if(Qg[s.text]){var c=U9.test(s.text),u=[];for(u.push(new es(Qg[s.text])),this.consume();;){var d=this.fetch().text;if(!Qg[d]||U9.test(d)!==c)break;u.unshift(new es(Qg[d])),this.consume()}var h=this.subparse(u);c?i={type:"ordgroup",mode:"math",body:h}:r={type:"ordgroup",mode:"math",body:h}}else break}return r||i?{type:"supsub",mode:this.mode,base:t,sup:r,sub:i}:t}parseFunction(e,t){var r=this.fetch(),i=r.text,s=ul[i];if(!s)return null;if(this.consume(),t&&t!=="atom"&&!s.allowedInArgument)throw new oe("Got function '"+i+"' with no arguments"+(t?" as "+t:""),r);if(this.mode==="text"&&!s.allowedInText)throw new oe("Can't use function '"+i+"' in text mode",r);if(this.mode==="math"&&s.allowedInMath===!1)throw new oe("Can't use function '"+i+"' in math mode",r);var{args:o,optArgs:a}=this.parseArguments(i,s);return this.callFunction(i,o,a,r,e)}callFunction(e,t,r,i,s){var o={funcName:e,parser:this,token:i,breakOnTokenText:s},a=ul[e];if(a&&a.handler)return a.handler(o,t,r);throw new oe("No function handler for "+e)}parseArguments(e,t){var r=t.numArgs+t.numOptionalArgs;if(r===0)return{args:[],optArgs:[]};for(var i=[],s=[],o=0;o<r;o++){var a=t.argTypes&&t.argTypes[o],l=o<t.numOptionalArgs;(t.primitive&&a==null||t.type==="sqrt"&&o===1&&s[0]==null)&&(a="primitive");var c=this.parseGroupOfType("argument to '"+e+"'",a,l);if(l)s.push(c);else if(c!=null)i.push(c);else throw new oe("Null argument, please report this as a bug")}return{args:i,optArgs:s}}parseGroupOfType(e,t,r){switch(t){case"color":return this.parseColorGroup(r);case"size":return this.parseSizeGroup(r);case"url":return this.parseUrlGroup(r);case"math":case"text":return this.parseArgumentGroup(r,t);case"hbox":{var i=this.parseArgumentGroup(r,"text");return i!=null?{type:"styling",mode:i.mode,body:[i],style:"text"}:null}case"raw":{var s=this.parseStringGroup("raw",r);return s!=null?{type:"raw",mode:"text",string:s.text}:null}case"primitive":{if(r)throw new oe("A primitive argument cannot be optional");var o=this.parseGroup(e);if(o==null)throw new oe("Expected group as "+e,this.fetch());return o}case"original":case null:case void 0:return this.parseArgumentGroup(r);default:throw new oe("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(e,t){var r=this.gullet.scanArgument(t);if(r==null)return null;for(var i="",s;(s=this.fetch()).text!=="EOF";)i+=s.text,this.consume();return this.consume(),r.text=i,r}parseRegexGroup(e,t){for(var r=this.fetch(),i=r,s="",o;(o=this.fetch()).text!=="EOF"&&e.test(s+o.text);)i=o,s+=i.text,this.consume();if(s==="")throw new oe("Invalid "+t+": '"+r.text+"'",r);return r.range(i,s)}parseColorGroup(e){var t=this.parseStringGroup("color",e);if(t==null)return null;var r=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!r)throw new oe("Invalid color: '"+t.text+"'",t);var i=r[0];return/^[0-9a-f]{6}$/i.test(i)&&(i="#"+i),{type:"color-token",mode:this.mode,color:i}}parseSizeGroup(e){var t,r=!1;if(this.gullet.consumeSpaces(),!e&&this.gullet.future().text!=="{"?t=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):t=this.parseStringGroup("size",e),!t)return null;!e&&t.text.length===0&&(t.text="0pt",r=!0);var i=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!i)throw new oe("Invalid size: '"+t.text+"'",t);var s={number:+(i[1]+i[2]),unit:i[3]};if(!_F(s))throw new oe("Invalid unit: '"+s.unit+"'",t);return{type:"size",mode:this.mode,value:s,isBlank:r}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),t==null)return null;var r=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:r}}parseArgumentGroup(e,t){var r=this.gullet.scanArgument(e);if(r==null)return null;var i=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var s=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var o={type:"ordgroup",mode:this.mode,loc:r.loc,body:s};return t&&this.switchMode(i),o}parseGroup(e,t){var r=this.fetch(),i=r.text,s;if(i==="{"||i==="\\begingroup"){this.consume();var o=i==="{"?"}":"\\endgroup";this.gullet.beginGroup();var a=this.parseExpression(!1,o),l=this.fetch();this.expect(o),this.gullet.endGroup(),s={type:"ordgroup",mode:this.mode,loc:vi.range(r,l),body:a,semisimple:i==="\\begingroup"||void 0}}else if(s=this.parseFunction(t,e)||this.parseSymbol(),s==null&&i[0]==="\\"&&!bB.hasOwnProperty(i)){if(this.settings.throwOnError)throw new oe("Undefined control sequence: "+i,r);s=this.formatUnsupportedCmd(i),this.consume()}return s}formLigatures(e){for(var t=e.length-1,r=0;r<t;++r){var i=e[r],s=i.text;s==="-"&&e[r+1].text==="-"&&(r+1<t&&e[r+2].text==="-"?(e.splice(r,3,{type:"textord",mode:"text",loc:vi.range(i,e[r+2]),text:"---"}),t-=2):(e.splice(r,2,{type:"textord",mode:"text",loc:vi.range(i,e[r+1]),text:"--"}),t-=1)),(s==="'"||s==="`")&&e[r+1].text===s&&(e.splice(r,2,{type:"textord",mode:"text",loc:vi.range(i,e[r+1]),text:s+s}),t-=1)}}parseSymbol(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var r=t.slice(5),i=r.charAt(0)==="*";if(i&&(r=r.slice(1)),r.length<2||r.charAt(0)!==r.slice(-1))throw new oe(`\\verb assertion failed --
                    please report what input caused this bug`);return r=r.slice(1,-1),{type:"verb",mode:"text",body:r,star:i}}H9.hasOwnProperty(t[0])&&!At[this.mode][t[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=H9[t[0]]+t.slice(1));var s=F2e.exec(t);s&&(t=t.substring(0,s.index),t==="i"?t="":t==="j"&&(t=""));var o;if(At[this.mode][t]){this.settings.strict&&this.mode==="math"&&Z4.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var a=At[this.mode][t].group,l=vi.range(e),c;if(_xe.hasOwnProperty(a)){var u=a;c={type:"atom",mode:this.mode,family:u,loc:l,text:t}}else c={type:a,mode:this.mode,loc:l,text:t};o=c}else if(t.charCodeAt(0)>=128)this.settings.strict&&(AF(t.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'"'+(" ("+t.charCodeAt(0)+")"),e)),o={type:"textord",mode:"text",loc:vi.range(e),text:t};else return null;if(this.consume(),s)for(var d=0;d<s[0].length;d++){var h=s[0][d];if(!W2[h])throw new oe("Unknown accent ' "+h+"'",e);var p=W2[h][this.mode]||W2[h].text;if(!p)throw new oe("Accent "+h+" unsupported in "+this.mode+" mode",e);o={type:"accent",mode:this.mode,loc:vi.range(e),label:p,isStretchy:!1,isShifty:!0,base:o}}return o}};OB.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var M7=function(e,t){if(!(typeof e=="string"||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var r=new OB(e,t);delete r.gullet.macros.current["\\df@tag"];var i=r.parse();if(delete r.gullet.macros.current["\\current@color"],delete r.gullet.macros.current["\\color"],r.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new oe("\\tag works only in display equations");i=[{type:"tag",mode:"text",body:i,tag:r.subparse([new es("\\df@tag")])}]}return i},CB=function(e,t,r){t.textContent="";var i=A7(e,r).toNode();t.appendChild(i)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),CB=function(){throw new oe("KaTeX doesn't work in quirks mode.")});var q2e=function(e,t){var r=A7(e,t).toMarkup();return r},W2e=function(e,t){var r=new h7(t);return M7(e,r)},PB=function(e,t,r){if(r.throwOnError||!(e instanceof oe))throw e;var i=K.makeSpan(["katex-error"],[new os(t)]);return i.setAttribute("title",e.toString()),i.setAttribute("style","color:"+r.errorColor),i},A7=function(e,t){var r=new h7(t);try{var i=M7(e,r);return t2e(i,e,r)}catch(s){return PB(s,e,r)}},V2e=function(e,t){var r=new h7(t);try{var i=M7(e,r);return n2e(i,e,r)}catch(s){return PB(s,e,r)}},G2e="0.16.21",X2e={Span:g0,Anchor:g7,SymbolNode:os,SvgNode:Pa,PathNode:jl,LineNode:Y4},K2e={version:G2e,render:CB,renderToString:q2e,ParseError:oe,SETTINGS_SCHEMA:i1,__parse:W2e,__renderToDomTree:A7,__renderToHTMLTree:V2e,__setFontMetrics:kxe,__defineSymbol:P,__defineFunction:pe,__defineMacro:R,__domTree:X2e};const tv=class tv extends Ti{constructor(){super(...arguments),this.canEdit=()=>!0,this.canResize=()=>!0,this.isAspectRatioLocked=()=>!0,this.onResize=(e,t)=>i0(e,t)}getDefaultProps(){return{w:200,h:45,text:"\\sin^2\\theta+\\cos^2\\theta=1"}}getGeometry(e){return new As({width:e.props.w,height:e.props.h,isFilled:!0})}component(e){const t=this.editor.getEditingShapeId()===e.id;let r={__html:K2e.renderToString(e.props.text,{throwOnError:!1,output:"mathml",displayMode:!0})};const i=5;return f.jsx(Oa,{id:e.id,onPointerDown:t?Tn:void 0,style:{pointerEvents:t?"all":"none",paddingTop:i+"px"},children:f.jsxs("div",{style:{containerType:"size"},children:[f.jsx("div",{style:{margin:0,padding:"5px",fontSize:"10cqw",textAlign:"center"},dangerouslySetInnerHTML:r}),t&&f.jsx("textarea",{style:{margin:0,marginTop:"8%",padding:"5px",paddingTop:"10px",position:"absolute",backgroundColor:"rgba(82, 78, 183, 0.2)",color:"currentColor",width:"120%",height:"100%",fontSize:"6cqw",border:"none",fontFamily:"monospace"},onChange:s=>{const o=s.target.value,l=s.target.parentNode.children[0],c=l.scrollHeight+i,u=l.scrollWidth;this.editor.updateShape({id:e.id,type:e.type,props:{...e.props,text:o,h:c,w:u}})},value:e.props.text})]})})}indicator(e){return f.jsx("rect",{width:e.props.w,height:e.props.h})}};tv.type="card",tv.props=XSe;let i5=tv;const nv=class nv extends cd{constructor(){super(...arguments),this.shapeType="code",this.onPointerDown=e=>{console.log("tool pointerdown event info",e)}}};nv.id="code",nv.initial="idle";let s5=nv;const Y2e={w:Me,h:Me,text:ze,version:ze};let o5=[],TB=[];(()=>{let n="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,t=0;e<n.length;e++)(e%2?TB:o5).push(t=t+n[e])})();function Z2e(n){if(n<768)return!1;for(let e=0,t=o5.length;;){let r=e+t>>1;if(n<o5[r])t=r;else if(n>=TB[r])e=r+1;else return!0;if(e==t)return!1}}function Q9(n){return n>=127462&&n<=127487}const q9=8205;function J2e(n,e,t=!0,r=!0){return(t?EB:ewe)(n,e,r)}function EB(n,e,t){if(e==n.length)return e;e&&IB(n.charCodeAt(e))&&MB(n.charCodeAt(e-1))&&e--;let r=V2(n,e);for(e+=W9(r);e<n.length;){let i=V2(n,e);if(r==q9||i==q9||t&&Z2e(i))e+=W9(i),r=i;else if(Q9(i)){let s=0,o=e-2;for(;o>=0&&Q9(V2(n,o));)s++,o-=2;if(s%2==0)break;e+=2}else break}return e}function ewe(n,e,t){for(;e>0;){let r=EB(n,e-2,t);if(r<e)return r;e--}return 0}function V2(n,e){let t=n.charCodeAt(e);if(!MB(t)||e+1==n.length)return t;let r=n.charCodeAt(e+1);return IB(r)?(t-55296<<10)+(r-56320)+65536:t}function IB(n){return n>=56320&&n<57344}function MB(n){return n>=55296&&n<56320}function W9(n){return n<65536?1:2}class rt{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,r){[e,t]=zd(this,e,t);let i=[];return this.decompose(0,e,i,2),r.length&&r.decompose(0,r.length,i,3),this.decompose(t,this.length,i,1),so.from(i,this.length-(t-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=zd(this,e,t);let r=[];return this.decompose(e,t,r,0),so.from(r,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),i=new Lf(this),s=new Lf(e);for(let o=t,a=t;;){if(i.next(o),s.next(o),o=0,i.lineBreak!=s.lineBreak||i.done!=s.done||i.value!=s.value)return!1;if(a+=i.value.length,i.done||a>=r)return!0}}iter(e=1){return new Lf(this,e)}iterRange(e,t=this.length){return new AB(this,e,t)}iterLines(e,t){let r;if(e==null)r=this.iter();else{t==null&&(t=this.lines+1);let i=this.line(e).from;r=this.iterRange(i,Math.max(i,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new _B(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?rt.empty:e.length<=32?new ln(e):so.from(ln.split(e,[]))}}class ln extends rt{constructor(e,t=twe(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,r,i){for(let s=0;;s++){let o=this.text[s],a=i+o.length;if((t?r:a)>=e)return new nwe(i,a,r,o);i=a+1,r++}}decompose(e,t,r,i){let s=e<=0&&t>=this.length?this:new ln(V9(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(i&1){let o=r.pop(),a=o1(s.text,o.text.slice(),0,s.length);if(a.length<=32)r.push(new ln(a,o.length+s.length));else{let l=a.length>>1;r.push(new ln(a.slice(0,l)),new ln(a.slice(l)))}}else r.push(s)}replace(e,t,r){if(!(r instanceof ln))return super.replace(e,t,r);[e,t]=zd(this,e,t);let i=o1(this.text,o1(r.text,V9(this.text,0,e)),t),s=this.length+r.length-(t-e);return i.length<=32?new ln(i,s):so.from(ln.split(i,[]),s)}sliceString(e,t=this.length,r=`
`){[e,t]=zd(this,e,t);let i="";for(let s=0,o=0;s<=t&&o<this.text.length;o++){let a=this.text[o],l=s+a.length;s>e&&o&&(i+=r),e<l&&t>s&&(i+=a.slice(Math.max(0,e-s),t-s)),s=l+1}return i}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let r=[],i=-1;for(let s of e)r.push(s),i+=s.length+1,r.length==32&&(t.push(new ln(r,i)),r=[],i=-1);return i>-1&&t.push(new ln(r,i)),t}}class so extends rt{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,t,r,i){for(let s=0;;s++){let o=this.children[s],a=i+o.length,l=r+o.lines-1;if((t?l:a)>=e)return o.lineInner(e,t,r,i);i=a+1,r=l+1}}decompose(e,t,r,i){for(let s=0,o=0;o<=t&&s<this.children.length;s++){let a=this.children[s],l=o+a.length;if(e<=l&&t>=o){let c=i&((o<=e?1:0)|(l>=t?2:0));o>=e&&l<=t&&!c?r.push(a):a.decompose(e-o,t-o,r,c)}o=l+1}}replace(e,t,r){if([e,t]=zd(this,e,t),r.lines<this.lines)for(let i=0,s=0;i<this.children.length;i++){let o=this.children[i],a=s+o.length;if(e>=s&&t<=a){let l=o.replace(e-s,t-s,r),c=this.lines-o.lines+l.lines;if(l.lines<c>>4&&l.lines>c>>6){let u=this.children.slice();return u[i]=l,new so(u,this.length-(t-e)+r.length)}return super.replace(s,a,l)}s=a+1}return super.replace(e,t,r)}sliceString(e,t=this.length,r=`
`){[e,t]=zd(this,e,t);let i="";for(let s=0,o=0;s<this.children.length&&o<=t;s++){let a=this.children[s],l=o+a.length;o>e&&s&&(i+=r),e<l&&t>o&&(i+=a.sliceString(e-o,t-o,r)),o=l+1}return i}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof so))return 0;let r=0,[i,s,o,a]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;i+=t,s+=t){if(i==o||s==a)return r;let l=this.children[i],c=e.children[s];if(l!=c)return r+l.scanIdentical(c,t);r+=l.length+1}}static from(e,t=e.reduce((r,i)=>r+i.length+1,-1)){let r=0;for(let p of e)r+=p.lines;if(r<32){let p=[];for(let g of e)g.flatten(p);return new ln(p,t)}let i=Math.max(32,r>>5),s=i<<1,o=i>>1,a=[],l=0,c=-1,u=[];function d(p){let g;if(p.lines>s&&p instanceof so)for(let m of p.children)d(m);else p.lines>o&&(l>o||!l)?(h(),a.push(p)):p instanceof ln&&l&&(g=u[u.length-1])instanceof ln&&p.lines+g.lines<=32?(l+=p.lines,c+=p.length+1,u[u.length-1]=new ln(g.text.concat(p.text),g.length+1+p.length)):(l+p.lines>i&&h(),l+=p.lines,c+=p.length+1,u.push(p))}function h(){l!=0&&(a.push(u.length==1?u[0]:so.from(u,c)),c=-1,l=u.length=0)}for(let p of e)d(p);return h(),a.length==1?a[0]:new so(a,t)}}rt.empty=new ln([""],0);function twe(n){let e=-1;for(let t of n)e+=t.length+1;return e}function o1(n,e,t=0,r=1e9){for(let i=0,s=0,o=!0;s<n.length&&i<=r;s++){let a=n[s],l=i+a.length;l>=t&&(l>r&&(a=a.slice(0,r-i)),i<t&&(a=a.slice(t-i)),o?(e[e.length-1]+=a,o=!1):e.push(a)),i=l+1}return e}function V9(n,e,t){return o1(n,[""],e,t)}class Lf{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof ln?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,i=this.nodes[r],s=this.offsets[r],o=s>>1,a=i instanceof ln?i.text.length:i.children.length;if(o==(t>0?a:0)){if(r==0)return this.done=!0,this.value="",this;t>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[r]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(i instanceof ln){let l=i.text[o+(t<0?-1:0)];if(this.offsets[r]+=t,l.length>Math.max(0,e))return this.value=e==0?l:t>0?l.slice(e):l.slice(0,l.length-e),this;e-=l.length}else{let l=i.children[o+(t<0?-1:0)];e>l.length?(e-=l.length,this.offsets[r]+=t):(t<0&&this.offsets[r]--,this.nodes.push(l),this.offsets.push(t>0?1:(l instanceof ln?l.text.length:l.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class AB{constructor(e,t,r){this.value="",this.done=!1,this.cursor=new Lf(e,t>r?-1:1),this.pos=t>r?e.length:0,this.from=Math.min(t,r),this.to=Math.max(t,r)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let r=t<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:i}=this.cursor.next(e);return this.pos+=(i.length+e)*t,this.value=i.length<=r?i:t<0?i.slice(i.length-r):i.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class _B{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:r,value:i}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(rt.prototype[Symbol.iterator]=function(){return this.iter()},Lf.prototype[Symbol.iterator]=AB.prototype[Symbol.iterator]=_B.prototype[Symbol.iterator]=function(){return this});class nwe{constructor(e,t,r,i){this.from=e,this.to=t,this.number=r,this.text=i}get length(){return this.to-this.from}}function zd(n,e,t){return e=Math.max(0,Math.min(n.length,e)),[e,Math.max(e,Math.min(n.length,t))]}function Tr(n,e,t=!0,r=!0){return J2e(n,e,t,r)}function rwe(n){return n>=56320&&n<57344}function iwe(n){return n>=55296&&n<56320}function swe(n,e){let t=n.charCodeAt(e);if(!iwe(t)||e+1==n.length)return t;let r=n.charCodeAt(e+1);return rwe(r)?(t-55296<<10)+(r-56320)+65536:t}function owe(n){return n<65536?1:2}const a5=/\r\n?|\n/;var Cr=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(Cr||(Cr={}));class bo{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t+1];e+=r<0?this.sections[t]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,r=0,i=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(r,i,s),i+=s):i+=o,r+=s}}iterChangedRanges(e,t=!1){l5(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let r=this.sections[t++],i=this.sections[t++];i<0?e.push(r,i):e.push(i,r)}return new bo(e)}composeDesc(e){return this.empty?e:e.empty?this:RB(this,e)}mapDesc(e,t=!1){return e.empty?this:c5(this,e,t)}mapPos(e,t=-1,r=Cr.Simple){let i=0,s=0;for(let o=0;o<this.sections.length;){let a=this.sections[o++],l=this.sections[o++],c=i+a;if(l<0){if(c>e)return s+(e-i);s+=a}else{if(r!=Cr.Simple&&c>=e&&(r==Cr.TrackDel&&i<e&&c>e||r==Cr.TrackBefore&&i<e||r==Cr.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!a)return e==i||t<0?s:s+l;s+=l}i=c}if(e>i)throw new RangeError(`Position ${e} is out of range for changeset of length ${i}`);return s}touchesRange(e,t=e){for(let r=0,i=0;r<this.sections.length&&i<=t;){let s=this.sections[r++],o=this.sections[r++],a=i+s;if(o>=0&&i<=t&&a>=e)return i<e&&a>t?"cover":!0;i=a}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let r=this.sections[t++],i=this.sections[t++];e+=(e?" ":"")+r+(i>=0?":"+i:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new bo(e)}static create(e){return new bo(e)}}class On extends bo{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return l5(this,(t,r,i,s,o)=>e=e.replace(i,i+(r-t),o),!1),e}mapDesc(e,t=!1){return c5(this,e,t,!0)}invert(e){let t=this.sections.slice(),r=[];for(let i=0,s=0;i<t.length;i+=2){let o=t[i],a=t[i+1];if(a>=0){t[i]=a,t[i+1]=o;let l=i>>1;for(;r.length<l;)r.push(rt.empty);r.push(o?e.slice(s,s+o):rt.empty)}s+=o}return new On(t,r)}compose(e){return this.empty?e:e.empty?this:RB(this,e,!0)}map(e,t=!1){return e.empty?this:c5(this,e,t,!0)}iterChanges(e,t=!1){l5(this,e,t)}get desc(){return bo.create(this.sections)}filter(e){let t=[],r=[],i=[],s=new Tp(this);e:for(let o=0,a=0;;){let l=o==e.length?1e9:e[o++];for(;a<l||a==l&&s.len==0;){if(s.done)break e;let u=Math.min(s.len,l-a);ur(i,u,-1);let d=s.ins==-1?-1:s.off==0?s.ins:0;ur(t,u,d),d>0&&dl(r,t,s.text),s.forward(u),a+=u}let c=e[o++];for(;a<c;){if(s.done)break e;let u=Math.min(s.len,c-a);ur(t,u,-1),ur(i,u,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(u),a+=u}}return{changes:new On(t,r),filtered:bo.create(i)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t],i=this.sections[t+1];i<0?e.push(r):i==0?e.push([r]):e.push([r].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,r){let i=[],s=[],o=0,a=null;function l(u=!1){if(!u&&!i.length)return;o<t&&ur(i,t-o,-1);let d=new On(i,s);a=a?a.compose(d.map(a)):d,i=[],s=[],o=0}function c(u){if(Array.isArray(u))for(let d of u)c(d);else if(u instanceof On){if(u.length!=t)throw new RangeError(`Mismatched change set length (got ${u.length}, expected ${t})`);l(),a=a?a.compose(u.map(a)):u}else{let{from:d,to:h=d,insert:p}=u;if(d>h||d<0||h>t)throw new RangeError(`Invalid change range ${d} to ${h} (in doc of length ${t})`);let g=p?typeof p=="string"?rt.of(p.split(r||a5)):p:rt.empty,m=g.length;if(d==h&&m==0)return;d<o&&l(),d>o&&ur(i,d-o,-1),ur(i,h-d,m),dl(s,i,g),o=h}}return c(e),l(!a),a}static empty(e){return new On(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],r=[];for(let i=0;i<e.length;i++){let s=e[i];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,a)=>a&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;r.length<i;)r.push(rt.empty);r[i]=rt.of(s.slice(1)),t.push(s[0],r[i].length)}}}return new On(t,r)}static createSet(e,t){return new On(e,t)}}function ur(n,e,t,r=!1){if(e==0&&t<=0)return;let i=n.length-2;i>=0&&t<=0&&t==n[i+1]?n[i]+=e:i>=0&&e==0&&n[i]==0?n[i+1]+=t:r?(n[i]+=e,n[i+1]+=t):n.push(e,t)}function dl(n,e,t){if(t.length==0)return;let r=e.length-2>>1;if(r<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<r;)n.push(rt.empty);n.push(t)}}function l5(n,e,t){let r=n.inserted;for(let i=0,s=0,o=0;o<n.sections.length;){let a=n.sections[o++],l=n.sections[o++];if(l<0)i+=a,s+=a;else{let c=i,u=s,d=rt.empty;for(;c+=a,u+=l,l&&r&&(d=d.append(r[o-2>>1])),!(t||o==n.sections.length||n.sections[o+1]<0);)a=n.sections[o++],l=n.sections[o++];e(i,c,s,u,d),i=c,s=u}}}function c5(n,e,t,r=!1){let i=[],s=r?[]:null,o=new Tp(n),a=new Tp(e);for(let l=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(o.ins==-1&&a.ins==-1){let c=Math.min(o.len,a.len);ur(i,c,-1),o.forward(c),a.forward(c)}else if(a.ins>=0&&(o.ins<0||l==o.i||o.off==0&&(a.len<o.len||a.len==o.len&&!t))){let c=a.len;for(ur(i,a.ins,-1);c;){let u=Math.min(o.len,c);o.ins>=0&&l<o.i&&o.len<=u&&(ur(i,0,o.ins),s&&dl(s,i,o.text),l=o.i),o.forward(u),c-=u}a.next()}else if(o.ins>=0){let c=0,u=o.len;for(;u;)if(a.ins==-1){let d=Math.min(u,a.len);c+=d,u-=d,a.forward(d)}else if(a.ins==0&&a.len<u)u-=a.len,a.next();else break;ur(i,c,l<o.i?o.ins:0),s&&l<o.i&&dl(s,i,o.text),l=o.i,o.forward(o.len-u)}else{if(o.done&&a.done)return s?On.createSet(i,s):bo.create(i);throw new Error("Mismatched change set lengths")}}}function RB(n,e,t=!1){let r=[],i=t?[]:null,s=new Tp(n),o=new Tp(e);for(let a=!1;;){if(s.done&&o.done)return i?On.createSet(r,i):bo.create(r);if(s.ins==0)ur(r,s.len,0,a),s.next();else if(o.len==0&&!o.done)ur(r,0,o.ins,a),i&&dl(i,r,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let l=Math.min(s.len2,o.len),c=r.length;if(s.ins==-1){let u=o.ins==-1?-1:o.off?0:o.ins;ur(r,l,u,a),i&&u&&dl(i,r,o.text)}else o.ins==-1?(ur(r,s.off?0:s.len,l,a),i&&dl(i,r,s.textBit(l))):(ur(r,s.off?0:s.len,o.off?0:o.ins,a),i&&!o.off&&dl(i,r,o.text));a=(s.ins>l||o.ins>=0&&o.len>l)&&(a||r.length>c),s.forward2(l),o.forward(l)}}}}class Tp{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?rt.empty:e[t]}textBit(e){let{inserted:t}=this.set,r=this.i-2>>1;return r>=t.length&&!e?rt.empty:t[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class kc{constructor(e,t,r){this.from=e,this.to=t,this.flags=r}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let r,i;return this.empty?r=i=e.mapPos(this.from,t):(r=e.mapPos(this.from,1),i=e.mapPos(this.to,-1)),r==this.from&&i==this.to?this:new kc(r,i,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return ce.range(e,t);let r=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return ce.range(this.anchor,r)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return ce.range(e.anchor,e.head)}static create(e,t,r){return new kc(e,t,r)}}class ce{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:ce.create(this.ranges.map(r=>r.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ce([this.main],0)}addRange(e,t=!0){return ce.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let r=this.ranges.slice();return r[t]=e,ce.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ce(e.ranges.map(t=>kc.fromJSON(t)),e.main)}static single(e,t=e){return new ce([ce.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,i=0;i<e.length;i++){let s=e[i];if(s.empty?s.from<=r:s.from<r)return ce.normalized(e.slice(),t);r=s.to}return new ce(e,t)}static cursor(e,t=0,r,i){return kc.create(e,e,(t==0?0:t<0?8:16)|(r==null?7:Math.min(6,r))|(i??16777215)<<6)}static range(e,t,r,i){let s=(r??16777215)<<6|(i==null?7:Math.min(6,i));return t<e?kc.create(t,e,48|s):kc.create(e,t,(t>e?8:0)|s)}static normalized(e,t=0){let r=e[t];e.sort((i,s)=>i.from-s.from),t=e.indexOf(r);for(let i=1;i<e.length;i++){let s=e[i],o=e[i-1];if(s.empty?s.from<=o.to:s.from<o.to){let a=o.from,l=Math.max(s.to,o.to);i<=t&&t--,e.splice(--i,2,s.anchor>s.head?ce.range(l,a):ce.range(a,l))}}return new ce(e,t)}}function DB(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let _7=0;class Ie{constructor(e,t,r,i,s){this.combine=e,this.compareInput=t,this.compare=r,this.isStatic=i,this.id=_7++,this.default=e([]),this.extensions=typeof s=="function"?s(this):s}get reader(){return this}static define(e={}){return new Ie(e.combine||(t=>t),e.compareInput||((t,r)=>t===r),e.compare||(e.combine?(t,r)=>t===r:R7),!!e.static,e.enables)}of(e){return new a1([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new a1(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new a1(e,this,2,t)}from(e,t){return t||(t=r=>r),this.compute([e],r=>t(r.field(e)))}}function R7(n,e){return n==e||n.length==e.length&&n.every((t,r)=>t===e[r])}class a1{constructor(e,t,r,i){this.dependencies=e,this.facet=t,this.type=r,this.value=i,this.id=_7++}dynamicSlot(e){var t;let r=this.value,i=this.facet.compareInput,s=this.id,o=e[s]>>1,a=this.type==2,l=!1,c=!1,u=[];for(let d of this.dependencies)d=="doc"?l=!0:d=="selection"?c=!0:((t=e[d.id])!==null&&t!==void 0?t:1)&1||u.push(e[d.id]);return{create(d){return d.values[o]=r(d),1},update(d,h){if(l&&h.docChanged||c&&(h.docChanged||h.selection)||u5(d,u)){let p=r(d);if(a?!G9(p,d.values[o],i):!i(p,d.values[o]))return d.values[o]=p,1}return 0},reconfigure:(d,h)=>{let p,g=h.config.address[s];if(g!=null){let m=Ly(h,g);if(this.dependencies.every(S=>S instanceof Ie?h.facet(S)===d.facet(S):S instanceof Bs?h.field(S,!1)==d.field(S,!1):!0)||(a?G9(p=r(d),m,i):i(p=r(d),m)))return d.values[o]=m,0}else p=r(d);return d.values[o]=p,1}}}}function G9(n,e,t){if(n.length!=e.length)return!1;for(let r=0;r<n.length;r++)if(!t(n[r],e[r]))return!1;return!0}function u5(n,e){let t=!1;for(let r of e)zf(n,r)&1&&(t=!0);return t}function awe(n,e,t){let r=t.map(l=>n[l.id]),i=t.map(l=>l.type),s=r.filter(l=>!(l&1)),o=n[e.id]>>1;function a(l){let c=[];for(let u=0;u<r.length;u++){let d=Ly(l,r[u]);if(i[u]==2)for(let h of d)c.push(h);else c.push(d)}return e.combine(c)}return{create(l){for(let c of r)zf(l,c);return l.values[o]=a(l),1},update(l,c){if(!u5(l,s))return 0;let u=a(l);return e.compare(u,l.values[o])?0:(l.values[o]=u,1)},reconfigure(l,c){let u=u5(l,r),d=c.config.facets[e.id],h=c.facet(e);if(d&&!u&&R7(t,d))return l.values[o]=h,0;let p=a(l);return e.compare(p,h)?(l.values[o]=h,0):(l.values[o]=p,1)}}}const qg=Ie.define({static:!0});class Bs{constructor(e,t,r,i,s){this.id=e,this.createF=t,this.updateF=r,this.compareF=i,this.spec=s,this.provides=void 0}static define(e){let t=new Bs(_7++,e.create,e.update,e.compare||((r,i)=>r===i),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(qg).find(r=>r.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:r=>(r.values[t]=this.create(r),1),update:(r,i)=>{let s=r.values[t],o=this.updateF(s,i);return this.compareF(s,o)?0:(r.values[t]=o,1)},reconfigure:(r,i)=>{let s=r.facet(qg),o=i.facet(qg),a;return(a=s.find(l=>l.field==this))&&a!=o.find(l=>l.field==this)?(r.values[t]=a.create(r),1):i.config.address[this.id]!=null?(r.values[t]=i.field(this),0):(r.values[t]=this.create(r),1)}}}init(e){return[this,qg.of({field:this,create:e})]}get extension(){return this}}const vc={lowest:4,low:3,default:2,high:1,highest:0};function $h(n){return e=>new jB(e,n)}const bS={highest:$h(vc.highest),high:$h(vc.high),default:$h(vc.default),low:$h(vc.low),lowest:$h(vc.lowest)};class jB{constructor(e,t){this.inner=e,this.prec=t}}class OS{of(e){return new d5(this,e)}reconfigure(e){return OS.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class d5{constructor(e,t){this.compartment=e,this.inner=t}}class jy{constructor(e,t,r,i,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=r,this.address=i,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,r){let i=[],s=Object.create(null),o=new Map;for(let h of lwe(e,t,o))h instanceof Bs?i.push(h):(s[h.facet.id]||(s[h.facet.id]=[])).push(h);let a=Object.create(null),l=[],c=[];for(let h of i)a[h.id]=c.length<<1,c.push(p=>h.slot(p));let u=r==null?void 0:r.config.facets;for(let h in s){let p=s[h],g=p[0].facet,m=u&&u[h]||[];if(p.every(S=>S.type==0))if(a[g.id]=l.length<<1|1,R7(m,p))l.push(r.facet(g));else{let S=g.combine(p.map(y=>y.value));l.push(r&&g.compare(S,r.facet(g))?r.facet(g):S)}else{for(let S of p)S.type==0?(a[S.id]=l.length<<1|1,l.push(S.value)):(a[S.id]=c.length<<1,c.push(y=>S.dynamicSlot(y)));a[g.id]=c.length<<1,c.push(S=>awe(S,g,p))}}let d=c.map(h=>h(a));return new jy(e,o,d,a,l,s)}}function lwe(n,e,t){let r=[[],[],[],[],[]],i=new Map;function s(o,a){let l=i.get(o);if(l!=null){if(l<=a)return;let c=r[l].indexOf(o);c>-1&&r[l].splice(c,1),o instanceof d5&&t.delete(o.compartment)}if(i.set(o,a),Array.isArray(o))for(let c of o)s(c,a);else if(o instanceof d5){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(o.compartment)||o.inner;t.set(o.compartment,c),s(c,a)}else if(o instanceof jB)s(o.inner,o.prec);else if(o instanceof Bs)r[a].push(o),o.provides&&s(o.provides,a);else if(o instanceof a1)r[a].push(o),o.facet.extensions&&s(o.facet.extensions,vc.default);else{let c=o.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(c,a)}}return s(n,vc.default),r.reduce((o,a)=>o.concat(a))}function zf(n,e){if(e&1)return 2;let t=e>>1,r=n.status[t];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;n.status[t]=4;let i=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|i}function Ly(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const LB=Ie.define(),h5=Ie.define({combine:n=>n.some(e=>e),static:!0}),zB=Ie.define({combine:n=>n.length?n[0]:void 0,static:!0}),NB=Ie.define(),$B=Ie.define(),FB=Ie.define(),BB=Ie.define({combine:n=>n.length?n[0]:!1});class zo{constructor(e,t){this.type=e,this.value=t}static define(){return new cwe}}class cwe{of(e){return new zo(this,e)}}class uwe{constructor(e){this.map=e}of(e){return new Ft(this,e)}}class Ft{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new Ft(this.type,t)}is(e){return this.type==e}static define(e={}){return new uwe(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let r=[];for(let i of e){let s=i.map(t);s&&r.push(s)}return r}}Ft.reconfigure=Ft.define();Ft.appendConfig=Ft.define();class yn{constructor(e,t,r,i,s,o){this.startState=e,this.changes=t,this.selection=r,this.effects=i,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,r&&DB(r,t.newLength),s.some(a=>a.type==yn.time)||(this.annotations=s.concat(yn.time.of(Date.now())))}static create(e,t,r,i,s,o){return new yn(e,t,r,i,s,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(yn.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}yn.time=zo.define();yn.userEvent=zo.define();yn.addToHistory=zo.define();yn.remote=zo.define();function dwe(n,e){let t=[];for(let r=0,i=0;;){let s,o;if(r<n.length&&(i==e.length||e[i]>=n[r]))s=n[r++],o=n[r++];else if(i<e.length)s=e[i++],o=e[i++];else return t;!t.length||t[t.length-1]<s?t.push(s,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function UB(n,e,t){var r;let i,s,o;return t?(i=e.changes,s=On.empty(e.changes.length),o=n.changes.compose(e.changes)):(i=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),o=n.changes.compose(i)),{changes:o,selection:e.selection?e.selection.map(s):(r=n.selection)===null||r===void 0?void 0:r.map(i),effects:Ft.mapEffects(n.effects,i).concat(Ft.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function f5(n,e,t){let r=e.selection,i=pd(e.annotations);return e.userEvent&&(i=i.concat(yn.userEvent.of(e.userEvent))),{changes:e.changes instanceof On?e.changes:On.of(e.changes||[],t,n.facet(zB)),selection:r&&(r instanceof ce?r:ce.single(r.anchor,r.head)),effects:pd(e.effects),annotations:i,scrollIntoView:!!e.scrollIntoView}}function HB(n,e,t){let r=f5(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let o=!!e[s].sequential;r=UB(r,f5(n,e[s],o?r.changes.newLength:n.doc.length),o)}let i=yn.create(n,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return fwe(t?hwe(i):i)}function hwe(n){let e=n.startState,t=!0;for(let i of e.facet(NB)){let s=i(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:dwe(t,s))}if(t!==!0){let i,s;if(t===!1)s=n.changes.invertedDesc,i=On.empty(e.doc.length);else{let o=n.changes.filter(t);i=o.changes,s=o.filtered.mapDesc(o.changes).invertedDesc}n=yn.create(e,i,n.selection&&n.selection.map(s),Ft.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let r=e.facet($B);for(let i=r.length-1;i>=0;i--){let s=r[i](n);s instanceof yn?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof yn?n=s[0]:n=HB(e,pd(s),!1)}return n}function fwe(n){let e=n.startState,t=e.facet(FB),r=n;for(let i=t.length-1;i>=0;i--){let s=t[i](n);s&&Object.keys(s).length&&(r=UB(r,f5(e,s,n.changes.newLength),!0))}return r==n?n:yn.create(e,n.changes,n.selection,r.effects,r.annotations,r.scrollIntoView)}const pwe=[];function pd(n){return n==null?pwe:Array.isArray(n)?n:[n]}var la=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(la||(la={}));const gwe=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let p5;try{p5=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function mwe(n){if(p5)return p5.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||gwe.test(t)))return!0}return!1}function ywe(n){return e=>{if(!/\S/.test(e))return la.Space;if(mwe(e))return la.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return la.Word;return la.Other}}class ft{constructor(e,t,r,i,s,o){this.config=e,this.doc=t,this.selection=r,this.values=i,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)zf(this,a<<1);this.computeSlot=null}field(e,t=!0){let r=this.config.address[e.id];if(r==null){if(t)throw new RangeError("Field is not present in this state");return}return zf(this,r),Ly(this,r)}update(...e){return HB(this,e,!0)}applyTransaction(e){let t=this.config,{base:r,compartments:i}=t;for(let a of e.effects)a.is(OS.reconfigure)?(t&&(i=new Map,t.compartments.forEach((l,c)=>i.set(c,l)),t=null),i.set(a.value.compartment,a.value.extension)):a.is(Ft.reconfigure)?(t=null,r=a.value):a.is(Ft.appendConfig)&&(t=null,r=pd(r).concat(a.value));let s;t?s=e.startState.values.slice():(t=jy.resolve(r,i,this),s=new ft(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,c)=>c.reconfigure(l,this),null).values);let o=e.startState.facet(h5)?e.newSelection:e.newSelection.asSingle();new ft(t,e.newDoc,o,s,(a,l)=>l.update(a,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:ce.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,r=e(t.ranges[0]),i=this.changes(r.changes),s=[r.range],o=pd(r.effects);for(let a=1;a<t.ranges.length;a++){let l=e(t.ranges[a]),c=this.changes(l.changes),u=c.map(i);for(let h=0;h<a;h++)s[h]=s[h].map(u);let d=i.mapDesc(c,!0);s.push(l.range.map(d)),i=i.compose(u),o=Ft.mapEffects(o,u).concat(Ft.mapEffects(pd(l.effects),d))}return{changes:i,selection:ce.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof On?e:On.of(e,this.doc.length,this.facet(ft.lineSeparator))}toText(e){return rt.of(e.split(this.facet(ft.lineSeparator)||a5))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(zf(this,t),Ly(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let i=e[r];i instanceof Bs&&this.config.address[i.id]!=null&&(t[r]=i.spec.toJSON(this.field(e[r]),this))}return t}static fromJSON(e,t={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let i=[];if(r){for(let s in r)if(Object.prototype.hasOwnProperty.call(e,s)){let o=r[s],a=e[s];i.push(o.init(l=>o.spec.fromJSON(a,l)))}}return ft.create({doc:e.doc,selection:ce.fromJSON(e.selection),extensions:t.extensions?i.concat([t.extensions]):i})}static create(e={}){let t=jy.resolve(e.extensions||[],new Map),r=e.doc instanceof rt?e.doc:rt.of((e.doc||"").split(t.staticFacet(ft.lineSeparator)||a5)),i=e.selection?e.selection instanceof ce?e.selection:ce.single(e.selection.anchor,e.selection.head):ce.single(0);return DB(i,r.length),t.staticFacet(h5)||(i=i.asSingle()),new ft(t,r,i,t.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(ft.tabSize)}get lineBreak(){return this.facet(ft.lineSeparator)||`
`}get readOnly(){return this.facet(BB)}phrase(e,...t){for(let r of this.facet(ft.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(r,i)=>{if(i=="$")return"$";let s=+(i||1);return!s||s>t.length?r:t[s-1]})),e}languageDataAt(e,t,r=-1){let i=[];for(let s of this.facet(LB))for(let o of s(this,t,r))Object.prototype.hasOwnProperty.call(o,e)&&i.push(o[e]);return i}charCategorizer(e){return ywe(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:r,length:i}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-r,a=e-r;for(;o>0;){let l=Tr(t,o,!1);if(s(t.slice(l,o))!=la.Word)break;o=l}for(;a<i;){let l=Tr(t,a);if(s(t.slice(a,l))!=la.Word)break;a=l}return o==a?null:ce.range(o+r,a+r)}}ft.allowMultipleSelections=h5;ft.tabSize=Ie.define({combine:n=>n.length?n[0]:4});ft.lineSeparator=zB;ft.readOnly=BB;ft.phrases=Ie.define({compare(n,e){let t=Object.keys(n),r=Object.keys(e);return t.length==r.length&&t.every(i=>n[i]==e[i])}});ft.languageData=LB;ft.changeFilter=NB;ft.transactionFilter=$B;ft.transactionExtender=FB;OS.reconfigure=Ft.define();function D7(n,e,t={}){let r={};for(let i of n)for(let s of Object.keys(i)){let o=i[s],a=r[s];if(a===void 0)r[s]=o;else if(!(a===o||o===void 0))if(Object.hasOwnProperty.call(t,s))r[s]=t[s](a,o);else throw new Error("Config merge conflict for field "+s)}for(let i in e)r[i]===void 0&&(r[i]=e[i]);return r}class Yc{eq(e){return this==e}range(e,t=e){return g5.create(e,t,this)}}Yc.prototype.startSide=Yc.prototype.endSide=0;Yc.prototype.point=!1;Yc.prototype.mapMode=Cr.TrackDel;let g5=class QB{constructor(e,t,r){this.from=e,this.to=t,this.value=r}static create(e,t,r){return new QB(e,t,r)}};function m5(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class j7{constructor(e,t,r,i){this.from=e,this.to=t,this.value=r,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(e,t,r,i=0){let s=r?this.to:this.from;for(let o=i,a=s.length;;){if(o==a)return o;let l=o+a>>1,c=s[l]-e||(r?this.value[l].endSide:this.value[l].startSide)-t;if(l==o)return c>=0?o:a;c>=0?a=l:o=l+1}}between(e,t,r,i){for(let s=this.findIndex(t,-1e9,!0),o=this.findIndex(r,1e9,!1,s);s<o;s++)if(i(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let r=[],i=[],s=[],o=-1,a=-1;for(let l=0;l<this.value.length;l++){let c=this.value[l],u=this.from[l]+e,d=this.to[l]+e,h,p;if(u==d){let g=t.mapPos(u,c.startSide,c.mapMode);if(g==null||(h=p=g,c.startSide!=c.endSide&&(p=t.mapPos(u,c.endSide),p<h)))continue}else if(h=t.mapPos(u,c.startSide),p=t.mapPos(d,c.endSide),h>p||h==p&&c.startSide>0&&c.endSide<=0)continue;(p-h||c.endSide-c.startSide)<0||(o<0&&(o=h),c.point&&(a=Math.max(a,p-h)),r.push(c),i.push(h-o),s.push(p-o))}return{mapped:r.length?new j7(i,s,r,a):null,pos:o}}}class gt{constructor(e,t,r,i){this.chunkPos=e,this.chunk=t,this.nextLayer=r,this.maxPoint=i}static create(e,t,r,i){return new gt(e,t,r,i)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:r=!1,filterFrom:i=0,filterTo:s=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(r&&(t=t.slice().sort(m5)),this.isEmpty)return t.length?gt.of(t):this;let a=new qB(this,null,-1).goto(0),l=0,c=[],u=new Ep;for(;a.value||l<t.length;)if(l<t.length&&(a.from-t[l].from||a.startSide-t[l].value.startSide)>=0){let d=t[l++];u.addInner(d.from,d.to,d.value)||c.push(d)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==t.length||this.chunkEnd(a.chunkIndex)<t[l].from)&&(!o||i>this.chunkEnd(a.chunkIndex)||s<this.chunkPos[a.chunkIndex])&&u.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!o||i>a.to||s<a.from||o(a.from,a.to,a.value))&&(u.addInner(a.from,a.to,a.value)||c.push(g5.create(a.from,a.to,a.value))),a.next());return u.finishInner(this.nextLayer.isEmpty&&!c.length?gt.empty:this.nextLayer.update({add:c,filter:o,filterFrom:i,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],r=[],i=-1;for(let o=0;o<this.chunk.length;o++){let a=this.chunkPos[o],l=this.chunk[o],c=e.touchesRange(a,a+l.length);if(c===!1)i=Math.max(i,l.maxPoint),t.push(l),r.push(e.mapPos(a));else if(c===!0){let{mapped:u,pos:d}=l.map(a,e);u&&(i=Math.max(i,u.maxPoint),t.push(u),r.push(d))}}let s=this.nextLayer.map(e);return t.length==0?s:new gt(r,t,s||gt.empty,i)}between(e,t,r){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let s=this.chunkPos[i],o=this.chunk[i];if(t>=s&&e<=s+o.length&&o.between(s,e-s,t-s,r)===!1)return}this.nextLayer.between(e,t,r)}}iter(e=0){return Ip.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Ip.from(e).goto(t)}static compare(e,t,r,i,s=-1){let o=e.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=s),a=t.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=s),l=X9(o,a,r),c=new Fh(o,l,s),u=new Fh(a,l,s);r.iterGaps((d,h,p)=>K9(c,d,u,h,p,i)),r.empty&&r.length==0&&K9(c,0,u,0,0,i)}static eq(e,t,r=0,i){i==null&&(i=999999999);let s=e.filter(u=>!u.isEmpty&&t.indexOf(u)<0),o=t.filter(u=>!u.isEmpty&&e.indexOf(u)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let a=X9(s,o),l=new Fh(s,a,0).goto(r),c=new Fh(o,a,0).goto(r);for(;;){if(l.to!=c.to||!y5(l.active,c.active)||l.point&&(!c.point||!l.point.eq(c.point)))return!1;if(l.to>i)return!0;l.next(),c.next()}}static spans(e,t,r,i,s=-1){let o=new Fh(e,null,s).goto(t),a=t,l=o.openStart;for(;;){let c=Math.min(o.to,r);if(o.point){let u=o.activeForPoint(o.to),d=o.pointFrom<t?u.length+1:o.point.startSide<0?u.length:Math.min(u.length,l);i.point(a,c,o.point,u,d,o.pointRank),l=Math.min(o.openEnd(c),u.length)}else c>a&&(i.span(a,c,o.active,l),l=o.openEnd(c));if(o.to>r)return l+(o.point&&o.to>r?1:0);a=o.to,o.next()}}static of(e,t=!1){let r=new Ep;for(let i of e instanceof g5?[e]:t?vwe(e):e)r.add(i.from,i.to,i.value);return r.finish()}static join(e){if(!e.length)return gt.empty;let t=e[e.length-1];for(let r=e.length-2;r>=0;r--)for(let i=e[r];i!=gt.empty;i=i.nextLayer)t=new gt(i.chunkPos,i.chunk,t,Math.max(i.maxPoint,t.maxPoint));return t}}gt.empty=new gt([],[],null,-1);function vwe(n){if(n.length>1)for(let e=n[0],t=1;t<n.length;t++){let r=n[t];if(m5(e,r)>0)return n.slice().sort(m5);e=r}return n}gt.empty.nextLayer=gt.empty;class Ep{finishChunk(e){this.chunks.push(new j7(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,r){this.addInner(e,t,r)||(this.nextLayer||(this.nextLayer=new Ep)).add(e,t,r)}addInner(e,t,r){let i=e-this.lastTo||r.startSide-this.last.endSide;if(i<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return i<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=t,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let r=t.value.length-1;return this.last=t.value[r],this.lastFrom=t.from[r]+e,this.lastTo=t.to[r]+e,!0}finish(){return this.finishInner(gt.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=gt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function X9(n,e,t){let r=new Map;for(let s of n)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&r.set(s.chunk[o],s.chunkPos[o]);let i=new Set;for(let s of e)for(let o=0;o<s.chunk.length;o++){let a=r.get(s.chunk[o]);a!=null&&(t?t.mapPos(a):a)==s.chunkPos[o]&&!(t!=null&&t.touchesRange(a,a+s.chunk[o].length))&&i.add(s.chunk[o])}return i}class qB{constructor(e,t,r,i=0){this.layer=e,this.skip=t,this.minPoint=r,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,r){for(;this.chunkIndex<this.layer.chunk.length;){let i=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(i)||this.layer.chunkEnd(this.chunkIndex)<e||i.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let i=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!r||this.rangeIndex<i)&&this.setRangeIndex(i)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],r=e+t.from[this.rangeIndex];if(this.from=r,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Ip{constructor(e){this.heap=e}static from(e,t=null,r=-1){let i=[];for(let s=0;s<e.length;s++)for(let o=e[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=r&&i.push(new qB(o,t,r,s));return i.length==1?i[0]:new Ip(i)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let r of this.heap)r.goto(e,t);for(let r=this.heap.length>>1;r>=0;r--)G2(this.heap,r);return this.next(),this}forward(e,t){for(let r of this.heap)r.forward(e,t);for(let r=this.heap.length>>1;r>=0;r--)G2(this.heap,r);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),G2(this.heap,0)}}}function G2(n,e){for(let t=n[e];;){let r=(e<<1)+1;if(r>=n.length)break;let i=n[r];if(r+1<n.length&&i.compare(n[r+1])>=0&&(i=n[r+1],r++),t.compare(i)<0)break;n[r]=t,n[e]=i,e=r}}class Fh{constructor(e,t,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Ip.from(e,t,r)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Wg(this.active,e),Wg(this.activeTo,e),Wg(this.activeRank,e),this.minActive=Y9(this.active,this.activeTo)}addActive(e){let t=0,{value:r,to:i,rank:s}=this.cursor;for(;t<this.activeRank.length&&(s-this.activeRank[t]||i-this.activeTo[t])>0;)t++;Vg(this.active,t,r),Vg(this.activeTo,t,i),Vg(this.activeRank,t,s),e&&Vg(e,t,this.cursor.from),this.minActive=Y9(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let r=this.openStart<0?[]:null;for(;;){let i=this.minActive;if(i>-1&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>e){this.to=this.activeTo[i],this.endSide=this.active[i].endSide;break}this.removeActive(i),r&&Wg(r,i)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(r),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){this.openStart=0;for(let i=r.length-1;i>=0&&r[i]<e;i--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&t.push(this.active[r]);return t.reverse()}openEnd(e){let t=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)t++;return t}}function K9(n,e,t,r,i,s){n.goto(e),t.goto(r);let o=r+i,a=r,l=r-e;for(;;){let c=n.to+l-t.to,u=c||n.endSide-t.endSide,d=u<0?n.to+l:t.to,h=Math.min(d,o);if(n.point||t.point?n.point&&t.point&&(n.point==t.point||n.point.eq(t.point))&&y5(n.activeForPoint(n.to),t.activeForPoint(t.to))||s.comparePoint(a,h,n.point,t.point):h>a&&!y5(n.active,t.active)&&s.compareRange(a,h,n.active,t.active),d>o)break;(c||n.openEnd!=t.openEnd)&&s.boundChange&&s.boundChange(d),a=d,u<=0&&n.next(),u>=0&&t.next()}}function y5(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t]&&!n[t].eq(e[t]))return!1;return!0}function Wg(n,e){for(let t=e,r=n.length-1;t<r;t++)n[t]=n[t+1];n.pop()}function Vg(n,e,t){for(let r=n.length-1;r>=e;r--)n[r+1]=n[r];n[e]=t}function Y9(n,e){let t=-1,r=1e9;for(let i=0;i<e.length;i++)(e[i]-r||n[i].endSide-n[t].endSide)<0&&(t=i,r=e[i]);return t}function kS(n,e,t=n.length){let r=0;for(let i=0;i<t&&i<n.length;)n.charCodeAt(i)==9?(r+=e-r%e,i++):(r++,i=Tr(n,i));return r}function Swe(n,e,t,r){for(let i=0,s=0;;){if(s>=e)return i;if(i==n.length)break;s+=n.charCodeAt(i)==9?t-s%t:1,i=Tr(n,i)}return r===!0?-1:n.length}const v5="",Z9=typeof Symbol>"u"?"__"+v5:Symbol.for(v5),S5=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),J9=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class zl{constructor(e,t){this.rules=[];let{finish:r}=t||{};function i(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function s(o,a,l,c){let u=[],d=/^@(\w+)\b/.exec(o[0]),h=d&&d[1]=="keyframes";if(d&&a==null)return l.push(o[0]+";");for(let p in a){let g=a[p];if(/&/.test(p))s(p.split(/,\s*/).map(m=>o.map(S=>m.replace(/&/,S))).reduce((m,S)=>m.concat(S)),g,l);else if(g&&typeof g=="object"){if(!d)throw new RangeError("The value of a property ("+p+") should be a primitive value.");s(i(p),g,u,h)}else g!=null&&u.push(p.replace(/_.*/,"").replace(/[A-Z]/g,m=>"-"+m.toLowerCase())+": "+g+";")}(u.length||h)&&l.push((r&&!d&&!c?o.map(r):o).join(", ")+" {"+u.join(" ")+"}")}for(let o in e)s(i(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=J9[Z9]||1;return J9[Z9]=e+1,v5+e.toString(36)}static mount(e,t,r){let i=e[S5],s=r&&r.nonce;i?s&&i.setNonce(s):i=new xwe(e,s),i.mount(Array.isArray(t)?t:[t],e)}}let eE=new Map;class xwe{constructor(e,t){let r=e.ownerDocument||e,i=r.defaultView;if(!e.head&&e.adoptedStyleSheets&&i.CSSStyleSheet){let s=eE.get(r);if(s)return e[S5]=s;this.sheet=new i.CSSStyleSheet,eE.set(r,this)}else this.styleTag=r.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[S5]=this}mount(e,t){let r=this.sheet,i=0,s=0;for(let o=0;o<e.length;o++){let a=e[o],l=this.modules.indexOf(a);if(l<s&&l>-1&&(this.modules.splice(l,1),s--,l=-1),l==-1){if(this.modules.splice(s++,0,a),r)for(let c=0;c<a.rules.length;c++)r.insertRule(a.rules[c],i++)}else{for(;s<l;)i+=this.modules[s++].rules.length;i+=a.rules.length,s++}}if(r)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o;let a=t.head||t;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var Nl={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Mp={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},wwe=typeof navigator<"u"&&/Mac/.test(navigator.platform),bwe=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Qn=0;Qn<10;Qn++)Nl[48+Qn]=Nl[96+Qn]=String(Qn);for(var Qn=1;Qn<=24;Qn++)Nl[Qn+111]="F"+Qn;for(var Qn=65;Qn<=90;Qn++)Nl[Qn]=String.fromCharCode(Qn+32),Mp[Qn]=String.fromCharCode(Qn);for(var X2 in Nl)Mp.hasOwnProperty(X2)||(Mp[X2]=Nl[X2]);function Owe(n){var e=wwe&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||bwe&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?Mp:Nl)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function Ap(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function x5(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function l1(n,e){if(!e.anchorNode)return!1;try{return x5(n,e.anchorNode)}catch{return!1}}function _p(n){return n.nodeType==3?Jc(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function Nf(n,e,t,r){return t?tE(n,e,t,r,-1)||tE(n,e,t,r,1):!1}function Zc(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function zy(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}function tE(n,e,t,r,i){for(;;){if(n==t&&e==r)return!0;if(e==(i<0?0:Mo(n))){if(n.nodeName=="DIV")return!1;let s=n.parentNode;if(!s||s.nodeType!=1)return!1;e=Zc(n)+(i<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(i<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=i<0?Mo(n):0}else return!1}}function Mo(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function CS(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function kwe(n){let e=n.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function WB(n,e){let t=e.width/n.offsetWidth,r=e.height/n.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-n.offsetWidth)<1)&&(t=1),(r>.995&&r<1.005||!isFinite(r)||Math.abs(e.height-n.offsetHeight)<1)&&(r=1),{scaleX:t,scaleY:r}}function Cwe(n,e,t,r,i,s,o,a){let l=n.ownerDocument,c=l.defaultView||window;for(let u=n,d=!1;u&&!d;)if(u.nodeType==1){let h,p=u==l.body,g=1,m=1;if(p)h=kwe(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(u).position)&&(d=!0),u.scrollHeight<=u.clientHeight&&u.scrollWidth<=u.clientWidth){u=u.assignedSlot||u.parentNode;continue}let x=u.getBoundingClientRect();({scaleX:g,scaleY:m}=WB(u,x)),h={left:x.left,right:x.left+u.clientWidth*g,top:x.top,bottom:x.top+u.clientHeight*m}}let S=0,y=0;if(i=="nearest")e.top<h.top?(y=e.top-(h.top+o),t>0&&e.bottom>h.bottom+y&&(y=e.bottom-h.bottom+o)):e.bottom>h.bottom&&(y=e.bottom-h.bottom+o,t<0&&e.top-y<h.top&&(y=e.top-(h.top+o)));else{let x=e.bottom-e.top,w=h.bottom-h.top;y=(i=="center"&&x<=w?e.top+x/2-w/2:i=="start"||i=="center"&&t<0?e.top-o:e.bottom-w+o)-h.top}if(r=="nearest"?e.left<h.left?(S=e.left-(h.left+s),t>0&&e.right>h.right+S&&(S=e.right-h.right+s)):e.right>h.right&&(S=e.right-h.right+s,t<0&&e.left<h.left+S&&(S=e.left-(h.left+s))):S=(r=="center"?e.left+(e.right-e.left)/2-(h.right-h.left)/2:r=="start"==a?e.left-s:e.right-(h.right-h.left)+s)-h.left,S||y)if(p)c.scrollBy(S,y);else{let x=0,w=0;if(y){let O=u.scrollTop;u.scrollTop+=y/m,w=(u.scrollTop-O)*m}if(S){let O=u.scrollLeft;u.scrollLeft+=S/g,x=(u.scrollLeft-O)*g}e={left:e.left-x,top:e.top-w,right:e.right-x,bottom:e.bottom-w},x&&Math.abs(x-S)<1&&(r="nearest"),w&&Math.abs(w-y)<1&&(i="nearest")}if(p)break;(e.top<h.top||e.bottom>h.bottom||e.left<h.left||e.right>h.right)&&(e={left:Math.max(e.left,h.left),right:Math.min(e.right,h.right),top:Math.max(e.top,h.top),bottom:Math.min(e.bottom,h.bottom)}),u=u.assignedSlot||u.parentNode}else if(u.nodeType==11)u=u.host;else break}function Pwe(n){let e=n.ownerDocument,t,r;for(let i=n.parentNode;i&&!(i==e.body||t&&r);)if(i.nodeType==1)!r&&i.scrollHeight>i.clientHeight&&(r=i),!t&&i.scrollWidth>i.clientWidth&&(t=i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;return{x:t,y:r}}class Twe{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:r}=e;this.set(t,Math.min(e.anchorOffset,t?Mo(t):0),r,Math.min(e.focusOffset,r?Mo(r):0))}set(e,t,r,i){this.anchorNode=e,this.anchorOffset=t,this.focusNode=r,this.focusOffset=i}}let Pu=null;function VB(n){if(n.setActive)return n.setActive();if(Pu)return n.focus(Pu);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(Pu==null?{get preventScroll(){return Pu={preventScroll:!0},!0}}:void 0),!Pu){Pu=!1;for(let t=0;t<e.length;){let r=e[t++],i=e[t++],s=e[t++];r.scrollTop!=i&&(r.scrollTop=i),r.scrollLeft!=s&&(r.scrollLeft=s)}}}let nE;function Jc(n,e,t=e){let r=nE||(nE=document.createRange());return r.setEnd(n,t),r.setStart(n,e),r}function gd(n,e,t,r){let i={key:e,code:e,keyCode:t,which:t,cancelable:!0};r&&({altKey:i.altKey,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,metaKey:i.metaKey}=r);let s=new KeyboardEvent("keydown",i);s.synthetic=!0,n.dispatchEvent(s);let o=new KeyboardEvent("keyup",i);return o.synthetic=!0,n.dispatchEvent(o),s.defaultPrevented||o.defaultPrevented}function Ewe(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function GB(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}function Iwe(n,e){let t=e.focusNode,r=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=r)return!1;for(r=Math.min(r,Mo(t));;)if(r){if(t.nodeType!=1)return!1;let i=t.childNodes[r-1];i.contentEditable=="false"?r--:(t=i,r=Mo(t))}else{if(t==n)return!0;r=Zc(t),t=t.parentNode}}function XB(n){return n.scrollTop>Math.max(1,n.scrollHeight-n.clientHeight-4)}function KB(n,e){for(let t=n,r=e;;){if(t.nodeType==3&&r>0)return{node:t,offset:r};if(t.nodeType==1&&r>0){if(t.contentEditable=="false")return null;t=t.childNodes[r-1],r=Mo(t)}else if(t.parentNode&&!zy(t))r=Zc(t),t=t.parentNode;else return null}}function YB(n,e){for(let t=n,r=e;;){if(t.nodeType==3&&r<t.nodeValue.length)return{node:t,offset:r};if(t.nodeType==1&&r<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[r],r=0}else if(t.parentNode&&!zy(t))r=Zc(t)+1,t=t.parentNode;else return null}}class pr{constructor(e,t,r=!0){this.node=e,this.offset=t,this.precise=r}static before(e,t){return new pr(e.parentNode,Zc(e),t)}static after(e,t){return new pr(e.parentNode,Zc(e)+1,t)}}const L7=[];class Ot{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let r of this.children){if(r==e)return t;t+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.flags&2){let r=this.dom,i=null,s;for(let o of this.children){if(o.flags&7){if(!o.dom&&(s=i?i.nextSibling:r.firstChild)){let a=Ot.get(s);(!a||!a.parent&&a.canReuseDOM(o))&&o.reuseDOM(s)}o.sync(e,t),o.flags&=-8}if(s=i?i.nextSibling:r.firstChild,t&&!t.written&&t.node==r&&s!=o.dom&&(t.written=!0),o.dom.parentNode==r)for(;s&&s!=o.dom;)s=rE(s);else r.insertBefore(o.dom,s);i=o.dom}for(s=i?i.nextSibling:r.firstChild,s&&t&&t.node==r&&(t.written=!0);s;)s=rE(s)}else if(this.flags&1)for(let r of this.children)r.flags&7&&(r.sync(e,t),r.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let r;if(e==this.dom)r=this.dom.childNodes[t];else{let i=Mo(e)==0?0:t==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;i==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?i=-1:i=1),e=s}i<0?r=e:r=e.nextSibling}if(r==this.dom.firstChild)return 0;for(;r&&!Ot.get(r);)r=r.nextSibling;if(!r)return this.length;for(let i=0,s=0;;i++){let o=this.children[i];if(o.dom==r)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,t,r=0){let i=-1,s=-1,o=-1,a=-1;for(let l=0,c=r,u=r;l<this.children.length;l++){let d=this.children[l],h=c+d.length;if(c<e&&h>t)return d.domBoundsAround(e,t,c);if(h>=e&&i==-1&&(i=l,s=c),c>t&&d.dom.parentNode==this.dom){o=l,a=u;break}u=h,c=h+d.breakAfter}return{from:s,to:a<0?r+this.length:a,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),t.flags&1)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,r=L7){this.markDirty();for(let i=e;i<t;i++){let s=this.children[i];s.parent==this&&r.indexOf(s)<0&&s.destroy()}r.length<250?this.children.splice(e,t-e,...r):this.children=[].concat(this.children.slice(0,e),r,this.children.slice(t));for(let i=0;i<r.length;i++)r[i].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ZB(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,r,i,s,o){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}Ot.prototype.breakAfter=0;function rE(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class ZB{constructor(e,t,r){this.children=e,this.pos=t,this.i=r,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}}function JB(n,e,t,r,i,s,o,a,l){let{children:c}=n,u=c.length?c[e]:null,d=s.length?s[s.length-1]:null,h=d?d.breakAfter:o;if(!(e==r&&u&&!o&&!h&&s.length<2&&u.merge(t,i,s.length?d:null,t==0,a,l))){if(r<c.length){let p=c[r];p&&(i<p.length||p.breakAfter&&(d!=null&&d.breakAfter))?(e==r&&(p=p.split(i),i=0),!h&&d&&p.merge(0,i,d,!0,0,l)?s[s.length-1]=p:((i||p.children.length&&!p.children[0].length)&&p.merge(0,i,null,!1,0,l),s.push(p))):p!=null&&p.breakAfter&&(d?d.breakAfter=1:o=1),r++}for(u&&(u.breakAfter=o,t>0&&(!o&&s.length&&u.merge(t,u.length,s[0],!1,a,0)?u.breakAfter=s.shift().breakAfter:(t<u.length||u.children.length&&u.children[u.children.length-1].length==0)&&u.merge(t,u.length,null,!1,a,0),e++));e<r&&s.length;)if(c[r-1].become(s[s.length-1]))r--,s.pop(),l=s.length?0:a;else if(c[e].become(s[0]))e++,s.shift(),a=s.length?0:l;else break;!s.length&&e&&r<c.length&&!c[e-1].breakAfter&&c[r].merge(0,0,c[e-1],!1,a,l)&&e--,(e<r||s.length)&&n.replaceChildren(e,r,s)}}function eU(n,e,t,r,i,s){let o=n.childCursor(),{i:a,off:l}=o.findPos(t,1),{i:c,off:u}=o.findPos(e,-1),d=e-t;for(let h of r)d+=h.length;n.length+=d,JB(n,c,u,a,l,r,0,i,s)}let Gr=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},w5=typeof document<"u"?document:{documentElement:{style:{}}};const b5=/Edge\/(\d+)/.exec(Gr.userAgent),tU=/MSIE \d/.test(Gr.userAgent),O5=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Gr.userAgent),PS=!!(tU||O5||b5),iE=!PS&&/gecko\/(\d+)/i.test(Gr.userAgent),K2=!PS&&/Chrome\/(\d+)/.exec(Gr.userAgent),sE="webkitFontSmoothing"in w5.documentElement.style,nU=!PS&&/Apple Computer/.test(Gr.vendor),oE=nU&&(/Mobile\/\w+/.test(Gr.userAgent)||Gr.maxTouchPoints>2);var xe={mac:oE||/Mac/.test(Gr.platform),windows:/Win/.test(Gr.platform),linux:/Linux|X11/.test(Gr.platform),ie:PS,ie_version:tU?w5.documentMode||6:O5?+O5[1]:b5?+b5[1]:0,gecko:iE,gecko_version:iE?+(/Firefox\/(\d+)/.exec(Gr.userAgent)||[0,0])[1]:0,chrome:!!K2,chrome_version:K2?+K2[1]:0,ios:oE,android:/Android\b/.test(Gr.userAgent),webkit:sE,safari:nU,webkit_version:sE?+(/\bAppleWebKit\/(\d+)/.exec(Gr.userAgent)||[0,0])[1]:0,tabSize:w5.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const Mwe=256;class Ds extends Ot{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,r){return this.flags&8||r&&(!(r instanceof Ds)||this.length-(t-e)+r.length>Mwe||r.flags&8)?!1:(this.text=this.text.slice(0,e)+(r?r.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new Ds(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=this.flags&8,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new pr(this.dom,e)}domBoundsAround(e,t,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return Awe(this.dom,e,t)}}class Ia extends Ot{constructor(e,t=[],r=0){super(),this.mark=e,this.children=t,this.length=r;for(let i of t)i.setParent(this)}setAttrs(e){if(GB(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,r,i,s,o){return r&&(!(r instanceof Ia&&r.mark.eq(this.mark))||e&&s<=0||t<this.length&&o<=0)?!1:(eU(this,e,t,r?r.children.slice():[],s-1,o-1),this.markDirty(),!0)}split(e){let t=[],r=0,i=-1,s=0;for(let a of this.children){let l=r+a.length;l>e&&t.push(r<e?a.split(e-r):a),i<0&&r>=e&&(i=s),r=l,s++}let o=this.length-e;return this.length=e,i>-1&&(this.children.length=i,this.markDirty()),new Ia(this.mark,t,o)}domAtPos(e){return rU(this,e)}coordsAt(e,t){return sU(this,e,t)}}function Awe(n,e,t){let r=n.nodeValue.length;e>r&&(e=r);let i=e,s=e,o=0;e==0&&t<0||e==r&&t>=0?xe.chrome||xe.gecko||(e?(i--,o=1):s<r&&(s++,o=-1)):t<0?i--:s<r&&s++;let a=Jc(n,i,s).getClientRects();if(!a.length)return null;let l=a[(o?o<0:t>=0)?0:a.length-1];return xe.safari&&!o&&l.width==0&&(l=Array.prototype.find.call(a,c=>c.width)||l),o?CS(l,o<0):l||null}class Cc extends Ot{static create(e,t,r){return new Cc(e,t,r)}constructor(e,t,r){super(),this.widget=e,this.length=t,this.side=r,this.prevWidget=null}split(e){let t=Cc.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,r,i,s,o){return r&&(!(r instanceof Cc)||!this.widget.compare(r.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-t),!0)}become(e){return e instanceof Cc&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return rt.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,r=t&&t.state.doc,i=this.posAtStart;return r?r.slice(i,i+this.length):rt.empty}domAtPos(e){return(this.length?e==0:this.side>0)?pr.before(this.dom):pr.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let r=this.widget.coordsAt(this.dom,e,t);if(r)return r;let i=this.dom.getClientRects(),s=null;if(!i.length)return null;let o=this.side?this.side<0:e>0;for(let a=o?i.length-1:0;s=i[a],!(e>0?a==0:a==i.length-1||s.top<s.bottom);a+=o?-1:1);return CS(s,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Nd extends Ot{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Nd&&e.side==this.side}split(){return new Nd(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?pr.before(this.dom):pr.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return rt.empty}get isHidden(){return!0}}Ds.prototype.children=Cc.prototype.children=Nd.prototype.children=L7;function rU(n,e){let t=n.dom,{children:r}=n,i=0;for(let s=0;i<r.length;i++){let o=r[i],a=s+o.length;if(!(a==s&&o.getSide()<=0)){if(e>s&&e<a&&o.dom.parentNode==t)return o.domAtPos(e-s);if(e<=s)break;s=a}}for(let s=i;s>0;s--){let o=r[s-1];if(o.dom.parentNode==t)return o.domAtPos(o.length)}for(let s=i;s<r.length;s++){let o=r[s];if(o.dom.parentNode==t)return o.domAtPos(0)}return new pr(t,0)}function iU(n,e,t){let r,{children:i}=n;t>0&&e instanceof Ia&&i.length&&(r=i[i.length-1])instanceof Ia&&r.mark.eq(e.mark)?iU(r,e.children[0],t-1):(i.push(e),e.setParent(n)),n.length+=e.length}function sU(n,e,t){let r=null,i=-1,s=null,o=-1;function a(c,u){for(let d=0,h=0;d<c.children.length&&h<=u;d++){let p=c.children[d],g=h+p.length;g>=u&&(p.children.length?a(p,u-h):(!s||s.isHidden&&(t>0||Rwe(s,p)))&&(g>u||h==g&&p.getSide()>0)?(s=p,o=u-h):(h<u||h==g&&p.getSide()<0&&!p.isHidden)&&(r=p,i=u-h)),h=g}}a(n,e);let l=(t<0?r:s)||r||s;return l?l.coordsAt(Math.max(0,l==r?i:o),t):_we(n)}function _we(n){let e=n.dom.lastChild;if(!e)return n.dom.getBoundingClientRect();let t=_p(e);return t[t.length-1]||null}function Rwe(n,e){let t=n.coordsAt(0,1),r=e.coordsAt(0,1);return t&&r&&r.top<t.bottom}function k5(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}const aE=Object.create(null);function Ny(n,e,t){if(n==e)return!0;n||(n=aE),e||(e=aE);let r=Object.keys(n),i=Object.keys(e);if(r.length-(t&&r.indexOf(t)>-1?1:0)!=i.length-(t&&i.indexOf(t)>-1?1:0))return!1;for(let s of r)if(s!=t&&(i.indexOf(s)==-1||n[s]!==e[s]))return!1;return!0}function C5(n,e,t){let r=!1;if(e)for(let i in e)t&&i in t||(r=!0,i=="style"?n.style.cssText="":n.removeAttribute(i));if(t)for(let i in t)e&&e[i]==t[i]||(r=!0,i=="style"?n.style.cssText=t[i]:n.setAttribute(i,t[i]));return r}function Dwe(n){let e=Object.create(null);for(let t=0;t<n.attributes.length;t++){let r=n.attributes[t];e[r.name]=r.value}return e}class TS{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,r){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var ts=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(ts||(ts={}));class on extends Yc{constructor(e,t,r,i){super(),this.startSide=e,this.endSide=t,this.widget=r,this.spec=i}get heightRelevant(){return!1}static mark(e){return new y0(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),r=!!e.block;return t+=r&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new $l(e,t,t,r,e.widget||null,!1)}static replace(e){let t=!!e.block,r,i;if(e.isBlockGap)r=-5e8,i=4e8;else{let{start:s,end:o}=oU(e,t);r=(s?t?-3e8:-1:5e8)-1,i=(o?t?2e8:1:-6e8)+1}return new $l(e,r,i,t,e.widget||null,!0)}static line(e){return new v0(e)}static set(e,t=!1){return gt.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}on.none=gt.empty;class y0 extends on{constructor(e){let{start:t,end:r}=oU(e);super(t?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,r;return this==e||e instanceof y0&&this.tagName==e.tagName&&(this.class||((t=this.attrs)===null||t===void 0?void 0:t.class))==(e.class||((r=e.attrs)===null||r===void 0?void 0:r.class))&&Ny(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}y0.prototype.point=!1;class v0 extends on{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof v0&&this.spec.class==e.spec.class&&Ny(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}v0.prototype.mapMode=Cr.TrackBefore;v0.prototype.point=!0;class $l extends on{constructor(e,t,r,i,s,o){super(t,r,s,e),this.block=i,this.isReplace=o,this.mapMode=i?t<=0?Cr.TrackBefore:Cr.TrackAfter:Cr.TrackDel}get type(){return this.startSide!=this.endSide?ts.WidgetRange:this.startSide<=0?ts.WidgetBefore:ts.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof $l&&jwe(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}$l.prototype.point=!0;function oU(n,e=!1){let{inclusiveStart:t,inclusiveEnd:r}=n;return t==null&&(t=n.inclusive),r==null&&(r=n.inclusive),{start:t??e,end:r??e}}function jwe(n,e){return n==e||!!(n&&e&&n.compare(e))}function c1(n,e,t,r=0){let i=t.length-1;i>=0&&t[i]+r>=n?t[i]=Math.max(t[i],e):t.push(n,e)}class pn extends Ot{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,r,i,s,o){if(r){if(!(r instanceof pn))return!1;this.dom||r.transferDOM(this)}return i&&this.setDeco(r?r.attrs:null),eU(this,e,t,r?r.children.slice():[],s,o),!0}split(e){let t=new pn;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i:r,off:i}=this.childPos(e);i&&(t.append(this.children[r].split(i),0),this.children[r].merge(i,this.children[r].length,null,!1,0,0),r++);for(let s=r;s<this.children.length;s++)t.append(this.children[s],0);for(;r>0&&this.children[r-1].length==0;)this.children[--r].destroy();return this.children.length=r,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Ny(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){iU(this,e,t)}addLineDeco(e){let t=e.spec.attributes,r=e.spec.class;t&&(this.attrs=k5(t,this.attrs||{})),r&&(this.attrs=k5({class:r},this.attrs||{}))}domAtPos(e){return rU(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,t){var r;this.dom?this.flags&4&&(GB(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(C5(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let i=this.dom.lastChild;for(;i&&Ot.get(i)instanceof Ia;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((r=Ot.get(i))===null||r===void 0?void 0:r.isEditable)==!1&&(!xe.ios||!this.children.some(s=>s instanceof Ds))){let s=document.createElement("BR");s.cmIgnore=!0,this.dom.appendChild(s)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let r of this.children){if(!(r instanceof Ds)||/[^ -~]/.test(r.text))return null;let i=_p(r.dom);if(i.length!=1)return null;e+=i[0].width,t=i[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let r=sU(this,e,t);if(!this.children.length&&r&&this.parent){let{heightOracle:i}=this.parent.view.viewState,s=r.bottom-r.top;if(Math.abs(s-i.lineHeight)<2&&i.textHeight<s){let o=(s-i.textHeight)/2;return{top:r.top+o,bottom:r.bottom-o,left:r.left,right:r.left}}}return r}become(e){return e instanceof pn&&this.children.length==0&&e.children.length==0&&Ny(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let r=0,i=0;r<e.children.length;r++){let s=e.children[r],o=i+s.length;if(o>=t){if(s instanceof pn)return s;if(o>t)break}i=o+s.breakAfter}return null}}class ma extends Ot{constructor(e,t,r){super(),this.widget=e,this.length=t,this.deco=r,this.breakAfter=0,this.prevWidget=null}merge(e,t,r,i,s,o){return r&&(!(r instanceof ma)||!this.widget.compare(r.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?pr.before(this.dom):pr.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let r=new ma(this.widget,t,this.deco);return r.breakAfter=this.breakAfter,r}get children(){return L7}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):rt.empty}domBoundsAround(){return null}become(e){return e instanceof ma&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){let r=this.widget.coordsAt(this.dom,e,t);return r||(this.widget instanceof P5?null:CS(this.dom.getBoundingClientRect(),this.length?e==0:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:r}=this.deco;return t==r?!1:e<0?t<0:r>0}}class P5 extends TS{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class $f{constructor(e,t,r,i){this.doc=e,this.pos=t,this.end=r,this.disallowBlockEffectsFor=i,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof ma&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new pn),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Gg(new Nd(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof ma)&&this.getLine()}buildText(e,t,r){for(;e>0;){if(this.textOff==this.text.length){let{value:s,lineBreak:o,done:a}=this.cursor.next(this.skip);if(this.skip=0,a)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=s,this.textOff=0}let i=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-r)),this.getLine().append(Gg(new Ds(this.text.slice(this.textOff,this.textOff+i)),t),r),this.atCursorPos=!0,this.textOff+=i,e-=i,r=0}}span(e,t,r,i){this.buildText(t-e,r,i),this.pos=t,this.openStart<0&&(this.openStart=i)}point(e,t,r,i,s,o){if(this.disallowBlockEffectsFor[o]&&r instanceof $l){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=t-e;if(r instanceof $l)if(r.block)r.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new ma(r.widget||$d.block,a,r));else{let l=Cc.create(r.widget||$d.inline,a,a?0:r.startSide),c=this.atCursorPos&&!l.isEditable&&s<=i.length&&(e<t||r.startSide>0),u=!l.isEditable&&(e<t||s>i.length||r.startSide<=0),d=this.getLine();this.pendingBuffer==2&&!c&&!l.isEditable&&(this.pendingBuffer=0),this.flushBuffer(i),c&&(d.append(Gg(new Nd(1),i),s),s=i.length+Math.max(0,s-i.length)),d.append(Gg(l,i),s),this.atCursorPos=u,this.pendingBuffer=u?e<t||s>i.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=i.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(r);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}static build(e,t,r,i,s){let o=new $f(e,t,r,s);return o.openEnd=gt.spans(i,t,r,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Gg(n,e){for(let t of e)n=new Ia(t,[n],n.length);return n}class $d extends TS{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}$d.inline=new $d("span");$d.block=new $d("div");var Pn=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(Pn||(Pn={}));const eu=Pn.LTR,z7=Pn.RTL;function aU(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const Lwe=aU("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),zwe=aU("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),T5=Object.create(null),Gs=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);T5[e]=t,T5[t]=-e}function lU(n){return n<=247?Lwe[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?zwe[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8204?256:64336<=n&&n<=65023?4:1}const Nwe=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class hl{get dir(){return this.level%2?z7:eu}constructor(e,t,r){this.from=e,this.to=t,this.level=r}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,r,i){let s=-1;for(let o=0;o<e.length;o++){let a=e[o];if(a.from<=t&&a.to>=t){if(a.level==r)return o;(s<0||(i!=0?i<0?a.from<t:a.to>t:e[s].level>a.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}function cU(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++){let r=n[t],i=e[t];if(r.from!=i.from||r.to!=i.to||r.direction!=i.direction||!cU(r.inner,i.inner))return!1}return!0}const bt=[];function $we(n,e,t,r,i){for(let s=0;s<=r.length;s++){let o=s?r[s-1].to:e,a=s<r.length?r[s].from:t,l=s?256:i;for(let c=o,u=l,d=l;c<a;c++){let h=lU(n.charCodeAt(c));h==512?h=u:h==8&&d==4&&(h=16),bt[c]=h==4?2:h,h&7&&(d=h),u=h}for(let c=o,u=l,d=l;c<a;c++){let h=bt[c];if(h==128)c<a-1&&u==bt[c+1]&&u&24?h=bt[c]=u:bt[c]=256;else if(h==64){let p=c+1;for(;p<a&&bt[p]==64;)p++;let g=c&&u==8||p<t&&bt[p]==8?d==1?1:8:256;for(let m=c;m<p;m++)bt[m]=g;c=p-1}else h==8&&d==1&&(bt[c]=1);u=h,h&7&&(d=h)}}}function Fwe(n,e,t,r,i){let s=i==1?2:1;for(let o=0,a=0,l=0;o<=r.length;o++){let c=o?r[o-1].to:e,u=o<r.length?r[o].from:t;for(let d=c,h,p,g;d<u;d++)if(p=T5[h=n.charCodeAt(d)])if(p<0){for(let m=a-3;m>=0;m-=3)if(Gs[m+1]==-p){let S=Gs[m+2],y=S&2?i:S&4?S&1?s:i:0;y&&(bt[d]=bt[Gs[m]]=y),a=m;break}}else{if(Gs.length==189)break;Gs[a++]=d,Gs[a++]=h,Gs[a++]=l}else if((g=bt[d])==2||g==1){let m=g==i;l=m?0:1;for(let S=a-3;S>=0;S-=3){let y=Gs[S+2];if(y&2)break;if(m)Gs[S+2]|=2;else{if(y&4)break;Gs[S+2]|=4}}}}}function Bwe(n,e,t,r){for(let i=0,s=r;i<=t.length;i++){let o=i?t[i-1].to:n,a=i<t.length?t[i].from:e;for(let l=o;l<a;){let c=bt[l];if(c==256){let u=l+1;for(;;)if(u==a){if(i==t.length)break;u=t[i++].to,a=i<t.length?t[i].from:e}else if(bt[u]==256)u++;else break;let d=s==1,h=(u<e?bt[u]:r)==1,p=d==h?d?1:2:r;for(let g=u,m=i,S=m?t[m-1].to:n;g>l;)g==S&&(g=t[--m].from,S=m?t[m-1].to:n),bt[--g]=p;l=u}else s=c,l++}}}function E5(n,e,t,r,i,s,o){let a=r%2?2:1;if(r%2==i%2)for(let l=e,c=0;l<t;){let u=!0,d=!1;if(c==s.length||l<s[c].from){let m=bt[l];m!=a&&(u=!1,d=m==16)}let h=!u&&a==1?[]:null,p=u?r:r+1,g=l;e:for(;;)if(c<s.length&&g==s[c].from){if(d)break e;let m=s[c];if(!u)for(let S=m.to,y=c+1;;){if(S==t)break e;if(y<s.length&&s[y].from==S)S=s[y++].to;else{if(bt[S]==a)break e;break}}if(c++,h)h.push(m);else{m.from>l&&o.push(new hl(l,m.from,p));let S=m.direction==eu!=!(p%2);I5(n,S?r+1:r,i,m.inner,m.from,m.to,o),l=m.to}g=m.to}else{if(g==t||(u?bt[g]!=a:bt[g]==a))break;g++}h?E5(n,l,g,r+1,i,h,o):l<g&&o.push(new hl(l,g,p)),l=g}else for(let l=t,c=s.length;l>e;){let u=!0,d=!1;if(!c||l>s[c-1].to){let m=bt[l-1];m!=a&&(u=!1,d=m==16)}let h=!u&&a==1?[]:null,p=u?r:r+1,g=l;e:for(;;)if(c&&g==s[c-1].to){if(d)break e;let m=s[--c];if(!u)for(let S=m.from,y=c;;){if(S==e)break e;if(y&&s[y-1].to==S)S=s[--y].from;else{if(bt[S-1]==a)break e;break}}if(h)h.push(m);else{m.to<l&&o.push(new hl(m.to,l,p));let S=m.direction==eu!=!(p%2);I5(n,S?r+1:r,i,m.inner,m.from,m.to,o),l=m.from}g=m.from}else{if(g==e||(u?bt[g-1]!=a:bt[g-1]==a))break;g--}h?E5(n,g,l,r+1,i,h,o):g<l&&o.push(new hl(g,l,p)),l=g}}function I5(n,e,t,r,i,s,o){let a=e%2?2:1;$we(n,i,s,r,a),Fwe(n,i,s,r,a),Bwe(i,s,r,a),E5(n,i,s,e,t,r,o)}function Uwe(n,e,t){if(!n)return[new hl(0,0,e==z7?1:0)];if(e==eu&&!t.length&&!Nwe.test(n))return uU(n.length);if(t.length)for(;n.length>bt.length;)bt[bt.length]=256;let r=[],i=e==eu?0:1;return I5(n,i,i,t,0,n.length,r),r}function uU(n){return[new hl(0,n,0)]}let dU="";function Hwe(n,e,t,r,i){var s;let o=r.head-n.from,a=hl.find(e,o,(s=r.bidiLevel)!==null&&s!==void 0?s:-1,r.assoc),l=e[a],c=l.side(i,t);if(o==c){let h=a+=i?1:-1;if(h<0||h>=e.length)return null;l=e[a=h],o=l.side(!i,t),c=l.side(i,t)}let u=Tr(n.text,o,l.forward(i,t));(u<l.from||u>l.to)&&(u=c),dU=n.text.slice(Math.min(o,u),Math.max(o,u));let d=a==(i?e.length-1:0)?null:e[a+(i?1:-1)];return d&&u==c&&d.level+(i?0:1)<l.level?ce.cursor(d.side(!i,t)+n.from,d.forward(i,t)?1:-1,d.level):ce.cursor(u+n.from,l.forward(i,t)?-1:1,l.level)}function Qwe(n,e,t){for(let r=e;r<t;r++){let i=lU(n.charCodeAt(r));if(i==1)return eu;if(i==2||i==4)return z7}return eu}const hU=Ie.define(),fU=Ie.define(),pU=Ie.define(),gU=Ie.define(),M5=Ie.define(),mU=Ie.define(),yU=Ie.define(),N7=Ie.define(),$7=Ie.define(),vU=Ie.define({combine:n=>n.some(e=>e)}),qwe=Ie.define({combine:n=>n.some(e=>e)}),SU=Ie.define();class md{constructor(e,t="nearest",r="nearest",i=5,s=5,o=!1){this.range=e,this.y=t,this.x=r,this.yMargin=i,this.xMargin=s,this.isSnapshot=o}map(e){return e.empty?this:new md(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new md(ce.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Xg=Ft.define({map:(n,e)=>n.map(e)}),xU=Ft.define();function po(n,e,t){let r=n.facet(gU);r.length?r[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const ra=Ie.define({combine:n=>n.length?n[0]:!0});let Wwe=0;const pf=Ie.define();class Fl{constructor(e,t,r,i,s){this.id=e,this.create=t,this.domEventHandlers=r,this.domEventObservers=i,this.extension=s(this)}static define(e,t){const{eventHandlers:r,eventObservers:i,provide:s,decorations:o}=t||{};return new Fl(Wwe++,e,r,i,a=>{let l=[pf.of(a)];return o&&l.push(Rp.of(c=>{let u=c.plugin(a);return u?o(u):on.none})),s&&l.push(s(a)),l})}static fromClass(e,t){return Fl.define(r=>new e(r),t)}}class Y2{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(r){if(po(t.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){po(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(r){po(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const wU=Ie.define(),F7=Ie.define(),Rp=Ie.define(),bU=Ie.define(),B7=Ie.define(),OU=Ie.define();function lE(n,e){let t=n.state.facet(OU);if(!t.length)return t;let r=t.map(s=>s instanceof Function?s(n):s),i=[];return gt.spans(r,e.from,e.to,{point(){},span(s,o,a,l){let c=s-e.from,u=o-e.from,d=i;for(let h=a.length-1;h>=0;h--,l--){let p=a[h].spec.bidiIsolate,g;if(p==null&&(p=Qwe(e.text,c,u)),l>0&&d.length&&(g=d[d.length-1]).to==c&&g.direction==p)g.to=u,d=g.inner;else{let m={from:c,to:u,direction:p,inner:[]};d.push(m),d=m.inner}}}}),i}const kU=Ie.define();function CU(n){let e=0,t=0,r=0,i=0;for(let s of n.state.facet(kU)){let o=s(n);o&&(o.left!=null&&(e=Math.max(e,o.left)),o.right!=null&&(t=Math.max(t,o.right)),o.top!=null&&(r=Math.max(r,o.top)),o.bottom!=null&&(i=Math.max(i,o.bottom)))}return{left:e,right:t,top:r,bottom:i}}const gf=Ie.define();class ns{constructor(e,t,r,i){this.fromA=e,this.toA=t,this.fromB=r,this.toB=i}join(e){return new ns(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,r=this;for(;t>0;t--){let i=e[t-1];if(!(i.fromA>r.toA)){if(i.toA<r.fromA)break;r=r.join(i),e.splice(t-1,1)}}return e.splice(t,0,r),e}static extendWithRanges(e,t){if(t.length==0)return e;let r=[];for(let i=0,s=0,o=0,a=0;;i++){let l=i==e.length?null:e[i],c=o-a,u=l?l.fromB:1e9;for(;s<t.length&&t[s]<u;){let d=t[s],h=t[s+1],p=Math.max(a,d),g=Math.min(u,h);if(p<=g&&new ns(p+c,g+c,p,g).addToSet(r),h>u)break;s+=2}if(!l)return r;new ns(l.fromA,l.toA,l.fromB,l.toB).addToSet(r),o=l.toA,a=l.toB}}}class $y{constructor(e,t,r){this.view=e,this.state=t,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=On.empty(this.startState.doc.length);for(let s of r)this.changes=this.changes.compose(s.changes);let i=[];this.changes.iterChangedRanges((s,o,a,l)=>i.push(new ns(s,o,a,l))),this.changedRanges=i}static create(e,t,r){return new $y(e,t,r)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class cE extends Ot{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=on.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new pn],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ns(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:c,toA:u})=>u<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let i=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?i=this.domChanged.newSel.head:!Jwe(e.changes,this.hasComposition)&&!e.selectionSet&&(i=e.state.selection.main.head));let s=i>-1?Gwe(this.view,e.changes,i):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:c,to:u}=this.hasComposition;r=new ns(c,u,e.changes.mapPos(c,-1),e.changes.mapPos(u,1)).addToSet(r.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,(xe.ie||xe.chrome)&&!s&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,a=this.updateDeco(),l=Ywe(o,a,e.changes);return r=ns.extendWithRanges(r,l),!(this.flags&7)&&r.length==0?!1:(this.updateInner(r,e.startState.doc.length,s),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,r){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,r);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=xe.chrome||xe.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||i.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof ma&&o.widget instanceof P5&&s.push(o.dom);i.updateGaps(s)}updateChildren(e,t,r){let i=r?r.range.addToSet(e.slice()):e,s=this.childCursor(t);for(let o=i.length-1;;o--){let a=o>=0?i[o]:null;if(!a)break;let{fromA:l,toA:c,fromB:u,toB:d}=a,h,p,g,m;if(r&&r.range.fromB<d&&r.range.toB>u){let O=$f.build(this.view.state.doc,u,r.range.fromB,this.decorations,this.dynamicDecorationMap),T=$f.build(this.view.state.doc,r.range.toB,d,this.decorations,this.dynamicDecorationMap);p=O.breakAtStart,g=O.openStart,m=T.openEnd;let E=this.compositionView(r);T.breakAtStart?E.breakAfter=1:T.content.length&&E.merge(E.length,E.length,T.content[0],!1,T.openStart,0)&&(E.breakAfter=T.content[0].breakAfter,T.content.shift()),O.content.length&&E.merge(0,0,O.content[O.content.length-1],!0,0,O.openEnd)&&O.content.pop(),h=O.content.concat(E).concat(T.content)}else({content:h,breakAtStart:p,openStart:g,openEnd:m}=$f.build(this.view.state.doc,u,d,this.decorations,this.dynamicDecorationMap));let{i:S,off:y}=s.findPos(c,1),{i:x,off:w}=s.findPos(l,-1);JB(this,x,w,S,y,h,p,g,m)}r&&this.fixCompositionDOM(r)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let r of t.effects)r.is(xU)&&(this.editContextFormatting=r.value)}compositionView(e){let t=new Ds(e.text.nodeValue);t.flags|=8;for(let{deco:i}of e.marks)t=new Ia(i,[t],t.length);let r=new pn;return r.append(t,0),r}fixCompositionDOM(e){let t=(s,o)=>{o.flags|=8|(o.children.some(l=>l.flags&7)?1:0),this.markedForComposition.add(o);let a=Ot.get(s);a&&a!=o&&(a.dom=null),o.setDOM(s)},r=this.childPos(e.range.fromB,1),i=this.children[r.i];t(e.line,i);for(let s=e.marks.length-1;s>=-1;s--)r=i.childPos(r.off,1),i=i.children[r.i],t(s>=0?e.marks[s].node:e.text,i)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let r=this.view.root.activeElement,i=r==this.dom,s=!i&&!(this.view.state.facet(ra)||this.dom.tabIndex>-1)&&l1(this.dom,this.view.observer.selectionRange)&&!(r&&this.dom.contains(r));if(!(i||t||s))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(a.anchor)),c=a.empty?l:this.moveToLine(this.domAtPos(a.head));if(xe.gecko&&a.empty&&!this.hasComposition&&Vwe(l)){let d=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(d,l.node.childNodes[l.offset]||null)),l=c=new pr(d,0),o=!0}let u=this.view.observer.selectionRange;(o||!u.focusNode||(!Nf(l.node,l.offset,u.anchorNode,u.anchorOffset)||!Nf(c.node,c.offset,u.focusNode,u.focusOffset))&&!this.suppressWidgetCursorChange(u,a))&&(this.view.observer.ignore(()=>{xe.android&&xe.chrome&&this.dom.contains(u.focusNode)&&Zwe(u.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let d=Ap(this.view.root);if(d)if(a.empty){if(xe.gecko){let h=Xwe(l.node,l.offset);if(h&&h!=3){let p=(h==1?KB:YB)(l.node,l.offset);p&&(l=new pr(p.node,p.offset))}}d.collapse(l.node,l.offset),a.bidiLevel!=null&&d.caretBidiLevel!==void 0&&(d.caretBidiLevel=a.bidiLevel)}else if(d.extend){d.collapse(l.node,l.offset);try{d.extend(c.node,c.offset)}catch{}}else{let h=document.createRange();a.anchor>a.head&&([l,c]=[c,l]),h.setEnd(c.node,c.offset),h.setStart(l.node,l.offset),d.removeAllRanges(),d.addRange(h)}s&&this.view.root.activeElement==this.dom&&(this.dom.blur(),r&&r.focus())}),this.view.observer.setSelectionRange(l,c)),this.impreciseAnchor=l.precise?null:new pr(u.anchorNode,u.anchorOffset),this.impreciseHead=c.precise?null:new pr(u.focusNode,u.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&Nf(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,r=Ap(e.root),{anchorNode:i,anchorOffset:s}=e.observer.selectionRange;if(!r||!t.empty||!t.assoc||!r.modify)return;let o=pn.find(this,t.head);if(!o)return;let a=o.posAtStart;if(t.head==a||t.head==a+o.length)return;let l=this.coordsAt(t.head,-1),c=this.coordsAt(t.head,1);if(!l||!c||l.bottom>c.top)return;let u=this.domAtPos(t.head+t.assoc);r.collapse(u.node,u.offset),r.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let d=e.observer.selectionRange;e.docView.posFromDOM(d.anchorNode,d.anchorOffset)!=t.from&&r.collapse(i,s)}moveToLine(e){let t=this.dom,r;if(e.node!=t)return e;for(let i=e.offset;!r&&i<t.childNodes.length;i++){let s=Ot.get(t.childNodes[i]);s instanceof pn&&(r=s.domAtPos(0))}for(let i=e.offset-1;!r&&i>=0;i--){let s=Ot.get(t.childNodes[i]);s instanceof pn&&(r=s.domAtPos(s.length))}return r?new pr(r.node,r.offset,!0):e}nearest(e){for(let t=e;t;){let r=Ot.get(t);if(r&&r.rootView==this)return r;t=t.parentNode}return null}posFromDOM(e,t){let r=this.nearest(e);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(e,t)+r.posAtStart}domAtPos(e){let{i:t,off:r}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let i=this.children[t];if(r<i.length||i instanceof pn)break;t++,r=0}return this.children[t].domAtPos(r)}coordsAt(e,t){let r=null,i=0;for(let s=this.length,o=this.children.length-1;o>=0;o--){let a=this.children[o],l=s-a.breakAfter,c=l-a.length;if(l<e)break;if(c<=e&&(c<e||a.covers(-1))&&(l>e||a.covers(1))&&(!r||a instanceof pn&&!(r instanceof pn&&t>=0)))r=a,i=c;else if(r&&c==e&&l==e&&a instanceof ma&&Math.abs(t)<2){if(a.deco.startSide<0)break;o&&(r=null)}s=c}return r?r.coordsAt(e-i,t):null}coordsForChar(e){let{i:t,off:r}=this.childPos(e,1),i=this.children[t];if(!(i instanceof pn))return null;for(;i.children.length;){let{i:a,off:l}=i.childPos(r,1);for(;;a++){if(a==i.children.length)return null;if((i=i.children[a]).length)break}r=l}if(!(i instanceof Ds))return null;let s=Tr(i.text,r);if(s==r)return null;let o=Jc(i.dom,r,s).getClientRects();for(let a=0;a<o.length;a++){let l=o[a];if(a==o.length-1||l.top<l.bottom&&l.left<l.right)return l}return null}measureVisibleLineHeights(e){let t=[],{from:r,to:i}=e,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==Pn.LTR;for(let c=0,u=0;u<this.children.length;u++){let d=this.children[u],h=c+d.length;if(h>i)break;if(c>=r){let p=d.dom.getBoundingClientRect();if(t.push(p.height),o){let g=d.dom.lastChild,m=g?_p(g):[];if(m.length){let S=m[m.length-1],y=l?S.right-p.left:p.right-S.left;y>a&&(a=y,this.minWidth=s,this.minWidthFrom=c,this.minWidthTo=h)}}}c=h+d.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?Pn.RTL:Pn.LTR}measureTextSize(){for(let s of this.children)if(s instanceof pn){let o=s.measureTextSize();if(o)return o}let e=document.createElement("div"),t,r,i;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let s=_p(e.firstChild)[0];t=e.getBoundingClientRect().height,r=s?s.width/27:7,i=s?s.height:t,e.remove()}),{lineHeight:t,charWidth:r,textHeight:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new ZB(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let r=0,i=0;;i++){let s=i==t.viewports.length?null:t.viewports[i],o=s?s.from-1:this.length;if(o>r){let a=(t.lineBlockAt(o).bottom-t.lineBlockAt(r).top)/this.view.scaleY;e.push(on.replace({widget:new P5(a),block:!0,inclusive:!0,isBlockGap:!0}).range(r,o))}if(!s)break;r=s.to+1}return on.set(e)}updateDeco(){let e=1,t=this.view.state.facet(Rp).map(s=>(this.dynamicDecorationMap[e++]=typeof s=="function")?s(this.view):s),r=!1,i=this.view.state.facet(bU).map((s,o)=>{let a=typeof s=="function";return a&&(r=!0),a?s(this.view):s});for(i.length&&(this.dynamicDecorationMap[e++]=r,t.push(gt.join(i))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let c of this.view.state.facet(SU))try{if(c(this.view,e.range,e))return!0}catch(u){po(this.view.state,u,"scroll handler")}let{range:t}=e,r=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),i;if(!r)return;!t.empty&&(i=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(r={left:Math.min(r.left,i.left),top:Math.min(r.top,i.top),right:Math.max(r.right,i.right),bottom:Math.max(r.bottom,i.bottom)});let s=CU(this.view),o={left:r.left-s.left,top:r.top-s.top,right:r.right+s.right,bottom:r.bottom+s.bottom},{offsetWidth:a,offsetHeight:l}=this.view.scrollDOM;Cwe(this.view.scrollDOM,o,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,a),-a),Math.max(Math.min(e.yMargin,l),-l),this.view.textDirection==Pn.LTR)}}function Vwe(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}function PU(n,e){let t=n.observer.selectionRange;if(!t.focusNode)return null;let r=KB(t.focusNode,t.focusOffset),i=YB(t.focusNode,t.focusOffset),s=r||i;if(i&&r&&i.node!=r.node){let a=Ot.get(i.node);if(!a||a instanceof Ds&&a.text!=i.node.nodeValue)s=i;else if(n.docView.lastCompositionAfterCursor){let l=Ot.get(r.node);!l||l instanceof Ds&&l.text!=r.node.nodeValue||(s=i)}}if(n.docView.lastCompositionAfterCursor=s!=r,!s)return null;let o=e-s.offset;return{from:o,to:o+s.node.nodeValue.length,node:s.node}}function Gwe(n,e,t){let r=PU(n,t);if(!r)return null;let{node:i,from:s,to:o}=r,a=i.nodeValue;if(/[\n\r]/.test(a)||n.state.doc.sliceString(r.from,r.to)!=a)return null;let l=e.invertedDesc,c=new ns(l.mapPos(s),l.mapPos(o),s,o),u=[];for(let d=i.parentNode;;d=d.parentNode){let h=Ot.get(d);if(h instanceof Ia)u.push({node:d,deco:h.mark});else{if(h instanceof pn||d.nodeName=="DIV"&&d.parentNode==n.contentDOM)return{range:c,text:i,marks:u,line:d};if(d!=n.contentDOM)u.push({node:d,deco:new y0({inclusive:!0,attributes:Dwe(d),tagName:d.tagName.toLowerCase()})});else return null}}}function Xwe(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}let Kwe=class{constructor(){this.changes=[]}compareRange(e,t){c1(e,t,this.changes)}comparePoint(e,t){c1(e,t,this.changes)}boundChange(e){c1(e,e,this.changes)}};function Ywe(n,e,t){let r=new Kwe;return gt.compare(n,e,t,r),r.changes}function Zwe(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function Jwe(n,e){let t=!1;return e&&n.iterChangedRanges((r,i)=>{r<e.to&&i>e.from&&(t=!0)}),t}function ebe(n,e,t=1){let r=n.charCategorizer(e),i=n.doc.lineAt(e),s=e-i.from;if(i.length==0)return ce.cursor(e);s==0?t=1:s==i.length&&(t=-1);let o=s,a=s;t<0?o=Tr(i.text,s,!1):a=Tr(i.text,s);let l=r(i.text.slice(o,a));for(;o>0;){let c=Tr(i.text,o,!1);if(r(i.text.slice(c,o))!=l)break;o=c}for(;a<i.length;){let c=Tr(i.text,a);if(r(i.text.slice(a,c))!=l)break;a=c}return ce.range(o+i.from,a+i.from)}function tbe(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function nbe(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function Z2(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function uE(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function dE(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function A5(n,e,t){let r,i,s,o,a=!1,l,c,u,d;for(let g=n.firstChild;g;g=g.nextSibling){let m=_p(g);for(let S=0;S<m.length;S++){let y=m[S];i&&Z2(i,y)&&(y=uE(dE(y,i.bottom),i.top));let x=tbe(e,y),w=nbe(t,y);if(x==0&&w==0)return g.nodeType==3?hE(g,e,t):A5(g,e,t);if(!r||o>w||o==w&&s>x){r=g,i=y,s=x,o=w;let O=w?t<y.top?-1:1:x?e<y.left?-1:1:0;a=!O||(O>0?S<m.length-1:S>0)}x==0?t>y.bottom&&(!u||u.bottom<y.bottom)?(l=g,u=y):t<y.top&&(!d||d.top>y.top)&&(c=g,d=y):u&&Z2(u,y)?u=dE(u,y.bottom):d&&Z2(d,y)&&(d=uE(d,y.top))}}if(u&&u.bottom>=t?(r=l,i=u):d&&d.top<=t&&(r=c,i=d),!r)return{node:n,offset:0};let h=Math.max(i.left,Math.min(i.right,e));if(r.nodeType==3)return hE(r,h,t);if(a&&r.contentEditable!="false")return A5(r,h,t);let p=Array.prototype.indexOf.call(n.childNodes,r)+(e>=(i.left+i.right)/2?1:0);return{node:n,offset:p}}function hE(n,e,t){let r=n.nodeValue.length,i=-1,s=1e9,o=0;for(let a=0;a<r;a++){let l=Jc(n,a,a+1).getClientRects();for(let c=0;c<l.length;c++){let u=l[c];if(u.top==u.bottom)continue;o||(o=e-u.left);let d=(u.top>t?u.top-t:t-u.bottom)-1;if(u.left-1<=e&&u.right+1>=e&&d<s){let h=e>=(u.left+u.right)/2,p=h;if((xe.chrome||xe.gecko)&&Jc(n,a).getBoundingClientRect().left==u.right&&(p=!h),d<=0)return{node:n,offset:a+(p?1:0)};i=a+(p?1:0),s=d}}}return{node:n,offset:i>-1?i:o>0?n.nodeValue.length:0}}function TU(n,e,t,r=-1){var i,s;let o=n.contentDOM.getBoundingClientRect(),a=o.top+n.viewState.paddingTop,l,{docHeight:c}=n.viewState,{x:u,y:d}=e,h=d-a;if(h<0)return 0;if(h>c)return n.state.doc.length;for(let O=n.viewState.heightOracle.textHeight/2,T=!1;l=n.elementAtHeight(h),l.type!=ts.Text;)for(;h=r>0?l.bottom+O:l.top-O,!(h>=0&&h<=c);){if(T)return t?null:0;T=!0,r=-r}d=a+h;let p=l.from;if(p<n.viewport.from)return n.viewport.from==0?0:t?null:fE(n,o,l,u,d);if(p>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:t?null:fE(n,o,l,u,d);let g=n.dom.ownerDocument,m=n.root.elementFromPoint?n.root:g,S=m.elementFromPoint(u,d);S&&!n.contentDOM.contains(S)&&(S=null),S||(u=Math.max(o.left+1,Math.min(o.right-1,u)),S=m.elementFromPoint(u,d),S&&!n.contentDOM.contains(S)&&(S=null));let y,x=-1;if(S&&((i=n.docView.nearest(S))===null||i===void 0?void 0:i.isEditable)!=!1){if(g.caretPositionFromPoint){let O=g.caretPositionFromPoint(u,d);O&&({offsetNode:y,offset:x}=O)}else if(g.caretRangeFromPoint){let O=g.caretRangeFromPoint(u,d);O&&({startContainer:y,startOffset:x}=O,(!n.contentDOM.contains(y)||xe.safari&&rbe(y,x,u)||xe.chrome&&ibe(y,x,u))&&(y=void 0))}y&&(x=Math.min(Mo(y),x))}if(!y||!n.docView.dom.contains(y)){let O=pn.find(n.docView,p);if(!O)return h>l.top+l.height/2?l.to:l.from;({node:y,offset:x}=A5(O.dom,u,d))}let w=n.docView.nearest(y);if(!w)return null;if(w.isWidget&&((s=w.dom)===null||s===void 0?void 0:s.nodeType)==1){let O=w.dom.getBoundingClientRect();return e.y<O.top||e.y<=O.bottom&&e.x<=(O.left+O.right)/2?w.posAtStart:w.posAtEnd}else return w.localPosFromDOM(y,x)+w.posAtStart}function fE(n,e,t,r,i){let s=Math.round((r-e.left)*n.defaultCharacterWidth);if(n.lineWrapping&&t.height>n.defaultLineHeight*1.5){let a=n.viewState.heightOracle.textHeight,l=Math.floor((i-t.top-(n.defaultLineHeight-a)*.5)/a);s+=l*n.viewState.heightOracle.lineLength}let o=n.state.sliceDoc(t.from,t.to);return t.from+Swe(o,s,n.state.tabSize)}function rbe(n,e,t){let r;if(n.nodeType!=3||e!=(r=n.nodeValue.length))return!1;for(let i=n.nextSibling;i;i=i.nextSibling)if(i.nodeType!=1||i.nodeName!="BR")return!1;return Jc(n,r-1,r).getBoundingClientRect().left>t}function ibe(n,e,t){if(e!=0)return!1;for(let i=n;;){let s=i.parentNode;if(!s||s.nodeType!=1||s.firstChild!=i)return!1;if(s.classList.contains("cm-line"))break;i=s}let r=n.nodeType==1?n.getBoundingClientRect():Jc(n,0,Math.max(n.nodeValue.length,1)).getBoundingClientRect();return t-r.left>5}function sbe(n,e){let t=n.lineBlockAt(e);if(Array.isArray(t.type)){for(let r of t.type)if(r.to>e||r.to==e&&(r.to==t.to||r.type==ts.Text))return r}return t}function obe(n,e,t,r){let i=sbe(n,e.head),s=!r||i.type!=ts.Text||!(n.lineWrapping||i.widgetLineBreaks)?null:n.coordsAtPos(e.assoc<0&&e.head>i.from?e.head-1:e.head);if(s){let o=n.dom.getBoundingClientRect(),a=n.textDirectionAt(i.from),l=n.posAtCoords({x:t==(a==Pn.LTR)?o.right-1:o.left+1,y:(s.top+s.bottom)/2});if(l!=null)return ce.cursor(l,t?-1:1)}return ce.cursor(t?i.to:i.from,t?-1:1)}function pE(n,e,t,r){let i=n.state.doc.lineAt(e.head),s=n.bidiSpans(i),o=n.textDirectionAt(i.from);for(let a=e,l=null;;){let c=Hwe(i,s,o,a,t),u=dU;if(!c){if(i.number==(t?n.state.doc.lines:1))return a;u=`
`,i=n.state.doc.line(i.number+(t?1:-1)),s=n.bidiSpans(i),c=n.visualLineSide(i,!t)}if(l){if(!l(u))return a}else{if(!r)return c;l=r(u)}a=c}}function abe(n,e,t){let r=n.state.charCategorizer(e),i=r(t);return s=>{let o=r(s);return i==la.Space&&(i=o),i==o}}function lbe(n,e,t,r){let i=e.head,s=t?1:-1;if(i==(t?n.state.doc.length:0))return ce.cursor(i,e.assoc);let o=e.goalColumn,a,l=n.contentDOM.getBoundingClientRect(),c=n.coordsAtPos(i,e.assoc||-1),u=n.documentTop;if(c)o==null&&(o=c.left-l.left),a=s<0?c.top:c.bottom;else{let p=n.viewState.lineBlockAt(i);o==null&&(o=Math.min(l.right-l.left,n.defaultCharacterWidth*(i-p.from))),a=(s<0?p.top:p.bottom)+u}let d=l.left+o,h=r??n.viewState.heightOracle.textHeight>>1;for(let p=0;;p+=10){let g=a+(h+p)*s,m=TU(n,{x:d,y:g},!1,s);if(g<l.top||g>l.bottom||(s<0?m<i:m>i)){let S=n.docView.coordsForChar(m),y=!S||g<S.top?-1:1;return ce.cursor(m,y,void 0,o)}}}function u1(n,e,t){for(;;){let r=0;for(let i of n)i.between(e-1,e+1,(s,o,a)=>{if(e>s&&e<o){let l=r||t||(e-s<o-e?-1:1);e=l<0?s:o,r=l}});if(!r)return e}}function J2(n,e,t){let r=u1(n.state.facet(B7).map(i=>i(n)),t.from,e.head>t.from?-1:1);return r==t.from?t:ce.cursor(r,r<t.from?1:-1)}const mf="";class cbe{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(ft.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=mf}readRange(e,t){if(!e)return this;let r=e.parentNode;for(let i=e;;){this.findPointBefore(r,i);let s=this.text.length;this.readNode(i);let o=i.nextSibling;if(o==t)break;let a=Ot.get(i),l=Ot.get(o);(a&&l?a.breakAfter:(a?a.breakAfter:zy(i))||zy(o)&&(i.nodeName!="BR"||i.cmIgnore)&&this.text.length>s)&&this.lineBreak(),i=o}return this.findPointBefore(r,t),this}readTextNode(e){let t=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,t.length));for(let r=0,i=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,a;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,r),o=this.lineSeparator.length):(a=i.exec(t))&&(s=a.index,o=a[0].length),this.append(t.slice(r,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let l of this.points)l.node==e&&l.pos>this.text.length&&(l.pos-=o-1);r=s+o}}readNode(e){if(e.cmIgnore)return;let t=Ot.get(e),r=t&&t.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let i=r.iter();!i.next().done;)i.lineBreak?this.lineBreak():this.append(i.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==t&&(r.pos=this.text.length)}findPointInside(e,t){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+(ube(e,r.node,r.offset)?t:0))}}function ube(n,e,t){for(;;){if(!e||t<Mo(e))return!1;if(e==n)return!0;t=Zc(e)+1,e=e.parentNode}}class gE{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class dbe{constructor(e,t,r,i){this.typeOver=i,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:s,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,r,0))){let a=s||o?[]:pbe(e),l=new cbe(a,e.state);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=gbe(a,this.bounds.from)}else{let a=e.observer.selectionRange,l=s&&s.node==a.focusNode&&s.offset==a.focusOffset||!x5(e.contentDOM,a.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(a.focusNode,a.focusOffset),c=o&&o.node==a.anchorNode&&o.offset==a.anchorOffset||!x5(e.contentDOM,a.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(a.anchorNode,a.anchorOffset),u=e.viewport;if((xe.ios||xe.chrome)&&e.state.selection.main.empty&&l!=c&&(u.from>0||u.to<e.state.doc.length)){let d=Math.min(l,c),h=Math.max(l,c),p=u.from-d,g=u.to-h;(p==0||p==1||d==0)&&(g==0||g==-1||h==e.state.doc.length)&&(l=0,c=e.state.doc.length)}this.newSel=ce.single(c,l)}}}function EU(n,e){let t,{newSel:r}=e,i=n.state.selection.main,s=n.inputState.lastKeyTime>Date.now()-100?n.inputState.lastKeyCode:-1;if(e.bounds){let{from:o,to:a}=e.bounds,l=i.from,c=null;(s===8||xe.android&&e.text.length<a-o)&&(l=i.to,c="end");let u=fbe(n.state.doc.sliceString(o,a,mf),e.text,l-o,c);u&&(xe.chrome&&s==13&&u.toB==u.from+2&&e.text.slice(u.from,u.toB)==mf+mf&&u.toB--,t={from:o+u.from,to:o+u.toA,insert:rt.of(e.text.slice(u.from,u.toB).split(mf))})}else r&&(!n.hasFocus&&n.state.facet(ra)||r.main.eq(i))&&(r=null);if(!t&&!r)return!1;if(!t&&e.typeOver&&!i.empty&&r&&r.main.empty?t={from:i.from,to:i.to,insert:n.state.doc.slice(i.from,i.to)}:(xe.mac||xe.android)&&t&&t.from==t.to&&t.from==i.head-1&&/^\. ?$/.test(t.insert.toString())&&n.contentDOM.getAttribute("autocorrect")=="off"?(r&&t.insert.length==2&&(r=ce.single(r.main.anchor-1,r.main.head-1)),t={from:t.from,to:t.to,insert:rt.of([t.insert.toString().replace("."," ")])}):t&&t.from>=i.from&&t.to<=i.to&&(t.from!=i.from||t.to!=i.to)&&i.to-i.from-(t.to-t.from)<=4?t={from:i.from,to:i.to,insert:n.state.doc.slice(i.from,t.from).append(t.insert).append(n.state.doc.slice(t.to,i.to))}:xe.chrome&&t&&t.from==t.to&&t.from==i.head&&t.insert.toString()==`
 `&&n.lineWrapping&&(r&&(r=ce.single(r.main.anchor-1,r.main.head-1)),t={from:i.from,to:i.to,insert:rt.of([" "])}),t)return U7(n,t,r,s);if(r&&!r.main.eq(i)){let o=!1,a="select";return n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(o=!0),a=n.inputState.lastSelectionOrigin),n.dispatch({selection:r,scrollIntoView:o,userEvent:a}),!0}else return!1}function U7(n,e,t,r=-1){if(xe.ios&&n.inputState.flushIOSKey(e))return!0;let i=n.state.selection.main;if(xe.android&&(e.to==i.to&&(e.from==i.from||e.from==i.from-1&&n.state.sliceDoc(e.from,i.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&gd(n.contentDOM,"Enter",13)||(e.from==i.from-1&&e.to==i.to&&e.insert.length==0||r==8&&e.insert.length<e.to-e.from&&e.to>i.head)&&gd(n.contentDOM,"Backspace",8)||e.from==i.from&&e.to==i.to+1&&e.insert.length==0&&gd(n.contentDOM,"Delete",46)))return!0;let s=e.insert.toString();n.inputState.composing>=0&&n.inputState.composing++;let o,a=()=>o||(o=hbe(n,e,t));return n.state.facet(mU).some(l=>l(n,e.from,e.to,s,a))||n.dispatch(a()),!0}function hbe(n,e,t){let r,i=n.state,s=i.selection.main;if(e.from>=s.from&&e.to<=s.to&&e.to-e.from>=(s.to-s.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&n.inputState.composing<0){let a=s.from<e.from?i.sliceDoc(s.from,e.from):"",l=s.to>e.to?i.sliceDoc(e.to,s.to):"";r=i.replaceSelection(n.state.toText(a+e.insert.sliceString(0,void 0,n.state.lineBreak)+l))}else{let a=i.changes(e),l=t&&t.main.to<=a.newLength?t.main:void 0;if(i.selection.ranges.length>1&&n.inputState.composing>=0&&e.to<=s.to&&e.to>=s.to-10){let c=n.state.sliceDoc(e.from,e.to),u,d=t&&PU(n,t.main.head);if(d){let g=e.insert.length-(e.to-e.from);u={from:d.from,to:d.to-g}}else u=n.state.doc.lineAt(s.head);let h=s.to-e.to,p=s.to-s.from;r=i.changeByRange(g=>{if(g.from==s.from&&g.to==s.to)return{changes:a,range:l||g.map(a)};let m=g.to-h,S=m-c.length;if(g.to-g.from!=p||n.state.sliceDoc(S,m)!=c||g.to>=u.from&&g.from<=u.to)return{range:g};let y=i.changes({from:S,to:m,insert:e.insert}),x=g.to-s.to;return{changes:y,range:l?ce.range(Math.max(0,l.anchor+x),Math.max(0,l.head+x)):g.map(y)}})}else r={changes:a,selection:l&&i.selection.replaceRange(l)}}let o="input.type";return(n.composing||n.inputState.compositionPendingChange&&n.inputState.compositionEndedAt>Date.now()-50)&&(n.inputState.compositionPendingChange=!1,o+=".compose",n.inputState.compositionFirstChange&&(o+=".start",n.inputState.compositionFirstChange=!1)),i.update(r,{userEvent:o,scrollIntoView:!0})}function fbe(n,e,t,r){let i=Math.min(n.length,e.length),s=0;for(;s<i&&n.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==i&&n.length==e.length)return null;let o=n.length,a=e.length;for(;o>0&&a>0&&n.charCodeAt(o-1)==e.charCodeAt(a-1);)o--,a--;if(r=="end"){let l=Math.max(0,s-Math.min(o,a));t-=o+l-s}if(o<s&&n.length<e.length){let l=t<=s&&t>=o?s-t:0;s-=l,a=s+(a-o),o=s}else if(a<s){let l=t<=s&&t>=a?s-t:0;s-=l,o=s+(o-a),a=s}return{from:s,toA:o,toB:a}}function pbe(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:r,focusNode:i,focusOffset:s}=n.observer.selectionRange;return t&&(e.push(new gE(t,r)),(i!=t||s!=r)&&e.push(new gE(i,s))),e}function gbe(n,e){if(n.length==0)return null;let t=n[0].pos,r=n.length==2?n[1].pos:t;return t>-1&&r>-1?ce.single(t+e,r+e):null}class mbe{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,xe.safari&&e.contentDOM.addEventListener("input",()=>null),xe.gecko&&_be(e.contentDOM.ownerDocument)}handleEvent(e){!kbe(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,t){let r=this.handlers[e];if(r){for(let i of r.observers)i(this.view,t);for(let i of r.handlers){if(t.defaultPrevented)break;if(i(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=ybe(e),r=this.handlers,i=this.view.contentDOM;for(let s in t)if(s!="scroll"){let o=!t[s].handlers.length,a=r[s];a&&o!=!a.handlers.length&&(i.removeEventListener(s,this.handleEvent),a=null),a||i.addEventListener(s,this.handleEvent,{passive:o})}for(let s in r)s!="scroll"&&!t[s]&&i.removeEventListener(s,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&MU.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),xe.android&&xe.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return xe.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=IU.find(r=>r.keyCode==e.keyCode))&&!e.ctrlKey||vbe.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,gd(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:xe.safari&&!xe.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function mE(n,e){return(t,r)=>{try{return e.call(n,r,t)}catch(i){po(t.state,i)}}}function ybe(n){let e=Object.create(null);function t(r){return e[r]||(e[r]={observers:[],handlers:[]})}for(let r of n){let i=r.spec;if(i&&i.domEventHandlers)for(let s in i.domEventHandlers){let o=i.domEventHandlers[s];o&&t(s).handlers.push(mE(r.value,o))}if(i&&i.domEventObservers)for(let s in i.domEventObservers){let o=i.domEventObservers[s];o&&t(s).observers.push(mE(r.value,o))}}for(let r in js)t(r).handlers.push(js[r]);for(let r in ls)t(r).observers.push(ls[r]);return e}const IU=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],vbe="dthko",MU=[16,17,18,20,91,92,224,225],Kg=6;function Yg(n){return Math.max(0,n)*.7+8}function Sbe(n,e){return Math.max(Math.abs(n.clientX-e.clientX),Math.abs(n.clientY-e.clientY))}class xbe{constructor(e,t,r,i){this.view=e,this.startEvent=t,this.style=r,this.mustSelect=i,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=Pwe(e.contentDOM),this.atoms=e.state.facet(B7).map(o=>o(e));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(ft.allowMultipleSelections)&&wbe(e,t),this.dragging=Obe(e,t)&&RU(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&Sbe(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,r=0,i=0,s=0,o=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:i,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:s,bottom:a}=this.scrollParents.y.getBoundingClientRect());let l=CU(this.view);e.clientX-l.left<=i+Kg?t=-Yg(i-e.clientX):e.clientX+l.right>=o-Kg&&(t=Yg(e.clientX-o)),e.clientY-l.top<=s+Kg?r=-Yg(s-e.clientY):e.clientY+l.bottom>=a-Kg&&(r=Yg(e.clientY-a)),this.setScrollSpeed(t,r)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let r=0;r<e.ranges.length;r++){let i=e.ranges[r],s=null;if(i.empty){let o=u1(this.atoms,i.from,0);o!=i.from&&(s=ce.cursor(o,-1))}else{let o=u1(this.atoms,i.from,-1),a=u1(this.atoms,i.to,1);(o!=i.from||a!=i.to)&&(s=ce.range(i.from==i.anchor?o:a,i.from==i.head?o:a))}s&&(t||(t=e.ranges.slice()),t[r]=s)}return t?ce.create(t,e.mainIndex):e}select(e){let{view:t}=this,r=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!r.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:r,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function wbe(n,e){let t=n.state.facet(hU);return t.length?t[0](e):xe.mac?e.metaKey:e.ctrlKey}function bbe(n,e){let t=n.state.facet(fU);return t.length?t[0](e):xe.mac?!e.altKey:!e.ctrlKey}function Obe(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let r=Ap(n.root);if(!r||r.rangeCount==0)return!0;let i=r.getRangeAt(0).getClientRects();for(let s=0;s<i.length;s++){let o=i[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function kbe(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,r;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(r=Ot.get(t))&&r.ignoreEvent(e))return!1;return!0}const js=Object.create(null),ls=Object.create(null),AU=xe.ie&&xe.ie_version<15||xe.ios&&xe.webkit_version<604;function Cbe(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),_U(n,t.value)},50)}function ES(n,e,t){for(let r of n.facet(e))t=r(t,n);return t}function _U(n,e){e=ES(n.state,N7,e);let{state:t}=n,r,i=1,s=t.toText(e),o=s.lines==t.selection.ranges.length;if(_5!=null&&t.selection.ranges.every(l=>l.empty)&&_5==s.toString()){let l=-1;r=t.changeByRange(c=>{let u=t.doc.lineAt(c.from);if(u.from==l)return{range:c};l=u.from;let d=t.toText((o?s.line(i++).text:e)+t.lineBreak);return{changes:{from:u.from,insert:d},range:ce.cursor(c.from+d.length)}})}else o?r=t.changeByRange(l=>{let c=s.line(i++);return{changes:{from:l.from,to:l.to,insert:c.text},range:ce.cursor(l.from+c.length)}}):r=t.replaceSelection(s);n.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}ls.scroll=n=>{n.inputState.lastScrollTop=n.scrollDOM.scrollTop,n.inputState.lastScrollLeft=n.scrollDOM.scrollLeft};js.keydown=(n,e)=>(n.inputState.setSelectionOrigin("select"),e.keyCode==27&&n.inputState.tabFocusMode!=0&&(n.inputState.tabFocusMode=Date.now()+2e3),!1);ls.touchstart=(n,e)=>{n.inputState.lastTouchTime=Date.now(),n.inputState.setSelectionOrigin("select.pointer")};ls.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")};js.mousedown=(n,e)=>{if(n.observer.flush(),n.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let r of n.state.facet(pU))if(t=r(n,e),t)break;if(!t&&e.button==0&&(t=Ebe(n,e)),t){let r=!n.hasFocus;n.inputState.startMouseSelection(new xbe(n,e,t,r)),r&&n.observer.ignore(()=>{VB(n.contentDOM);let s=n.root.activeElement;s&&!s.contains(n.contentDOM)&&s.blur()});let i=n.inputState.mouseSelection;if(i)return i.start(e),i.dragging===!1}return!1};function yE(n,e,t,r){if(r==1)return ce.cursor(e,t);if(r==2)return ebe(n.state,e,t);{let i=pn.find(n.docView,e),s=n.state.doc.lineAt(i?i.posAtEnd:e),o=i?i.posAtStart:s.from,a=i?i.posAtEnd:s.to;return a<n.state.doc.length&&a==s.to&&a++,ce.range(o,a)}}let vE=(n,e,t)=>e>=t.top&&e<=t.bottom&&n>=t.left&&n<=t.right;function Pbe(n,e,t,r){let i=pn.find(n.docView,e);if(!i)return 1;let s=e-i.posAtStart;if(s==0)return 1;if(s==i.length)return-1;let o=i.coordsAt(s,-1);if(o&&vE(t,r,o))return-1;let a=i.coordsAt(s,1);return a&&vE(t,r,a)?1:o&&o.bottom>=r?-1:1}function SE(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:Pbe(n,t,e.clientX,e.clientY)}}const Tbe=xe.ie&&xe.ie_version<=11;let xE=null,wE=0,bE=0;function RU(n){if(!Tbe)return n.detail;let e=xE,t=bE;return xE=n,bE=Date.now(),wE=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(wE+1)%3:1}function Ebe(n,e){let t=SE(n,e),r=RU(e),i=n.state.selection;return{update(s){s.docChanged&&(t.pos=s.changes.mapPos(t.pos),i=i.map(s.changes))},get(s,o,a){let l=SE(n,s),c,u=yE(n,l.pos,l.bias,r);if(t.pos!=l.pos&&!o){let d=yE(n,t.pos,t.bias,r),h=Math.min(d.from,u.from),p=Math.max(d.to,u.to);u=h<u.from?ce.range(h,p):ce.range(p,h)}return o?i.replaceRange(i.main.extend(u.from,u.to)):a&&r==1&&i.ranges.length>1&&(c=Ibe(i,l.pos))?c:a?i.addRange(u):ce.create([u])}}}function Ibe(n,e){for(let t=0;t<n.ranges.length;t++){let{from:r,to:i}=n.ranges[t];if(r<=e&&i>=e)return ce.create(n.ranges.slice(0,t).concat(n.ranges.slice(t+1)),n.mainIndex==t?0:n.mainIndex-(n.mainIndex>t?1:0))}return null}js.dragstart=(n,e)=>{let{selection:{main:t}}=n.state;if(e.target.draggable){let i=n.docView.nearest(e.target);if(i&&i.isWidget){let s=i.posAtStart,o=s+i.length;(s>=t.to||o<=t.from)&&(t=ce.range(s,o))}}let{inputState:r}=n;return r.mouseSelection&&(r.mouseSelection.dragging=!0),r.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",ES(n.state,$7,n.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};js.dragend=n=>(n.inputState.draggedContent=null,!1);function OE(n,e,t,r){if(t=ES(n.state,N7,t),!t)return;let i=n.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:s}=n.inputState,o=r&&s&&bbe(n,e)?{from:s.from,to:s.to}:null,a={from:i,insert:t},l=n.state.changes(o?[o,a]:a);n.focus(),n.dispatch({changes:l,selection:{anchor:l.mapPos(i,-1),head:l.mapPos(i,1)},userEvent:o?"move.drop":"input.drop"}),n.inputState.draggedContent=null}js.drop=(n,e)=>{if(!e.dataTransfer)return!1;if(n.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let r=Array(t.length),i=0,s=()=>{++i==t.length&&OE(n,e,r.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let a=new FileReader;a.onerror=s,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(r[o]=a.result),s()},a.readAsText(t[o])}return!0}else{let r=e.dataTransfer.getData("Text");if(r)return OE(n,e,r,!0),!0}return!1};js.paste=(n,e)=>{if(n.state.readOnly)return!0;n.observer.flush();let t=AU?null:e.clipboardData;return t?(_U(n,t.getData("text/plain")||t.getData("text/uri-list")),!0):(Cbe(n),!1)};function Mbe(n,e){let t=n.dom.parentNode;if(!t)return;let r=t.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),n.focus()},50)}function Abe(n){let e=[],t=[],r=!1;for(let i of n.selection.ranges)i.empty||(e.push(n.sliceDoc(i.from,i.to)),t.push(i));if(!e.length){let i=-1;for(let{from:s}of n.selection.ranges){let o=n.doc.lineAt(s);o.number>i&&(e.push(o.text),t.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),i=o.number}r=!0}return{text:ES(n,$7,e.join(n.lineBreak)),ranges:t,linewise:r}}let _5=null;js.copy=js.cut=(n,e)=>{let{text:t,ranges:r,linewise:i}=Abe(n.state);if(!t&&!i)return!1;_5=i?t:null,e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:r,scrollIntoView:!0,userEvent:"delete.cut"});let s=AU?null:e.clipboardData;return s?(s.clearData(),s.setData("text/plain",t),!0):(Mbe(n,t),!1)};const DU=zo.define();function jU(n,e){let t=[];for(let r of n.facet(yU)){let i=r(n,e);i&&t.push(i)}return t?n.update({effects:t,annotations:DU.of(!0)}):null}function LU(n){setTimeout(()=>{let e=n.hasFocus;if(e!=n.inputState.notifiedFocused){let t=jU(n.state,e);t?n.dispatch(t):n.update([])}},10)}ls.focus=n=>{n.inputState.lastFocusTime=Date.now(),!n.scrollDOM.scrollTop&&(n.inputState.lastScrollTop||n.inputState.lastScrollLeft)&&(n.scrollDOM.scrollTop=n.inputState.lastScrollTop,n.scrollDOM.scrollLeft=n.inputState.lastScrollLeft),LU(n)};ls.blur=n=>{n.observer.clearSelectionRange(),LU(n)};ls.compositionstart=ls.compositionupdate=n=>{n.observer.editContext||(n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0))};ls.compositionend=n=>{n.observer.editContext||(n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionPendingKey=!0,n.inputState.compositionPendingChange=n.observer.pendingRecords().length>0,n.inputState.compositionFirstChange=null,xe.chrome&&xe.android?n.observer.flushSoon():n.inputState.compositionPendingChange?Promise.resolve().then(()=>n.observer.flush()):setTimeout(()=>{n.inputState.composing<0&&n.docView.hasComposition&&n.update([])},50))};ls.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()};js.beforeinput=(n,e)=>{var t,r;if(e.inputType=="insertReplacementText"&&n.observer.editContext){let s=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),o=e.getTargetRanges();if(s&&o.length){let a=o[0],l=n.posAtDOM(a.startContainer,a.startOffset),c=n.posAtDOM(a.endContainer,a.endOffset);return U7(n,{from:l,to:c,insert:n.state.toText(s)},null),!0}}let i;if(xe.chrome&&xe.android&&(i=IU.find(s=>s.inputType==e.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let s=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>s+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}return xe.ios&&e.inputType=="deleteContentForward"&&n.observer.flushSoon(),xe.safari&&e.inputType=="insertText"&&n.inputState.composing>=0&&setTimeout(()=>ls.compositionend(n,e),20),!1};const kE=new Set;function _be(n){kE.has(n)||(kE.add(n),n.addEventListener("copy",()=>{}),n.addEventListener("cut",()=>{}))}const CE=["pre-wrap","normal","pre-line","break-spaces"];let Fd=!1;function PE(){Fd=!1}class Rbe{constructor(e){this.lineWrapping=e,this.doc=rt.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let r=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((t-e-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return CE.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let r=0;r<e.length;r++){let i=e[r];i<0?r++:this.heightSamples[Math.floor(i*10)]||(t=!0,this.heightSamples[Math.floor(i*10)]=!0)}return t}refresh(e,t,r,i,s,o){let a=CE.indexOf(e)>-1,l=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=t,this.charWidth=r,this.textHeight=i,this.lineLength=s,l){this.heightSamples={};for(let c=0;c<o.length;c++){let u=o[c];u<0?c++:this.heightSamples[Math.floor(u*10)]=!0}}return l}}class Dbe{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class oo{constructor(e,t,r,i,s){this.from=e,this.length=t,this.top=r,this.height=i,this._content=s}get type(){return typeof this._content=="number"?ts.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof $l?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new oo(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var Nt=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(Nt||(Nt={}));const d1=.001;class Ir{constructor(e,t,r=2){this.length=e,this.height=t,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>d1&&(Fd=!0),this.height=e)}replace(e,t,r){return Ir.of(r)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,r,i){let s=this,o=r.doc;for(let a=i.length-1;a>=0;a--){let{fromA:l,toA:c,fromB:u,toB:d}=i[a],h=s.lineAt(l,Nt.ByPosNoHeight,r.setDoc(t),0,0),p=h.to>=c?h:s.lineAt(c,Nt.ByPosNoHeight,r,0,0);for(d+=p.to-c,c=p.to;a>0&&h.from<=i[a-1].toA;)l=i[a-1].fromA,u=i[a-1].fromB,a--,l<h.from&&(h=s.lineAt(l,Nt.ByPosNoHeight,r,0,0));u+=h.from-l,l=h.from;let g=H7.build(r.setDoc(o),e,u,d);s=Fy(s,s.replace(l,c,g))}return s.updateHeight(r,0)}static empty(){return new yi(0,0)}static of(e){if(e.length==1)return e[0];let t=0,r=e.length,i=0,s=0;for(;;)if(t==r)if(i>s*2){let a=e[t-1];a.break?e.splice(--t,1,a.left,null,a.right):e.splice(--t,1,a.left,a.right),r+=1+a.break,i-=a.size}else if(s>i*2){let a=e[r];a.break?e.splice(r,1,a.left,null,a.right):e.splice(r,1,a.left,a.right),r+=2+a.break,s-=a.size}else break;else if(i<s){let a=e[t++];a&&(i+=a.size)}else{let a=e[--r];a&&(s+=a.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,r++),new jbe(Ir.of(e.slice(0,t)),o,Ir.of(e.slice(r)))}}function Fy(n,e){return n==e?n:(n.constructor!=e.constructor&&(Fd=!0),e)}Ir.prototype.size=1;class zU extends Ir{constructor(e,t,r){super(e,t),this.deco=r}blockAt(e,t,r,i){return new oo(i,this.length,r,this.height,this.deco||0)}lineAt(e,t,r,i,s){return this.blockAt(0,r,i,s)}forEachLine(e,t,r,i,s,o){e<=s+this.length&&t>=s&&o(this.blockAt(0,r,i,s))}updateHeight(e,t=0,r=!1,i){return i&&i.from<=t&&i.more&&this.setHeight(i.heights[i.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class yi extends zU{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,r,i){return new oo(i,this.length,r,this.height,this.breaks)}replace(e,t,r){let i=r[0];return r.length==1&&(i instanceof yi||i instanceof Bn&&i.flags&4)&&Math.abs(this.length-i.length)<10?(i instanceof Bn?i=new yi(i.length,this.height):i.height=this.height,this.outdated||(i.outdated=!1),i):Ir.of(r)}updateHeight(e,t=0,r=!1,i){return i&&i.from<=t&&i.more?this.setHeight(i.heights[i.index++]):(r||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Bn extends Ir{constructor(e){super(e,0)}heightMetrics(e,t){let r=e.doc.lineAt(t).number,i=e.doc.lineAt(t+this.length).number,s=i-r+1,o,a=0;if(e.lineWrapping){let l=Math.min(this.height,e.lineHeight*s);o=l/s,this.length>s+1&&(a=(this.height-l)/(this.length-s-1))}else o=this.height/s;return{firstLine:r,lastLine:i,perLine:o,perChar:a}}blockAt(e,t,r,i){let{firstLine:s,lastLine:o,perLine:a,perChar:l}=this.heightMetrics(t,i);if(t.lineWrapping){let c=i+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-r)/this.height))*this.length)),u=t.doc.lineAt(c),d=a+u.length*l,h=Math.max(r,e-d/2);return new oo(u.from,u.length,h,d,0)}else{let c=Math.max(0,Math.min(o-s,Math.floor((e-r)/a))),{from:u,length:d}=t.doc.line(s+c);return new oo(u,d,r+a*c,a,0)}}lineAt(e,t,r,i,s){if(t==Nt.ByHeight)return this.blockAt(e,r,i,s);if(t==Nt.ByPosNoHeight){let{from:p,to:g}=r.doc.lineAt(e);return new oo(p,g-p,0,0,0)}let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(r,s),c=r.doc.lineAt(e),u=a+c.length*l,d=c.number-o,h=i+a*d+l*(c.from-s-d);return new oo(c.from,c.length,Math.max(i,Math.min(h,i+this.height-u)),u,0)}forEachLine(e,t,r,i,s,o){e=Math.max(e,s),t=Math.min(t,s+this.length);let{firstLine:a,perLine:l,perChar:c}=this.heightMetrics(r,s);for(let u=e,d=i;u<=t;){let h=r.doc.lineAt(u);if(u==e){let g=h.number-a;d+=l*g+c*(e-s-g)}let p=l+c*h.length;o(new oo(h.from,h.length,d,p,0)),d+=p,u=h.to+1}}replace(e,t,r){let i=this.length-t;if(i>0){let s=r[r.length-1];s instanceof Bn?r[r.length-1]=new Bn(s.length+i):r.push(null,new Bn(i-1))}if(e>0){let s=r[0];s instanceof Bn?r[0]=new Bn(e+s.length):r.unshift(new Bn(e-1),null)}return Ir.of(r)}decomposeLeft(e,t){t.push(new Bn(e-1),null)}decomposeRight(e,t){t.push(null,new Bn(this.length-e-1))}updateHeight(e,t=0,r=!1,i){let s=t+this.length;if(i&&i.from<=t+this.length&&i.more){let o=[],a=Math.max(t,i.from),l=-1;for(i.from>t&&o.push(new Bn(i.from-t-1).updateHeight(e,t));a<=s&&i.more;){let u=e.doc.lineAt(a).length;o.length&&o.push(null);let d=i.heights[i.index++];l==-1?l=d:Math.abs(d-l)>=d1&&(l=-2);let h=new yi(u,d);h.outdated=!1,o.push(h),a+=u+1}a<=s&&o.push(null,new Bn(s-a).updateHeight(e,a));let c=Ir.of(o);return(l<0||Math.abs(c.height-this.height)>=d1||Math.abs(l-this.heightMetrics(e,t).perLine)>=d1)&&(Fd=!0),Fy(this,c)}else(r||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class jbe extends Ir{constructor(e,t,r){super(e.length+t+r.length,e.height+r.height,t|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,t,r,i){let s=r+this.left.height;return e<s?this.left.blockAt(e,t,r,i):this.right.blockAt(e,t,s,i+this.left.length+this.break)}lineAt(e,t,r,i,s){let o=i+this.left.height,a=s+this.left.length+this.break,l=t==Nt.ByHeight?e<o:e<a,c=l?this.left.lineAt(e,t,r,i,s):this.right.lineAt(e,t,r,o,a);if(this.break||(l?c.to<a:c.from>a))return c;let u=t==Nt.ByPosNoHeight?Nt.ByPosNoHeight:Nt.ByPos;return l?c.join(this.right.lineAt(a,u,r,o,a)):this.left.lineAt(a,u,r,i,s).join(c)}forEachLine(e,t,r,i,s,o){let a=i+this.left.height,l=s+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,t,r,i,s,o),t>=l&&this.right.forEachLine(e,t,r,a,l,o);else{let c=this.lineAt(l,Nt.ByPos,r,i,s);e<c.from&&this.left.forEachLine(e,c.from-1,r,i,s,o),c.to>=e&&c.from<=t&&o(c),t>c.to&&this.right.forEachLine(c.to+1,t,r,a,l,o)}}replace(e,t,r){let i=this.left.length+this.break;if(t<i)return this.balanced(this.left.replace(e,t,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-i,t-i,r));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let a of r)s.push(a);if(e>0&&TE(s,o-1),t<this.length){let a=s.length;this.decomposeRight(t,s),TE(s,a)}return Ir.of(s)}decomposeLeft(e,t){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(r++,e>=r&&t.push(null)),e>r&&this.right.decomposeLeft(e-r,t)}decomposeRight(e,t){let r=this.left.length,i=r+this.break;if(e>=i)return this.right.decomposeRight(e-i,t);e<r&&this.left.decomposeRight(e,t),this.break&&e<i&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Ir.of(this.break?[e,null,t]:[e,t]):(this.left=Fy(this.left,e),this.right=Fy(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,r=!1,i){let{left:s,right:o}=this,a=t+s.length+this.break,l=null;return i&&i.from<=t+s.length&&i.more?l=s=s.updateHeight(e,t,r,i):s.updateHeight(e,t,r),i&&i.from<=a+o.length&&i.more?l=o=o.updateHeight(e,a,r,i):o.updateHeight(e,a,r),l?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function TE(n,e){let t,r;n[e]==null&&(t=n[e-1])instanceof Bn&&(r=n[e+1])instanceof Bn&&n.splice(e-1,3,new Bn(t.length+1+r.length))}const Lbe=5;class H7{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let r=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof yi?i.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new yi(r-this.pos,-1)),this.writtenTo=r,t>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,r){if(e<t||r.heightRelevant){let i=r.widget?r.widget.estimatedHeight:0,s=r.widget?r.widget.lineBreaks:0;i<0&&(i=this.oracle.lineHeight);let o=t-e;r.block?this.addBlock(new zU(o,i,r)):(o||s||i>=Lbe)&&this.addLineDeco(i,s,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new yi(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let r=new Bn(t-e);return this.oracle.doc.lineAt(e).to==t&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof yi)return e;let t=new yi(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,r){let i=this.ensureLine();i.length+=r,i.collapsed+=r,i.widgetHeight=Math.max(i.widgetHeight,e),i.breaks+=t,this.writtenTo=this.pos=this.pos+r}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof yi)&&!this.isCovered?this.nodes.push(new yi(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let i of this.nodes)i instanceof yi&&i.updateHeight(this.oracle,r),r+=i?i.length:1;return this.nodes}static build(e,t,r,i){let s=new H7(r,e);return gt.spans(t,r,i,s,0),s.finish(r)}}function zbe(n,e,t){let r=new Nbe;return gt.compare(n,e,t,r,0),r.changes}class Nbe{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,r,i){(e<t||r&&r.heightRelevant||i&&i.heightRelevant)&&c1(e,t,this.changes,5)}}function $be(n,e){let t=n.getBoundingClientRect(),r=n.ownerDocument,i=r.defaultView||window,s=Math.max(0,t.left),o=Math.min(i.innerWidth,t.right),a=Math.max(0,t.top),l=Math.min(i.innerHeight,t.bottom);for(let c=n.parentNode;c&&c!=r.body;)if(c.nodeType==1){let u=c,d=window.getComputedStyle(u);if((u.scrollHeight>u.clientHeight||u.scrollWidth>u.clientWidth)&&d.overflow!="visible"){let h=u.getBoundingClientRect();s=Math.max(s,h.left),o=Math.min(o,h.right),a=Math.max(a,h.top),l=Math.min(c==n.parentNode?i.innerHeight:l,h.bottom)}c=d.position=="absolute"||d.position=="fixed"?u.offsetParent:u.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:s-t.left,right:Math.max(s,o)-t.left,top:a-(t.top+e),bottom:Math.max(a,l)-(t.top+e)}}function Fbe(n){let e=n.getBoundingClientRect(),t=n.ownerDocument.defaultView||window;return e.left<t.innerWidth&&e.right>0&&e.top<t.innerHeight&&e.bottom>0}function Bbe(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class ew{constructor(e,t,r,i){this.from=e,this.to=t,this.size=r,this.displaySize=i}static same(e,t){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],s=t[r];if(i.from!=s.from||i.to!=s.to||i.size!=s.size)return!1}return!0}draw(e,t){return on.replace({widget:new Ube(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class Ube extends TS{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class EE{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IE,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Pn.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(F7).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new Rbe(t),this.stateDeco=e.facet(Rp).filter(r=>typeof r!="function"),this.heightMap=Ir.empty().applyChanges(this.stateDeco,rt.empty,this.heightOracle.setDoc(e.doc),[new ns(0,0,0,e.doc.length)]);for(let r=0;r<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());r++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=on.set(this.lineGaps.map(r=>r.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let r=0;r<=1;r++){let i=r?t.head:t.anchor;if(!e.some(({from:s,to:o})=>i>=s&&i<=o)){let{from:s,to:o}=this.lineBlockAt(i);e.push(new Zg(s,o))}}return this.viewports=e.sort((r,i)=>r.from-i.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?IE:new Q7(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(yf(e,this.scaler))})}update(e,t=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=this.state.facet(Rp).filter(u=>typeof u!="function");let i=e.changedRanges,s=ns.extendWithRanges(i,zbe(r,this.stateDeco,e?e.changes:On.empty(this.state.doc.length))),o=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);PE(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=o||Fd)&&(e.flags|=2),a?(this.scrollAnchorPos=e.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let l=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<l.from||t.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,t));let c=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,e.flags|=this.updateForViewport(),(c||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(qwe)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,r=window.getComputedStyle(t),i=this.heightOracle,s=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?Pn.RTL:Pn.LTR;let o=this.heightOracle.mustRefreshForWrapping(s),a=t.getBoundingClientRect(),l=o||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let c=0,u=0;if(a.width&&a.height){let{scaleX:O,scaleY:T}=WB(t,a);(O>.005&&Math.abs(this.scaleX-O)>.005||T>.005&&Math.abs(this.scaleY-T)>.005)&&(this.scaleX=O,this.scaleY=T,c|=16,o=l=!0)}let d=(parseInt(r.paddingTop)||0)*this.scaleY,h=(parseInt(r.paddingBottom)||0)*this.scaleY;(this.paddingTop!=d||this.paddingBottom!=h)&&(this.paddingTop=d,this.paddingBottom=h,c|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(i.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=16);let p=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=p&&(this.scrollAnchorHeight=-1,this.scrollTop=p),this.scrolledToBottom=XB(e.scrollDOM);let g=(this.printing?Bbe:$be)(t,this.paddingTop),m=g.top-this.pixelViewport.top,S=g.bottom-this.pixelViewport.bottom;this.pixelViewport=g;let y=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(y!=this.inView&&(this.inView=y,y&&(l=!0)),!this.inView&&!this.scrollTarget&&!Fbe(e.dom))return 0;let x=a.width;if((this.contentDOMWidth!=x||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=a.width,this.editorHeight=e.scrollDOM.clientHeight,c|=16),l){let O=e.docView.measureVisibleLineHeights(this.viewport);if(i.mustRefreshForHeights(O)&&(o=!0),o||i.lineWrapping&&Math.abs(x-this.contentDOMWidth)>i.charWidth){let{lineHeight:T,charWidth:E,textHeight:C}=e.docView.measureTextSize();o=T>0&&i.refresh(s,T,E,C,x/E,O),o&&(e.docView.minWidth=0,c|=16)}m>0&&S>0?u=Math.max(m,S):m<0&&S<0&&(u=Math.min(m,S)),PE();for(let T of this.viewports){let E=T.from==this.viewport.from?O:e.docView.measureVisibleLineHeights(T);this.heightMap=(o?Ir.empty().applyChanges(this.stateDeco,rt.empty,this.heightOracle,[new ns(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(i,0,o,new Dbe(T.from,E))}Fd&&(c|=2)}let w=!this.viewportIsAppropriate(this.viewport,u)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return w&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(u,this.scrollTarget),c|=this.updateForViewport()),(c&2||w)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),i=this.heightMap,s=this.heightOracle,{visibleTop:o,visibleBottom:a}=this,l=new Zg(i.lineAt(o-r*1e3,Nt.ByHeight,s,0,0).from,i.lineAt(a+(1-r)*1e3,Nt.ByHeight,s,0,0).to);if(t){let{head:c}=t.range;if(c<l.from||c>l.to){let u=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),d=i.lineAt(c,Nt.ByPos,s,0,0),h;t.y=="center"?h=(d.top+d.bottom)/2-u/2:t.y=="start"||t.y=="nearest"&&c<l.from?h=d.top:h=d.bottom-u,l=new Zg(i.lineAt(h-1e3/2,Nt.ByHeight,s,0,0).from,i.lineAt(h+u+1e3/2,Nt.ByHeight,s,0,0).to)}}return l}mapViewport(e,t){let r=t.mapPos(e.from,-1),i=t.mapPos(e.to,1);return new Zg(this.heightMap.lineAt(r,Nt.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(i,Nt.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},r=0){if(!this.inView)return!0;let{top:i}=this.heightMap.lineAt(e,Nt.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(t,Nt.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:a}=this;return(e==0||i<=o-Math.max(10,Math.min(-r,250)))&&(t==this.state.doc.length||s>=a+Math.max(10,Math.min(r,250)))&&i>o-2*1e3&&s<a+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let r=[];for(let i of e)t.touchesRange(i.from,i.to)||r.push(new ew(t.mapPos(i.from),t.mapPos(i.to),i.size,i.displaySize));return r}ensureLineGaps(e,t){let r=this.heightOracle.lineWrapping,i=r?1e4:2e3,s=i>>1,o=i<<1;if(this.defaultTextDirection!=Pn.LTR&&!r)return[];let a=[],l=(u,d,h,p)=>{if(d-u<s)return;let g=this.state.selection.main,m=[g.from];g.empty||m.push(g.to);for(let y of m)if(y>u&&y<d){l(u,y-10,h,p),l(y+10,d,h,p);return}let S=Qbe(e,y=>y.from>=h.from&&y.to<=h.to&&Math.abs(y.from-u)<s&&Math.abs(y.to-d)<s&&!m.some(x=>y.from<x&&y.to>x));if(!S){if(d<h.to&&t&&r&&t.visibleRanges.some(w=>w.from<=d&&w.to>=d)){let w=t.moveToLineBoundary(ce.cursor(d),!1,!0).head;w>u&&(d=w)}let y=this.gapSize(h,u,d,p),x=r||y<2e6?y:2e6;S=new ew(u,d,y,x)}a.push(S)},c=u=>{if(u.length<o||u.type!=ts.Text)return;let d=Hbe(u.from,u.to,this.stateDeco);if(d.total<o)return;let h=this.scrollTarget?this.scrollTarget.range.head:null,p,g;if(r){let m=i/this.heightOracle.lineLength*this.heightOracle.lineHeight,S,y;if(h!=null){let x=em(d,h),w=((this.visibleBottom-this.visibleTop)/2+m)/u.height;S=x-w,y=x+w}else S=(this.visibleTop-u.top-m)/u.height,y=(this.visibleBottom-u.top+m)/u.height;p=Jg(d,S),g=Jg(d,y)}else{let m=d.total*this.heightOracle.charWidth,S=i*this.heightOracle.charWidth,y=0;if(m>2e6)for(let E of e)E.from>=u.from&&E.from<u.to&&E.size!=E.displaySize&&E.from*this.heightOracle.charWidth+y<this.pixelViewport.left&&(y=E.size-E.displaySize);let x=this.pixelViewport.left+y,w=this.pixelViewport.right+y,O,T;if(h!=null){let E=em(d,h),C=((w-x)/2+S)/m;O=E-C,T=E+C}else O=(x-S)/m,T=(w+S)/m;p=Jg(d,O),g=Jg(d,T)}p>u.from&&l(u.from,p,u,d),g<u.to&&l(g,u.to,u,d)};for(let u of this.viewportLines)Array.isArray(u.type)?u.type.forEach(c):c(u);return a}gapSize(e,t,r,i){let s=em(i,r)-em(i,t);return this.heightOracle.lineWrapping?e.height*s:i.total*this.heightOracle.charWidth*s}updateLineGaps(e){ew.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=on.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let r=[];gt.spans(t,this.viewport.from,this.viewport.to,{span(s,o){r.push({from:s,to:o})},point(){}},20);let i=0;if(r.length!=this.visibleRanges.length)i=12;else for(let s=0;s<r.length&&!(i&8);s++){let o=this.visibleRanges[s],a=r[s];(o.from!=a.from||o.to!=a.to)&&(i|=4,e&&e.mapPos(o.from,-1)==a.from&&e.mapPos(o.to,1)==a.to||(i|=8))}return this.visibleRanges=r,i}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||yf(this.heightMap.lineAt(e,Nt.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||yf(this.heightMap.lineAt(this.scaler.fromDOM(e),Nt.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return yf(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Zg{constructor(e,t){this.from=e,this.to=t}}function Hbe(n,e,t){let r=[],i=n,s=0;return gt.spans(t,n,e,{span(){},point(o,a){o>i&&(r.push({from:i,to:o}),s+=o-i),i=a}},20),i<e&&(r.push({from:i,to:e}),s+=e-i),{total:s,ranges:r}}function Jg({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let r=Math.floor(n*t);for(let i=0;;i++){let{from:s,to:o}=e[i],a=o-s;if(r<=a)return s+r;r-=a}}function em(n,e){let t=0;for(let{from:r,to:i}of n.ranges){if(e<=i){t+=e-r;break}t+=i-r}return t/n.total}function Qbe(n,e){for(let t of n)if(e(t))return t}const IE={toDOM(n){return n},fromDOM(n){return n},scale:1,eq(n){return n==this}};class Q7{constructor(e,t,r){let i=0,s=0,o=0;this.viewports=r.map(({from:a,to:l})=>{let c=t.lineAt(a,Nt.ByPos,e,0,0).top,u=t.lineAt(l,Nt.ByPos,e,0,0).bottom;return i+=u-c,{from:a,to:l,top:c,bottom:u,domTop:0,domBottom:0}}),this.scale=(7e6-i)/(t.height-i);for(let a of this.viewports)a.domTop=o+(a.top-s)*this.scale,o=a.domBottom=a.domTop+(a.bottom-a.top),s=a.bottom}toDOM(e){for(let t=0,r=0,i=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return i+(e-r)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);r=s.bottom,i=s.domBottom}}fromDOM(e){for(let t=0,r=0,i=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return r+(e-i)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);r=s.bottom,i=s.domBottom}}eq(e){return e instanceof Q7?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,r)=>t.from==e.viewports[r].from&&t.to==e.viewports[r].to):!1}}function yf(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),r=e.toDOM(n.bottom);return new oo(n.from,n.length,t,r-t,Array.isArray(n._content)?n._content.map(i=>yf(i,e)):n._content)}const tm=Ie.define({combine:n=>n.join(" ")}),R5=Ie.define({combine:n=>n.indexOf(!0)>-1}),D5=zl.newName(),NU=zl.newName(),$U=zl.newName(),FU={"&light":"."+NU,"&dark":"."+$U};function j5(n,e,t){return new zl(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,i=>{if(i=="&")return n;if(!t||!t[i])throw new RangeError(`Unsupported selector: ${i}`);return t[i]}):n+" "+r}})}const qbe=j5("."+D5,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},FU),Wbe={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},tw=xe.ie&&xe.ie_version<=11;class Vbe{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new Twe,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let r of t)this.queue.push(r);(xe.ie&&xe.ie_version<=11||xe.ios&&e.composing)&&t.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&e.constructor.EDIT_CONTEXT!==!1&&!(xe.chrome&&xe.chrome_version<126)&&(this.editContext=new Xbe(e),e.state.facet(ra)&&(e.contentDOM.editContext=this.editContext.editContext)),tw&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,r)=>t!=e[r]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,i=this.selectionRange;if(r.state.facet(ra)?r.root.activeElement!=this.dom:!l1(this.dom,i))return;let s=i.anchorNode&&r.docView.nearest(i.anchorNode);if(s&&s.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(xe.ie&&xe.ie_version<=11||xe.android&&xe.chrome)&&!r.state.selection.main.empty&&i.focusNode&&Nf(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=Ap(e.root);if(!t)return!1;let r=xe.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&Gbe(this.view,t)||t;if(!r||this.selectionRange.eq(r))return!1;let i=l1(this.dom,r);return i&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&Iwe(this.dom,r)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(r),i&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let r=this.dom;r;)if(r.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=t)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Wbe),tw&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),tw&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var r;if(!this.delayedAndroidKey){let i=()=>{let s=this.delayedAndroidKey;s&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=s.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&s.force&&gd(this.dom,s.key,s.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(i)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,r=-1,i=!1;for(let s of e){let o=this.readMutation(s);o&&(o.typeOver&&(i=!0),t==-1?{from:t,to:r}=o:(t=Math.min(o.from,t),r=Math.max(o.to,r)))}return{from:t,to:r,typeOver:i}}readChange(){let{from:e,to:t,typeOver:r}=this.processRecords(),i=this.selectionChanged&&l1(this.dom,this.selectionRange);if(e<0&&!i)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new dbe(this.view,e,t,r);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let r=this.view.state,i=EU(this.view,t);return this.view.state==r&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),i}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.flags|=4),e.type=="childList"){let r=ME(t,e.previousSibling||e.target.previousSibling,-1),i=ME(t,e.nextSibling||e.target.nextSibling,1);return{from:r?t.posAfter(r):t.posAtStart,to:i?t.posBefore(i):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(ra)!=e.state.facet(ra)&&(e.view.contentDOM.editContext=e.state.facet(ra)?this.editContext.editContext:null))}destroy(){var e,t,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect();for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function ME(n,e,t){for(;e;){let r=Ot.get(e);if(r&&r.parent==n)return r;let i=e.parentNode;e=i!=n.dom?i:t>0?e.nextSibling:e.previousSibling}return null}function AE(n,e){let t=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=n.docView.domAtPos(n.state.selection.main.anchor);return Nf(o.node,o.offset,i,s)&&([t,r,i,s]=[i,s,t,r]),{anchorNode:t,anchorOffset:r,focusNode:i,focusOffset:s}}function Gbe(n,e){if(e.getComposedRanges){let i=e.getComposedRanges(n.root)[0];if(i)return AE(n,i)}let t=null;function r(i){i.preventDefault(),i.stopImmediatePropagation(),t=i.getTargetRanges()[0]}return n.contentDOM.addEventListener("beforeinput",r,!0),n.dom.ownerDocument.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",r,!0),t?AE(n,t):null}class Xbe{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=r=>{let i=e.state.selection.main,{anchor:s,head:o}=i,a=this.toEditorPos(r.updateRangeStart),l=this.toEditorPos(r.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:r.updateRangeStart,editorBase:a,drifted:!1});let c={from:a,to:l,insert:rt.of(r.text.split(`
`))};if(c.from==this.from&&s<this.from?c.from=s:c.to==this.to&&s>this.to&&(c.to=s),c.from==c.to&&!c.insert.length){let u=ce.single(this.toEditorPos(r.selectionStart),this.toEditorPos(r.selectionEnd));u.main.eq(i)||e.dispatch({selection:u,userEvent:"select"});return}if((xe.mac||xe.android)&&c.from==o-1&&/^\. ?$/.test(r.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(c={from:a,to:l,insert:rt.of([r.text.replace("."," ")])}),this.pendingContextChange=c,!e.state.readOnly){let u=this.to-this.from+(c.to-c.from+c.insert.length);U7(e,c,ce.single(this.toEditorPos(r.selectionStart,u),this.toEditorPos(r.selectionEnd,u)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state))},this.handlers.characterboundsupdate=r=>{let i=[],s=null;for(let o=this.toEditorPos(r.rangeStart),a=this.toEditorPos(r.rangeEnd);o<a;o++){let l=e.coordsForChar(o);s=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||s||new DOMRect,i.push(s)}t.updateCharacterBounds(r.rangeStart,i)},this.handlers.textformatupdate=r=>{let i=[];for(let s of r.getTextFormats()){let o=s.underlineStyle,a=s.underlineThickness;if(o!="None"&&a!="None"){let l=this.toEditorPos(s.rangeStart),c=this.toEditorPos(s.rangeEnd);if(l<c){let u=`text-decoration: underline ${o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${a=="Thin"?1:2}px`;i.push(on.mark({attributes:{style:u}}).range(l,c))}}}e.dispatch({effects:xU.of(on.set(i))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:r}=this.composing;this.composing=null,r&&this.reset(e.state)}};for(let r in this.handlers)t.addEventListener(r,this.handlers[r]);this.measureReq={read:r=>{this.editContext.updateControlBounds(r.contentDOM.getBoundingClientRect());let i=Ap(r.root);i&&i.rangeCount&&this.editContext.updateSelectionBounds(i.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,r=!1,i=this.pendingContextChange;return e.changes.iterChanges((s,o,a,l,c)=>{if(r)return;let u=c.length-(o-s);if(i&&o>=i.to)if(i.from==s&&i.to==o&&i.insert.eq(c)){i=this.pendingContextChange=null,t+=u,this.to+=u;return}else i=null,this.revertPending(e.state);if(s+=t,o+=t,o<=this.from)this.from+=u,this.to+=u;else if(s<this.to){if(s<this.from||o>this.to||this.to-this.from+c.length>3e4){r=!0;return}this.editContext.updateText(this.toContextPos(s),this.toContextPos(o),c.toString()),this.to+=u}t+=u}),i&&!r&&this.revertPending(e.state),!r}update(e){let t=this.pendingContextChange,r=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(r.from,r.to)&&e.transactions.some(i=>!i.isUserEvent("input.type")&&i.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,r=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),i=this.toContextPos(t.head);(this.editContext.selectionStart!=r||this.editContext.selectionEnd!=i)&&this.editContext.updateSelection(r,i)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let r=this.composing;return r&&r.drifted?r.editorBase+(e-r.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class Ne{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:r}=e;this.dispatchTransactions=e.dispatchTransactions||r&&(i=>i.forEach(s=>r(s,this)))||(i=>this.update(i)),this.dispatch=this.dispatch.bind(this),this._root=e.root||Ewe(e.parent)||document,this.viewState=new EE(e.state||ft.create(e)),e.scrollTo&&e.scrollTo.is(Xg)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(pf).map(i=>new Y2(i));for(let i of this.plugins)i.update(this);this.observer=new Vbe(this),this.inputState=new mbe(this),this.inputState.ensureHandlers(this.plugins),this.docView=new cE(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let t=e.length==1&&e[0]instanceof yn?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,r=!1,i,s=this.state;for(let h of e){if(h.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=h.state}if(this.destroyed){this.viewState.state=s;return}let o=this.hasFocus,a=0,l=null;e.some(h=>h.annotation(DU))?(this.inputState.notifiedFocused=o,a=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,l=jU(s,o),l||(a=1));let c=this.observer.delayedAndroidKey,u=null;if(c?(this.observer.clearDelayedAndroidKey(),u=this.observer.readChange(),(u&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(u=null)):this.observer.clear(),s.facet(ft.phrases)!=this.state.facet(ft.phrases))return this.setState(s);i=$y.create(this,s,e),i.flags|=a;let d=this.viewState.scrollTarget;try{this.updateState=2;for(let h of e){if(d&&(d=d.map(h.changes)),h.scrollIntoView){let{main:p}=h.state.selection;d=new md(p.empty?p:ce.cursor(p.head,p.head>p.anchor?-1:1))}for(let p of h.effects)p.is(Xg)&&(d=p.value.clip(this.state))}this.viewState.update(i,d),this.bidiCache=By.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),t=this.docView.update(i),this.state.facet(gf)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(h=>h.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(tm)!=i.state.facet(tm)&&(this.viewState.mustMeasureContent=!0),(t||r||d||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!i.empty)for(let h of this.state.facet(M5))try{h(i)}catch(p){po(this.state,p,"update listener")}(l||u)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),u&&!EU(this,u)&&c.force&&gd(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new EE(e),this.plugins=e.facet(pf).map(r=>new Y2(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView.destroy(),this.docView=new cE(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(pf),r=e.state.facet(pf);if(t!=r){let i=[];for(let s of r){let o=t.indexOf(s);if(o<0)i.push(new Y2(s));else{let a=this.plugins[o];a.mustUpdate=e,i.push(a)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=i,this.pluginMap.clear()}else for(let i of this.plugins)i.mustUpdate=e;for(let i=0;i<this.plugins.length;i++)this.plugins[i].update(this);t!=r&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(r){po(this.state,r,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,r=this.scrollDOM,i=r.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:o}=this.viewState;Math.abs(i-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let a=0;;a++){if(o<0)if(XB(r))s=-1,o=this.viewState.heightMap.height;else{let p=this.viewState.scrollAnchorAt(i);s=p.from,o=p.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(a>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];l&4||([this.measureRequests,c]=[c,this.measureRequests]);let u=c.map(p=>{try{return p.read(this)}catch(g){return po(this.state,g),_E}}),d=$y.create(this,this.state,[]),h=!1;d.flags|=l,t?t.flags|=l:t=d,this.updateState=2,d.empty||(this.updatePlugins(d),this.inputState.update(d),this.updateAttrs(),h=this.docView.update(d),h&&this.docViewUpdate());for(let p=0;p<c.length;p++)if(u[p]!=_E)try{let g=c[p];g.write&&g.write(u[p],this)}catch(g){po(this.state,g)}if(h&&this.docView.updateSelection(!0),!d.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let g=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-o;if(g>1||g<-1){i=i+g,r.scrollTop=i/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let a of this.state.facet(M5))a(t)}get themeClasses(){return D5+" "+(this.state.facet(R5)?$U:NU)+" "+this.state.facet(tm)}updateAttrs(){let e=RE(this,wU,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(ra)?"true":"false",class:"cm-content",style:`${xe.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),RE(this,F7,t);let r=this.observer.ignore(()=>{let i=C5(this.contentDOM,this.contentAttrs,t),s=C5(this.dom,this.editorAttrs,e);return i||s});return this.editorAttrs=e,this.contentAttrs=t,r}showAnnouncements(e){let t=!0;for(let r of e)for(let i of r.effects)if(i.is(Ne.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=i.value}}mountStyles(){this.styleModules=this.state.facet(gf);let e=this.state.facet(Ne.cspNonce);zl.mount(this.root,this.styleModules.concat(qbe).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(r=>r.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,r){return J2(this,e,pE(this,e,t,r))}moveByGroup(e,t){return J2(this,e,pE(this,e,t,r=>abe(this,e.head,r)))}visualLineSide(e,t){let r=this.bidiSpans(e),i=this.textDirectionAt(e.from),s=r[t?r.length-1:0];return ce.cursor(s.side(t,i)+e.from,s.forward(!t,i)?1:-1)}moveToLineBoundary(e,t,r=!0){return obe(this,e,t,r)}moveVertically(e,t,r){return J2(this,e,lbe(this,e,t,r))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),TU(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let r=this.docView.coordsAt(e,t);if(!r||r.left==r.right)return r;let i=this.state.doc.lineAt(e),s=this.bidiSpans(i),o=s[hl.find(s,e-i.from,-1,t)];return CS(r,o.dir==Pn.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(vU)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>Kbe)return uU(e.length);let t=this.textDirectionAt(e.from),r;for(let s of this.bidiCache)if(s.from==e.from&&s.dir==t&&(s.fresh||cU(s.isolates,r=lE(this,e))))return s.order;r||(r=lE(this,e));let i=Uwe(e.text,t,r);return this.bidiCache.push(new By(e.from,e.to,t,r,!0,i)),i}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||xe.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{VB(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Xg.of(new md(typeof e=="number"?ce.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,r=this.viewState.scrollAnchorAt(e);return Xg.of(new md(ce.cursor(r.from),"start","start",r.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return Fl.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return Fl.define(()=>({}),{eventObservers:e})}static theme(e,t){let r=zl.newName(),i=[tm.of(r),gf.of(j5(`.${r}`,e))];return t&&t.dark&&i.push(R5.of(!0)),i}static baseTheme(e){return bS.lowest(gf.of(j5("."+D5,e,FU)))}static findFromDOM(e){var t;let r=e.querySelector(".cm-content"),i=r&&Ot.get(r)||Ot.get(e);return((t=i==null?void 0:i.rootView)===null||t===void 0?void 0:t.view)||null}}Ne.styleModule=gf;Ne.inputHandler=mU;Ne.clipboardInputFilter=N7;Ne.clipboardOutputFilter=$7;Ne.scrollHandler=SU;Ne.focusChangeEffect=yU;Ne.perLineTextDirection=vU;Ne.exceptionSink=gU;Ne.updateListener=M5;Ne.editable=ra;Ne.mouseSelectionStyle=pU;Ne.dragMovesSelection=fU;Ne.clickAddsSelectionRange=hU;Ne.decorations=Rp;Ne.outerDecorations=bU;Ne.atomicRanges=B7;Ne.bidiIsolatedRanges=OU;Ne.scrollMargins=kU;Ne.darkTheme=R5;Ne.cspNonce=Ie.define({combine:n=>n.length?n[0]:""});Ne.contentAttributes=F7;Ne.editorAttributes=wU;Ne.lineWrapping=Ne.contentAttributes.of({class:"cm-lineWrapping"});Ne.announce=Ft.define();const Kbe=4096,_E={};class By{constructor(e,t,r,i,s,o){this.from=e,this.to=t,this.dir=r,this.isolates=i,this.fresh=s,this.order=o}static update(e,t){if(t.empty&&!e.some(s=>s.fresh))return e;let r=[],i=e.length?e[e.length-1].dir:Pn.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==i&&!t.touchesRange(o.from,o.to)&&r.push(new By(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return r}}function RE(n,e,t){for(let r=n.state.facet(e),i=r.length-1;i>=0;i--){let s=r[i],o=typeof s=="function"?s(n):s;o&&k5(o,t)}return t}const Ybe=xe.mac?"mac":xe.windows?"win":xe.linux?"linux":"key";function Zbe(n,e){const t=n.split(/-(?!$)/);let r=t[t.length-1];r=="Space"&&(r=" ");let i,s,o,a;for(let l=0;l<t.length-1;++l){const c=t[l];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))i=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))e=="mac"?a=!0:s=!0;else throw new Error("Unrecognized modifier name: "+c)}return i&&(r="Alt-"+r),s&&(r="Ctrl-"+r),a&&(r="Meta-"+r),o&&(r="Shift-"+r),r}function nm(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const Jbe=bS.default(Ne.domEventHandlers({keydown(n,e){return r4e(e4e(e.state),n,e,"editor")}})),q7=Ie.define({enables:Jbe}),DE=new WeakMap;function e4e(n){let e=n.facet(q7),t=DE.get(e);return t||DE.set(e,t=n4e(e.reduce((r,i)=>r.concat(i),[]))),t}let rl=null;const t4e=4e3;function n4e(n,e=Ybe){let t=Object.create(null),r=Object.create(null),i=(o,a)=>{let l=r[o];if(l==null)r[o]=a;else if(l!=a)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,a,l,c,u)=>{var d,h;let p=t[o]||(t[o]=Object.create(null)),g=a.split(/ (?!$)/).map(y=>Zbe(y,e));for(let y=1;y<g.length;y++){let x=g.slice(0,y).join(" ");i(x,!0),p[x]||(p[x]={preventDefault:!0,stopPropagation:!1,run:[w=>{let O=rl={view:w,prefix:x,scope:o};return setTimeout(()=>{rl==O&&(rl=null)},t4e),!0}]})}let m=g.join(" ");i(m,!1);let S=p[m]||(p[m]={preventDefault:!1,stopPropagation:!1,run:((h=(d=p._any)===null||d===void 0?void 0:d.run)===null||h===void 0?void 0:h.slice())||[]});l&&S.run.push(l),c&&(S.preventDefault=!0),u&&(S.stopPropagation=!0)};for(let o of n){let a=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let c of a){let u=t[c]||(t[c]=Object.create(null));u._any||(u._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:d}=o;for(let h in u)u[h].run.push(p=>d(p,L5))}let l=o[e]||o.key;if(l)for(let c of a)s(c,l,o.run,o.preventDefault,o.stopPropagation),o.shift&&s(c,"Shift-"+l,o.shift,o.preventDefault,o.stopPropagation)}return t}let L5=null;function r4e(n,e,t,r){L5=e;let i=Owe(e),s=swe(i,0),o=owe(s)==i.length&&i!=" ",a="",l=!1,c=!1,u=!1;rl&&rl.view==t&&rl.scope==r&&(a=rl.prefix+" ",MU.indexOf(e.keyCode)<0&&(c=!0,rl=null));let d=new Set,h=S=>{if(S){for(let y of S.run)if(!d.has(y)&&(d.add(y),y(t)))return S.stopPropagation&&(u=!0),!0;S.preventDefault&&(S.stopPropagation&&(u=!0),c=!0)}return!1},p=n[r],g,m;return p&&(h(p[a+nm(i,e,!o)])?l=!0:o&&(e.altKey||e.metaKey||e.ctrlKey)&&!(xe.windows&&e.ctrlKey&&e.altKey)&&(g=Nl[e.keyCode])&&g!=i?(h(p[a+nm(g,e,!0)])||e.shiftKey&&(m=Mp[e.keyCode])!=i&&m!=g&&h(p[a+nm(m,e,!1)]))&&(l=!0):o&&e.shiftKey&&h(p[a+nm(i,e,!0)])&&(l=!0),!l&&h(p._any)&&(l=!0)),c&&(l=!0),l&&u&&e.stopPropagation(),L5=null,l}class tu extends Yc{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}tu.prototype.elementClass="";tu.prototype.toDOM=void 0;tu.prototype.mapMode=Cr.TrackBefore;tu.prototype.startSide=tu.prototype.endSide=-1;tu.prototype.point=!0;const nw=Ie.define(),i4e=Ie.define(),h1=Ie.define(),jE=Ie.define({combine:n=>n.some(e=>e)});function s4e(n){return[o4e]}const o4e=Fl.fromClass(class{constructor(n){this.view=n,this.prevViewport=n.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=n.state.facet(h1).map(e=>new zE(n,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!n.state.facet(jE),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),n.scrollDOM.insertBefore(this.dom,n.contentDOM)}update(n){if(this.updateGutters(n)){let e=this.prevViewport,t=n.view.viewport,r=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(r<(t.to-t.from)*.8)}n.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(jE)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=n.view.viewport}syncGutters(n){let e=this.dom.nextSibling;n&&this.dom.remove();let t=gt.iter(this.view.state.facet(nw),this.view.viewport.from),r=[],i=this.gutters.map(s=>new a4e(s,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks)if(r.length&&(r=[]),Array.isArray(s.type)){let o=!0;for(let a of s.type)if(a.type==ts.Text&&o){z5(t,r,a.from);for(let l of i)l.line(this.view,a,r);o=!1}else if(a.widget)for(let l of i)l.widget(this.view,a)}else if(s.type==ts.Text){z5(t,r,s.from);for(let o of i)o.line(this.view,s,r)}else if(s.widget)for(let o of i)o.widget(this.view,s);for(let s of i)s.finish();n&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(n){let e=n.startState.facet(h1),t=n.state.facet(h1),r=n.docChanged||n.heightChanged||n.viewportChanged||!gt.eq(n.startState.facet(nw),n.state.facet(nw),n.view.viewport.from,n.view.viewport.to);if(e==t)for(let i of this.gutters)i.update(n)&&(r=!0);else{r=!0;let i=[];for(let s of t){let o=e.indexOf(s);o<0?i.push(new zE(this.view,s)):(this.gutters[o].update(n),i.push(this.gutters[o]))}for(let s of this.gutters)s.dom.remove(),i.indexOf(s)<0&&s.destroy();for(let s of i)this.dom.appendChild(s.dom);this.gutters=i}return r}destroy(){for(let n of this.gutters)n.destroy();this.dom.remove()}},{provide:n=>Ne.scrollMargins.of(e=>{let t=e.plugin(n);return!t||t.gutters.length==0||!t.fixed?null:e.textDirection==Pn.LTR?{left:t.dom.offsetWidth*e.scaleX}:{right:t.dom.offsetWidth*e.scaleX}})});function LE(n){return Array.isArray(n)?n:[n]}function z5(n,e,t){for(;n.value&&n.from<=t;)n.from==t&&e.push(n.value),n.next()}class a4e{constructor(e,t,r){this.gutter=e,this.height=r,this.i=0,this.cursor=gt.iter(e.markers,t.from)}addElement(e,t,r){let{gutter:i}=this,s=(t.top-this.height)/e.scaleY,o=t.height/e.scaleY;if(this.i==i.elements.length){let a=new BU(e,o,s,r);i.elements.push(a),i.dom.appendChild(a.dom)}else i.elements[this.i].update(e,o,s,r);this.height=t.bottom,this.i++}line(e,t,r){let i=[];z5(this.cursor,i,t.from),r.length&&(i=i.concat(r));let s=this.gutter.config.lineMarker(e,t,i);s&&i.unshift(s);let o=this.gutter;i.length==0&&!o.config.renderEmptyElements||this.addElement(e,t,i)}widget(e,t){let r=this.gutter.config.widgetMarker(e,t.widget,t),i=r?[r]:null;for(let s of e.state.facet(i4e)){let o=s(e,t.widget,t);o&&(i||(i=[])).push(o)}i&&this.addElement(e,t,i)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class zE{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let r in t.domEventHandlers)this.dom.addEventListener(r,i=>{let s=i.target,o;if(s!=this.dom&&this.dom.contains(s)){for(;s.parentNode!=this.dom;)s=s.parentNode;let l=s.getBoundingClientRect();o=(l.top+l.bottom)/2}else o=i.clientY;let a=e.lineBlockAtHeight(o-e.documentTop);t.domEventHandlers[r](e,a,i)&&i.preventDefault()});this.markers=LE(t.markers(e)),t.initialSpacer&&(this.spacer=new BU(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=LE(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let i=this.config.updateSpacer(this.spacer.markers[0],e);i!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[i])}let r=e.view.viewport;return!gt.eq(this.markers,t,r.from,r.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class BU{constructor(e,t,r,i){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,r,i)}update(e,t,r,i){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),l4e(this.markers,i)||this.setMarkers(e,i)}setMarkers(e,t){let r="cm-gutterElement",i=this.dom.firstChild;for(let s=0,o=0;;){let a=o,l=s<t.length?t[s++]:null,c=!1;if(l){let u=l.elementClass;u&&(r+=" "+u);for(let d=o;d<this.markers.length;d++)if(this.markers[d].compare(l)){a=d,c=!0;break}}else a=this.markers.length;for(;o<a;){let u=this.markers[o++];if(u.toDOM){u.destroy(i);let d=i.nextSibling;i.remove(),i=d}}if(!l)break;l.toDOM&&(c?i=i.nextSibling:this.dom.insertBefore(l.toDOM(e),i)),c&&o++}this.dom.className=r,this.markers=t}destroy(){this.setMarkers(null,[])}}function l4e(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].compare(e[t]))return!1;return!0}const c4e=Ie.define(),u4e=Ie.define(),Yu=Ie.define({combine(n){return D7(n,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let r=Object.assign({},e);for(let i in t){let s=r[i],o=t[i];r[i]=s?(a,l,c)=>s(a,l,c)||o(a,l,c):o}return r}})}});class rw extends tu{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function iw(n,e){return n.state.facet(Yu).formatNumber(e,n.state)}const d4e=h1.compute([Yu],n=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(c4e)},lineMarker(e,t,r){return r.some(i=>i.toDOM)?null:new rw(iw(e,e.state.doc.lineAt(t.from).number))},widgetMarker:(e,t,r)=>{for(let i of e.state.facet(u4e)){let s=i(e,t,r);if(s)return s}return null},lineMarkerChange:e=>e.startState.facet(Yu)!=e.state.facet(Yu),initialSpacer(e){return new rw(iw(e,NE(e.state.doc.lines)))},updateSpacer(e,t){let r=iw(t.view,NE(t.view.state.doc.lines));return r==e.number?e:new rw(r)},domEventHandlers:n.facet(Yu).domEventHandlers}));function h4e(n={}){return[Yu.of(n),s4e(),d4e]}function NE(n){let e=9;for(;e<n;)e=e*10+9;return e}const UU=1024;let f4e=0,sw=class{constructor(e,t){this.from=e,this.to=t}};class Ge{constructor(e={}){this.id=f4e++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=oi.match(e)),t=>{let r=e(t);return r===void 0?null:[this,r]}}}Ge.closedBy=new Ge({deserialize:n=>n.split(" ")});Ge.openedBy=new Ge({deserialize:n=>n.split(" ")});Ge.group=new Ge({deserialize:n=>n.split(" ")});Ge.isolate=new Ge({deserialize:n=>{if(n&&n!="rtl"&&n!="ltr"&&n!="auto")throw new RangeError("Invalid value for isolate: "+n);return n||"auto"}});Ge.contextHash=new Ge({perNode:!0});Ge.lookAhead=new Ge({perNode:!0});Ge.mounted=new Ge({perNode:!0});class Uy{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}static get(e){return e&&e.props&&e.props[Ge.mounted.id]}}const p4e=Object.create(null);class oi{constructor(e,t,r,i=0){this.name=e,this.props=t,this.id=r,this.flags=i}static define(e){let t=e.props&&e.props.length?Object.create(null):p4e,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),i=new oi(e.name||"",t,e.id,r);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(i)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return i}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(Ge.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let i of r.split(" "))t[i]=e[r];return r=>{for(let i=r.prop(Ge.group),s=-1;s<(i?i.length:0);s++){let o=t[s<0?r.name:i[s]];if(o)return o}}}}oi.none=new oi("",Object.create(null),0,8);class W7{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let i=null;for(let s of e){let o=s(r);o&&(i||(i=Object.assign({},r.props)),i[o[0].id]=o[1])}t.push(i?new oi(r.name,i,r.id,r.flags):r)}return new W7(t)}}const rm=new WeakMap,$E=new WeakMap;var kn;(function(n){n[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays"})(kn||(kn={}));class vn{constructor(e,t,r,i,s){if(this.type=e,this.children=t,this.positions=r,this.length=i,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,a]of s)this.props[typeof o=="number"?o:o.id]=a}}toString(){let e=Uy.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let i=r.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new $5(this.topNode,e)}cursorAt(e,t=0,r=0){let i=rm.get(this)||this.topNode,s=new $5(i);return s.moveTo(e,t),rm.set(this,s._tree),s}get topNode(){return new si(this,0,0,null)}resolve(e,t=0){let r=Dp(rm.get(this)||this.topNode,e,t,!1);return rm.set(this,r),r}resolveInner(e,t=0){let r=Dp($E.get(this)||this.topNode,e,t,!0);return $E.set(this,r),r}resolveStack(e,t=0){return y4e(this,e,t)}iterate(e){let{enter:t,leave:r,from:i=0,to:s=this.length}=e,o=e.mode||0,a=(o&kn.IncludeAnonymous)>0;for(let l=this.cursor(o|kn.IncludeAnonymous);;){let c=!1;if(l.from<=s&&l.to>=i&&(!a&&l.type.isAnonymous||t(l)!==!1)){if(l.firstChild())continue;c=!0}for(;c&&r&&(a||!l.type.isAnonymous)&&r(l),!l.nextSibling();){if(!l.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:X7(oi.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,i)=>new vn(this.type,t,r,i,this.propValues),e.makeTree||((t,r,i)=>new vn(oi.none,t,r,i)))}static build(e){return v4e(e)}}vn.empty=new vn(oi.none,[],[],0);class V7{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new V7(this.buffer,this.index)}}class Bl{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return oi.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],i=this.set.types[t],s=i.name;if(/\W/.test(s)&&!i.isError&&(s=JSON.stringify(s)),e+=4,r==e)return s;let o=[];for(;e<r;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,t,r,i,s){let{buffer:o}=this,a=-1;for(let l=e;l!=t&&!(HU(s,i,o[l+1],o[l+2])&&(a=l,r>0));l=o[l+3]);return a}slice(e,t,r){let i=this.buffer,s=new Uint16Array(t-e),o=0;for(let a=e,l=0;a<t;){s[l++]=i[a++],s[l++]=i[a++]-r;let c=s[l++]=i[a++]-r;s[l++]=i[a++]-e,o=Math.max(o,c)}return new Bl(s,o,this.set)}}function HU(n,e,t,r){switch(n){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function Dp(n,e,t,r){for(var i;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let o=!r&&n instanceof si&&n.index<0?null:n.parent;if(!o)return n;n=o}let s=r?0:kn.IgnoreOverlays;if(r)for(let o=n,a=o.parent;a;o=a,a=o.parent)o instanceof si&&o.index<0&&((i=a.enter(e,t,s))===null||i===void 0?void 0:i.from)!=o.from&&(n=a);for(;;){let o=n.enter(e,t,s);if(!o)return n;n=o}}class QU{cursor(e=0){return new $5(this,e)}getChild(e,t=null,r=null){let i=FE(this,e,t,r);return i.length?i[0]:null}getChildren(e,t=null,r=null){return FE(this,e,t,r)}resolve(e,t=0){return Dp(this,e,t,!1)}resolveInner(e,t=0){return Dp(this,e,t,!0)}matchContext(e){return N5(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let i=t.lastChild;if(!i||i.to!=t.to)break;i.type.isError&&i.from==i.to?(r=t,t=i.prevSibling):t=i}return r}get node(){return this}get next(){return this.parent}}class si extends QU{constructor(e,t,r,i){super(),this._tree=e,this.from=t,this.index=r,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,i,s=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,c=t>0?a.length:-1;e!=c;e+=t){let u=a[e],d=l[e]+o.from;if(HU(i,r,d,d+u.length)){if(u instanceof Bl){if(s&kn.ExcludeBuffers)continue;let h=u.findChild(0,u.buffer.length,t,r-d,i);if(h>-1)return new go(new g4e(o,u,e,d),null,h)}else if(s&kn.IncludeAnonymous||!u.type.isAnonymous||G7(u)){let h;if(!(s&kn.IgnoreMounts)&&(h=Uy.get(u))&&!h.overlay)return new si(h.tree,d,e,o);let p=new si(u,d,e,o);return s&kn.IncludeAnonymous||!p.type.isAnonymous?p:p.nextChild(t<0?u.children.length-1:0,t,r,i)}}}if(s&kn.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let i;if(!(r&kn.IgnoreOverlays)&&(i=Uy.get(this._tree))&&i.overlay){let s=e-this.from;for(let{from:o,to:a}of i.overlay)if((t>0?o<=s:o<s)&&(t<0?a>=s:a>s))return new si(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function FE(n,e,t,r){let i=n.cursor(),s=[];if(!i.firstChild())return s;if(t!=null){for(let o=!1;!o;)if(o=i.type.is(t),!i.nextSibling())return s}for(;;){if(r!=null&&i.type.is(r))return s;if(i.type.is(e)&&s.push(i.node),!i.nextSibling())return r==null?s:[]}}function N5(n,e,t=e.length-1){for(let r=n;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}class g4e{constructor(e,t,r,i){this.parent=e,this.buffer=t,this.index=r,this.start=i}}class go extends QU{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:i}=this.context,s=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.context.start,r);return s<0?null:new go(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&kn.ExcludeBuffers)return null;let{buffer:i}=this.context,s=i.findChild(this.index+4,i.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new go(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new go(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new go(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,i=this.index+4,s=r.buffer[this.index+3];if(s>i){let o=r.buffer[this.index+1];e.push(r.slice(i,s,o)),t.push(0)}return new vn(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function qU(n){if(!n.length)return null;let e=0,t=n[0];for(let s=1;s<n.length;s++){let o=n[s];(o.from>t.from||o.to<t.to)&&(t=o,e=s)}let r=t instanceof si&&t.index<0?null:t.parent,i=n.slice();return r?i[e]=r:i.splice(e,1),new m4e(i,t)}class m4e{constructor(e,t){this.heads=e,this.node=t}get next(){return qU(this.heads)}}function y4e(n,e,t){let r=n.resolveInner(e,t),i=null;for(let s=r instanceof si?r:r.context.parent;s;s=s.parent)if(s.index<0){let o=s.parent;(i||(i=[r])).push(o.resolve(e,t)),s=o}else{let o=Uy.get(s.tree);if(o&&o.overlay&&o.overlay[0].from<=e&&o.overlay[o.overlay.length-1].to>=e){let a=new si(o.tree,o.overlay[0].from+s.from,-1,s);(i||(i=[r])).push(Dp(a,e,t,!1))}}return i?qU(i):r}class $5{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof si)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:r,buffer:i}=this.buffer;return this.type=t||i.set.types[i.buffer[e]],this.from=r+i.buffer[e+1],this.to=r+i.buffer[e+2],!0}yield(e){return e?e instanceof si?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:i}=this.buffer,s=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.buffer.start,r);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?r&kn.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&kn.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&kn.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let i=r<0?0:this.stack[r]+4;if(this.index!=i)return this.yieldBuf(t.findChild(i,this.index,-1,0,4))}else{let i=t.buffer[this.index+3];if(i<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(i)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:i}=this;if(i){if(e>0){if(this.index<i.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(i.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:r}=i)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let s=t+e,o=e<0?-1:r._tree.children.length;s!=o;s+=e){let a=r._tree.children[s];if(this.mode&kn.IncludeAnonymous||a instanceof Bl||!a.type.isAnonymous||G7(a))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let i=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==i){if(i==this.index)return o;t=o,r=s+1;break e}i=this.stack[--s]}for(let i=r;i<this.stack.length;i++)t=new go(this.buffer,t,this.stack[i]);return this.bufferNode=new go(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let i=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(i=!0)}for(;;){if(i&&t&&t(this),i=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,i=!0}}}matchContext(e){if(!this.buffer)return N5(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let i=e.length-1,s=this.stack.length-1;i>=0;s--){if(s<0)return N5(this._tree,e,i);let o=r[t.buffer[this.stack[s]]];if(!o.isAnonymous){if(e[i]&&e[i]!=o.name)return!1;i--}}return!0}}function G7(n){return n.children.some(e=>e instanceof Bl||!e.type.isAnonymous||G7(e))}function v4e(n){var e;let{buffer:t,nodeSet:r,maxBufferLength:i=UU,reused:s=[],minRepeatType:o=r.types.length}=n,a=Array.isArray(t)?new V7(t,t.length):t,l=r.types,c=0,u=0;function d(T,E,C,M,A,D){let{id:N,start:F,end:j,size:L}=a,U=u,Y=c;for(;L<0;)if(a.next(),L==-1){let le=s[N];C.push(le),M.push(F-T);return}else if(L==-3){c=N;return}else if(L==-4){u=N;return}else throw new RangeError(`Unrecognized record size: ${L}`);let V=l[N],W,J,ne=F-T;if(j-F<=i&&(J=S(a.pos-E,A))){let le=new Uint16Array(J.size-J.skip),ue=a.pos-J.size,Pe=le.length;for(;a.pos>ue;)Pe=y(J.start,le,Pe);W=new Bl(le,j-J.start,r),ne=J.start-T}else{let le=a.pos-L;a.next();let ue=[],Pe=[],je=N>=o?N:-1,he=0,et=j;for(;a.pos>le;)je>=0&&a.id==je&&a.size>=0?(a.end<=et-i&&(g(ue,Pe,F,he,a.end,et,je,U,Y),he=ue.length,et=a.end),a.next()):D>2500?h(F,le,ue,Pe):d(F,le,ue,Pe,je,D+1);if(je>=0&&he>0&&he<ue.length&&g(ue,Pe,F,he,F,et,je,U,Y),ue.reverse(),Pe.reverse(),je>-1&&he>0){let Ue=p(V,Y);W=X7(V,ue,Pe,0,ue.length,0,j-F,Ue,Ue)}else W=m(V,ue,Pe,j-F,U-j,Y)}C.push(W),M.push(ne)}function h(T,E,C,M){let A=[],D=0,N=-1;for(;a.pos>E;){let{id:F,start:j,end:L,size:U}=a;if(U>4)a.next();else{if(N>-1&&j<N)break;N<0&&(N=L-i),A.push(F,j,L),D++,a.next()}}if(D){let F=new Uint16Array(D*4),j=A[A.length-2];for(let L=A.length-3,U=0;L>=0;L-=3)F[U++]=A[L],F[U++]=A[L+1]-j,F[U++]=A[L+2]-j,F[U++]=U;C.push(new Bl(F,A[2]-j,r)),M.push(j-T)}}function p(T,E){return(C,M,A)=>{let D=0,N=C.length-1,F,j;if(N>=0&&(F=C[N])instanceof vn){if(!N&&F.type==T&&F.length==A)return F;(j=F.prop(Ge.lookAhead))&&(D=M[N]+F.length+j)}return m(T,C,M,A,D,E)}}function g(T,E,C,M,A,D,N,F,j){let L=[],U=[];for(;T.length>M;)L.push(T.pop()),U.push(E.pop()+C-A);T.push(m(r.types[N],L,U,D-A,F-D,j)),E.push(A-C)}function m(T,E,C,M,A,D,N){if(D){let F=[Ge.contextHash,D];N=N?[F].concat(N):[F]}if(A>25){let F=[Ge.lookAhead,A];N=N?[F].concat(N):[F]}return new vn(T,E,C,M,N)}function S(T,E){let C=a.fork(),M=0,A=0,D=0,N=C.end-i,F={size:0,start:0,skip:0};e:for(let j=C.pos-T;C.pos>j;){let L=C.size;if(C.id==E&&L>=0){F.size=M,F.start=A,F.skip=D,D+=4,M+=4,C.next();continue}let U=C.pos-L;if(L<0||U<j||C.start<N)break;let Y=C.id>=o?4:0,V=C.start;for(C.next();C.pos>U;){if(C.size<0)if(C.size==-3)Y+=4;else break e;else C.id>=o&&(Y+=4);C.next()}A=V,M+=L,D+=Y}return(E<0||M==T)&&(F.size=M,F.start=A,F.skip=D),F.size>4?F:void 0}function y(T,E,C){let{id:M,start:A,end:D,size:N}=a;if(a.next(),N>=0&&M<o){let F=C;if(N>4){let j=a.pos-(N-4);for(;a.pos>j;)C=y(T,E,C)}E[--C]=F,E[--C]=D-T,E[--C]=A-T,E[--C]=M}else N==-3?c=M:N==-4&&(u=M);return C}let x=[],w=[];for(;a.pos>0;)d(n.start||0,n.bufferStart||0,x,w,-1,0);let O=(e=n.length)!==null&&e!==void 0?e:x.length?w[0]+x[0].length:0;return new vn(l[n.topID],x.reverse(),w.reverse(),O)}const BE=new WeakMap;function f1(n,e){if(!n.isAnonymous||e instanceof Bl||e.type!=n)return 1;let t=BE.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=n||!(r instanceof vn)){t=1;break}t+=f1(n,r)}BE.set(e,t)}return t}function X7(n,e,t,r,i,s,o,a,l){let c=0;for(let g=r;g<i;g++)c+=f1(n,e[g]);let u=Math.ceil(c*1.5/8),d=[],h=[];function p(g,m,S,y,x){for(let w=S;w<y;){let O=w,T=m[w],E=f1(n,g[w]);for(w++;w<y;w++){let C=f1(n,g[w]);if(E+C>=u)break;E+=C}if(w==O+1){if(E>u){let C=g[O];p(C.children,C.positions,0,C.children.length,m[O]+x);continue}d.push(g[O])}else{let C=m[w-1]+g[w-1].length-T;d.push(X7(n,g,m,O,w,T,C,null,l))}h.push(T+x-s)}}return p(e,t,r,i,0),(a||l)(d,h,o)}class S4e{constructor(){this.map=new WeakMap}setBuffer(e,t,r){let i=this.map.get(e);i||this.map.set(e,i=new Map),i.set(t,r)}getBuffer(e,t){let r=this.map.get(e);return r&&r.get(t)}set(e,t){e instanceof go?this.setBuffer(e.context.buffer,e.index,t):e instanceof si&&this.map.set(e.tree,t)}get(e){return e instanceof go?this.getBuffer(e.context.buffer,e.index):e instanceof si?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class Ac{constructor(e,t,r,i,s=!1,o=!1){this.from=e,this.to=t,this.tree=r,this.offset=i,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],r=!1){let i=[new Ac(0,e.length,e,0,!1,r)];for(let s of t)s.to>e.length&&i.push(s);return i}static applyChanges(e,t,r=128){if(!t.length)return e;let i=[],s=1,o=e.length?e[0]:null;for(let a=0,l=0,c=0;;a++){let u=a<t.length?t[a]:null,d=u?u.fromA:1e9;if(d-l>=r)for(;o&&o.from<d;){let h=o;if(l>=h.from||d<=h.to||c){let p=Math.max(h.from,l)-c,g=Math.min(h.to,d)-c;h=p>=g?null:new Ac(p,g,h.tree,h.offset+c,a>0,!!u)}if(h&&i.push(h),o.to>d)break;o=s<e.length?e[s++]:null}if(!u)break;l=u.toA,c=u.toA-u.toB}return i}}class WU{startParse(e,t,r){return typeof e=="string"&&(e=new x4e(e)),r=r?r.length?r.map(i=>new sw(i.from,i.to)):[new sw(0,0)]:[new sw(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let i=this.startParse(e,t,r);for(;;){let s=i.advance();if(s)return s}}}class x4e{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new Ge({perNode:!0});let w4e=0;class Wi{constructor(e,t,r,i){this.name=e,this.set=t,this.base=r,this.modified=i,this.id=w4e++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let r=typeof e=="string"?e:"?";if(e instanceof Wi&&(t=e),t!=null&&t.base)throw new Error("Can not derive from a modified tag");let i=new Wi(r,[],null,[]);if(i.set.push(i),t)for(let s of t.set)i.set.push(s);return i}static defineModifier(e){let t=new Hy(e);return r=>r.modified.indexOf(t)>-1?r:Hy.get(r.base||r,r.modified.concat(t).sort((i,s)=>i.id-s.id))}}let b4e=0;class Hy{constructor(e){this.name=e,this.instances=[],this.id=b4e++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find(a=>a.base==e&&O4e(t,a.modified));if(r)return r;let i=[],s=new Wi(e.name,i,e,t);for(let a of t)a.instances.push(s);let o=k4e(t);for(let a of e.set)if(!a.modified.length)for(let l of o)i.push(Hy.get(a,l));return s}}function O4e(n,e){return n.length==e.length&&n.every((t,r)=>t==e[r])}function k4e(n){let e=[[]];for(let t=0;t<n.length;t++)for(let r=0,i=e.length;r<i;r++)e.push(e[r].concat(n[t]));return e.sort((t,r)=>r.length-t.length)}function VU(n){let e=Object.create(null);for(let t in n){let r=n[t];Array.isArray(r)||(r=[r]);for(let i of t.split(" "))if(i){let s=[],o=2,a=i;for(let d=0;;){if(a=="..."&&d>0&&d+3==i.length){o=1;break}let h=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!h)throw new RangeError("Invalid path: "+i);if(s.push(h[0]=="*"?"":h[0][0]=='"'?JSON.parse(h[0]):h[0]),d+=h[0].length,d==i.length)break;let p=i[d++];if(d==i.length&&p=="!"){o=0;break}if(p!="/")throw new RangeError("Invalid path: "+i);a=i.slice(d)}let l=s.length-1,c=s[l];if(!c)throw new RangeError("Invalid path: "+i);let u=new Qy(r,o,l>0?s.slice(0,l):null);e[c]=u.sort(e[c])}}return GU.add(e)}const GU=new Ge;class Qy{constructor(e,t,r,i){this.tags=e,this.mode=t,this.context=r,this.next=i}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Qy.empty=new Qy([],2,null);function XU(n,e){let t=Object.create(null);for(let s of n)if(!Array.isArray(s.tag))t[s.tag.id]=s.class;else for(let o of s.tag)t[o.id]=s.class;let{scope:r,all:i=null}=e||{};return{style:s=>{let o=i;for(let a of s)for(let l of a.set){let c=t[l.id];if(c){o=o?o+" "+c:c;break}}return o},scope:r}}function C4e(n,e){let t=null;for(let r of n){let i=r.style(e);i&&(t=t?t+" "+i:i)}return t}function P4e(n,e,t,r=0,i=n.length){let s=new T4e(r,Array.isArray(e)?e:[e],t);s.highlightRange(n.cursor(),r,i,"",s.highlighters),s.flush(i)}class T4e{constructor(e,t,r){this.at=e,this.highlighters=t,this.span=r,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,r,i,s){let{type:o,from:a,to:l}=e;if(a>=r||l<=t)return;o.isTop&&(s=this.highlighters.filter(p=>!p.scope||p.scope(o)));let c=i,u=E4e(e)||Qy.empty,d=C4e(s,u.tags);if(d&&(c&&(c+=" "),c+=d,u.mode==1&&(i+=(i?" ":"")+d)),this.startSpan(Math.max(t,a),c),u.opaque)return;let h=e.tree&&e.tree.prop(Ge.mounted);if(h&&h.overlay){let p=e.node.enter(h.overlay[0].from+a,1),g=this.highlighters.filter(S=>!S.scope||S.scope(h.tree.type)),m=e.firstChild();for(let S=0,y=a;;S++){let x=S<h.overlay.length?h.overlay[S]:null,w=x?x.from+a:l,O=Math.max(t,y),T=Math.min(r,w);if(O<T&&m)for(;e.from<T&&(this.highlightRange(e,O,T,i,s),this.startSpan(Math.min(T,e.to),c),!(e.to>=w||!e.nextSibling())););if(!x||w>r)break;y=x.to+a,y>t&&(this.highlightRange(p.cursor(),Math.max(t,x.from+a),Math.min(r,y),"",g),this.startSpan(Math.min(r,y),c))}m&&e.parent()}else if(e.firstChild()){h&&(i="");do if(!(e.to<=t)){if(e.from>=r)break;this.highlightRange(e,t,r,i,s),this.startSpan(Math.min(r,e.to),c)}while(e.nextSibling());e.parent()}}}function E4e(n){let e=n.type.prop(GU);for(;e&&e.context&&!n.matchContext(e.context);)e=e.next;return e||null}const fe=Wi.define,im=fe(),Za=fe(),UE=fe(Za),HE=fe(Za),Ja=fe(),sm=fe(Ja),ow=fe(Ja),Ys=fe(),fc=fe(Ys),Xs=fe(),Ks=fe(),F5=fe(),Bh=fe(F5),om=fe(),X={comment:im,lineComment:fe(im),blockComment:fe(im),docComment:fe(im),name:Za,variableName:fe(Za),typeName:UE,tagName:fe(UE),propertyName:HE,attributeName:fe(HE),className:fe(Za),labelName:fe(Za),namespace:fe(Za),macroName:fe(Za),literal:Ja,string:sm,docString:fe(sm),character:fe(sm),attributeValue:fe(sm),number:ow,integer:fe(ow),float:fe(ow),bool:fe(Ja),regexp:fe(Ja),escape:fe(Ja),color:fe(Ja),url:fe(Ja),keyword:Xs,self:fe(Xs),null:fe(Xs),atom:fe(Xs),unit:fe(Xs),modifier:fe(Xs),operatorKeyword:fe(Xs),controlKeyword:fe(Xs),definitionKeyword:fe(Xs),moduleKeyword:fe(Xs),operator:Ks,derefOperator:fe(Ks),arithmeticOperator:fe(Ks),logicOperator:fe(Ks),bitwiseOperator:fe(Ks),compareOperator:fe(Ks),updateOperator:fe(Ks),definitionOperator:fe(Ks),typeOperator:fe(Ks),controlOperator:fe(Ks),punctuation:F5,separator:fe(F5),bracket:Bh,angleBracket:fe(Bh),squareBracket:fe(Bh),paren:fe(Bh),brace:fe(Bh),content:Ys,heading:fc,heading1:fe(fc),heading2:fe(fc),heading3:fe(fc),heading4:fe(fc),heading5:fe(fc),heading6:fe(fc),contentSeparator:fe(Ys),list:fe(Ys),quote:fe(Ys),emphasis:fe(Ys),strong:fe(Ys),link:fe(Ys),monospace:fe(Ys),strikethrough:fe(Ys),inserted:fe(),deleted:fe(),changed:fe(),invalid:fe(),meta:om,documentMeta:fe(om),annotation:fe(om),processingInstruction:fe(om),definition:Wi.defineModifier("definition"),constant:Wi.defineModifier("constant"),function:Wi.defineModifier("function"),standard:Wi.defineModifier("standard"),local:Wi.defineModifier("local"),special:Wi.defineModifier("special")};for(let n in X){let e=X[n];e instanceof Wi&&(e.name=n)}XU([{tag:X.link,class:"tok-link"},{tag:X.heading,class:"tok-heading"},{tag:X.emphasis,class:"tok-emphasis"},{tag:X.strong,class:"tok-strong"},{tag:X.keyword,class:"tok-keyword"},{tag:X.atom,class:"tok-atom"},{tag:X.bool,class:"tok-bool"},{tag:X.url,class:"tok-url"},{tag:X.labelName,class:"tok-labelName"},{tag:X.inserted,class:"tok-inserted"},{tag:X.deleted,class:"tok-deleted"},{tag:X.literal,class:"tok-literal"},{tag:X.string,class:"tok-string"},{tag:X.number,class:"tok-number"},{tag:[X.regexp,X.escape,X.special(X.string)],class:"tok-string2"},{tag:X.variableName,class:"tok-variableName"},{tag:X.local(X.variableName),class:"tok-variableName tok-local"},{tag:X.definition(X.variableName),class:"tok-variableName tok-definition"},{tag:X.special(X.variableName),class:"tok-variableName2"},{tag:X.definition(X.propertyName),class:"tok-propertyName tok-definition"},{tag:X.typeName,class:"tok-typeName"},{tag:X.namespace,class:"tok-namespace"},{tag:X.className,class:"tok-className"},{tag:X.macroName,class:"tok-macroName"},{tag:X.propertyName,class:"tok-propertyName"},{tag:X.operator,class:"tok-operator"},{tag:X.comment,class:"tok-comment"},{tag:X.meta,class:"tok-meta"},{tag:X.invalid,class:"tok-invalid"},{tag:X.punctuation,class:"tok-punctuation"}]);var aw;const Zu=new Ge;function I4e(n){return Ie.define({combine:n?e=>e.concat(n):void 0})}const M4e=new Ge;class Cs{constructor(e,t,r=[],i=""){this.data=e,this.name=i,ft.prototype.hasOwnProperty("tree")||Object.defineProperty(ft.prototype,"tree",{get(){return cs(this)}}),this.parser=t,this.extension=[Ud.of(this),ft.languageData.of((s,o,a)=>{let l=QE(s,o,a),c=l.type.prop(Zu);if(!c)return[];let u=s.facet(c),d=l.type.prop(M4e);if(d){let h=l.resolve(o-l.from,a);for(let p of d)if(p.test(h,s)){let g=s.facet(p.facet);return p.type=="replace"?g:g.concat(u)}}return u})].concat(r)}isActiveAt(e,t,r=-1){return QE(e,t,r).type.prop(Zu)==this.data}findRegions(e){let t=e.facet(Ud);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],i=(s,o)=>{if(s.prop(Zu)==this.data){r.push({from:o,to:o+s.length});return}let a=s.prop(Ge.mounted);if(a){if(a.tree.prop(Zu)==this.data){if(a.overlay)for(let l of a.overlay)r.push({from:l.from+o,to:l.to+o});else r.push({from:o,to:o+s.length});return}else if(a.overlay){let l=r.length;if(i(a.tree,a.overlay[0].from+o),r.length>l)return}}for(let l=0;l<s.children.length;l++){let c=s.children[l];c instanceof vn&&i(c,s.positions[l]+o)}};return i(cs(e),0),r}get allowsNesting(){return!0}}Cs.setState=Ft.define();function QE(n,e,t){let r=n.facet(Ud),i=cs(n).topNode;if(!r||r.allowsNesting)for(let s=i;s;s=s.enter(e,t,kn.ExcludeBuffers))s.type.isTop&&(i=s);return i}class qy extends Cs{constructor(e,t,r){super(e,t,[],r),this.parser=t}static define(e){let t=I4e(e.languageData);return new qy(t,e.parser.configure({props:[Zu.add(r=>r.isTop?t:void 0)]}),e.name)}configure(e,t){return new qy(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function cs(n){let e=n.field(Cs.state,!1);return e?e.tree:vn.empty}class A4e{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let Uh=null;class Wy{constructor(e,t,r=[],i,s,o,a,l){this.parser=e,this.state=t,this.fragments=r,this.tree=i,this.treeLen=s,this.viewport=o,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new Wy(e,t,[],vn.empty,0,r,[],null)}startParse(){return this.parser.startParse(new A4e(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=vn.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let i=Date.now()+e;e=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(Ac.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Ac.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=Uh;Uh=this;try{return e()}finally{Uh=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=qE(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:i,treeLen:s,viewport:o,skipped:a}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((c,u,d,h)=>l.push({fromA:c,toA:u,fromB:d,toB:h})),r=Ac.applyChanges(r,l),i=vn.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){a=[];for(let c of this.skipped){let u=e.mapPos(c.from,1),d=e.mapPos(c.to,-1);u<d&&a.push({from:u,to:d})}}}return new Wy(this.parser,t,r,i,s,o,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:i,to:s}=this.skipped[r];i<e.to&&s>e.from&&(this.fragments=qE(this.fragments,i,s),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends WU{createParse(t,r,i){let s=i[0].from,o=i[i.length-1].to;return{parsedPos:s,advance(){let l=Uh;if(l){for(let c of i)l.tempSkipped.push(c);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=o,new vn(oi.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return Uh}}function qE(n,e,t){return Ac.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class Bd{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new Bd(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=Wy.create(e.facet(Ud).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new Bd(r)}}Cs.state=Bs.define({create:Bd.init,update(n,e){for(let t of e.effects)if(t.is(Cs.setState))return t.value;return e.startState.facet(Ud)!=e.state.facet(Ud)?Bd.init(e.state):n.apply(e)}});let KU=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(KU=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const lw=typeof navigator<"u"&&(!((aw=navigator.scheduling)===null||aw===void 0)&&aw.isInputPending)?()=>navigator.scheduling.isInputPending():null,_4e=Fl.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Cs.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Cs.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=KU(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:i}}=this.view,s=r.field(Cs.state);if(s.tree==s.context.tree&&s.context.isDone(i+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!lw?Math.max(25,e.timeRemaining()-5):1e9),a=s.context.treeLen<i&&r.doc.length>i+1e3,l=s.context.work(()=>lw&&lw()||Date.now()>o,i+(a?0:1e5));this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Cs.setState.of(new Bd(s.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>po(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Ud=Ie.define({combine(n){return n.length?n[0]:null},enables:n=>[Cs.state,_4e,Ne.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]});class R4e{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const D4e=Ie.define(),IS=Ie.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function Vy(n){let e=n.facet(IS);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function Gy(n,e){let t="",r=n.tabSize,i=n.facet(IS)[0];if(i=="	"){for(;e>=r;)t+="	",e-=r;i=" "}for(let s=0;s<e;s++)t+=i;return t}function YU(n,e){n instanceof ft&&(n=new MS(n));for(let r of n.state.facet(D4e)){let i=r(n,e);if(i!==void 0)return i}let t=cs(n.state);return t.length>=e?j4e(n,t,e):null}class MS{constructor(e,t={}){this.state=e,this.options=t,this.unit=Vy(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:i,simulateDoubleBreak:s}=this.options;return i!=null&&i>=r.from&&i<=r.to?s&&i==e?{text:"",from:e}:(t<0?i<e:i<=e)?{text:r.text.slice(i-r.from),from:i}:{text:r.text.slice(0,i-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:i}=this.lineAt(e,t);return r.slice(e-i,Math.min(r.length,e+100-i))}column(e,t=1){let{text:r,from:i}=this.lineAt(e,t),s=this.countColumn(r,e-i),o=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return o>-1&&(s+=o-this.countColumn(r,r.search(/\S|$/))),s}countColumn(e,t=e.length){return kS(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:i}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let o=s(i);if(o>-1)return o}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const ZU=new Ge;function j4e(n,e,t){let r=e.resolveStack(t),i=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(i!=r.node){let s=[];for(let o=i;o&&!(o.from==r.node.from&&o.type==r.node.type);o=o.parent)s.push(o);for(let o=s.length-1;o>=0;o--)r={node:s[o],next:r}}return JU(r,n,t)}function JU(n,e,t){for(let r=n;r;r=r.next){let i=z4e(r.node);if(i)return i(K7.create(e,t,r))}return 0}function L4e(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function z4e(n){let e=n.type.prop(ZU);if(e)return e;let t=n.firstChild,r;if(t&&(r=t.type.prop(Ge.closedBy))){let i=n.lastChild,s=i&&r.indexOf(i.name)>-1;return o=>eH(o,!0,1,void 0,s&&!L4e(o)?i.from:void 0)}return n.parent==null?N4e:null}function N4e(){return 0}class K7 extends MS{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new K7(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if($4e(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return JU(this.context.next,this.base,this.pos)}}function $4e(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function F4e(n){let e=n.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let i=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),o=i==null||i<=s.from?s.to:Math.min(s.to,i);for(let a=t.to;;){let l=e.childAfter(a);if(!l||l==r)return null;if(!l.type.isSkipped){if(l.from>=o)return null;let c=/^ */.exec(s.text.slice(t.to-s.from))[0].length;return{from:t.from,to:t.to+c}}a=l.to}}function cw({closing:n,align:e=!0,units:t=1}){return r=>eH(r,e,t,n)}function eH(n,e,t,r,i){let s=n.textAfter,o=s.match(/^\s*/)[0].length,a=r&&s.slice(o,o+r.length)==r||i==n.pos+o,l=e?F4e(n):null;return l?a?n.column(l.from):n.column(l.to):n.baseIndent+(a?0:n.unit*t)}const B4e=new Ge;function U4e(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}class S0{constructor(e,t){this.specs=e;let r;function i(a){let l=zl.newName();return(r||(r=Object.create(null)))["."+l]=a,l}const s=typeof t.all=="string"?t.all:t.all?i(t.all):void 0,o=t.scope;this.scope=o instanceof Cs?a=>a.prop(Zu)==o.data:o?a=>a==o:void 0,this.style=XU(e.map(a=>({tag:a.tag,class:a.class||i(Object.assign({},a,{tag:null}))})),{all:s}).style,this.module=r?new zl(r):null,this.themeType=t.themeType}static define(e,t){return new S0(e,t||{})}}const B5=Ie.define(),H4e=Ie.define({combine(n){return n.length?[n[0]]:null}});function uw(n){let e=n.facet(B5);return e.length?e:n.facet(H4e)}function Q4e(n,e){let t=[W4e],r;return n instanceof S0&&(n.module&&t.push(Ne.styleModule.of(n.module)),r=n.themeType),r?t.push(B5.computeN([Ne.darkTheme],i=>i.facet(Ne.darkTheme)==(r=="dark")?[n]:[])):t.push(B5.of(n)),t}class q4e{constructor(e){this.markCache=Object.create(null),this.tree=cs(e.state),this.decorations=this.buildDeco(e,uw(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=cs(e.state),r=uw(e.state),i=r!=uw(e.startState),{viewport:s}=e.view,o=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!i&&t.type==this.tree.type&&o>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(t!=this.tree||e.viewportChanged||i)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return on.none;let r=new Ep;for(let{from:i,to:s}of e.visibleRanges)P4e(this.tree,t,(o,a,l)=>{r.add(o,a,this.markCache[l]||(this.markCache[l]=on.mark({class:l})))},i,s);return r.finish()}}const W4e=bS.high(Fl.fromClass(q4e,{decorations:n=>n.decorations}));X.meta,X.link,X.heading,X.emphasis,X.strong,X.strikethrough,X.keyword,X.atom,X.bool,X.url,X.contentSeparator,X.labelName,X.literal,X.inserted,X.string,X.deleted,X.regexp,X.escape,X.string,X.variableName,X.variableName,X.typeName,X.namespace,X.className,X.variableName,X.macroName,X.propertyName,X.comment,X.invalid;const V4e=1e4,G4e="()[]{}",X4e=new Ge;function U5(n,e,t){let r=n.prop(e<0?Ge.openedBy:Ge.closedBy);if(r)return r;if(n.name.length==1){let i=t.indexOf(n.name);if(i>-1&&i%2==(e<0?1:0))return[t[i+e]]}return null}function H5(n){let e=n.type.prop(X4e);return e?e(n.node):n}function Ju(n,e,t,r={}){let i=r.maxScanDistance||V4e,s=r.brackets||G4e,o=cs(n),a=o.resolveInner(e,t);for(let l=a;l;l=l.parent){let c=U5(l.type,t,s);if(c&&l.from<l.to){let u=H5(l);if(u&&(t>0?e>=u.from&&e<u.to:e>u.from&&e<=u.to))return K4e(n,e,t,l,u,c,s)}}return Y4e(n,e,t,o,a.type,i,s)}function K4e(n,e,t,r,i,s,o){let a=r.parent,l={from:i.from,to:i.to},c=0,u=a==null?void 0:a.cursor();if(u&&(t<0?u.childBefore(r.from):u.childAfter(r.to)))do if(t<0?u.to<=r.from:u.from>=r.to){if(c==0&&s.indexOf(u.type.name)>-1&&u.from<u.to){let d=H5(u);return{start:l,end:d?{from:d.from,to:d.to}:void 0,matched:!0}}else if(U5(u.type,t,o))c++;else if(U5(u.type,-t,o)){if(c==0){let d=H5(u);return{start:l,end:d&&d.from<d.to?{from:d.from,to:d.to}:void 0,matched:!1}}c--}}while(t<0?u.prevSibling():u.nextSibling());return{start:l,matched:!1}}function Y4e(n,e,t,r,i,s,o){let a=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),l=o.indexOf(a);if(l<0||l%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},u=n.doc.iterRange(e,t>0?n.doc.length:0),d=0;for(let h=0;!u.next().done&&h<=s;){let p=u.value;t<0&&(h+=p.length);let g=e+h*t;for(let m=t>0?0:p.length-1,S=t>0?p.length:-1;m!=S;m+=t){let y=o.indexOf(p[m]);if(!(y<0||r.resolveInner(g+m,1).type!=i))if(y%2==0==t>0)d++;else{if(d==1)return{start:c,end:{from:g+m,to:g+m+1},matched:y>>1==l>>1};d--}}t>0&&(h+=p.length)}return u.done?{start:c,matched:!1}:null}const Z4e=Object.create(null),WE=[oi.none],VE=[],GE=Object.create(null),J4e=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])J4e[n]=e5e(Z4e,e);function dw(n,e){VE.indexOf(n)>-1||(VE.push(n),console.warn(e))}function e5e(n,e){let t=[];for(let a of e.split(" ")){let l=[];for(let c of a.split(".")){let u=n[c]||X[c];u?typeof u=="function"?l.length?l=l.map(u):dw(c,`Modifier ${c} used at start of tag`):l.length?dw(c,`Tag ${c} used as modifier`):l=Array.isArray(u)?u:[u]:dw(c,`Unknown highlighting tag ${c}`)}for(let c of l)t.push(c)}if(!t.length)return 0;let r=e.replace(/ /g,"_"),i=r+" "+t.map(a=>a.id),s=GE[i];if(s)return s.id;let o=GE[i]=oi.define({id:WE.length,name:r,props:[VU({[r]:t})]});return WE.push(o),o.id}Pn.RTL,Pn.LTR;const t5e=n=>{let{state:e}=n,t=e.doc.lineAt(e.selection.main.from),r=Z7(n.state,t.from);return r.line?n5e(n):r.block?i5e(n):!1};function Y7(n,e){return({state:t,dispatch:r})=>{if(t.readOnly)return!1;let i=n(e,t);return i?(r(t.update(i)),!0):!1}}const n5e=Y7(a5e,0),r5e=Y7(tH,0),i5e=Y7((n,e)=>tH(n,e,o5e(e)),0);function Z7(n,e){let t=n.languageDataAt("commentTokens",e,1);return t.length?t[0]:{}}const Hh=50;function s5e(n,{open:e,close:t},r,i){let s=n.sliceDoc(r-Hh,r),o=n.sliceDoc(i,i+Hh),a=/\s*$/.exec(s)[0].length,l=/^\s*/.exec(o)[0].length,c=s.length-a;if(s.slice(c-e.length,c)==e&&o.slice(l,l+t.length)==t)return{open:{pos:r-a,margin:a&&1},close:{pos:i+l,margin:l&&1}};let u,d;i-r<=2*Hh?u=d=n.sliceDoc(r,i):(u=n.sliceDoc(r,r+Hh),d=n.sliceDoc(i-Hh,i));let h=/^\s*/.exec(u)[0].length,p=/\s*$/.exec(d)[0].length,g=d.length-p-t.length;return u.slice(h,h+e.length)==e&&d.slice(g,g+t.length)==t?{open:{pos:r+h+e.length,margin:/\s/.test(u.charAt(h+e.length))?1:0},close:{pos:i-p-t.length,margin:/\s/.test(d.charAt(g-1))?1:0}}:null}function o5e(n){let e=[];for(let t of n.selection.ranges){let r=n.doc.lineAt(t.from),i=t.to<=r.to?r:n.doc.lineAt(t.to);i.from>r.from&&i.from==t.to&&(i=t.to==r.to+1?r:n.doc.lineAt(t.to-1));let s=e.length-1;s>=0&&e[s].to>r.from?e[s].to=i.to:e.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:i.to})}return e}function tH(n,e,t=e.selection.ranges){let r=t.map(s=>Z7(e,s.from).block);if(!r.every(s=>s))return null;let i=t.map((s,o)=>s5e(e,r[o],s.from,s.to));if(n!=2&&!i.every(s=>s))return{changes:e.changes(t.map((s,o)=>i[o]?[]:[{from:s.from,insert:r[o].open+" "},{from:s.to,insert:" "+r[o].close}]))};if(n!=1&&i.some(s=>s)){let s=[];for(let o=0,a;o<i.length;o++)if(a=i[o]){let l=r[o],{open:c,close:u}=a;s.push({from:c.pos-l.open.length,to:c.pos+c.margin},{from:u.pos-u.margin,to:u.pos+l.close.length})}return{changes:s}}return null}function a5e(n,e,t=e.selection.ranges){let r=[],i=-1;for(let{from:s,to:o}of t){let a=r.length,l=1e9,c=Z7(e,s).line;if(c){for(let u=s;u<=o;){let d=e.doc.lineAt(u);if(d.from>i&&(s==o||o>d.from)){i=d.from;let h=/^\s*/.exec(d.text)[0].length,p=h==d.length,g=d.text.slice(h,h+c.length)==c?h:-1;h<d.text.length&&h<l&&(l=h),r.push({line:d,comment:g,token:c,indent:h,empty:p,single:!1})}u=d.to+1}if(l<1e9)for(let u=a;u<r.length;u++)r[u].indent<r[u].line.text.length&&(r[u].indent=l);r.length==a+1&&(r[a].single=!0)}}if(n!=2&&r.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:a,token:l,indent:c,empty:u,single:d}of r)(d||!u)&&s.push({from:a.from+c,insert:l+" "});let o=e.changes(s);return{changes:o,selection:e.selection.map(o,1)}}else if(n!=1&&r.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:a,token:l}of r)if(a>=0){let c=o.from+a,u=c+l.length;o.text[u-o.from]==" "&&u++,s.push({from:c,to:u})}return{changes:s}}return null}const Q5=zo.define(),l5e=zo.define(),c5e=Ie.define(),nH=Ie.define({combine(n){return D7(n,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(r,i)=>e(r,i)||t(r,i)})}}),rH=Bs.define({create(){return mo.empty},update(n,e){let t=e.state.facet(nH),r=e.annotation(Q5);if(r){let l=ei.fromTransaction(e,r.selection),c=r.side,u=c==0?n.undone:n.done;return l?u=Xy(u,u.length,t.minDepth,l):u=oH(u,e.startState.selection),new mo(c==0?r.rest:u,c==0?u:r.rest)}let i=e.annotation(l5e);if((i=="full"||i=="before")&&(n=n.isolate()),e.annotation(yn.addToHistory)===!1)return e.changes.empty?n:n.addMapping(e.changes.desc);let s=ei.fromTransaction(e),o=e.annotation(yn.time),a=e.annotation(yn.userEvent);return s?n=n.addChanges(s,o,a,t,e):e.selection&&(n=n.addSelection(e.startState.selection,o,a,t.newGroupDelay)),(i=="full"||i=="after")&&(n=n.isolate()),n},toJSON(n){return{done:n.done.map(e=>e.toJSON()),undone:n.undone.map(e=>e.toJSON())}},fromJSON(n){return new mo(n.done.map(ei.fromJSON),n.undone.map(ei.fromJSON))}});function u5e(n={}){return[rH,nH.of(n),Ne.domEventHandlers({beforeinput(e,t){let r=e.inputType=="historyUndo"?iH:e.inputType=="historyRedo"?q5:null;return r?(e.preventDefault(),r(t)):!1}})]}function AS(n,e){return function({state:t,dispatch:r}){if(!e&&t.readOnly)return!1;let i=t.field(rH,!1);if(!i)return!1;let s=i.pop(n,t,e);return s?(r(s),!0):!1}}const iH=AS(0,!1),q5=AS(1,!1),d5e=AS(0,!0),h5e=AS(1,!0);class ei{constructor(e,t,r,i,s){this.changes=e,this.effects=t,this.mapped=r,this.startSelection=i,this.selectionsAfter=s}setSelAfter(e){return new ei(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(i=>i.toJSON())}}static fromJSON(e){return new ei(e.changes&&On.fromJSON(e.changes),[],e.mapped&&bo.fromJSON(e.mapped),e.startSelection&&ce.fromJSON(e.startSelection),e.selectionsAfter.map(ce.fromJSON))}static fromTransaction(e,t){let r=Yi;for(let i of e.startState.facet(c5e)){let s=i(e);s.length&&(r=r.concat(s))}return!r.length&&e.changes.empty?null:new ei(e.changes.invert(e.startState.doc),r,void 0,t||e.startState.selection,Yi)}static selection(e){return new ei(void 0,Yi,void 0,void 0,e)}}function Xy(n,e,t,r){let i=e+1>t+20?e-t-1:0,s=n.slice(i,e);return s.push(r),s}function f5e(n,e){let t=[],r=!1;return n.iterChangedRanges((i,s)=>t.push(i,s)),e.iterChangedRanges((i,s,o,a)=>{for(let l=0;l<t.length;){let c=t[l++],u=t[l++];a>=c&&o<=u&&(r=!0)}}),r}function p5e(n,e){return n.ranges.length==e.ranges.length&&n.ranges.filter((t,r)=>t.empty!=e.ranges[r].empty).length===0}function sH(n,e){return n.length?e.length?n.concat(e):n:e}const Yi=[],g5e=200;function oH(n,e){if(n.length){let t=n[n.length-1],r=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-g5e));return r.length&&r[r.length-1].eq(e)?n:(r.push(e),Xy(n,n.length-1,1e9,t.setSelAfter(r)))}else return[ei.selection([e])]}function m5e(n){let e=n[n.length-1],t=n.slice();return t[n.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function hw(n,e){if(!n.length)return n;let t=n.length,r=Yi;for(;t;){let i=y5e(n[t-1],e,r);if(i.changes&&!i.changes.empty||i.effects.length){let s=n.slice(0,t);return s[t-1]=i,s}else e=i.mapped,t--,r=i.selectionsAfter}return r.length?[ei.selection(r)]:Yi}function y5e(n,e,t){let r=sH(n.selectionsAfter.length?n.selectionsAfter.map(a=>a.map(e)):Yi,t);if(!n.changes)return ei.selection(r);let i=n.changes.map(e),s=e.mapDesc(n.changes,!0),o=n.mapped?n.mapped.composeDesc(s):s;return new ei(i,Ft.mapEffects(n.effects,e),o,n.startSelection.map(s),r)}const v5e=/^(input\.type|delete)($|\.)/;class mo{constructor(e,t,r=0,i=void 0){this.done=e,this.undone=t,this.prevTime=r,this.prevUserEvent=i}isolate(){return this.prevTime?new mo(this.done,this.undone):this}addChanges(e,t,r,i,s){let o=this.done,a=o[o.length-1];return a&&a.changes&&!a.changes.empty&&e.changes&&(!r||v5e.test(r))&&(!a.selectionsAfter.length&&t-this.prevTime<i.newGroupDelay&&i.joinToEvent(s,f5e(a.changes,e.changes))||r=="input.type.compose")?o=Xy(o,o.length-1,i.minDepth,new ei(e.changes.compose(a.changes),sH(Ft.mapEffects(e.effects,a.changes),a.effects),a.mapped,a.startSelection,Yi)):o=Xy(o,o.length,i.minDepth,e),new mo(o,Yi,t,r)}addSelection(e,t,r,i){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:Yi;return s.length>0&&t-this.prevTime<i&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&p5e(s[s.length-1],e)?this:new mo(oH(this.done,e),this.undone,t,r)}addMapping(e){return new mo(hw(this.done,e),hw(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,r){let i=e==0?this.done:this.undone;if(i.length==0)return null;let s=i[i.length-1],o=s.selectionsAfter[0]||t.selection;if(r&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Q5.of({side:e,rest:m5e(i),selection:o}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let a=i.length==1?Yi:i.slice(0,i.length-1);return s.mapped&&(a=hw(a,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Q5.of({side:e,rest:a,selection:o}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}mo.empty=new mo(Yi,Yi);const S5e=[{key:"Mod-z",run:iH,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:q5,preventDefault:!0},{linux:"Ctrl-Shift-z",run:q5,preventDefault:!0},{key:"Mod-u",run:d5e,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:h5e,preventDefault:!0}];function ah(n,e){return ce.create(n.ranges.map(e),n.mainIndex)}function No(n,e){return n.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Us({state:n,dispatch:e},t){let r=ah(n.selection,t);return r.eq(n.selection,!0)?!1:(e(No(n,r)),!0)}function _S(n,e){return ce.cursor(e?n.to:n.from)}function aH(n,e){return Us(n,t=>t.empty?n.moveByChar(t,e):_S(t,e))}function xr(n){return n.textDirectionAt(n.state.selection.main.head)==Pn.LTR}const lH=n=>aH(n,!xr(n)),cH=n=>aH(n,xr(n));function uH(n,e){return Us(n,t=>t.empty?n.moveByGroup(t,e):_S(t,e))}const x5e=n=>uH(n,!xr(n)),w5e=n=>uH(n,xr(n));function b5e(n,e,t){if(e.type.prop(t))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(n.sliceDoc(e.from,e.to)))||e.firstChild}function RS(n,e,t){let r=cs(n).resolveInner(e.head),i=t?Ge.closedBy:Ge.openedBy;for(let l=e.head;;){let c=t?r.childAfter(l):r.childBefore(l);if(!c)break;b5e(n,c,i)?r=c:l=t?c.to:c.from}let s=r.type.prop(i),o,a;return s&&(o=t?Ju(n,r.from,1):Ju(n,r.to,-1))&&o.matched?a=t?o.end.to:o.end.from:a=t?r.to:r.from,ce.cursor(a,t?-1:1)}const O5e=n=>Us(n,e=>RS(n.state,e,!xr(n))),k5e=n=>Us(n,e=>RS(n.state,e,xr(n)));function dH(n,e){return Us(n,t=>{if(!t.empty)return _S(t,e);let r=n.moveVertically(t,e);return r.head!=t.head?r:n.moveToLineBoundary(t,e)})}const hH=n=>dH(n,!1),fH=n=>dH(n,!0);function pH(n){let e=n.scrollDOM.clientHeight<n.scrollDOM.scrollHeight-2,t=0,r=0,i;if(e){for(let s of n.state.facet(Ne.scrollMargins)){let o=s(n);o!=null&&o.top&&(t=Math.max(o==null?void 0:o.top,t)),o!=null&&o.bottom&&(r=Math.max(o==null?void 0:o.bottom,r))}i=n.scrollDOM.clientHeight-t-r}else i=(n.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:r,selfScroll:e,height:Math.max(n.defaultLineHeight,i-5)}}function gH(n,e){let t=pH(n),{state:r}=n,i=ah(r.selection,o=>o.empty?n.moveVertically(o,e,t.height):_S(o,e));if(i.eq(r.selection))return!1;let s;if(t.selfScroll){let o=n.coordsAtPos(r.selection.main.head),a=n.scrollDOM.getBoundingClientRect(),l=a.top+t.marginTop,c=a.bottom-t.marginBottom;o&&o.top>l&&o.bottom<c&&(s=Ne.scrollIntoView(i.main.head,{y:"start",yMargin:o.top-l}))}return n.dispatch(No(r,i),{effects:s}),!0}const XE=n=>gH(n,!1),W5=n=>gH(n,!0);function rc(n,e,t){let r=n.lineBlockAt(e.head),i=n.moveToLineBoundary(e,t);if(i.head==e.head&&i.head!=(t?r.to:r.from)&&(i=n.moveToLineBoundary(e,t,!1)),!t&&i.head==r.from&&r.length){let s=/^\s*/.exec(n.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;s&&e.head!=r.from+s&&(i=ce.cursor(r.from+s))}return i}const C5e=n=>Us(n,e=>rc(n,e,!0)),P5e=n=>Us(n,e=>rc(n,e,!1)),T5e=n=>Us(n,e=>rc(n,e,!xr(n))),E5e=n=>Us(n,e=>rc(n,e,xr(n))),I5e=n=>Us(n,e=>ce.cursor(n.lineBlockAt(e.head).from,1)),M5e=n=>Us(n,e=>ce.cursor(n.lineBlockAt(e.head).to,-1));function A5e(n,e,t){let r=!1,i=ah(n.selection,s=>{let o=Ju(n,s.head,-1)||Ju(n,s.head,1)||s.head>0&&Ju(n,s.head-1,1)||s.head<n.doc.length&&Ju(n,s.head+1,-1);if(!o||!o.end)return s;r=!0;let a=o.start.from==s.head?o.end.to:o.end.from;return ce.cursor(a)});return r?(e(No(n,i)),!0):!1}const _5e=({state:n,dispatch:e})=>A5e(n,e);function hs(n,e){let t=ah(n.state.selection,r=>{let i=e(r);return ce.range(r.anchor,i.head,i.goalColumn,i.bidiLevel||void 0)});return t.eq(n.state.selection)?!1:(n.dispatch(No(n.state,t)),!0)}function mH(n,e){return hs(n,t=>n.moveByChar(t,e))}const yH=n=>mH(n,!xr(n)),vH=n=>mH(n,xr(n));function SH(n,e){return hs(n,t=>n.moveByGroup(t,e))}const R5e=n=>SH(n,!xr(n)),D5e=n=>SH(n,xr(n)),j5e=n=>hs(n,e=>RS(n.state,e,!xr(n))),L5e=n=>hs(n,e=>RS(n.state,e,xr(n)));function xH(n,e){return hs(n,t=>n.moveVertically(t,e))}const wH=n=>xH(n,!1),bH=n=>xH(n,!0);function OH(n,e){return hs(n,t=>n.moveVertically(t,e,pH(n).height))}const KE=n=>OH(n,!1),YE=n=>OH(n,!0),z5e=n=>hs(n,e=>rc(n,e,!0)),N5e=n=>hs(n,e=>rc(n,e,!1)),$5e=n=>hs(n,e=>rc(n,e,!xr(n))),F5e=n=>hs(n,e=>rc(n,e,xr(n))),B5e=n=>hs(n,e=>ce.cursor(n.lineBlockAt(e.head).from)),U5e=n=>hs(n,e=>ce.cursor(n.lineBlockAt(e.head).to)),ZE=({state:n,dispatch:e})=>(e(No(n,{anchor:0})),!0),JE=({state:n,dispatch:e})=>(e(No(n,{anchor:n.doc.length})),!0),eI=({state:n,dispatch:e})=>(e(No(n,{anchor:n.selection.main.anchor,head:0})),!0),tI=({state:n,dispatch:e})=>(e(No(n,{anchor:n.selection.main.anchor,head:n.doc.length})),!0),H5e=({state:n,dispatch:e})=>(e(n.update({selection:{anchor:0,head:n.doc.length},userEvent:"select"})),!0),Q5e=({state:n,dispatch:e})=>{let t=DS(n).map(({from:r,to:i})=>ce.range(r,Math.min(i+1,n.doc.length)));return e(n.update({selection:ce.create(t),userEvent:"select"})),!0},q5e=({state:n,dispatch:e})=>{let t=ah(n.selection,r=>{let i=cs(n),s=i.resolveStack(r.from,1);if(r.empty){let o=i.resolveStack(r.from,-1);o.node.from>=s.node.from&&o.node.to<=s.node.to&&(s=o)}for(let o=s;o;o=o.next){let{node:a}=o;if((a.from<r.from&&a.to>=r.to||a.to>r.to&&a.from<=r.from)&&o.next)return ce.range(a.to,a.from)}return r});return t.eq(n.selection)?!1:(e(No(n,t)),!0)},W5e=({state:n,dispatch:e})=>{let t=n.selection,r=null;return t.ranges.length>1?r=ce.create([t.main]):t.main.empty||(r=ce.create([ce.cursor(t.main.head)])),r?(e(No(n,r)),!0):!1};function x0(n,e){if(n.state.readOnly)return!1;let t="delete.selection",{state:r}=n,i=r.changeByRange(s=>{let{from:o,to:a}=s;if(o==a){let l=e(s);l<o?(t="delete.backward",l=am(n,l,!1)):l>o&&(t="delete.forward",l=am(n,l,!0)),o=Math.min(o,l),a=Math.max(a,l)}else o=am(n,o,!1),a=am(n,a,!0);return o==a?{range:s}:{changes:{from:o,to:a},range:ce.cursor(o,o<s.head?-1:1)}});return i.changes.empty?!1:(n.dispatch(r.update(i,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?Ne.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function am(n,e,t){if(n instanceof Ne)for(let r of n.state.facet(Ne.atomicRanges).map(i=>i(n)))r.between(e,e,(i,s)=>{i<e&&s>e&&(e=t?s:i)});return e}const kH=(n,e,t)=>x0(n,r=>{let i=r.from,{state:s}=n,o=s.doc.lineAt(i),a,l;if(t&&!e&&i>o.from&&i<o.from+200&&!/[^ \t]/.test(a=o.text.slice(0,i-o.from))){if(a[a.length-1]=="	")return i-1;let c=kS(a,s.tabSize),u=c%Vy(s)||Vy(s);for(let d=0;d<u&&a[a.length-1-d]==" ";d++)i--;l=i}else l=Tr(o.text,i-o.from,e,e)+o.from,l==i&&o.number!=(e?s.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(o.text.slice(l-o.from,i-o.from))&&(l=Tr(o.text,l-o.from,!1,!1)+o.from);return l}),V5=n=>kH(n,!1,!0),CH=n=>kH(n,!0,!1),PH=(n,e)=>x0(n,t=>{let r=t.head,{state:i}=n,s=i.doc.lineAt(r),o=i.charCategorizer(r);for(let a=null;;){if(r==(e?s.to:s.from)){r==t.head&&s.number!=(e?i.doc.lines:1)&&(r+=e?1:-1);break}let l=Tr(s.text,r-s.from,e)+s.from,c=s.text.slice(Math.min(r,l)-s.from,Math.max(r,l)-s.from),u=o(c);if(a!=null&&u!=a)break;(c!=" "||r!=t.head)&&(a=u),r=l}return r}),TH=n=>PH(n,!1),V5e=n=>PH(n,!0),G5e=n=>x0(n,e=>{let t=n.lineBlockAt(e.head).to;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),X5e=n=>x0(n,e=>{let t=n.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),K5e=n=>x0(n,e=>{let t=n.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),Y5e=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:rt.of(["",""])},range:ce.cursor(r.from)}));return e(n.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},Z5e=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(r=>{if(!r.empty||r.from==0||r.from==n.doc.length)return{range:r};let i=r.from,s=n.doc.lineAt(i),o=i==s.from?i-1:Tr(s.text,i-s.from,!1)+s.from,a=i==s.to?i+1:Tr(s.text,i-s.from,!0)+s.from;return{changes:{from:o,to:a,insert:n.doc.slice(i,a).append(n.doc.slice(o,i))},range:ce.cursor(a)}});return t.changes.empty?!1:(e(n.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function DS(n){let e=[],t=-1;for(let r of n.selection.ranges){let i=n.doc.lineAt(r.from),s=n.doc.lineAt(r.to);if(!r.empty&&r.to==s.from&&(s=n.doc.lineAt(r.to-1)),t>=i.number){let o=e[e.length-1];o.to=s.to,o.ranges.push(r)}else e.push({from:i.from,to:s.to,ranges:[r]});t=s.number+1}return e}function EH(n,e,t){if(n.readOnly)return!1;let r=[],i=[];for(let s of DS(n)){if(t?s.to==n.doc.length:s.from==0)continue;let o=n.doc.lineAt(t?s.to+1:s.from-1),a=o.length+1;if(t){r.push({from:s.to,to:o.to},{from:s.from,insert:o.text+n.lineBreak});for(let l of s.ranges)i.push(ce.range(Math.min(n.doc.length,l.anchor+a),Math.min(n.doc.length,l.head+a)))}else{r.push({from:o.from,to:s.from},{from:s.to,insert:n.lineBreak+o.text});for(let l of s.ranges)i.push(ce.range(l.anchor-a,l.head-a))}}return r.length?(e(n.update({changes:r,scrollIntoView:!0,selection:ce.create(i,n.selection.mainIndex),userEvent:"move.line"})),!0):!1}const J5e=({state:n,dispatch:e})=>EH(n,e,!1),e3e=({state:n,dispatch:e})=>EH(n,e,!0);function IH(n,e,t){if(n.readOnly)return!1;let r=[];for(let i of DS(n))t?r.push({from:i.from,insert:n.doc.slice(i.from,i.to)+n.lineBreak}):r.push({from:i.to,insert:n.lineBreak+n.doc.slice(i.from,i.to)});return e(n.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const t3e=({state:n,dispatch:e})=>IH(n,e,!1),n3e=({state:n,dispatch:e})=>IH(n,e,!0),r3e=n=>{if(n.state.readOnly)return!1;let{state:e}=n,t=e.changes(DS(e).map(({from:i,to:s})=>(i>0?i--:s<e.doc.length&&s++,{from:i,to:s}))),r=ah(e.selection,i=>{let s;if(n.lineWrapping){let o=n.lineBlockAt(i.head),a=n.coordsAtPos(i.head,i.assoc||1);a&&(s=o.bottom+n.documentTop-a.bottom+n.defaultLineHeight/2)}return n.moveVertically(i,!0,s)}).map(t);return n.dispatch({changes:t,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function i3e(n,e){if(/\(\)|\[\]|\{\}/.test(n.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=cs(n).resolveInner(e),r=t.childBefore(e),i=t.childAfter(e),s;return r&&i&&r.to<=e&&i.from>=e&&(s=r.type.prop(Ge.closedBy))&&s.indexOf(i.name)>-1&&n.doc.lineAt(r.to).from==n.doc.lineAt(i.from).from&&!/\S/.test(n.sliceDoc(r.to,i.from))?{from:r.to,to:i.from}:null}const nI=MH(!1),s3e=MH(!0);function MH(n){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=e.changeByRange(i=>{let{from:s,to:o}=i,a=e.doc.lineAt(s),l=!n&&s==o&&i3e(e,s);n&&(s=o=(o<=a.to?a:e.doc.lineAt(o)).to);let c=new MS(e,{simulateBreak:s,simulateDoubleBreak:!!l}),u=YU(c,s);for(u==null&&(u=kS(/^\s*/.exec(e.doc.lineAt(s).text)[0],e.tabSize));o<a.to&&/\s/.test(a.text[o-a.from]);)o++;l?{from:s,to:o}=l:s>a.from&&s<a.from+100&&!/\S/.test(a.text.slice(0,s))&&(s=a.from);let d=["",Gy(e,u)];return l&&d.push(Gy(e,c.lineIndent(a.from,-1))),{changes:{from:s,to:o,insert:rt.of(d)},range:ce.cursor(s+1+d[1].length)}});return t(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function J7(n,e){let t=-1;return n.changeByRange(r=>{let i=[];for(let o=r.from;o<=r.to;){let a=n.doc.lineAt(o);a.number>t&&(r.empty||r.to>a.from)&&(e(a,i,r),t=a.number),o=a.to+1}let s=n.changes(i);return{changes:i,range:ce.range(s.mapPos(r.anchor,1),s.mapPos(r.head,1))}})}const o3e=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=Object.create(null),r=new MS(n,{overrideIndentation:s=>{let o=t[s];return o??-1}}),i=J7(n,(s,o,a)=>{let l=YU(r,s.from);if(l==null)return;/\S/.test(s.text)||(l=0);let c=/^\s*/.exec(s.text)[0],u=Gy(n,l);(c!=u||a.from<s.from+c.length)&&(t[s.from]=l,o.push({from:s.from,to:s.from+c.length,insert:u}))});return i.changes.empty||e(n.update(i,{userEvent:"indent"})),!0},a3e=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(J7(n,(t,r)=>{r.push({from:t.from,insert:n.facet(IS)})}),{userEvent:"input.indent"})),!0),l3e=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(J7(n,(t,r)=>{let i=/^\s*/.exec(t.text)[0];if(!i)return;let s=kS(i,n.tabSize),o=0,a=Gy(n,Math.max(0,s-Vy(n)));for(;o<i.length&&o<a.length&&i.charCodeAt(o)==a.charCodeAt(o);)o++;r.push({from:t.from+o,to:t.from+i.length,insert:a.slice(o)})}),{userEvent:"delete.dedent"})),!0),c3e=n=>(n.setTabFocusMode(),!0),u3e=[{key:"Ctrl-b",run:lH,shift:yH,preventDefault:!0},{key:"Ctrl-f",run:cH,shift:vH},{key:"Ctrl-p",run:hH,shift:wH},{key:"Ctrl-n",run:fH,shift:bH},{key:"Ctrl-a",run:I5e,shift:B5e},{key:"Ctrl-e",run:M5e,shift:U5e},{key:"Ctrl-d",run:CH},{key:"Ctrl-h",run:V5},{key:"Ctrl-k",run:G5e},{key:"Ctrl-Alt-h",run:TH},{key:"Ctrl-o",run:Y5e},{key:"Ctrl-t",run:Z5e},{key:"Ctrl-v",run:W5}],d3e=[{key:"ArrowLeft",run:lH,shift:yH,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:x5e,shift:R5e,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:T5e,shift:$5e,preventDefault:!0},{key:"ArrowRight",run:cH,shift:vH,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:w5e,shift:D5e,preventDefault:!0},{mac:"Cmd-ArrowRight",run:E5e,shift:F5e,preventDefault:!0},{key:"ArrowUp",run:hH,shift:wH,preventDefault:!0},{mac:"Cmd-ArrowUp",run:ZE,shift:eI},{mac:"Ctrl-ArrowUp",run:XE,shift:KE},{key:"ArrowDown",run:fH,shift:bH,preventDefault:!0},{mac:"Cmd-ArrowDown",run:JE,shift:tI},{mac:"Ctrl-ArrowDown",run:W5,shift:YE},{key:"PageUp",run:XE,shift:KE},{key:"PageDown",run:W5,shift:YE},{key:"Home",run:P5e,shift:N5e,preventDefault:!0},{key:"Mod-Home",run:ZE,shift:eI},{key:"End",run:C5e,shift:z5e,preventDefault:!0},{key:"Mod-End",run:JE,shift:tI},{key:"Enter",run:nI,shift:nI},{key:"Mod-a",run:H5e},{key:"Backspace",run:V5,shift:V5},{key:"Delete",run:CH},{key:"Mod-Backspace",mac:"Alt-Backspace",run:TH},{key:"Mod-Delete",mac:"Alt-Delete",run:V5e},{mac:"Mod-Backspace",run:X5e},{mac:"Mod-Delete",run:K5e}].concat(u3e.map(n=>({mac:n.key,run:n.run,shift:n.shift}))),h3e=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:O5e,shift:j5e},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:k5e,shift:L5e},{key:"Alt-ArrowUp",run:J5e},{key:"Shift-Alt-ArrowUp",run:t3e},{key:"Alt-ArrowDown",run:e3e},{key:"Shift-Alt-ArrowDown",run:n3e},{key:"Escape",run:W5e},{key:"Mod-Enter",run:s3e},{key:"Alt-l",mac:"Ctrl-l",run:Q5e},{key:"Mod-i",run:q5e,preventDefault:!0},{key:"Mod-[",run:l3e},{key:"Mod-]",run:a3e},{key:"Mod-Alt-\\",run:o3e},{key:"Shift-Mod-k",run:r3e},{key:"Shift-Mod-\\",run:_5e},{key:"Mod-/",run:t5e},{key:"Alt-A",run:r5e},{key:"Ctrl-m",mac:"Shift-Alt-m",run:c3e}].concat(d3e);class f3e{constructor(e,t,r,i){this.origin=e,this.changes=t,this.effects=r,this.clientID=i}}class rI{constructor(e,t){this.version=e,this.unconfirmed=t}}const Ky=Ie.define({combine(n){let e=D7(n,{startVersion:0,clientID:null,sharedEffects:()=>[]},{generatedID:t=>t});return e.clientID==null&&(e.clientID=n.length&&n[0].generatedID||""),e}}),p3e=zo.define(),g3e=Bs.define({create(n){return new rI(n.facet(Ky).startVersion,[])},update(n,e){let t=e.annotation(p3e);if(t)return t;let{sharedEffects:r,clientID:i}=e.startState.facet(Ky),s=r(e);return s.length||!e.changes.empty?new rI(n.version,n.unconfirmed.concat(new f3e(e,e.changes,s,i))):n}});function m3e(n={}){return[g3e,Ky.of(Object.assign({generatedID:Math.floor(Math.random()*1e9).toString(36)},n))]}function AH(n){return n.facet(Ky).clientID}const y3e="#e5c07b",iI="#e06c75",v3e="#56b6c2",S3e="#ffffff",p1="#abb2bf",G5="#7d8799",x3e="#61afef",w3e="#98c379",sI="#d19a66",b3e="#c678dd",O3e="#21252b",oI="#2c313a",aI="#282c34",fw="#353a42",k3e="#3E4451",lI="#528bff",C3e=Ne.theme({"&":{color:p1,backgroundColor:aI},".cm-content":{caretColor:lI},".cm-cursor, .cm-dropCursor":{borderLeftColor:lI},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:k3e},".cm-panels":{backgroundColor:O3e,color:p1},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:aI,color:G5,border:"none"},".cm-activeLineGutter":{backgroundColor:oI},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:fw},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:fw,borderBottomColor:fw},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:oI,color:p1}}},{dark:!0}),P3e=S0.define([{tag:X.keyword,color:b3e},{tag:[X.name,X.deleted,X.character,X.propertyName,X.macroName],color:iI},{tag:[X.function(X.variableName),X.labelName],color:x3e},{tag:[X.color,X.constant(X.name),X.standard(X.name)],color:sI},{tag:[X.definition(X.name),X.separator],color:p1},{tag:[X.typeName,X.className,X.number,X.changed,X.annotation,X.modifier,X.self,X.namespace],color:y3e},{tag:[X.operator,X.operatorKeyword,X.url,X.escape,X.regexp,X.link,X.special(X.string)],color:v3e},{tag:[X.meta,X.comment],color:G5},{tag:X.strong,fontWeight:"bold"},{tag:X.emphasis,fontStyle:"italic"},{tag:X.strikethrough,textDecoration:"line-through"},{tag:X.link,color:G5,textDecoration:"underline"},{tag:X.heading,fontWeight:"bold",color:iI},{tag:[X.atom,X.bool,X.special(X.variableName)],color:sI},{tag:[X.processingInstruction,X.string,X.inserted],color:w3e},{tag:X.invalid,color:S3e}]),T3e=[C3e,Q4e(P3e)];var cI={};class Yy{constructor(e,t,r,i,s,o,a,l,c,u=0,d){this.p=e,this.stack=t,this.state=r,this.reducePos=i,this.pos=s,this.score=o,this.buffer=a,this.bufferBase=l,this.curContext=c,this.lookAhead=u,this.parent=d}toString(){return`[${this.stack.filter((e,t)=>t%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,r=0){let i=e.parser.context;return new Yy(e,[],t,r,r,0,[],0,i?new uI(i,i.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let r=e>>19,i=e&65535,{parser:s}=this.p,o=this.reducePos<this.pos-25;o&&this.setLookAhead(this.pos);let a=s.dynamicPrecedence(i);if(a&&(this.score+=a),r==0){this.pushState(s.getGoto(this.state,i,!0),this.reducePos),i<s.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,o?8:4,!0),this.reduceContext(i,this.reducePos);return}let l=this.stack.length-(r-1)*3-(e&262144?6:0),c=l?this.stack[l-2]:this.p.ranges[0].from,u=this.reducePos-c;u>=2e3&&!(!((t=this.p.parser.nodeSet.types[i])===null||t===void 0)&&t.isAnonymous)&&(c==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=u):this.p.lastBigReductionSize<u&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=c,this.p.lastBigReductionSize=u));let d=l?this.stack[l-1]:0,h=this.bufferBase+this.buffer.length-d;if(i<s.minRepeatTerm||e&131072){let p=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,c,p,h+4,!0)}if(e&262144)this.state=this.stack[l];else{let p=this.stack[l-3];this.state=s.getGoto(p,i,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(i,c)}storeNode(e,t,r,i=4,s=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let o=this,a=this.buffer.length;if(a==0&&o.parent&&(a=o.bufferBase-o.parent.bufferBase,o=o.parent),a>0&&o.buffer[a-4]==0&&o.buffer[a-1]>-1){if(t==r)return;if(o.buffer[a-2]>=t){o.buffer[a-2]=r;return}}}if(!s||this.pos==r)this.buffer.push(e,t,r,i);else{let o=this.buffer.length;if(o>0&&this.buffer[o-4]!=0){let a=!1;for(let l=o;l>0&&this.buffer[l-2]>r;l-=4)if(this.buffer[l-1]>=0){a=!0;break}if(a)for(;o>0&&this.buffer[o-2]>r;)this.buffer[o]=this.buffer[o-4],this.buffer[o+1]=this.buffer[o-3],this.buffer[o+2]=this.buffer[o-2],this.buffer[o+3]=this.buffer[o-1],o-=4,i>4&&(i-=4)}this.buffer[o]=e,this.buffer[o+1]=t,this.buffer[o+2]=r,this.buffer[o+3]=i}}shift(e,t,r,i){if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=i,this.shiftContext(t,r),t<=this.p.parser.maxNode&&this.buffer.push(t,r,i,4);else{let s=e,{parser:o}=this.p;(i>this.pos||t<=o.maxNode)&&(this.pos=i,o.stateFlag(s,1)||(this.reducePos=i)),this.pushState(s,r),this.shiftContext(t,r),t<=o.maxNode&&this.buffer.push(t,r,i,4)}}apply(e,t,r,i){e&65536?this.reduce(e):this.shift(e,t,r,i)}useNode(e,t){let r=this.p.reused.length-1;(r<0||this.p.reused[r]!=e)&&(this.p.reused.push(e),r++);let i=this.pos;this.reducePos=this.pos=i+e.length,this.pushState(t,i),this.buffer.push(r,i,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let r=e.buffer.slice(t),i=e.bufferBase+t;for(;e&&i==e.bufferBase;)e=e.parent;return new Yy(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,r,i,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let r=e<=this.p.parser.maxNode;r&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,r?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new E3e(this);;){let r=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(r==0)return!1;if(!(r&65536))return!0;t.reduce(r)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let i=[];for(let s=0,o;s<t.length;s+=2)(o=t[s+1])!=this.state&&this.p.parser.hasAction(o,e)&&i.push(t[s],o);if(this.stack.length<120)for(let s=0;i.length<8&&s<t.length;s+=2){let o=t[s+1];i.some((a,l)=>l&1&&a==o)||i.push(t[s],o)}t=i}let r=[];for(let i=0;i<t.length&&r.length<4;i+=2){let s=t[i+1];if(s==this.state)continue;let o=this.split();o.pushState(s,this.pos),o.storeNode(0,o.pos,o.pos,4,!0),o.shiftContext(t[i],this.pos),o.reducePos=this.pos,o.score-=200,r.push(o)}return r}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if(!(t&65536))return!1;if(!e.validAction(this.state,t)){let r=t>>19,i=t&65535,s=this.stack.length-r*3;if(s<0||e.getGoto(this.stack[s],i,!1)<0){let o=this.findForcedReduction();if(o==null)return!1;t=o}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],r=(i,s)=>{if(!t.includes(i))return t.push(i),e.allActions(i,o=>{if(!(o&393216))if(o&65536){let a=(o>>19)-s;if(a>1){let l=o&65535,c=this.stack.length-a*3;if(c>=0&&e.getGoto(this.stack[c],l,!1)>=0)return a<<19|65536|l}}else{let a=r(o,s+1);if(a!=null)return a}})};return r(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new uI(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class uI{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class E3e{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=e&65535,r=e>>19;r==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(r-1)*3;let i=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=i}}class Zy{constructor(e,t,r){this.stack=e,this.pos=t,this.index=r,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new Zy(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new Zy(this.stack,this.pos,this.index)}}function lm(n,e=Uint16Array){if(typeof n!="string")return n;let t=null;for(let r=0,i=0;r<n.length;){let s=0;for(;;){let o=n.charCodeAt(r++),a=!1;if(o==126){s=65535;break}o>=92&&o--,o>=34&&o--;let l=o-32;if(l>=46&&(l-=46,a=!0),s+=l,a)break;s*=46}t?t[i++]=s:t=new e(s)}return t}class g1{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const dI=new g1;class I3e{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=dI,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let r=this.range,i=this.rangeIndex,s=this.pos+e;for(;s<r.from;){if(!i)return null;let o=this.ranges[--i];s-=r.from-o.to,r=o}for(;t<0?s>r.to:s>=r.to;){if(i==this.ranges.length-1)return null;let o=this.ranges[++i];s+=o.from-r.to,r=o}return s}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t=this.chunkOff+e,r,i;if(t>=0&&t<this.chunk.length)r=this.pos+e,i=this.chunk.charCodeAt(t);else{let s=this.resolveOffset(e,1);if(s==null)return-1;if(r=s,r>=this.chunk2Pos&&r<this.chunk2Pos+this.chunk2.length)i=this.chunk2.charCodeAt(r-this.chunk2Pos);else{let o=this.rangeIndex,a=this.range;for(;a.to<=r;)a=this.ranges[++o];this.chunk2=this.input.chunk(this.chunk2Pos=r),r+this.chunk2.length>a.to&&(this.chunk2=this.chunk2.slice(0,a.to-r)),i=this.chunk2.charCodeAt(0)}}return r>=this.token.lookAhead&&(this.token.lookAhead=r+1),i}acceptToken(e,t=0){let r=t?this.resolveOffset(t,-1):this.pos;if(r==null||r<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=r}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=dI,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let r="";for(let i of this.ranges){if(i.from>=t)break;i.to>e&&(r+=this.input.read(Math.max(i.from,e),Math.min(i.to,t)))}return r}}class yd{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:r}=t.p;M3e(this.data,e,t,this.id,r.data,r.tokenPrecTable)}}yd.prototype.contextual=yd.prototype.fallback=yd.prototype.extend=!1;yd.prototype.fallback=yd.prototype.extend=!1;class jS{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function M3e(n,e,t,r,i,s){let o=0,a=1<<r,{dialect:l}=t.p.parser;e:for(;a&n[o];){let c=n[o+1];for(let p=o+3;p<c;p+=2)if((n[p+1]&a)>0){let g=n[p];if(l.allows(g)&&(e.token.value==-1||e.token.value==g||A3e(g,e.token.value,i,s))){e.acceptToken(g);break}}let u=e.next,d=0,h=n[o+2];if(e.next<0&&h>d&&n[c+h*3-3]==65535){o=n[c+h*3-1];continue e}for(;d<h;){let p=d+h>>1,g=c+p+(p<<1),m=n[g],S=n[g+1]||65536;if(u<m)h=p;else if(u>=S)d=p+1;else{o=n[g+2],e.advance();continue e}}break}}function hI(n,e,t){for(let r=e,i;(i=n[r])!=65535;r++)if(i==t)return r-e;return-1}function A3e(n,e,t,r){let i=hI(t,r,e);return i<0||hI(t,r,n)<i}const fi=typeof process<"u"&&cI&&/\bparse\b/.test(cI.LOG);let pw=null;function fI(n,e,t){let r=n.cursor(kn.IncludeAnonymous);for(r.moveTo(e);;)if(!(t<0?r.childBefore(e):r.childAfter(e)))for(;;){if((t<0?r.to<e:r.from>e)&&!r.type.isError)return t<0?Math.max(0,Math.min(r.to-1,e-25)):Math.min(n.length,Math.max(r.from+1,e+25));if(t<0?r.prevSibling():r.nextSibling())break;if(!r.parent())return t<0?0:n.length}}class _3e{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?fI(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?fI(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let r=this.trees[t],i=this.index[t];if(i==r.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=r.children[i],o=this.start[t]+r.positions[i];if(o>e)return this.nextStart=o,null;if(s instanceof vn){if(o==e){if(o<this.safeFrom)return null;let a=o+s.length;if(a<=this.safeTo){let l=s.prop(Ge.lookAhead);if(!l||a+l<this.fragment.to)return s}}this.index[t]++,o+s.length>=Math.max(this.safeFrom,e)&&(this.trees.push(s),this.start.push(o),this.index.push(0))}else this.index[t]++,this.nextStart=o+s.length}}}class R3e{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(r=>new g1)}getActions(e){let t=0,r=null,{parser:i}=e.p,{tokenizers:s}=i,o=i.stateSlot(e.state,3),a=e.curContext?e.curContext.hash:0,l=0;for(let c=0;c<s.length;c++){if(!(1<<c&o))continue;let u=s[c],d=this.tokens[c];if(!(r&&!u.fallback)&&((u.contextual||d.start!=e.pos||d.mask!=o||d.context!=a)&&(this.updateCachedToken(d,u,e),d.mask=o,d.context=a),d.lookAhead>d.end+25&&(l=Math.max(d.lookAhead,l)),d.value!=0)){let h=t;if(d.extended>-1&&(t=this.addActions(e,d.extended,d.end,t)),t=this.addActions(e,d.value,d.end,t),!u.extend&&(r=d,t>h))break}}for(;this.actions.length>t;)this.actions.pop();return l&&e.setLookAhead(l),!r&&e.pos==this.stream.end&&(r=new g1,r.value=e.p.parser.eofTerm,r.start=r.end=e.pos,t=this.addActions(e,r.value,r.end,t)),this.mainToken=r,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new g1,{pos:r,p:i}=e;return t.start=r,t.end=Math.min(r+1,i.stream.end),t.value=r==i.stream.end?i.parser.eofTerm:0,t}updateCachedToken(e,t,r){let i=this.stream.clipPos(r.pos);if(t.token(this.stream.reset(i,e),r),e.value>-1){let{parser:s}=r.p;for(let o=0;o<s.specialized.length;o++)if(s.specialized[o]==e.value){let a=s.specializers[o](this.stream.read(e.start,e.end),r);if(a>=0&&r.p.parser.dialect.allows(a>>1)){a&1?e.extended=a>>1:e.value=a>>1;break}}}else e.value=0,e.end=this.stream.clipPos(i+1)}putAction(e,t,r,i){for(let s=0;s<i;s+=3)if(this.actions[s]==e)return i;return this.actions[i++]=e,this.actions[i++]=t,this.actions[i++]=r,i}addActions(e,t,r,i){let{state:s}=e,{parser:o}=e.p,{data:a}=o;for(let l=0;l<2;l++)for(let c=o.stateSlot(s,l?2:1);;c+=3){if(a[c]==65535)if(a[c+1]==1)c=ta(a,c+2);else{i==0&&a[c+1]==2&&(i=this.putAction(ta(a,c+2),t,r,i));break}a[c]==t&&(i=this.putAction(ta(a,c+1),t,r,i))}return i}}class D3e{constructor(e,t,r,i){this.parser=e,this.input=t,this.ranges=i,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new I3e(t,i),this.tokens=new R3e(e,this.stream),this.topTerm=e.top[1];let{from:s}=i[0];this.stacks=[Yy.start(this,e.top[0],s)],this.fragments=r.length&&this.stream.end-s>e.bufferLength*4?new _3e(r,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,t=this.minStackPos,r=this.stacks=[],i,s;if(this.bigReductionCount>300&&e.length==1){let[o]=e;for(;o.forceReduce()&&o.stack.length&&o.stack[o.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<e.length;o++){let a=e[o];for(;;){if(this.tokens.mainToken=null,a.pos>t)r.push(a);else{if(this.advanceStack(a,r,e))continue;{i||(i=[],s=[]),i.push(a);let l=this.tokens.getMainToken(a);s.push(l.value,l.end)}}break}}if(!r.length){let o=i&&z3e(i);if(o)return fi&&console.log("Finish with "+this.stackID(o)),this.stackToTree(o);if(this.parser.strict)throw fi&&i&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+t);this.recovering||(this.recovering=5)}if(this.recovering&&i){let o=this.stoppedAt!=null&&i[0].pos>this.stoppedAt?i[0]:this.runRecovery(i,s,r);if(o)return fi&&console.log("Force-finish "+this.stackID(o)),this.stackToTree(o.forceAll())}if(this.recovering){let o=this.recovering==1?1:this.recovering*3;if(r.length>o)for(r.sort((a,l)=>l.score-a.score);r.length>o;)r.pop();r.some(a=>a.reducePos>t)&&this.recovering--}else if(r.length>1){e:for(let o=0;o<r.length-1;o++){let a=r[o];for(let l=o+1;l<r.length;l++){let c=r[l];if(a.sameState(c)||a.buffer.length>500&&c.buffer.length>500)if((a.score-c.score||a.buffer.length-c.buffer.length)>0)r.splice(l--,1);else{r.splice(o--,1);continue e}}}r.length>12&&r.splice(12,r.length-12)}this.minStackPos=r[0].pos;for(let o=1;o<r.length;o++)r[o].pos<this.minStackPos&&(this.minStackPos=r[o].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,r){let i=e.pos,{parser:s}=this,o=fi?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&i>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let c=e.curContext&&e.curContext.tracker.strict,u=c?e.curContext.hash:0;for(let d=this.fragments.nodeAt(i);d;){let h=this.parser.nodeSet.types[d.type.id]==d.type?s.getGoto(e.state,d.type.id):-1;if(h>-1&&d.length&&(!c||(d.prop(Ge.contextHash)||0)==u))return e.useNode(d,h),fi&&console.log(o+this.stackID(e)+` (via reuse of ${s.getName(d.type.id)})`),!0;if(!(d instanceof vn)||d.children.length==0||d.positions[0]>0)break;let p=d.children[0];if(p instanceof vn&&d.positions[0]==0)d=p;else break}}let a=s.stateSlot(e.state,4);if(a>0)return e.reduce(a),fi&&console.log(o+this.stackID(e)+` (via always-reduce ${s.getName(a&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let l=this.tokens.getActions(e);for(let c=0;c<l.length;){let u=l[c++],d=l[c++],h=l[c++],p=c==l.length||!r,g=p?e:e.split(),m=this.tokens.mainToken;if(g.apply(u,d,m?m.start:g.pos,h),fi&&console.log(o+this.stackID(g)+` (via ${u&65536?`reduce of ${s.getName(u&65535)}`:"shift"} for ${s.getName(d)} @ ${i}${g==e?"":", split"})`),p)return!0;g.pos>i?t.push(g):r.push(g)}return!1}advanceFully(e,t){let r=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>r)return pI(e,t),!0}}runRecovery(e,t,r){let i=null,s=!1;for(let o=0;o<e.length;o++){let a=e[o],l=t[o<<1],c=t[(o<<1)+1],u=fi?this.stackID(a)+" -> ":"";if(a.deadEnd&&(s||(s=!0,a.restart(),fi&&console.log(u+this.stackID(a)+" (restarted)"),this.advanceFully(a,r))))continue;let d=a.split(),h=u;for(let p=0;d.forceReduce()&&p<10&&(fi&&console.log(h+this.stackID(d)+" (via force-reduce)"),!this.advanceFully(d,r));p++)fi&&(h=this.stackID(d)+" -> ");for(let p of a.recoverByInsert(l))fi&&console.log(u+this.stackID(p)+" (via recover-insert)"),this.advanceFully(p,r);this.stream.end>a.pos?(c==a.pos&&(c++,l=0),a.recoverByDelete(l,c),fi&&console.log(u+this.stackID(a)+` (via recover-delete ${this.parser.getName(l)})`),pI(a,r)):(!i||i.score<a.score)&&(i=a)}return i}stackToTree(e){return e.close(),vn.build({buffer:Zy.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(pw||(pw=new WeakMap)).get(e);return t||pw.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function pI(n,e){for(let t=0;t<e.length;t++){let r=e[t];if(r.pos==n.pos&&r.sameState(n)){e[t].score<n.score&&(e[t]=n);return}}e.push(n)}class j3e{constructor(e,t,r){this.source=e,this.flags=t,this.disabled=r}allows(e){return!this.disabled||this.disabled[e]==0}}const gw=n=>n;class L3e{constructor(e){this.start=e.start,this.shift=e.shift||gw,this.reduce=e.reduce||gw,this.reuse=e.reuse||gw,this.hash=e.hash||(()=>0),this.strict=e.strict!==!1}}class Jy extends WU{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let a=0;a<e.repeatNodeCount;a++)t.push("");let r=Object.keys(e.topRules).map(a=>e.topRules[a][1]),i=[];for(let a=0;a<t.length;a++)i.push([]);function s(a,l,c){i[a].push([l,l.deserialize(String(c))])}if(e.nodeProps)for(let a of e.nodeProps){let l=a[0];typeof l=="string"&&(l=Ge[l]);for(let c=1;c<a.length;){let u=a[c++];if(u>=0)s(u,l,a[c++]);else{let d=a[c+-u];for(let h=-u;h>0;h--)s(a[c++],l,d);c++}}}this.nodeSet=new W7(t.map((a,l)=>oi.define({name:l>=this.minRepeatTerm?void 0:a,id:l,props:i[l],top:r.indexOf(l)>-1,error:l==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(l)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=UU;let o=lm(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let a=0;a<this.specializerSpecs.length;a++)this.specialized[a]=this.specializerSpecs[a].term;this.specializers=this.specializerSpecs.map(gI),this.states=lm(e.states,Uint32Array),this.data=lm(e.stateData),this.goto=lm(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(a=>typeof a=="number"?new yd(o,a):a),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,r){let i=new D3e(this,e,t,r);for(let s of this.wrappers)i=s(i,e,t,r);return i}getGoto(e,t,r=!1){let i=this.goto;if(t>=i[0])return-1;for(let s=i[t+1];;){let o=i[s++],a=o&1,l=i[s++];if(a&&r)return l;for(let c=s+(o>>1);s<c;s++)if(i[s]==e)return l;if(a)return-1}}hasAction(e,t){let r=this.data;for(let i=0;i<2;i++)for(let s=this.stateSlot(e,i?2:1),o;;s+=3){if((o=r[s])==65535)if(r[s+1]==1)o=r[s=ta(r,s+2)];else{if(r[s+1]==2)return ta(r,s+2);break}if(o==t||o==0)return ta(r,s+1)}return 0}stateSlot(e,t){return this.states[e*6+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,r=>r==t?!0:null)}allActions(e,t){let r=this.stateSlot(e,4),i=r?t(r):void 0;for(let s=this.stateSlot(e,1);i==null;s+=3){if(this.data[s]==65535)if(this.data[s+1]==1)s=ta(this.data,s+2);else break;i=t(ta(this.data,s+1))}return i}nextStates(e){let t=[];for(let r=this.stateSlot(e,1);;r+=3){if(this.data[r]==65535)if(this.data[r+1]==1)r=ta(this.data,r+2);else break;if(!(this.data[r+2]&1)){let i=this.data[r+1];t.some((s,o)=>o&1&&s==i)||t.push(this.data[r],i)}}return t}configure(e){let t=Object.assign(Object.create(Jy.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let r=this.topRules[e.top];if(!r)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=r}return e.tokenizers&&(t.tokenizers=this.tokenizers.map(r=>{let i=e.tokenizers.find(s=>s.from==r);return i?i.to:r})),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map((r,i)=>{let s=e.specializers.find(a=>a.from==r.external);if(!s)return r;let o=Object.assign(Object.assign({},r),{external:s.to});return t.specializers[i]=gI(o),o})),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),e.bufferLength!=null&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return t==null?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),r=t.map(()=>!1);if(e)for(let s of e.split(" ")){let o=t.indexOf(s);o>=0&&(r[o]=!0)}let i=null;for(let s=0;s<t.length;s++)if(!r[s])for(let o=this.dialects[t[s]],a;(a=this.data[o++])!=65535;)(i||(i=new Uint8Array(this.maxTerm+1)))[a]=1;return new j3e(e,r,i)}static deserialize(e){return new Jy(e)}}function ta(n,e){return n[e]|n[e+1]<<16}function z3e(n){let e=null;for(let t of n){let r=t.p.stoppedAt;(t.pos==t.p.stream.end||r!=null&&t.pos>r)&&t.p.parser.stateFlag(t.state,2)&&(!e||e.score<t.score)&&(e=t)}return e}function gI(n){if(n.external){let e=n.extend?1:0;return(t,r)=>n.external(t,r)<<1|e}return n.get}const N3e=1,_H=194,RH=195,$3e=196,mI=197,F3e=198,B3e=199,U3e=200,H3e=2,DH=3,yI=201,Q3e=24,q3e=25,W3e=49,V3e=50,G3e=55,X3e=56,K3e=57,Y3e=59,Z3e=60,J3e=61,e6e=62,t6e=63,n6e=65,r6e=238,i6e=71,s6e=241,o6e=242,a6e=243,l6e=244,c6e=245,u6e=246,d6e=247,h6e=248,jH=72,f6e=249,p6e=250,g6e=251,m6e=252,y6e=253,v6e=254,S6e=255,x6e=256,w6e=73,b6e=77,O6e=263,k6e=112,C6e=130,P6e=151,T6e=152,E6e=155,nu=10,jp=13,ek=32,LS=9,tk=35,I6e=40,M6e=46,X5=123,vI=125,LH=39,zH=34,SI=92,A6e=111,_6e=120,R6e=78,D6e=117,j6e=85,L6e=new Set([q3e,W3e,V3e,O6e,n6e,C6e,X3e,K3e,r6e,e6e,t6e,jH,w6e,b6e,Z3e,J3e,P6e,T6e,E6e,k6e]);function mw(n){return n==nu||n==jp}function yw(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102}const z6e=new jS((n,e)=>{let t;if(n.next<0)n.acceptToken(B3e);else if(e.context.flags&m1)mw(n.next)&&n.acceptToken(F3e,1);else if(((t=n.peek(-1))<0||mw(t))&&e.canShift(mI)){let r=0;for(;n.next==ek||n.next==LS;)n.advance(),r++;(n.next==nu||n.next==jp||n.next==tk)&&n.acceptToken(mI,-r)}else mw(n.next)&&n.acceptToken($3e,1)},{contextual:!0}),N6e=new jS((n,e)=>{let t=e.context;if(t.flags)return;let r=n.peek(-1);if(r==nu||r==jp){let i=0,s=0;for(;;){if(n.next==ek)i++;else if(n.next==LS)i+=8-i%8;else break;n.advance(),s++}i!=t.indent&&n.next!=nu&&n.next!=jp&&n.next!=tk&&(i<t.indent?n.acceptToken(RH,-s):n.acceptToken(_H))}}),m1=1,NH=2,Wo=4,Vo=8,Go=16,Xo=32;function y1(n,e,t){this.parent=n,this.indent=e,this.flags=t,this.hash=(n?n.hash+n.hash<<8:0)+e+(e<<4)+t+(t<<6)}const $6e=new y1(null,0,0);function F6e(n){let e=0;for(let t=0;t<n.length;t++)e+=n.charCodeAt(t)==LS?8-e%8:1;return e}const xI=new Map([[s6e,0],[o6e,Wo],[a6e,Vo],[l6e,Vo|Wo],[c6e,Go],[u6e,Go|Wo],[d6e,Go|Vo],[h6e,Go|Vo|Wo],[f6e,Xo],[p6e,Xo|Wo],[g6e,Xo|Vo],[m6e,Xo|Vo|Wo],[y6e,Xo|Go],[v6e,Xo|Go|Wo],[S6e,Xo|Go|Vo],[x6e,Xo|Go|Vo|Wo]].map(([n,e])=>[n,e|NH])),B6e=new L3e({start:$6e,reduce(n,e,t,r){return n.flags&m1&&L6e.has(e)||(e==i6e||e==jH)&&n.flags&NH?n.parent:n},shift(n,e,t,r){return e==_H?new y1(n,F6e(r.read(r.pos,t.pos)),0):e==RH?n.parent:e==Q3e||e==G3e||e==Y3e||e==DH?new y1(n,0,m1):xI.has(e)?new y1(n,0,xI.get(e)|n.flags&m1):n},hash(n){return n.hash}}),U6e=new jS(n=>{for(let e=0;e<5;e++){if(n.next!="print".charCodeAt(e))return;n.advance()}if(!/\w/.test(String.fromCharCode(n.next)))for(let e=0;;e++){let t=n.peek(e);if(!(t==ek||t==LS)){t!=I6e&&t!=M6e&&t!=nu&&t!=jp&&t!=tk&&n.acceptToken(N3e);return}}}),H6e=new jS((n,e)=>{let{flags:t}=e.context,r=t&Wo?zH:LH,i=(t&Vo)>0,s=!(t&Go),o=(t&Xo)>0,a=n.pos;for(;!(n.next<0);)if(o&&n.next==X5)if(n.peek(1)==X5)n.advance(2);else{if(n.pos==a){n.acceptToken(DH,1);return}break}else if(s&&n.next==SI){if(n.pos==a){n.advance();let l=n.next;l>=0&&(n.advance(),Q6e(n,l)),n.acceptToken(H3e);return}break}else if(n.next==SI&&!s&&n.peek(1)>-1)n.advance(2);else if(n.next==r&&(!i||n.peek(1)==r&&n.peek(2)==r)){if(n.pos==a){n.acceptToken(yI,i?3:1);return}break}else if(n.next==nu){if(i)n.advance();else if(n.pos==a){n.acceptToken(yI);return}break}else n.advance();n.pos>a&&n.acceptToken(U3e)});function Q6e(n,e){if(e==A6e)for(let t=0;t<2&&n.next>=48&&n.next<=55;t++)n.advance();else if(e==_6e)for(let t=0;t<2&&yw(n.next);t++)n.advance();else if(e==D6e)for(let t=0;t<4&&yw(n.next);t++)n.advance();else if(e==j6e)for(let t=0;t<8&&yw(n.next);t++)n.advance();else if(e==R6e&&n.next==X5){for(n.advance();n.next>=0&&n.next!=vI&&n.next!=LH&&n.next!=zH&&n.next!=nu;)n.advance();n.next==vI&&n.advance()}}const q6e=VU({'async "*" "**" FormatConversion FormatSpec':X.modifier,"for while if elif else try except finally return raise break continue with pass assert await yield match case":X.controlKeyword,"in not and or is del":X.operatorKeyword,"from def class global nonlocal lambda":X.definitionKeyword,import:X.moduleKeyword,"with as print":X.keyword,Boolean:X.bool,None:X.null,VariableName:X.variableName,"CallExpression/VariableName":X.function(X.variableName),"FunctionDefinition/VariableName":X.function(X.definition(X.variableName)),"ClassDefinition/VariableName":X.definition(X.className),PropertyName:X.propertyName,"CallExpression/MemberExpression/PropertyName":X.function(X.propertyName),Comment:X.lineComment,Number:X.number,String:X.string,FormatString:X.special(X.string),Escape:X.escape,UpdateOp:X.updateOperator,"ArithOp!":X.arithmeticOperator,BitOp:X.bitwiseOperator,CompareOp:X.compareOperator,AssignOp:X.definitionOperator,Ellipsis:X.punctuation,At:X.meta,"( )":X.paren,"[ ]":X.squareBracket,"{ }":X.brace,".":X.derefOperator,", ;":X.separator}),W6e={__proto__:null,await:44,or:54,and:56,in:60,not:62,is:64,if:70,else:72,lambda:76,yield:94,from:96,async:102,for:104,None:162,True:164,False:164,del:178,pass:182,break:186,continue:190,return:194,raise:202,import:206,as:208,global:212,nonlocal:214,assert:218,type:223,elif:236,while:240,try:246,except:248,finally:250,with:254,def:258,class:268,match:279,case:285},V6e=Jy.deserialize({version:14,states:"##jO`QeOOP$}OSOOO&WQtO'#HUOOQS'#Co'#CoOOQS'#Cp'#CpO'vQdO'#CnO*UQtO'#HTOOQS'#HU'#HUOOQS'#DU'#DUOOQS'#HT'#HTO*rQdO'#D_O+VQdO'#DfO+gQdO'#DjO+zOWO'#DuO,VOWO'#DvO.[QtO'#GuOOQS'#Gu'#GuO'vQdO'#GtO0ZQtO'#GtOOQS'#Eb'#EbO0rQdO'#EcOOQS'#Gs'#GsO0|QdO'#GrOOQV'#Gr'#GrO1XQdO'#FYOOQS'#G^'#G^O1^QdO'#FXOOQV'#IS'#ISOOQV'#Gq'#GqOOQV'#Fq'#FqQ`QeOOO'vQdO'#CqO1lQdO'#C}O1sQdO'#DRO2RQdO'#HYO2cQtO'#EVO'vQdO'#EWOOQS'#EY'#EYOOQS'#E['#E[OOQS'#E^'#E^O2wQdO'#E`O3_QdO'#EdO3rQdO'#EfO3zQtO'#EfO1XQdO'#EiO0rQdO'#ElO1XQdO'#EnO0rQdO'#EtO0rQdO'#EwO4VQdO'#EyO4^QdO'#FOO4iQdO'#EzO0rQdO'#FOO1XQdO'#FQO1XQdO'#FVO4nQdO'#F[P4uOdO'#GpPOOO)CBd)CBdOOQS'#Ce'#CeOOQS'#Cf'#CfOOQS'#Cg'#CgOOQS'#Ch'#ChOOQS'#Ci'#CiOOQS'#Cj'#CjOOQS'#Cl'#ClO'vQdO,59OO'vQdO,59OO'vQdO,59OO'vQdO,59OO'vQdO,59OO'vQdO,59OO5TQdO'#DoOOQS,5:Y,5:YO5hQdO'#HdOOQS,5:],5:]O5uQ!fO,5:]O5zQtO,59YO1lQdO,59bO1lQdO,59bO1lQdO,59bO8jQdO,59bO8oQdO,59bO8vQdO,59jO8}QdO'#HTO:TQdO'#HSOOQS'#HS'#HSOOQS'#D['#D[O:lQdO,59aO'vQdO,59aO:zQdO,59aOOQS,59y,59yO;PQdO,5:RO'vQdO,5:ROOQS,5:Q,5:QO;_QdO,5:QO;dQdO,5:XO'vQdO,5:XO'vQdO,5:VOOQS,5:U,5:UO;uQdO,5:UO;zQdO,5:WOOOW'#Fy'#FyO<POWO,5:aOOQS,5:a,5:aO<[QdO'#HwOOOW'#Dw'#DwOOOW'#Fz'#FzO<lOWO,5:bOOQS,5:b,5:bOOQS'#F}'#F}O<zQtO,5:iO?lQtO,5=`O@VQ#xO,5=`O@vQtO,5=`OOQS,5:},5:}OA_QeO'#GWOBqQdO,5;^OOQV,5=^,5=^OB|QtO'#IPOCkQdO,5;tOOQS-E:[-E:[OOQV,5;s,5;sO4dQdO'#FQOOQV-E9o-E9oOCsQtO,59]OEzQtO,59iOFeQdO'#HVOFpQdO'#HVO1XQdO'#HVOF{QdO'#DTOGTQdO,59mOGYQdO'#HZO'vQdO'#HZO0rQdO,5=tOOQS,5=t,5=tO0rQdO'#EROOQS'#ES'#ESOGwQdO'#GPOHXQdO,58|OHXQdO,58|O*xQdO,5:oOHgQtO'#H]OOQS,5:r,5:rOOQS,5:z,5:zOHzQdO,5;OOI]QdO'#IOO1XQdO'#H}OOQS,5;Q,5;QOOQS'#GT'#GTOIqQtO,5;QOJPQdO,5;QOJUQdO'#IQOOQS,5;T,5;TOJdQdO'#H|OOQS,5;W,5;WOJuQdO,5;YO4iQdO,5;`O4iQdO,5;cOJ}QtO'#ITO'vQdO'#ITOKXQdO,5;eO4VQdO,5;eO0rQdO,5;jO1XQdO,5;lOK^QeO'#EuOLjQgO,5;fO!!kQdO'#IUO4iQdO,5;jO!!vQdO,5;lO!#OQdO,5;qO!#ZQtO,5;vO'vQdO,5;vPOOO,5=[,5=[P!#bOSO,5=[P!#jOdO,5=[O!&bQtO1G.jO!&iQtO1G.jO!)YQtO1G.jO!)dQtO1G.jO!+}QtO1G.jO!,bQtO1G.jO!,uQdO'#HcO!-TQtO'#GuO0rQdO'#HcO!-_QdO'#HbOOQS,5:Z,5:ZO!-gQdO,5:ZO!-lQdO'#HeO!-wQdO'#HeO!.[QdO,5>OOOQS'#Ds'#DsOOQS1G/w1G/wOOQS1G.|1G.|O!/[QtO1G.|O!/cQtO1G.|O1lQdO1G.|O!0OQdO1G/UOOQS'#DZ'#DZO0rQdO,59tOOQS1G.{1G.{O!0VQdO1G/eO!0gQdO1G/eO!0oQdO1G/fO'vQdO'#H[O!0tQdO'#H[O!0yQtO1G.{O!1ZQdO,59iO!2aQdO,5=zO!2qQdO,5=zO!2yQdO1G/mO!3OQtO1G/mOOQS1G/l1G/lO!3`QdO,5=uO!4VQdO,5=uO0rQdO1G/qO!4tQdO1G/sO!4yQtO1G/sO!5ZQtO1G/qOOQS1G/p1G/pOOQS1G/r1G/rOOOW-E9w-E9wOOQS1G/{1G/{O!5kQdO'#HxO0rQdO'#HxO!5|QdO,5>cOOOW-E9x-E9xOOQS1G/|1G/|OOQS-E9{-E9{O!6[Q#xO1G2zO!6{QtO1G2zO'vQdO,5<jOOQS,5<j,5<jOOQS-E9|-E9|OOQS,5<r,5<rOOQS-E:U-E:UOOQV1G0x1G0xO1XQdO'#GRO!7dQtO,5>kOOQS1G1`1G1`O!8RQdO1G1`OOQS'#DV'#DVO0rQdO,5=qOOQS,5=q,5=qO!8WQdO'#FrO!8cQdO,59oO!8kQdO1G/XO!8uQtO,5=uOOQS1G3`1G3`OOQS,5:m,5:mO!9fQdO'#GtOOQS,5<k,5<kOOQS-E9}-E9}O!9wQdO1G.hOOQS1G0Z1G0ZO!:VQdO,5=wO!:gQdO,5=wO0rQdO1G0jO0rQdO1G0jO!:xQdO,5>jO!;ZQdO,5>jO1XQdO,5>jO!;lQdO,5>iOOQS-E:R-E:RO!;qQdO1G0lO!;|QdO1G0lO!<RQdO,5>lO!<aQdO,5>lO!<oQdO,5>hO!=VQdO,5>hO!=hQdO'#EpO0rQdO1G0tO!=sQdO1G0tO!=xQgO1G0zO!AvQgO1G0}O!EqQdO,5>oO!E{QdO,5>oO!FTQtO,5>oO0rQdO1G1PO!F_QdO1G1PO4iQdO1G1UO!!vQdO1G1WOOQV,5;a,5;aO!FdQfO,5;aO!FiQgO1G1QO!JjQdO'#GZO4iQdO1G1QO4iQdO1G1QO!JzQdO,5>pO!KXQdO,5>pO1XQdO,5>pOOQV1G1U1G1UO!KaQdO'#FSO!KrQ!fO1G1WO!KzQdO1G1WOOQV1G1]1G1]O4iQdO1G1]O!LPQdO1G1]O!LXQdO'#F^OOQV1G1b1G1bO!#ZQtO1G1bPOOO1G2v1G2vP!L^OSO1G2vOOQS,5=},5=}OOQS'#Dp'#DpO0rQdO,5=}O!LfQdO,5=|O!LyQdO,5=|OOQS1G/u1G/uO!MRQdO,5>PO!McQdO,5>PO!MkQdO,5>PO!NOQdO,5>PO!N`QdO,5>POOQS1G3j1G3jOOQS7+$h7+$hO!8kQdO7+$pO#!RQdO1G.|O#!YQdO1G.|OOQS1G/`1G/`OOQS,5<`,5<`O'vQdO,5<`OOQS7+%P7+%PO#!aQdO7+%POOQS-E9r-E9rOOQS7+%Q7+%QO#!qQdO,5=vO'vQdO,5=vOOQS7+$g7+$gO#!vQdO7+%PO##OQdO7+%QO##TQdO1G3fOOQS7+%X7+%XO##eQdO1G3fO##mQdO7+%XOOQS,5<_,5<_O'vQdO,5<_O##rQdO1G3aOOQS-E9q-E9qO#$iQdO7+%]OOQS7+%_7+%_O#$wQdO1G3aO#%fQdO7+%_O#%kQdO1G3gO#%{QdO1G3gO#&TQdO7+%]O#&YQdO,5>dO#&sQdO,5>dO#&sQdO,5>dOOQS'#Dx'#DxO#'UO&jO'#DzO#'aO`O'#HyOOOW1G3}1G3}O#'fQdO1G3}O#'nQdO1G3}O#'yQ#xO7+(fO#(jQtO1G2UP#)TQdO'#GOOOQS,5<m,5<mOOQS-E:P-E:POOQS7+&z7+&zOOQS1G3]1G3]OOQS,5<^,5<^OOQS-E9p-E9pOOQS7+$s7+$sO#)bQdO,5=`O#){QdO,5=`O#*^QtO,5<aO#*qQdO1G3cOOQS-E9s-E9sOOQS7+&U7+&UO#+RQdO7+&UO#+aQdO,5<nO#+uQdO1G4UOOQS-E:Q-E:QO#,WQdO1G4UOOQS1G4T1G4TOOQS7+&W7+&WO#,iQdO7+&WOOQS,5<p,5<pO#,tQdO1G4WOOQS-E:S-E:SOOQS,5<l,5<lO#-SQdO1G4SOOQS-E:O-E:OO1XQdO'#EqO#-jQdO'#EqO#-uQdO'#IRO#-}QdO,5;[OOQS7+&`7+&`O0rQdO7+&`O#.SQgO7+&fO!JmQdO'#GXO4iQdO7+&fO4iQdO7+&iO#2QQtO,5<tO'vQdO,5<tO#2[QdO1G4ZOOQS-E:W-E:WO#2fQdO1G4ZO4iQdO7+&kO0rQdO7+&kOOQV7+&p7+&pO!KrQ!fO7+&rO!KzQdO7+&rO`QeO1G0{OOQV-E:X-E:XO4iQdO7+&lO4iQdO7+&lOOQV,5<u,5<uO#2nQdO,5<uO!JmQdO,5<uOOQV7+&l7+&lO#2yQgO7+&lO#6tQdO,5<vO#7PQdO1G4[OOQS-E:Y-E:YO#7^QdO1G4[O#7fQdO'#IWO#7tQdO'#IWO1XQdO'#IWOOQS'#IW'#IWO#8PQdO'#IVOOQS,5;n,5;nO#8XQdO,5;nO0rQdO'#FUOOQV7+&r7+&rO4iQdO7+&rOOQV7+&w7+&wO4iQdO7+&wO#8^QfO,5;xOOQV7+&|7+&|POOO7+(b7+(bO#8cQdO1G3iOOQS,5<c,5<cO#8qQdO1G3hOOQS-E9u-E9uO#9UQdO,5<dO#9aQdO,5<dO#9tQdO1G3kOOQS-E9v-E9vO#:UQdO1G3kO#:^QdO1G3kO#:nQdO1G3kO#:UQdO1G3kOOQS<<H[<<H[O#:yQtO1G1zOOQS<<Hk<<HkP#;WQdO'#FtO8vQdO1G3bO#;eQdO1G3bO#;jQdO<<HkOOQS<<Hl<<HlO#;zQdO7+)QOOQS<<Hs<<HsO#<[QtO1G1yP#<{QdO'#FsO#=YQdO7+)RO#=jQdO7+)RO#=rQdO<<HwO#=wQdO7+({OOQS<<Hy<<HyO#>nQdO,5<bO'vQdO,5<bOOQS-E9t-E9tOOQS<<Hw<<HwOOQS,5<g,5<gO0rQdO,5<gO#>sQdO1G4OOOQS-E9y-E9yO#?^QdO1G4OO<[QdO'#H{OOOO'#D{'#D{OOOO'#F|'#F|O#?oO&jO,5:fOOOW,5>e,5>eOOOW7+)i7+)iO#?zQdO7+)iO#@SQdO1G2zO#@mQdO1G2zP'vQdO'#FuO0rQdO<<IpO1XQdO1G2YP1XQdO'#GSO#AOQdO7+)pO#AaQdO7+)pOOQS<<Ir<<IrP1XQdO'#GUP0rQdO'#GQOOQS,5;],5;]O#ArQdO,5>mO#BQQdO,5>mOOQS1G0v1G0vOOQS<<Iz<<IzOOQV-E:V-E:VO4iQdO<<JQOOQV,5<s,5<sO4iQdO,5<sOOQV<<JQ<<JQOOQV<<JT<<JTO#BYQtO1G2`P#BdQdO'#GYO#BkQdO7+)uO#BuQgO<<JVO4iQdO<<JVOOQV<<J^<<J^O4iQdO<<J^O!KrQ!fO<<J^O#FpQgO7+&gOOQV<<JW<<JWO#FzQgO<<JWOOQV1G2a1G2aO1XQdO1G2aO#JuQdO1G2aO4iQdO<<JWO1XQdO1G2bP0rQdO'#G[O#KQQdO7+)vO#K_QdO7+)vOOQS'#FT'#FTO0rQdO,5>rO#KgQdO,5>rO#KrQdO,5>rO#K}QdO,5>qO#L`QdO,5>qOOQS1G1Y1G1YOOQS,5;p,5;pOOQV<<Jc<<JcO#LhQdO1G1dOOQS7+)T7+)TP#LmQdO'#FwO#L}QdO1G2OO#MbQdO1G2OO#MrQdO1G2OP#M}QdO'#FxO#N[QdO7+)VO#NlQdO7+)VO#NlQdO7+)VO#NtQdO7+)VO$ UQdO7+(|O8vQdO7+(|OOQSAN>VAN>VO$ oQdO<<LmOOQSAN>cAN>cO0rQdO1G1|O$!PQtO1G1|P$!ZQdO'#FvOOQS1G2R1G2RP$!hQdO'#F{O$!uQdO7+)jO$#`QdO,5>gOOOO-E9z-E9zOOOW<<MT<<MTO$#nQdO7+(fOOQSAN?[AN?[OOQS7+'t7+'tO$$XQdO<<M[OOQS,5<q,5<qO$$jQdO1G4XOOQS-E:T-E:TOOQVAN?lAN?lOOQV1G2_1G2_O4iQdOAN?qO$$xQgOAN?qOOQVAN?xAN?xO4iQdOAN?xOOQV<<JR<<JRO4iQdOAN?rO4iQdO7+'{OOQV7+'{7+'{O1XQdO7+'{OOQVAN?rAN?rOOQS7+'|7+'|O$(sQdO<<MbOOQS1G4^1G4^O0rQdO1G4^OOQS,5<w,5<wO$)QQdO1G4]OOQS-E:Z-E:ZOOQU'#G_'#G_O$)cQfO7+'OO$)nQdO'#F_O$*uQdO7+'jO$+VQdO7+'jOOQS7+'j7+'jO$+bQdO<<LqO$+rQdO<<LqO$+rQdO<<LqO$+zQdO'#H^OOQS<<Lh<<LhO$,UQdO<<LhOOQS7+'h7+'hOOQS'#D|'#D|OOOO1G4R1G4RO$,oQdO1G4RO$,wQdO1G4RP!=hQdO'#GVOOQVG25]G25]O4iQdOG25]OOQVG25dG25dOOQVG25^G25^OOQV<<Kg<<KgO4iQdO<<KgOOQS7+)x7+)xP$-SQdO'#G]OOQU-E:]-E:]OOQV<<Jj<<JjO$-vQtO'#FaOOQS'#Fc'#FcO$.WQdO'#FbO$.xQdO'#FbOOQS'#Fb'#FbO$.}QdO'#IYO$)nQdO'#FiO$)nQdO'#FiO$/fQdO'#FjO$)nQdO'#FkO$/mQdO'#IZOOQS'#IZ'#IZO$0[QdO,5;yOOQS<<KU<<KUO$0dQdO<<KUO$0tQdOANB]O$1UQdOANB]O$1^QdO'#H_OOQS'#H_'#H_O1sQdO'#DcO$1wQdO,5=xOOQSANBSANBSOOOO7+)m7+)mO$2`QdO7+)mOOQVLD*wLD*wOOQVANARANARO5uQ!fO'#GaO$2hQtO,5<SO$)nQdO'#FmOOQS,5<W,5<WOOQS'#Fd'#FdO$3YQdO,5;|O$3_QdO,5;|OOQS'#Fg'#FgO$)nQdO'#G`O$4PQdO,5<QO$4kQdO,5>tO$4{QdO,5>tO1XQdO,5<PO$5^QdO,5<TO$5cQdO,5<TO$)nQdO'#I[O$5hQdO'#I[O$5mQdO,5<UOOQS,5<V,5<VO'vQdO'#FpOOQU1G1e1G1eO4iQdO1G1eOOQSAN@pAN@pO$5rQdOG27wO$6SQdO,59}OOQS1G3d1G3dOOOO<<MX<<MXOOQS,5<{,5<{OOQS-E:_-E:_O$6XQtO'#FaO$6`QdO'#I]O$6nQdO'#I]O$6vQdO,5<XOOQS1G1h1G1hO$6{QdO1G1hO$7QQdO,5<zOOQS-E:^-E:^O$7lQdO,5=OO$8TQdO1G4`OOQS-E:b-E:bOOQS1G1k1G1kOOQS1G1o1G1oO$8eQdO,5>vO$)nQdO,5>vOOQS1G1p1G1pO$8sQtO,5<[OOQU7+'P7+'PO$+zQdO1G/iO$)nQdO,5<YO$8zQdO,5>wO$9RQdO,5>wOOQS1G1s1G1sOOQS7+'S7+'SP$)nQdO'#GdO$9ZQdO1G4bO$9eQdO1G4bO$9mQdO1G4bOOQS7+%T7+%TO$9{QdO1G1tO$:ZQtO'#FaO$:bQdO,5<}OOQS,5<},5<}O$:pQdO1G4cOOQS-E:a-E:aO$)nQdO,5<|O$:wQdO,5<|O$:|QdO7+)|OOQS-E:`-E:`O$;WQdO7+)|O$)nQdO,5<ZP$)nQdO'#GcO$;`QdO1G2hO$)nQdO1G2hP$;nQdO'#GbO$;uQdO<<MhO$<PQdO1G1uO$<_QdO7+(SO8vQdO'#C}O8vQdO,59bO8vQdO,59bO8vQdO,59bO$<mQtO,5=`O8vQdO1G.|O0rQdO1G/XO0rQdO7+$pP$=QQdO'#GOO'vQdO'#GtO$=_QdO,59bO$=dQdO,59bO$=kQdO,59mO$=pQdO1G/UO1sQdO'#DRO8vQdO,59j",stateData:"$>Z~O%cOS%^OSSOS%]PQ~OPdOVaOfoOhYOopOs!POvqO!PrO!Q{O!T!SO!U!RO!XZO!][O!h`O!r`O!s`O!t`O!{tO!}uO#PvO#RwO#TxO#XyO#ZzO#^|O#_|O#a}O#c!OO#l!QO#o!TO#s!UO#u!VO#z!WO#}hO$P!XO%oRO%pRO%tSO%uWO&Z]O&[]O&]]O&^]O&_]O&`]O&a]O&b]O&c^O&d^O&e^O&f^O&g^O&h^O&i^O&j^O~O%]!YO~OV!aO_!aOa!bOh!iO!X!kO!f!mO%j![O%k!]O%l!^O%m!_O%n!_O%o!`O%p!`O%q!aO%r!aO%s!aO~Ok%xXl%xXm%xXn%xXo%xXp%xXs%xXz%xX{%xX!x%xX#g%xX%[%xX%_%xX%z%xXg%xX!T%xX!U%xX%{%xX!W%xX![%xX!Q%xX#[%xXt%xX!m%xX~P%SOfoOhYO!XZO!][O!h`O!r`O!s`O!t`O%oRO%pRO%tSO%uWO&Z]O&[]O&]]O&^]O&_]O&`]O&a]O&b]O&c^O&d^O&e^O&f^O&g^O&h^O&i^O&j^O~Oz%wX{%wX#g%wX%[%wX%_%wX%z%wX~Ok!pOl!qOm!oOn!oOo!rOp!sOs!tO!x%wX~P)pOV!zOg!|Oo0cOv0qO!PrO~P'vOV#OOo0cOv0qO!W#PO~P'vOV#SOa#TOo0cOv0qO![#UO~P'vOQ#XO%`#XO%a#ZO~OQ#^OR#[O%`#^O%a#`O~OV%iX_%iXa%iXh%iXk%iXl%iXm%iXn%iXo%iXp%iXs%iXz%iX!X%iX!f%iX%j%iX%k%iX%l%iX%m%iX%n%iX%o%iX%p%iX%q%iX%r%iX%s%iXg%iX!T%iX!U%iX~O&Z]O&[]O&]]O&^]O&_]O&`]O&a]O&b]O&c^O&d^O&e^O&f^O&g^O&h^O&i^O&j^O{%iX!x%iX#g%iX%[%iX%_%iX%z%iX%{%iX!W%iX![%iX!Q%iX#[%iXt%iX!m%iX~P,eOz#dO{%hX!x%hX#g%hX%[%hX%_%hX%z%hX~Oo0cOv0qO~P'vO#g#gO%[#iO%_#iO~O%uWO~O!T#nO#u!VO#z!WO#}hO~OopO~P'vOV#sOa#tO%uWO{wP~OV#xOo0cOv0qO!Q#yO~P'vO{#{O!x$QO%z#|O#g!yX%[!yX%_!yX~OV#xOo0cOv0qO#g#SX%[#SX%_#SX~P'vOo0cOv0qO#g#WX%[#WX%_#WX~P'vOh$WO%uWO~O!f$YO!r$YO%uWO~OV$eO~P'vO!U$gO#s$hO#u$iO~O{$jO~OV$qO~P'vOS$sO%[$rO%_$rO%c$tO~OV$}Oa$}Og%POo0cOv0qO~P'vOo0cOv0qO{%SO~P'vO&Y%UO~Oa!bOh!iO!X!kO!f!mOVba_bakbalbambanbaobapbasbazba{ba!xba#gba%[ba%_ba%jba%kba%lba%mba%nba%oba%pba%qba%rba%sba%zbagba!Tba!Uba%{ba!Wba![ba!Qba#[batba!mba~On%ZO~Oo%ZO~P'vOo0cO~P'vOk0eOl0fOm0dOn0dOo0mOp0nOs0rOg%wX!T%wX!U%wX%{%wX!W%wX![%wX!Q%wX#[%wX!m%wX~P)pO%{%]Og%vXz%vX!T%vX!U%vX!W%vX{%vX~Og%_Oz%`O!T%dO!U%cO~Og%_O~Oz%gO!T%dO!U%cO!W&SX~O!W%kO~Oz%lO{%nO!T%dO!U%cO![%}X~O![%rO~O![%sO~OQ#XO%`#XO%a%uO~OV%wOo0cOv0qO!PrO~P'vOQ#^OR#[O%`#^O%a%zO~OV!qa_!qaa!qah!qak!qal!qam!qan!qao!qap!qas!qaz!qa{!qa!X!qa!f!qa!x!qa#g!qa%[!qa%_!qa%j!qa%k!qa%l!qa%m!qa%n!qa%o!qa%p!qa%q!qa%r!qa%s!qa%z!qag!qa!T!qa!U!qa%{!qa!W!qa![!qa!Q!qa#[!qat!qa!m!qa~P#yOz%|O{%ha!x%ha#g%ha%[%ha%_%ha%z%ha~P%SOV&OOopOvqO{%ha!x%ha#g%ha%[%ha%_%ha%z%ha~P'vOz%|O{%ha!x%ha#g%ha%[%ha%_%ha%z%ha~OPdOVaOopOvqO!PrO!Q{O!{tO!}uO#PvO#RwO#TxO#XyO#ZzO#^|O#_|O#a}O#c!OO#g$zX%[$zX%_$zX~P'vO#g#gO%[&TO%_&TO~O!f&UOh&sX%[&sXz&sX#[&sX#g&sX%_&sX#Z&sXg&sX~Oh!iO%[&WO~Okealeameaneaoeapeaseazea{ea!xea#gea%[ea%_ea%zeagea!Tea!Uea%{ea!Wea![ea!Qea#[eatea!mea~P%SOsqazqa{qa#gqa%[qa%_qa%zqa~Ok!pOl!qOm!oOn!oOo!rOp!sO!xqa~PEcO%z&YOz%yX{%yX~O%uWOz%yX{%yX~Oz&]O{wX~O{&_O~Oz%lO#g%}X%[%}X%_%}Xg%}X{%}X![%}X!m%}X%z%}X~OV0lOo0cOv0qO!PrO~P'vO%z#|O#gUa%[Ua%_Ua~Oz&hO#g&PX%[&PX%_&PXn&PX~P%SOz&kO!Q&jO#g#Wa%[#Wa%_#Wa~Oz&lO#[&nO#g&rX%[&rX%_&rXg&rX~O!f$YO!r$YO#Z&qO%uWO~O#Z&qO~Oz&sO#g&tX%[&tX%_&tX~Oz&uO#g&pX%[&pX%_&pX{&pX~O!X&wO%z&xO~Oz&|On&wX~P%SOn'PO~OPdOVaOopOvqO!PrO!Q{O!{tO!}uO#PvO#RwO#TxO#XyO#ZzO#^|O#_|O#a}O#c!OO%['UO~P'vOt'YO#p'WO#q'XOP#naV#naf#nah#nao#nas#nav#na!P#na!Q#na!T#na!U#na!X#na!]#na!h#na!r#na!s#na!t#na!{#na!}#na#P#na#R#na#T#na#X#na#Z#na#^#na#_#na#a#na#c#na#l#na#o#na#s#na#u#na#z#na#}#na$P#na%X#na%o#na%p#na%t#na%u#na&Z#na&[#na&]#na&^#na&_#na&`#na&a#na&b#na&c#na&d#na&e#na&f#na&g#na&h#na&i#na&j#na%Z#na%_#na~Oz'ZO#[']O{&xX~Oh'_O!X&wO~Oh!iO{$jO!X&wO~O{'eO~P%SO%['hO%_'hO~OS'iO%['hO%_'hO~OV!aO_!aOa!bOh!iO!X!kO!f!mO%l!^O%m!_O%n!_O%o!`O%p!`O%q!aO%r!aO%s!aOkWilWimWinWioWipWisWizWi{Wi!xWi#gWi%[Wi%_Wi%jWi%zWigWi!TWi!UWi%{Wi!WWi![Wi!QWi#[WitWi!mWi~O%k!]O~P!#uO%kWi~P!#uOV!aO_!aOa!bOh!iO!X!kO!f!mO%o!`O%p!`O%q!aO%r!aO%s!aOkWilWimWinWioWipWisWizWi{Wi!xWi#gWi%[Wi%_Wi%jWi%kWi%lWi%zWigWi!TWi!UWi%{Wi!WWi![Wi!QWi#[WitWi!mWi~O%m!_O%n!_O~P!&pO%mWi%nWi~P!&pOa!bOh!iO!X!kO!f!mOkWilWimWinWioWipWisWizWi{Wi!xWi#gWi%[Wi%_Wi%jWi%kWi%lWi%mWi%nWi%oWi%pWi%zWigWi!TWi!UWi%{Wi!WWi![Wi!QWi#[WitWi!mWi~OV!aO_!aO%q!aO%r!aO%s!aO~P!)nOVWi_Wi%qWi%rWi%sWi~P!)nO!T%dO!U%cOg&VXz&VX~O%z'kO%{'kO~P,eOz'mOg&UX~Og'oO~Oz'pO{'rO!W&XX~Oo0cOv0qOz'pO{'sO!W&XX~P'vO!W'uO~Om!oOn!oOo!rOp!sOkjisjizji{ji!xji#gji%[ji%_ji%zji~Ol!qO~P!.aOlji~P!.aOk0eOl0fOm0dOn0dOo0mOp0nO~Ot'wO~P!/jOV'|Og'}Oo0cOv0qO~P'vOg'}Oz(OO~Og(QO~O!U(SO~Og(TOz(OO!T%dO!U%cO~P%SOk0eOl0fOm0dOn0dOo0mOp0nOgqa!Tqa!Uqa%{qa!Wqa![qa!Qqa#[qatqa!mqa~PEcOV'|Oo0cOv0qO!W&Sa~P'vOz(WO!W&Sa~O!W(XO~Oz(WO!T%dO!U%cO!W&Sa~P%SOV(]Oo0cOv0qO![%}a#g%}a%[%}a%_%}ag%}a{%}a!m%}a%z%}a~P'vOz(^O![%}a#g%}a%[%}a%_%}ag%}a{%}a!m%}a%z%}a~O![(aO~Oz(^O!T%dO!U%cO![%}a~P%SOz(dO!T%dO!U%cO![&Ta~P%SOz(gO{&lX![&lX!m&lX%z&lX~O{(kO![(mO!m(nO%z(jO~OV&OOopOvqO{%hi!x%hi#g%hi%[%hi%_%hi%z%hi~P'vOz(pO{%hi!x%hi#g%hi%[%hi%_%hi%z%hi~O!f&UOh&sa%[&saz&sa#[&sa#g&sa%_&sa#Z&sag&sa~O%[(uO~OV#sOa#tO%uWO~Oz&]O{wa~OopOvqO~P'vOz(^O#g%}a%[%}a%_%}ag%}a{%}a![%}a!m%}a%z%}a~P%SOz(zO#g%hX%[%hX%_%hX%z%hX~O%z#|O#gUi%[Ui%_Ui~O#g&Pa%[&Pa%_&Pan&Pa~P'vOz(}O#g&Pa%[&Pa%_&Pan&Pa~O%uWO#g&ra%[&ra%_&rag&ra~Oz)SO#g&ra%[&ra%_&rag&ra~Og)VO~OV)WOh$WO%uWO~O#Z)XO~O%uWO#g&ta%[&ta%_&ta~Oz)ZO#g&ta%[&ta%_&ta~Oo0cOv0qO#g&pa%[&pa%_&pa{&pa~P'vOz)^O#g&pa%[&pa%_&pa{&pa~OV)`Oa)`O%uWO~O%z)eO~Ot)hO#j)gOP#hiV#hif#hih#hio#his#hiv#hi!P#hi!Q#hi!T#hi!U#hi!X#hi!]#hi!h#hi!r#hi!s#hi!t#hi!{#hi!}#hi#P#hi#R#hi#T#hi#X#hi#Z#hi#^#hi#_#hi#a#hi#c#hi#l#hi#o#hi#s#hi#u#hi#z#hi#}#hi$P#hi%X#hi%o#hi%p#hi%t#hi%u#hi&Z#hi&[#hi&]#hi&^#hi&_#hi&`#hi&a#hi&b#hi&c#hi&d#hi&e#hi&f#hi&g#hi&h#hi&i#hi&j#hi%Z#hi%_#hi~Ot)iOP#kiV#kif#kih#kio#kis#kiv#ki!P#ki!Q#ki!T#ki!U#ki!X#ki!]#ki!h#ki!r#ki!s#ki!t#ki!{#ki!}#ki#P#ki#R#ki#T#ki#X#ki#Z#ki#^#ki#_#ki#a#ki#c#ki#l#ki#o#ki#s#ki#u#ki#z#ki#}#ki$P#ki%X#ki%o#ki%p#ki%t#ki%u#ki&Z#ki&[#ki&]#ki&^#ki&_#ki&`#ki&a#ki&b#ki&c#ki&d#ki&e#ki&f#ki&g#ki&h#ki&i#ki&j#ki%Z#ki%_#ki~OV)kOn&wa~P'vOz)lOn&wa~Oz)lOn&wa~P%SOn)pO~O%Y)tO~Ot)wO#p'WO#q)vOP#niV#nif#nih#nio#nis#niv#ni!P#ni!Q#ni!T#ni!U#ni!X#ni!]#ni!h#ni!r#ni!s#ni!t#ni!{#ni!}#ni#P#ni#R#ni#T#ni#X#ni#Z#ni#^#ni#_#ni#a#ni#c#ni#l#ni#o#ni#s#ni#u#ni#z#ni#}#ni$P#ni%X#ni%o#ni%p#ni%t#ni%u#ni&Z#ni&[#ni&]#ni&^#ni&_#ni&`#ni&a#ni&b#ni&c#ni&d#ni&e#ni&f#ni&g#ni&h#ni&i#ni&j#ni%Z#ni%_#ni~OV)zOo0cOv0qO{$jO~P'vOo0cOv0qO{&xa~P'vOz*OO{&xa~OV*SOa*TOg*WO%q*UO%uWO~O{$jO&{*YO~Oh'_O~Oh!iO{$jO~O%[*_O~O%[*aO%_*aO~OV$}Oa$}Oo0cOv0qOg&Ua~P'vOz*dOg&Ua~Oo0cOv0qO{*gO!W&Xa~P'vOz*hO!W&Xa~Oo0cOv0qOz*hO{*kO!W&Xa~P'vOo0cOv0qOz*hO!W&Xa~P'vOz*hO{*kO!W&Xa~Om0dOn0dOo0mOp0nOgjikjisjizji!Tji!Uji%{ji!Wji{ji![ji#gji%[ji%_ji!Qji#[jitji!mji%zji~Ol0fO~P!NkOlji~P!NkOV'|Og*pOo0cOv0qO~P'vOn*rO~Og*pOz*tO~Og*uO~OV'|Oo0cOv0qO!W&Si~P'vOz*vO!W&Si~O!W*wO~OV(]Oo0cOv0qO![%}i#g%}i%[%}i%_%}ig%}i{%}i!m%}i%z%}i~P'vOz*zO!T%dO!U%cO![&Ti~Oz*}O![%}i#g%}i%[%}i%_%}ig%}i{%}i!m%}i%z%}i~O![+OO~Oa+QOo0cOv0qO![&Ti~P'vOz*zO![&Ti~O![+SO~OV+UOo0cOv0qO{&la![&la!m&la%z&la~P'vOz+VO{&la![&la!m&la%z&la~O!]+YO&n+[O![!nX~O![+^O~O{(kO![+_O~O{(kO![+_O!m+`O~OV&OOopOvqO{%hq!x%hq#g%hq%[%hq%_%hq%z%hq~P'vOz$ri{$ri!x$ri#g$ri%[$ri%_$ri%z$ri~P%SOV&OOopOvqO~P'vOV&OOo0cOv0qO#g%ha%[%ha%_%ha%z%ha~P'vOz+aO#g%ha%[%ha%_%ha%z%ha~Oz$ia#g$ia%[$ia%_$ian$ia~P%SO#g&Pi%[&Pi%_&Pin&Pi~P'vOz+dO#g#Wq%[#Wq%_#Wq~O#[+eOz$va#g$va%[$va%_$vag$va~O%uWO#g&ri%[&ri%_&rig&ri~Oz+gO#g&ri%[&ri%_&rig&ri~OV+iOh$WO%uWO~O%uWO#g&ti%[&ti%_&ti~Oo0cOv0qO#g&pi%[&pi%_&pi{&pi~P'vO{#{Oz#eX!W#eX~Oz+mO!W&uX~O!W+oO~Ot+rO#j)gOP#hqV#hqf#hqh#hqo#hqs#hqv#hq!P#hq!Q#hq!T#hq!U#hq!X#hq!]#hq!h#hq!r#hq!s#hq!t#hq!{#hq!}#hq#P#hq#R#hq#T#hq#X#hq#Z#hq#^#hq#_#hq#a#hq#c#hq#l#hq#o#hq#s#hq#u#hq#z#hq#}#hq$P#hq%X#hq%o#hq%p#hq%t#hq%u#hq&Z#hq&[#hq&]#hq&^#hq&_#hq&`#hq&a#hq&b#hq&c#hq&d#hq&e#hq&f#hq&g#hq&h#hq&i#hq&j#hq%Z#hq%_#hq~On$|az$|a~P%SOV)kOn&wi~P'vOz+yOn&wi~Oz,TO{$jO#[,TO~O#q,VOP#nqV#nqf#nqh#nqo#nqs#nqv#nq!P#nq!Q#nq!T#nq!U#nq!X#nq!]#nq!h#nq!r#nq!s#nq!t#nq!{#nq!}#nq#P#nq#R#nq#T#nq#X#nq#Z#nq#^#nq#_#nq#a#nq#c#nq#l#nq#o#nq#s#nq#u#nq#z#nq#}#nq$P#nq%X#nq%o#nq%p#nq%t#nq%u#nq&Z#nq&[#nq&]#nq&^#nq&_#nq&`#nq&a#nq&b#nq&c#nq&d#nq&e#nq&f#nq&g#nq&h#nq&i#nq&j#nq%Z#nq%_#nq~O#[,WOz%Oa{%Oa~Oo0cOv0qO{&xi~P'vOz,YO{&xi~O{#{O%z,[Og&zXz&zX~O%uWOg&zXz&zX~Oz,`Og&yX~Og,bO~O%Y,eO~O!T%dO!U%cOg&Viz&Vi~OV$}Oa$}Oo0cOv0qOg&Ui~P'vO{,hOz$la!W$la~Oo0cOv0qO{,iOz$la!W$la~P'vOo0cOv0qO{*gO!W&Xi~P'vOz,lO!W&Xi~Oo0cOv0qOz,lO!W&Xi~P'vOz,lO{,oO!W&Xi~Og$hiz$hi!W$hi~P%SOV'|Oo0cOv0qO~P'vOn,qO~OV'|Og,rOo0cOv0qO~P'vOV'|Oo0cOv0qO!W&Sq~P'vOz$gi![$gi#g$gi%[$gi%_$gig$gi{$gi!m$gi%z$gi~P%SOV(]Oo0cOv0qO~P'vOa+QOo0cOv0qO![&Tq~P'vOz,sO![&Tq~O![,tO~OV(]Oo0cOv0qO![%}q#g%}q%[%}q%_%}qg%}q{%}q!m%}q%z%}q~P'vO{,uO~OV+UOo0cOv0qO{&li![&li!m&li%z&li~P'vOz,zO{&li![&li!m&li%z&li~O!]+YO&n+[O![!na~O{(kO![,}O~OV&OOo0cOv0qO#g%hi%[%hi%_%hi%z%hi~P'vOz-OO#g%hi%[%hi%_%hi%z%hi~O%uWO#g&rq%[&rq%_&rqg&rq~Oz-RO#g&rq%[&rq%_&rqg&rq~OV)`Oa)`O%uWO!W&ua~Oz-TO!W&ua~On$|iz$|i~P%SOV)kO~P'vOV)kOn&wq~P'vOt-XOP#myV#myf#myh#myo#mys#myv#my!P#my!Q#my!T#my!U#my!X#my!]#my!h#my!r#my!s#my!t#my!{#my!}#my#P#my#R#my#T#my#X#my#Z#my#^#my#_#my#a#my#c#my#l#my#o#my#s#my#u#my#z#my#}#my$P#my%X#my%o#my%p#my%t#my%u#my&Z#my&[#my&]#my&^#my&_#my&`#my&a#my&b#my&c#my&d#my&e#my&f#my&g#my&h#my&i#my&j#my%Z#my%_#my~O%Z-]O%_-]O~P`O#q-^OP#nyV#nyf#nyh#nyo#nys#nyv#ny!P#ny!Q#ny!T#ny!U#ny!X#ny!]#ny!h#ny!r#ny!s#ny!t#ny!{#ny!}#ny#P#ny#R#ny#T#ny#X#ny#Z#ny#^#ny#_#ny#a#ny#c#ny#l#ny#o#ny#s#ny#u#ny#z#ny#}#ny$P#ny%X#ny%o#ny%p#ny%t#ny%u#ny&Z#ny&[#ny&]#ny&^#ny&_#ny&`#ny&a#ny&b#ny&c#ny&d#ny&e#ny&f#ny&g#ny&h#ny&i#ny&j#ny%Z#ny%_#ny~Oz-aO{$jO#[-aO~Oo0cOv0qO{&xq~P'vOz-dO{&xq~O%z,[Og&zaz&za~O{#{Og&zaz&za~OV*SOa*TO%q*UO%uWOg&ya~Oz-hOg&ya~O$S-lO~OV$}Oa$}Oo0cOv0qO~P'vOo0cOv0qO{-mOz$li!W$li~P'vOo0cOv0qOz$li!W$li~P'vO{-mOz$li!W$li~Oo0cOv0qO{*gO~P'vOo0cOv0qO{*gO!W&Xq~P'vOz-pO!W&Xq~Oo0cOv0qOz-pO!W&Xq~P'vOs-sO!T%dO!U%cOg&Oq!W&Oq![&Oqz&Oq~P!/jOa+QOo0cOv0qO![&Ty~P'vOz$ji![$ji~P%SOa+QOo0cOv0qO~P'vOV+UOo0cOv0qO~P'vOV+UOo0cOv0qO{&lq![&lq!m&lq%z&lq~P'vO{(kO![-xO!m-yO%z-wO~OV&OOo0cOv0qO#g%hq%[%hq%_%hq%z%hq~P'vO%uWO#g&ry%[&ry%_&ryg&ry~OV)`Oa)`O%uWO!W&ui~Ot-}OP#m!RV#m!Rf#m!Rh#m!Ro#m!Rs#m!Rv#m!R!P#m!R!Q#m!R!T#m!R!U#m!R!X#m!R!]#m!R!h#m!R!r#m!R!s#m!R!t#m!R!{#m!R!}#m!R#P#m!R#R#m!R#T#m!R#X#m!R#Z#m!R#^#m!R#_#m!R#a#m!R#c#m!R#l#m!R#o#m!R#s#m!R#u#m!R#z#m!R#}#m!R$P#m!R%X#m!R%o#m!R%p#m!R%t#m!R%u#m!R&Z#m!R&[#m!R&]#m!R&^#m!R&_#m!R&`#m!R&a#m!R&b#m!R&c#m!R&d#m!R&e#m!R&f#m!R&g#m!R&h#m!R&i#m!R&j#m!R%Z#m!R%_#m!R~Oo0cOv0qO{&xy~P'vOV*SOa*TO%q*UO%uWOg&yi~O$S-lO%Z.VO%_.VO~OV.aOh._O!X.^O!].`O!h.YO!s.[O!t.[O%p.XO%uWO&Z]O&[]O&]]O&^]O&_]O&`]O&a]O&b]O~Oo0cOv0qOz$lq!W$lq~P'vO{.fOz$lq!W$lq~Oo0cOv0qO{*gO!W&Xy~P'vOz.gO!W&Xy~Oo0cOv.kO~P'vOs-sO!T%dO!U%cOg&Oy!W&Oy![&Oyz&Oy~P!/jO{(kO![.nO~O{(kO![.nO!m.oO~OV*SOa*TO%q*UO%uWO~Oh.tO!f.rOz$TX#[$TX%j$TXg$TX~Os$TX{$TX!W$TX![$TX~P$-bO%o.vO%p.vOs$UXz$UX{$UX#[$UX%j$UX!W$UXg$UX![$UX~O!h.xO~Oz.|O#[/OO%j.yOs&|X{&|X!W&|Xg&|X~Oa/RO~P$)zOh.tOs&}Xz&}X{&}X#[&}X%j&}X!W&}Xg&}X![&}X~Os/VO{$jO~Oo0cOv0qOz$ly!W$ly~P'vOo0cOv0qO{*gO!W&X!R~P'vOz/ZO!W&X!R~Og&RXs&RX!T&RX!U&RX!W&RX![&RXz&RX~P!/jOs-sO!T%dO!U%cOg&Qa!W&Qa![&Qaz&Qa~O{(kO![/^O~O!f.rOh$[as$[az$[a{$[a#[$[a%j$[a!W$[ag$[a![$[a~O!h/eO~O%o.vO%p.vOs$Uaz$Ua{$Ua#[$Ua%j$Ua!W$Uag$Ua![$Ua~O%j.yOs$Yaz$Ya{$Ya#[$Ya!W$Yag$Ya![$Ya~Os&|a{&|a!W&|ag&|a~P$)nOz/jOs&|a{&|a!W&|ag&|a~O!W/mO~Og/mO~O{/oO~O![/pO~Oo0cOv0qO{*gO!W&X!Z~P'vO{/sO~O%z/tO~P$-bOz/uO#[/OO%j.yOg'PX~Oz/uOg'PX~Og/wO~O!h/xO~O#[/OOs%Saz%Sa{%Sa%j%Sa!W%Sag%Sa![%Sa~O#[/OO%j.yOs%Waz%Wa{%Wa!W%Wag%Wa~Os&|i{&|i!W&|ig&|i~P$)nOz/zO#[/OO%j.yO!['Oa~O{$da~P%SOg'Pa~P$)nOz0SOg'Pa~Oa0UO!['Oi~P$)zOz0WO!['Oi~Oz0WO#[/OO%j.yO!['Oi~O#[/OO%j.yOg$biz$bi~O%z0ZO~P$-bO#[/OO%j.yOg%Vaz%Va~Og'Pi~P$)nO{0^O~Oa0UO!['Oq~P$)zOz0`O!['Oq~O#[/OO%j.yOz%Ui![%Ui~Oa0UO~P$)zOa0UO!['Oy~P$)zO#[/OO%j.yOg$ciz$ci~O#[/OO%j.yOz%Uq![%Uq~Oz+aO#g%ha%[%ha%_%ha%z%ha~P%SOV&OOo0cOv0qO~P'vOn0hO~Oo0hO~P'vO{0iO~Ot0jO~P!/jO&]&Z&j&h&i&g&f&d&e&c&b&`&a&_&^&[%u~",goto:"!=o'QPPPPPP'RP'Z*s+]+v,b,}-kP.YP'Z.y.y'ZPPP'Z2cPPPPPP2c5VPP5VP7g7p=xPP={>m>pPP'Z'ZPP?PPP'Z'ZPP'Z'Z'Z'Z'Z?T?}'ZP@QP@WD_G{HPPHSH^Hb'ZPPPHeHq'RP'R'RP'RP'RP'RP'RP'R'R'RP'RPP'RPP'RP'RPHwITI]PIdIjPIdPIdIdPPPIdPKxPLRL]LcKxPIdLlPIdPLsLyPL}McNQNkL}L}Nq! OL}L}L}L}! d! j! m! r! u!!P!!V!!c!!u!!{!#V!#]!#y!$P!$V!$a!$g!$m!%P!%Z!%a!%g!%q!%w!%}!&T!&Z!&a!&k!&q!&{!'R!'[!'b!'q!'y!(T!([PPPPPPPPPPP!(b!(e!(k!(t!)O!)ZPPPPPPPPPPPP!-}!/c!3c!6sPP!6{!7[!7e!8^!8T!8g!8m!8p!8s!8v!9O!9oPPPPPPPPPPPPPPPPP!9r!9v!9|P!:b!:f!:r!:{!;X!;o!;r!;u!;{!<R!<X!<[P!<d!<m!=i!=l]eOn#g$j)t,P'}`OTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!i!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'm'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0r}!cQ#c#p$R$d$p%e%j%p%q&`'O'g(q(|)j*o*x+w,v/q0g!P!dQ#c#p$R$d$p$u%e%j%p%q&`'O'g(q(|)j*o*x+w,v/q0g!R!eQ#c#p$R$d$p$u$v%e%j%p%q&`'O'g(q(|)j*o*x+w,v/q0g!T!fQ#c#p$R$d$p$u$v$w%e%j%p%q&`'O'g(q(|)j*o*x+w,v/q0g!V!gQ#c#p$R$d$p$u$v$w$x%e%j%p%q&`'O'g(q(|)j*o*x+w,v/q0g!X!hQ#c#p$R$d$p$u$v$w$x$y%e%j%p%q&`'O'g(q(|)j*o*x+w,v/q0g!]!hQ!n#c#p$R$d$p$u$v$w$x$y$z%e%j%p%q&`'O'g(q(|)j*o*x+w,v/q0g'}TOTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!i!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'm'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0r&cVOYZ[dnprxy}!P!Q!U!i!k!o!p!q!s!t#[#d#g#y#{#}$Q$h$j$}%S%Z%^%`%g%l%n%w%|&Z&_&j&k&u&x'P'W'Z'l'm'p'r's'w(O(W(^(d(g(p(r(z)^)e)g)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+U+V+Y+a+d+k,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/Z/s0c0d0e0f0h0i0j0k0n0r%mXOYZ[dnrxy}!P!Q!U!i!k#[#d#g#y#{#}$Q$h$j$}%S%^%`%g%l%n%w%|&Z&_&j&k&u&x'P'W'Z'l'm'p'r's'w(O(W(^(d(g(p(r(z)^)e)g)p)t)z*O*Y*d*g*h*k*q*t*v*y*z*}+U+V+Y+a+d+k,P,X,Y,],g,h,i,k,l,o,s,u,w,y,z-O-d-f-m-p.f.g/Z0i0j0kQ#vqQ/[.kR0o0q't`OTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0rh#jhz{$W$Z&l&q)S)X+f+g-RW#rq&].k0qQ$]|Q$a!OQ$n!VQ$o!WW$|!i'm*d,gS&[#s#tQ'S$iQ(s&UQ)U&nU)Y&s)Z+jW)a&w+m-T-{Q*Q']W*R'_,`-h.TQ+l)`S,_*S*TQ-Q+eQ-_,TQ-c,WQ.R-al.W-l.^._.a.z.|/R/j/o/t/y0U0Z0^Q/S.`Q/a.tQ/l/OU0P/u0S0[X0V/z0W0_0`R&Z#r!_!wYZ!P!Q!k%S%`%g'p'r's(O(W)g*g*h*k*q*t*v,h,i,k,l,o-m-p.f.g/ZR%^!vQ!{YQ%x#[Q&d#}Q&g$QR,{+YT.j-s/s![!jQ!n#c#p$R$d$p$u$v$w$x$y$z%e%j%p%q&`'O'g(q(|)j*o*x+w,v/q0gQ&X#kQ'c$oR*^'dR'l$|Q%V!mR/_.r'|_OTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!i!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'm'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0rS#a_#b!P.[-l.^._.`.a.t.z.|/R/j/o/t/u/y/z0S0U0W0Z0[0^0_0`'|_OTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!i!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'm'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0rT#a_#bT#^^#_R(o%xa(l%x(n(o+`,{-y-z.oT+[(k+]R-z,{Q$PsQ+l)aQ,^*RR-e,_X#}s$O$P&fQ&y$aQ'a$nQ'd$oR)s'SQ)b&wV-S+m-T-{ZgOn$j)t,PXkOn)t,PQ$k!TQ&z$bQ&{$cQ'^$mQ'b$oQ)q'RQ)x'WQ){'XQ)|'YQ*Z'`S*]'c'dQ+s)gQ+u)hQ+v)iQ+z)oS+|)r*[Q,Q)vQ,R)wS,S)y)zQ,d*^Q-V+rQ-W+tQ-Y+{S-Z+},OQ-`,UQ-b,VQ-|-XQ.O-[Q.P-^Q.Q-_Q.p-}Q.q.RQ/W.dR/r/XWkOn)t,PR#mjQ'`$nS)r'S'aR,O)sQ,]*RR-f,^Q*['`Q+})rR-[,OZiOjn)t,PQ'f$pR*`'gT-j,e-ku.c-l.^._.a.t.z.|/R/j/o/t/u/y0S0U0Z0[0^t.c-l.^._.a.t.z.|/R/j/o/t/u/y0S0U0Z0[0^Q/S.`X0V/z0W0_0`!P.Z-l.^._.`.a.t.z.|/R/j/o/t/u/y/z0S0U0W0Z0[0^0_0`Q.w.YR/f.xg.z.].{/b/i/n/|0O0Q0]0a0bu.b-l.^._.a.t.z.|/R/j/o/t/u/y0S0U0Z0[0^X.u.W.b/a0PR/c.tV0R/u0S0[R/X.dQnOS#on,PR,P)tQ&^#uR(x&^S%m#R#wS(_%m(bT(b%p&`Q%a!yQ%h!}W(P%a%h(U(YQ(U%eR(Y%jQ&i$RR)O&iQ(e%qQ*{(`T+R(e*{Q'n%OR*e'nS'q%R%SY*i'q*j,m-q.hU*j'r's'tU,m*k*l*mS-q,n,oR.h-rQ#Y]R%t#YQ#_^R%y#_Q(h%vS+W(h+XR+X(iQ+](kR,|+]Q#b_R%{#bQ#ebQ%}#cW&Q#e%}({+bQ({&cR+b0gQ$OsS&e$O&fR&f$PQ&v$_R)_&vQ&V#jR(t&VQ&m$VS)T&m+hR+h)UQ$Z{R&p$ZQ&t$]R)[&tQ+n)bR-U+nQ#hfR&S#hQ)f&zR+q)fQ&}$dS)m&})nR)n'OQ'V$kR)u'VQ'[$lS*P'[,ZR,Z*QQ,a*VR-i,aWjOn)t,PR#ljQ-k,eR.U-kd.{.]/b/i/n/|0O0Q0]0a0bR/h.{U.s.W/a0PR/`.sQ/{/nS0X/{0YR0Y/|S/v/b/cR0T/vQ.}.]R/k.}R!ZPXmOn)t,PWlOn)t,PR'T$jYfOn$j)t,PR&R#g[sOn#g$j)t,PR&d#}&bQOYZ[dnprxy}!P!Q!U!i!k!o!p!q!s!t#[#d#g#y#{#}$Q$h$j$}%S%Z%^%`%g%l%n%w%|&Z&_&j&k&u&x'P'W'Z'l'm'p'r's'w(O(W(^(d(g(p(r(z)^)e)g)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+U+V+Y+a+d+k,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/Z/s0c0d0e0f0h0i0j0k0n0rQ!nTQ#caQ#poU$Rt%c(SS$d!R$gQ$p!XQ$u!cQ$v!dQ$w!eQ$x!fQ$y!gQ$z!hQ%e!zQ%j#OQ%p#SQ%q#TQ&`#xQ'O$eQ'g$qQ(q&OU(|&h(}+cW)j&|)l+x+yQ*o'|Q*x(]Q+w)kQ,v+QQ/q/VR0g0lQ!yYQ!}ZQ$b!PQ$c!QQ%R!kQ't%S^'{%`%g(O(W*q*t*v^*f'p*h,k,l-p.g/ZQ*l'rQ*m'sQ+t)gQ,j*gQ,n*kQ-n,hQ-o,iQ-r,oQ.e-mR/Y.f[bOn#g$j)t,P!^!vYZ!P!Q!k%S%`%g'p'r's(O(W)g*g*h*k*q*t*v,h,i,k,l,o-m-p.f.g/ZQ#R[Q#fdS#wrxQ$UyW$_}$Q'P)pS$l!U$hW${!i'm*d,gS%v#[+Y`&P#d%|(p(r(z+a-O0kQ&a#yQ&b#{Q&c#}Q'j$}Q'z%^W([%l(^*y*}Q(`%nQ(i%wQ(v&ZS(y&_0iQ)P&jQ)Q&kU)]&u)^+kQ)d&xQ)y'WY)}'Z*O,X,Y-dQ*b'lS*n'w0jW+P(d*z,s,wW+T(g+V,y,zQ+p)eQ,U)zQ,c*YQ,x+UQ-P+dQ-e,]Q-v,uR.S-fhUOn#d#g$j%|&_'w(p(r)t,P%S!uYZ[drxy}!P!Q!U!i!k#[#y#{#}$Q$h$}%S%^%`%g%l%n%w&Z&j&k&u&x'P'W'Z'l'm'p'r's(O(W(^(d(g(z)^)e)g)p)z*O*Y*d*g*h*k*q*t*v*y*z*}+U+V+Y+a+d+k,X,Y,],g,h,i,k,l,o,s,u,w,y,z-O-d-f-m-p.f.g/Z0i0j0kQ#qpW%W!o!s0d0nQ%X!pQ%Y!qQ%[!tQ%f0cS'v%Z0hQ'x0eQ'y0fQ,p*rQ-u,qS.i-s/sR0p0rU#uq.k0qR(w&][cOn#g$j)t,PZ!xY#[#}$Q+YQ#W[Q#zrR$TxQ%b!yQ%i!}Q%o#RQ'j${Q(V%eQ(Z%jQ(c%pQ(f%qQ*|(`Q,f*bQ-t,pQ.m-uR/].lQ$StQ(R%cR*s(SQ.l-sR/}/sR#QZR#V[R%Q!iQ%O!iV*c'm*d,g!]!lQ!n#c#p$R$d$p$u$v$w$x$y$z%e%j%p%q&`'O'g(q(|)j*o*x+w,v/q0gR%T!kT#]^#_Q%x#[R,{+YQ(m%xS+_(n(oQ,}+`Q-x,{S.n-y-zR/^.oT+Z(k+]Q$`}Q&g$QQ)o'PR+{)pQ$XzQ)W&qR+i)XQ$XzQ&o$WQ)W&qR+i)XQ#khW$Vz$W&q)XQ$[{Q&r$ZZ)R&l)S+f+g-RR$^|R)c&wXlOn)t,PQ$f!RR'Q$gQ$m!UR'R$hR*X'_Q*V'_V-g,`-h.TQ.d-lQ/P.^R/Q._U.]-l.^._Q/U.aQ/b.tQ/g.zU/i.|/j/yQ/n/RQ/|/oQ0O/tU0Q/u0S0[Q0]0UQ0a0ZR0b0^R/T.`R/d.t",nodeNames:" print Escape { Comment Script AssignStatement * BinaryExpression BitOp BitOp BitOp BitOp ArithOp ArithOp @ ArithOp ** UnaryExpression ArithOp BitOp AwaitExpression await ) ( ParenthesizedExpression BinaryExpression or and CompareOp in not is UnaryExpression ConditionalExpression if else LambdaExpression lambda ParamList VariableName AssignOp , : NamedExpression AssignOp YieldExpression yield from TupleExpression ComprehensionExpression async for LambdaExpression ] [ ArrayExpression ArrayComprehensionExpression } { DictionaryExpression DictionaryComprehensionExpression SetExpression SetComprehensionExpression CallExpression ArgList AssignOp MemberExpression . PropertyName Number String FormatString FormatReplacement FormatSelfDoc FormatConversion FormatSpec FormatReplacement FormatSelfDoc ContinuedString Ellipsis None Boolean TypeDef AssignOp UpdateStatement UpdateOp ExpressionStatement DeleteStatement del PassStatement pass BreakStatement break ContinueStatement continue ReturnStatement return YieldStatement PrintStatement RaiseStatement raise ImportStatement import as ScopeStatement global nonlocal AssertStatement assert TypeDefinition type TypeParamList TypeParam StatementGroup ; IfStatement Body elif WhileStatement while ForStatement TryStatement try except finally WithStatement with FunctionDefinition def ParamList AssignOp TypeDef ClassDefinition class DecoratedStatement Decorator At MatchStatement match MatchBody MatchClause case CapturePattern LiteralPattern ArithOp ArithOp AsPattern OrPattern LogicOp AttributePattern SequencePattern MappingPattern StarPattern ClassPattern PatternArgList KeywordPattern KeywordPattern Guard",maxTerm:277,context:B6e,nodeProps:[["isolate",-5,4,71,72,73,77,""],["group",-15,6,85,87,88,90,92,94,96,98,99,100,102,105,108,110,"Statement Statement",-22,8,18,21,25,40,49,50,56,57,60,61,62,63,64,67,70,71,72,79,80,81,82,"Expression",-10,114,116,119,121,122,126,128,133,135,138,"Statement",-9,143,144,147,148,150,151,152,153,154,"Pattern"],["openedBy",23,"(",54,"[",58,"{"],["closedBy",24,")",55,"]",59,"}"]],propSources:[q6e],skippedNodes:[0,4],repeatNodeCount:34,tokenData:"!2|~R!`OX%TXY%oY[%T[]%o]p%Tpq%oqr'ars)Yst*xtu%Tuv,dvw-hwx.Uxy/tyz0[z{0r{|2S|}2p}!O3W!O!P4_!P!Q:Z!Q!R;k!R![>_![!]Do!]!^Es!^!_FZ!_!`Gk!`!aHX!a!b%T!b!cIf!c!dJU!d!eK^!e!hJU!h!i!#f!i!tJU!t!u!,|!u!wJU!w!x!.t!x!}JU!}#O!0S#O#P&o#P#Q!0j#Q#R!1Q#R#SJU#S#T%T#T#UJU#U#VK^#V#YJU#Y#Z!#f#Z#fJU#f#g!,|#g#iJU#i#j!.t#j#oJU#o#p!1n#p#q!1s#q#r!2a#r#s!2f#s$g%T$g;'SJU;'S;=`KW<%lOJU`%YT&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%T`%lP;=`<%l%To%v]&n`%c_OX%TXY%oY[%T[]%o]p%Tpq%oq#O%T#O#P&o#P#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To&tX&n`OY%TYZ%oZ]%T]^%o^#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc'f[&n`O!_%T!_!`([!`#T%T#T#U(r#U#f%T#f#g(r#g#h(r#h#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc(cTmR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc(yT!mR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk)aV&n`&[ZOr%Trs)vs#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk){V&n`Or%Trs*bs#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk*iT&n`&^ZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To+PZS_&n`OY*xYZ%TZ]*x]^%T^#o*x#o#p+r#p#q*x#q#r+r#r;'S*x;'S;=`,^<%lO*x_+wTS_OY+rZ]+r^;'S+r;'S;=`,W<%lO+r_,ZP;=`<%l+ro,aP;=`<%l*xj,kV%rQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tj-XT!xY&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tj-oV%lQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk.]V&n`&ZZOw%Twx.rx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk.wV&n`Ow%Twx/^x#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk/eT&n`&]ZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk/{ThZ&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc0cTgR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk0yXVZ&n`Oz%Tz{1f{!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk1mVaR&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk2ZV%oZ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc2wTzR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To3_W%pZ&n`O!_%T!_!`-Q!`!a3w!a#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Td4OT&{S&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk4fX!fQ&n`O!O%T!O!P5R!P!Q%T!Q![6T![#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk5WV&n`O!O%T!O!P5m!P#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk5tT!rZ&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti6[a!hX&n`O!Q%T!Q![6T![!g%T!g!h7a!h!l%T!l!m9s!m#R%T#R#S6T#S#X%T#X#Y7a#Y#^%T#^#_9s#_#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti7fZ&n`O{%T{|8X|}%T}!O8X!O!Q%T!Q![8s![#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti8^V&n`O!Q%T!Q![8s![#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti8z]!hX&n`O!Q%T!Q![8s![!l%T!l!m9s!m#R%T#R#S8s#S#^%T#^#_9s#_#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti9zT!hX&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk:bX%qR&n`O!P%T!P!Q:}!Q!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tj;UV%sQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti;ro!hX&n`O!O%T!O!P=s!P!Q%T!Q![>_![!d%T!d!e?q!e!g%T!g!h7a!h!l%T!l!m9s!m!q%T!q!rA]!r!z%T!z!{Bq!{#R%T#R#S>_#S#U%T#U#V?q#V#X%T#X#Y7a#Y#^%T#^#_9s#_#c%T#c#dA]#d#l%T#l#mBq#m#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti=xV&n`O!Q%T!Q![6T![#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti>fc!hX&n`O!O%T!O!P=s!P!Q%T!Q![>_![!g%T!g!h7a!h!l%T!l!m9s!m#R%T#R#S>_#S#X%T#X#Y7a#Y#^%T#^#_9s#_#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti?vY&n`O!Q%T!Q!R@f!R!S@f!S#R%T#R#S@f#S#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti@mY!hX&n`O!Q%T!Q!R@f!R!S@f!S#R%T#R#S@f#S#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TiAbX&n`O!Q%T!Q!YA}!Y#R%T#R#SA}#S#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TiBUX!hX&n`O!Q%T!Q!YA}!Y#R%T#R#SA}#S#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TiBv]&n`O!Q%T!Q![Co![!c%T!c!iCo!i#R%T#R#SCo#S#T%T#T#ZCo#Z#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TiCv]!hX&n`O!Q%T!Q![Co![!c%T!c!iCo!i#R%T#R#SCo#S#T%T#T#ZCo#Z#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%ToDvV{_&n`O!_%T!_!`E]!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TcEdT%{R&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkEzT#gZ&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkFbXmR&n`O!^%T!^!_F}!_!`([!`!a([!a#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TjGUV%mQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkGrV%zZ&n`O!_%T!_!`([!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkH`WmR&n`O!_%T!_!`([!`!aHx!a#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TjIPV%nQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkIoV_Q#}P&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%ToJ_]&n`&YS%uZO!Q%T!Q![JU![!c%T!c!}JU!}#R%T#R#SJU#S#T%T#T#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUoKZP;=`<%lJUoKge&n`&YS%uZOr%Trs)Ysw%Twx.Ux!Q%T!Q![JU![!c%T!c!tJU!t!uLx!u!}JU!}#R%T#R#SJU#S#T%T#T#fJU#f#gLx#g#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUoMRa&n`&YS%uZOr%TrsNWsw%Twx! vx!Q%T!Q![JU![!c%T!c!}JU!}#R%T#R#SJU#S#T%T#T#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUkN_V&n`&`ZOr%TrsNts#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkNyV&n`Or%Trs! `s#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk! gT&n`&bZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk! }V&n`&_ZOw%Twx!!dx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!!iV&n`Ow%Twx!#Ox#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!#VT&n`&aZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To!#oe&n`&YS%uZOr%Trs!%Qsw%Twx!&px!Q%T!Q![JU![!c%T!c!tJU!t!u!(`!u!}JU!}#R%T#R#SJU#S#T%T#T#fJU#f#g!(`#g#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUk!%XV&n`&dZOr%Trs!%ns#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!%sV&n`Or%Trs!&Ys#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!&aT&n`&fZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!&wV&n`&cZOw%Twx!'^x#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!'cV&n`Ow%Twx!'xx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!(PT&n`&eZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To!(ia&n`&YS%uZOr%Trs!)nsw%Twx!+^x!Q%T!Q![JU![!c%T!c!}JU!}#R%T#R#SJU#S#T%T#T#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUk!)uV&n`&hZOr%Trs!*[s#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!*aV&n`Or%Trs!*vs#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!*}T&n`&jZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!+eV&n`&gZOw%Twx!+zx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!,PV&n`Ow%Twx!,fx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!,mT&n`&iZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To!-Vi&n`&YS%uZOr%TrsNWsw%Twx! vx!Q%T!Q![JU![!c%T!c!dJU!d!eLx!e!hJU!h!i!(`!i!}JU!}#R%T#R#SJU#S#T%T#T#UJU#U#VLx#V#YJU#Y#Z!(`#Z#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUo!.}a&n`&YS%uZOr%Trs)Ysw%Twx.Ux!Q%T!Q![JU![!c%T!c!}JU!}#R%T#R#SJU#S#T%T#T#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUk!0ZT!XZ&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc!0qT!WR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tj!1XV%kQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%T~!1sO!]~k!1zV%jR&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%T~!2fO![~i!2mT%tX&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%T",tokenizers:[U6e,N6e,z6e,H6e,0,1,2,3,4],topRules:{Script:[0,5]},specialized:[{term:221,get:n=>W6e[n]||-1}],tokenPrec:7675});function wI(n){let e=Object.keys(n).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function G6e(n){let e=Object.create(null),t=Object.create(null);for(let{label:i}of n){e[i[0]]=!0;for(let s=1;s<i.length;s++)t[i[s]]=!0}let r=wI(e)+wI(t)+"*$";return[new RegExp("^"+r),new RegExp(r)]}function X6e(n){let e=n.map(i=>typeof i=="string"?{label:i}:i),[t,r]=e.every(i=>/^\w+$/.test(i.label))?[/\w*$/,/\w+$/]:G6e(e);return i=>{let s=i.matchBefore(r);return s||i.explicit?{from:s?s.from:i.pos,options:e,validFor:t}:null}}function K6e(n,e){return t=>{for(let r=cs(t.state).resolveInner(t.pos,-1);r;r=r.parent){if(n.indexOf(r.name)>-1)return null;if(r.type.isTop)break}return e(t)}}const Y6e=zo.define(),Z6e=Ne.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'""',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"''"}},".cm-completionIcon-class":{"&:after":{content:"''"}},".cm-completionIcon-interface":{"&:after":{content:"''"}},".cm-completionIcon-variable":{"&:after":{content:"''"}},".cm-completionIcon-constant":{"&:after":{content:"''"}},".cm-completionIcon-type":{"&:after":{content:"''"}},".cm-completionIcon-enum":{"&:after":{content:"''"}},".cm-completionIcon-property":{"&:after":{content:"''"}},".cm-completionIcon-keyword":{"&:after":{content:"''"}},".cm-completionIcon-namespace":{"&:after":{content:"''"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class J6e{constructor(e,t,r,i){this.field=e,this.line=t,this.from=r,this.to=i}}class nk{constructor(e,t,r){this.field=e,this.from=t,this.to=r}map(e){let t=e.mapPos(this.from,-1,Cr.TrackDel),r=e.mapPos(this.to,1,Cr.TrackDel);return t==null||r==null?null:new nk(this.field,t,r)}}class rk{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let r=[],i=[t],s=e.doc.lineAt(t),o=/^\s*/.exec(s.text)[0];for(let l of this.lines){if(r.length){let c=o,u=/^\t*/.exec(l)[0].length;for(let d=0;d<u;d++)c+=e.facet(IS);i.push(t+c.length-u),l=c+l.slice(u)}r.push(l),t+=l.length+1}let a=this.fieldPositions.map(l=>new nk(l.field,i[l.line]+l.from,i[l.line]+l.to));return{text:r,ranges:a}}static parse(e){let t=[],r=[],i=[],s;for(let o of e.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(o);){let a=s[1]?+s[1]:null,l=s[2]||s[3]||"",c=-1,u=l.replace(/\\[{}]/g,d=>d[1]);for(let d=0;d<t.length;d++)(a!=null?t[d].seq==a:u&&t[d].name==u)&&(c=d);if(c<0){let d=0;for(;d<t.length&&(a==null||t[d].seq!=null&&t[d].seq<a);)d++;t.splice(d,0,{seq:a,name:u}),c=d;for(let h of i)h.field>=c&&h.field++}i.push(new J6e(c,r.length,s.index,s.index+u.length)),o=o.slice(0,s.index)+l+o.slice(s.index+s[0].length)}o=o.replace(/\\([{}])/g,(a,l,c)=>{for(let u of i)u.line==r.length&&u.from>c&&(u.from--,u.to--);return l}),r.push(o)}return new rk(r,i)}}let eOe=on.widget({widget:new class extends TS{toDOM(){let n=document.createElement("span");return n.className="cm-snippetFieldPosition",n}ignoreEvent(){return!1}}}),tOe=on.mark({class:"cm-snippetField"});class lh{constructor(e,t){this.ranges=e,this.active=t,this.deco=on.set(e.map(r=>(r.from==r.to?eOe:tOe).range(r.from,r.to)))}map(e){let t=[];for(let r of this.ranges){let i=r.map(e);if(!i)return null;t.push(i)}return new lh(t,this.active)}selectionInsideField(e){return e.ranges.every(t=>this.ranges.some(r=>r.field==this.active&&r.from<=t.from&&r.to>=t.to))}}const w0=Ft.define({map(n,e){return n&&n.map(e)}}),nOe=Ft.define(),Lp=Bs.define({create(){return null},update(n,e){for(let t of e.effects){if(t.is(w0))return t.value;if(t.is(nOe)&&n)return new lh(n.ranges,t.value)}return n&&e.docChanged&&(n=n.map(e.changes)),n&&e.selection&&!n.selectionInsideField(e.selection)&&(n=null),n},provide:n=>Ne.decorations.from(n,e=>e?e.deco:on.none)});function ik(n,e){return ce.create(n.filter(t=>t.field==e).map(t=>ce.range(t.from,t.to)))}function rOe(n){let e=rk.parse(n);return(t,r,i,s)=>{let{text:o,ranges:a}=e.instantiate(t.state,i),{main:l}=t.state.selection,c={changes:{from:i,to:s==l.from?l.to:s,insert:rt.of(o)},scrollIntoView:!0,annotations:r?[Y6e.of(r),yn.userEvent.of("input.complete")]:void 0};if(a.length&&(c.selection=ik(a,0)),a.some(u=>u.field>0)){let u=new lh(a,0),d=c.effects=[w0.of(u)];t.state.field(Lp,!1)===void 0&&d.push(Ft.appendConfig.of([Lp,lOe,cOe,Z6e]))}t.dispatch(t.state.update(c))}}function $H(n){return({state:e,dispatch:t})=>{let r=e.field(Lp,!1);if(!r||n<0&&r.active==0)return!1;let i=r.active+n,s=n>0&&!r.ranges.some(o=>o.field==i+n);return t(e.update({selection:ik(r.ranges,i),effects:w0.of(s?null:new lh(r.ranges,i)),scrollIntoView:!0})),!0}}const iOe=({state:n,dispatch:e})=>n.field(Lp,!1)?(e(n.update({effects:w0.of(null)})),!0):!1,sOe=$H(1),oOe=$H(-1),aOe=[{key:"Tab",run:sOe,shift:oOe},{key:"Escape",run:iOe}],bI=Ie.define({combine(n){return n.length?n[0]:aOe}}),lOe=bS.highest(q7.compute([bI],n=>n.facet(bI)));function Ho(n,e){return Object.assign(Object.assign({},e),{apply:rOe(n)})}const cOe=Ne.domEventHandlers({mousedown(n,e){let t=e.state.field(Lp,!1),r;if(!t||(r=e.posAtCoords({x:n.clientX,y:n.clientY}))==null)return!1;let i=t.ranges.find(s=>s.from<=r&&s.to>=r);return!i||i.field==t.active?!1:(e.dispatch({selection:ik(t.ranges,i.field),effects:w0.of(t.ranges.some(s=>s.field>i.field)?new lh(t.ranges,i.field):null),scrollIntoView:!0}),!0)}}),FH=new class extends Yc{};FH.startSide=1;FH.endSide=-1;const OI=new S4e,BH=new Set(["Script","Body","FunctionDefinition","ClassDefinition","LambdaExpression","ForStatement","MatchClause"]);function cm(n){return(e,t,r)=>{if(r)return!1;let i=e.node.getChild("VariableName");return i&&t(i,n),!0}}const uOe={FunctionDefinition:cm("function"),ClassDefinition:cm("class"),ForStatement(n,e,t){if(t){for(let r=n.node.firstChild;r;r=r.nextSibling)if(r.name=="VariableName")e(r,"variable");else if(r.name=="in")break}},ImportStatement(n,e){var t,r;let{node:i}=n,s=((t=i.firstChild)===null||t===void 0?void 0:t.name)=="from";for(let o=i.getChild("import");o;o=o.nextSibling)o.name=="VariableName"&&((r=o.nextSibling)===null||r===void 0?void 0:r.name)!="as"&&e(o,s?"variable":"namespace")},AssignStatement(n,e){for(let t=n.node.firstChild;t;t=t.nextSibling)if(t.name=="VariableName")e(t,"variable");else if(t.name==":"||t.name=="AssignOp")break},ParamList(n,e){for(let t=null,r=n.node.firstChild;r;r=r.nextSibling)r.name=="VariableName"&&(!t||!/\*|AssignOp/.test(t.name))&&e(r,"variable"),t=r},CapturePattern:cm("variable"),AsPattern:cm("variable"),__proto__:null};function UH(n,e){let t=OI.get(e);if(t)return t;let r=[],i=!0;function s(o,a){let l=n.sliceString(o.from,o.to);r.push({label:l,type:a})}return e.cursor(kn.IncludeAnonymous).iterate(o=>{if(o.name){let a=uOe[o.name];if(a&&a(o,s,i)||!i&&BH.has(o.name))return!1;i=!1}else if(o.to-o.from>8192){for(let a of UH(n,o.node))r.push(a);return!1}}),OI.set(e,r),r}const kI=/^[\w\xa1-\uffff][\w\d\xa1-\uffff]*$/,HH=["String","FormatString","Comment","PropertyName"];function dOe(n){let e=cs(n.state).resolveInner(n.pos,-1);if(HH.indexOf(e.name)>-1)return null;let t=e.name=="VariableName"||e.to-e.from<20&&kI.test(n.state.sliceDoc(e.from,e.to));if(!t&&!n.explicit)return null;let r=[];for(let i=e;i;i=i.parent)BH.has(i.name)&&(r=r.concat(UH(n.state.doc,i)));return{options:r,from:t?e.from:n.pos,validFor:kI}}const hOe=["__annotations__","__builtins__","__debug__","__doc__","__import__","__name__","__loader__","__package__","__spec__","False","None","True"].map(n=>({label:n,type:"constant"})).concat(["ArithmeticError","AssertionError","AttributeError","BaseException","BlockingIOError","BrokenPipeError","BufferError","BytesWarning","ChildProcessError","ConnectionAbortedError","ConnectionError","ConnectionRefusedError","ConnectionResetError","DeprecationWarning","EOFError","Ellipsis","EncodingWarning","EnvironmentError","Exception","FileExistsError","FileNotFoundError","FloatingPointError","FutureWarning","GeneratorExit","IOError","ImportError","ImportWarning","IndentationError","IndexError","InterruptedError","IsADirectoryError","KeyError","KeyboardInterrupt","LookupError","MemoryError","ModuleNotFoundError","NameError","NotADirectoryError","NotImplemented","NotImplementedError","OSError","OverflowError","PendingDeprecationWarning","PermissionError","ProcessLookupError","RecursionError","ReferenceError","ResourceWarning","RuntimeError","RuntimeWarning","StopAsyncIteration","StopIteration","SyntaxError","SyntaxWarning","SystemError","SystemExit","TabError","TimeoutError","TypeError","UnboundLocalError","UnicodeDecodeError","UnicodeEncodeError","UnicodeError","UnicodeTranslateError","UnicodeWarning","UserWarning","ValueError","Warning","ZeroDivisionError"].map(n=>({label:n,type:"type"}))).concat(["bool","bytearray","bytes","classmethod","complex","float","frozenset","int","list","map","memoryview","object","range","set","staticmethod","str","super","tuple","type"].map(n=>({label:n,type:"class"}))).concat(["abs","aiter","all","anext","any","ascii","bin","breakpoint","callable","chr","compile","delattr","dict","dir","divmod","enumerate","eval","exec","exit","filter","format","getattr","globals","hasattr","hash","help","hex","id","input","isinstance","issubclass","iter","len","license","locals","max","min","next","oct","open","ord","pow","print","property","quit","repr","reversed","round","setattr","slice","sorted","sum","vars","zip"].map(n=>({label:n,type:"function"}))),fOe=[Ho("def ${name}(${params}):\n	${}",{label:"def",detail:"function",type:"keyword"}),Ho("for ${name} in ${collection}:\n	${}",{label:"for",detail:"loop",type:"keyword"}),Ho("while ${}:\n	${}",{label:"while",detail:"loop",type:"keyword"}),Ho("try:\n	${}\nexcept ${error}:\n	${}",{label:"try",detail:"/ except block",type:"keyword"}),Ho(`if \${}:
	
`,{label:"if",detail:"block",type:"keyword"}),Ho("if ${}:\n	${}\nelse:\n	${}",{label:"if",detail:"/ else block",type:"keyword"}),Ho("class ${name}:\n	def __init__(self, ${params}):\n			${}",{label:"class",detail:"definition",type:"keyword"}),Ho("import ${module}",{label:"import",detail:"statement",type:"keyword"}),Ho("from ${module} import ${names}",{label:"from",detail:"import",type:"keyword"})],pOe=K6e(HH,X6e(hOe.concat(fOe)));function vw(n){let{node:e,pos:t}=n,r=n.lineIndent(t,-1),i=null;for(;;){let s=e.childBefore(t);if(s)if(s.name=="Comment")t=s.from;else if(s.name=="Body"||s.name=="MatchBody")n.baseIndentFor(s)+n.unit<=r&&(i=s),e=s;else if(s.name=="MatchClause")e=s;else if(s.type.is("Statement"))e=s;else break;else break}return i}function Sw(n,e){let t=n.baseIndentFor(e),r=n.lineAt(n.pos,-1),i=r.from+r.text.length;return/^\s*($|#)/.test(r.text)&&n.node.to<i+100&&!/\S/.test(n.state.sliceDoc(i,n.node.to))&&n.lineIndent(n.pos,-1)<=t||/^\s*(else:|elif |except |finally:|case\s+[^=:]+:)/.test(n.textAfter)&&n.lineIndent(n.pos,-1)>t?null:t+n.unit}const xw=qy.define({name:"python",parser:V6e.configure({props:[ZU.add({Body:n=>{var e;let t=vw(n);return(e=Sw(n,t||n.node))!==null&&e!==void 0?e:n.continue()},MatchBody:n=>{var e;let t=vw(n);return(e=Sw(n,t||n.node))!==null&&e!==void 0?e:n.continue()},IfStatement:n=>/^\s*(else:|elif )/.test(n.textAfter)?n.baseIndent:n.continue(),"ForStatement WhileStatement":n=>/^\s*else:/.test(n.textAfter)?n.baseIndent:n.continue(),TryStatement:n=>/^\s*(except |finally:|else:)/.test(n.textAfter)?n.baseIndent:n.continue(),MatchStatement:n=>/^\s*case /.test(n.textAfter)?n.baseIndent+n.unit:n.continue(),"TupleExpression ComprehensionExpression ParamList ArgList ParenthesizedExpression":cw({closing:")"}),"DictionaryExpression DictionaryComprehensionExpression SetExpression SetComprehensionExpression":cw({closing:"}"}),"ArrayExpression ArrayComprehensionExpression":cw({closing:"]"}),"String FormatString":()=>null,Script:n=>{var e;let t=vw(n);return(e=t&&Sw(n,t))!==null&&e!==void 0?e:n.continue()}}),B4e.add({"ArrayExpression DictionaryExpression SetExpression TupleExpression":U4e,Body:(n,e)=>({from:n.from+1,to:n.to-(n.to==e.doc.length?0:1)})})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"'''",'"""'],stringPrefixes:["f","fr","rf","r","u","b","br","rb","F","FR","RF","R","U","B","BR","RB"]},commentTokens:{line:"#"},indentOnInput:/^\s*([\}\]\)]|else:|elif |except |finally:|case\s+[^:]*:?)$/}});function gOe(){return new R4e(xw,[xw.data.of({autocomplete:dOe}),xw.data.of({autocomplete:pOe})])}class mOe{constructor(){this.requestID=0}getRequestID(){return this.requestID++}getSyntaxHighlighter(){return null}}class yOe extends mOe{constructor(){super(...arguments),this.worker=new Worker(new URL("/assets/worker-Sfvkc3nO.js",import.meta.url))}run(e,t){const r=this.getRequestID();return new Promise(i=>{const s=o=>{o.data.requestID==r&&(o.data.kind==="run-code-output"?t(o.data.output):o.data.kind==="run-code-done"&&(this.worker.removeEventListener("message",s),i()))};this.worker.addEventListener("message",s),this.worker.postMessage({kind:"run-code",code:e,requestID:r})})}getSyntaxHighlighter(){return gOe()}}class vOe extends k.Component{constructor(e){super(e),this.codeMirror=null,this.editor=k.createRef(),this.outputRef=k.createRef(),this.events=new EventTarget,this.kernel=new yOe,this.state={kind:"ready",output:[]},this.running=!1,this.mounted=!1,this.editing=!!e.editing,console.log("editing?",this.editing),this.events.addEventListener("worker-restarted",()=>{this.setState({kind:"ready",output:[]})}),this.toggleReadOnly=Ft.define(),this.readOnlyField=Bs.define({create(){return!0},update:(t,r)=>(console.log("returning passed in value for update",t),!this.props.editing),provide:t=>ft.readOnly.from(t,r=>r)})}render(){return f.jsx("div",{className:"cell-editor",children:f.jsxs("div",{style:{height:"auto",overflowY:"hidden",opacity:"1",transition:"opacity 0.2s ease 0s"},children:[f.jsx("div",{ref:this.editor}),this.state.output.length>0?f.jsx("div",{children:f.jsx("pre",{ref:this.outputRef,className:"snippet-output",children:this.state.output.map((e,t)=>f.jsx("div",{className:"output-"+e.type,children:e.line},t))})}):null,f.jsxs("div",{className:"run-bar run-bar-"+(this.state.kind==="running"?"running":"ready"),onClick:()=>this.run(this.codeMirror.state.doc.toString()),onPointerDown:e=>e.stopPropagation(),children:[this.state.kind==="ready"?f.jsxs("div",{children:[f.jsx("i",{className:"fa-solid fa-play"})," RUN"]}):null,this.state.kind==="re-runnable"?f.jsxs("div",{children:[f.jsx("i",{className:"fa-solid fa-arrows-rotate"})," RE-RUN"]}):null,this.state.kind==="running"?f.jsx("img",{style:{height:"0.8em",margin:"0px"},src:"three-dots.svg"}):null]})]})})}componentDidMount(){this.mounted=!0;const e=[u5e(),h4e(),T3e,m3e(),q7.of([...h3e,...S5e]),this.readOnlyField],t=this.kernel.getSyntaxHighlighter();if(t&&e.push(t),this.props.onUpdate){let r=Ne.updateListener.of(this.props.onUpdate);e.push(r)}this.codeMirror=new Ne({parent:this.editor.current,doc:this.props.code,extensions:e}),this.props.onMount&&this.props.onMount()}componentDidUpdate(e,t){var i;if(this.state.output.length>t.output.length&&(this.outputRef.current.scrollTop=this.outputRef.current.scrollHeight),this.props.editing!=e.editing&&(console.log("toggle editing, readonly?",!this.props.editing),(i=this.codeMirror)==null||i.dispatch({effects:[this.toggleReadOnly.of(!this.props.editing)]})),!this.codeMirror)return;AH(this.codeMirror.state)!=this.props.version&&this.codeMirror.state.doc.toString()!=this.props.code&&this.codeMirror.dispatch({changes:{from:0,to:this.codeMirror.state.doc.length,insert:this.props.code}})}async run(e){if(console.log("code already running?",!!this.running),this.running)return;console.log("Running snippet..."),this.running=!0,this.mounted?this.setState({kind:"running",output:[]}):(this.state.kind="running",this.state.output=[]);const t=new Promise((r,i)=>{setTimeout(()=>r(),500)});await this.kernel.run(e,r=>{this.setState(i=>({output:[...i.output,r]}))}),await t,console.log("ran some code",this.state.output),this.running=!1,this.setState({kind:"re-runnable"}),this.state.output.length===0&&this.setState({output:[{type:"log",line:"Done."}]})}}const rv=class rv extends Ti{constructor(){super(...arguments),this.canEdit=()=>!0,this.canResize=()=>!1,this.isAspectRatioLocked=()=>!1,this.onResize=(e,t)=>i0(e,t)}getDefaultProps(){return{w:700,h:80,text:'print("hello world")',version:""}}getGeometry(e){return new As({width:e.props.w,height:e.props.h,isFilled:!0})}component(e){const t=this.editor.getEditingShapeId()===e.id;console.log("code shape component call",e);let r=Qe.createRef();const i=s=>{var o,a,l,c,u;if(console.log("updateHandler called"),s.docChanged){console.log("update",s),console.log("outerDiv",r.current),console.log("height",(o=s.view.dom)==null?void 0:o.clientHeight);const d={text:s.state.doc.toString(),version:AH(s.state)};(a=s.view.dom)!=null&&a.clientWidth&&((l=s.view.dom)!=null&&l.clientHeight)&&(d.w=(c=s.view.dom)==null?void 0:c.clientWidth,d.h=(u=s.view.dom)==null?void 0:u.clientHeight),this.editor.updateShape({id:e.id,type:e.type,props:d})}};return f.jsx(Oa,{id:e.id,style:{pointerEvents:"all"},children:f.jsx("div",{className:t?"editing-codeblock":"",children:f.jsx(vOe,{code:e.props.text,editing:t,version:e.props.version,onUpdate:i})})})}indicator(e){const r=this.editor.getEditingShapeId()===e.id?"#ED9C31":"";return f.jsx("rect",{width:e.props.w,height:e.props.h,stroke:r})}};rv.type="code",rv.props=Y2e;let K5=rv;const sk=location.origin;console.log("host",sk);const SOe={async upload(n,e){const r=`${wt()}-${e.name}`,i=`${sk}/uploads/${encodeURIComponent(r)}`,s=await fetch(i,{method:"PUT",body:e});if(!s.ok)throw new Error(`Failed to upload asset: ${s.statusText}`);let o=await s.json();return o&&o.publicUrl?(console.log("got a public url from server",o.publicUrl),o.publicUrl):(console.log("no public url",s),i)},resolve(n){return console.log("resolve asset",n.props),n.props.src}};function xOe(n){let e=n.roomId;if(!e||e<1)return null;const t=()=>f.jsxs(J$,{children:[f.jsx(Z$,{}),f.jsx("div",{style:{backgroundColor:"thistle"},children:f.jsx($e,{id:"example",children:f.jsx(Z,{id:"goBack",label:"Go back",icon:"arrow-left",readonlyOk:!0,onSelect:()=>{console.log("go back click"),n.handler(0)}})})})]}),r={icons:{"sigma-icon":"sigma.svg","python-icon":"python.svg"}},i={MainMenu:t,...GSe},s=[i5,K5],o=[G4,s5],a=k.useRef([...dO,...s]),l=qSe({uri:`${sk}/connect/${e}`,assets:SOe,shapeUtils:a.current});return f.jsx("div",{style:{position:"fixed",inset:0},children:f.jsx(bSe,{assetUrls:r,components:i,overrides:VSe,shapeUtils:s,store:l,tools:o})})}function wOe(n){const e=`${n.host}/list`,[t,r]=k.useState([]),[i,s]=k.useState(!0),[o,a]=k.useState(null),l=n.handler;return k.useEffect(()=>{(async()=>{try{const u=await fetch(e);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const d=await u.json();r(d.records)}catch(u){a(u)}finally{s(!1)}})()},[]),i?f.jsx("p",{children:"Loading records..."}):o?f.jsxs("p",{children:["Error: ",o.message]}):f.jsx("div",{className:"board-list",children:t.map(c=>f.jsx("div",{className:"list-entry",onClick:()=>l(c.jam_id),children:f.jsx("span",{children:c.title})},c.jam_id))})}const CI=location.origin;class i7e extends Qe.Component{constructor(e){super(e),this.state={inputValue:""},this.handler=e.handler}reset(){this.state={inputValue:""}}updateValue(e){this.setState({inputValue:e.target.value})}handleClick(){this.handler(Number(this.state.inputValue))}render(){return f.jsxs("div",{children:[f.jsx("div",{children:" Room ID: "}),f.jsx("input",{value:this.state.inputValue,onChange:this.updateValue.bind(this)}),f.jsx("button",{onClick:this.handleClick.bind(this),children:"confirm"})]})}}function bOe(n){const[e,t]=k.useState(""),r=i=>{i.preventDefault(),e&&(alert(`Creating new board: ${e}`),n.handler(e),t(""))};return f.jsxs("form",{onSubmit:r,children:[f.jsx("div",{children:"Enter title for new board:"}),f.jsx("br",{}),f.jsx("input",{type:"text",value:e,onChange:i=>t(i.target.value)}),f.jsx("input",{type:"submit"})]})}class OOe extends Qe.Component{constructor(e){super(e),this.state={currentRoom:0,updateKey:wt()}}async newRoom(e){if(!e)return;const t=`${CI}/new`;try{const r={method:"PUT",body:JSON.stringify({title:e})},i=await fetch(t,r);if(!i.ok)throw new Error(`new room HTTP error! status: ${i.status}`);setTimeout(()=>this.refresh(),100)}catch(r){console.log("new room error",r)}}refresh(){const e={currentRoom:this.state.currentRoom,updateKey:wt()};this.setState(e)}changeRoom(e){this.setState({currentRoom:e})}reset(){this.state={currentRoom:0,updateKey:wt()}}render(){return this.state.currentRoom<1?f.jsxs("div",{className:"homepage",children:[f.jsx("h1",{children:"Sketchboard"}),f.jsx("div",{className:"new-board",children:f.jsx(bOe,{handler:this.newRoom.bind(this)})}),f.jsx(wOe,{handler:this.changeRoom.bind(this),host:CI},this.state.updateKey)]}):f.jsx(xOe,{handler:this.changeRoom.bind(this),roomId:this.state.currentRoom})}}Bw.createRoot(document.getElementById("root")).render(f.jsx(Qe.StrictMode,{children:f.jsx(OOe,{})}));
